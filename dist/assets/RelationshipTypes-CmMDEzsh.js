import{u as O,j as e,L as V,c as $,r as a,b as C}from"./vendor-CjdX6t1i.js";import{c as F,H,P as X,X as L,w as v}from"./main-D6r1FXj6.js";import{S as Y}from"./shield-alert-D6-jVMFX.js";import{T as Z}from"./trash-2-GMOh3z4B.js";import{R as G}from"./rotate-ccw-DxI9kbTe.js";import"./utils-D5Yy9kBW.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=F("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=F("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);function D({value:c,onChange:T,relationshipTypes:R,currentTypeId:h=null}){const[u,x]=a.useState(""),[y,r]=a.useState(!1),d=a.useRef(null),f=a.useRef(null),l=a.useMemo(()=>R.sort((s,o)=>{const p=(s.name||"").toLowerCase(),S=(o.name||"").toLowerCase();return p<S?-1:p>S?1:0}),[R]),g=a.useMemo(()=>{if(!u)return l.slice(0,10);const s=u.toLowerCase();return l.filter(o=>(o.name||"").toLowerCase().includes(s)).slice(0,10)},[l,u]),m=a.useMemo(()=>l.find(s=>s.id===parseInt(c,10)),[l,c]);a.useEffect(()=>{const s=o=>{f.current&&!f.current.contains(o.target)&&d.current&&!d.current.contains(o.target)&&r(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const j=s=>{T(s?s.toString():""),x(""),r(!1)},N=()=>{T(""),x(""),r(!1)},w=m?m.name:"";return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:m&&!y?e.jsxs("div",{className:"flex items-center justify-between input pr-8 cursor-text",onClick:()=>r(!0),children:[e.jsx("span",{children:w}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),N()},className:"absolute right-2 text-gray-400 hover:text-gray-600",children:e.jsx(L,{className:"w-4 h-4"})})]}):e.jsx("input",{ref:d,type:"text",value:u,onChange:s=>{x(s.target.value),r(!0)},onFocus:()=>r(!0),placeholder:"Search for a relationship type...",className:"input"})}),y&&(u||!m)&&e.jsx("div",{ref:f,className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:g.length>0?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>j(null),className:`w-full text-left px-4 py-2 hover:bg-gray-50 ${c?"":"bg-primary-50"}`,children:e.jsx("span",{className:"text-gray-500 italic",children:"None (no inverse)"})}),g.map(s=>e.jsx("button",{type:"button",onClick:()=>j(s.id),className:`w-full text-left px-4 py-2 hover:bg-gray-50 ${c===s.id.toString()?"bg-primary-50":""}`,children:s.name},s.id))]}):e.jsx("p",{className:"px-4 py-2 text-gray-500 text-sm",children:"No relationship types found"})})]})}function ae(){H("Relationship Types - Settings");const c=O();if(!((window.prmConfig||{}).isAdmin||!1))return e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(Y,{className:"w-16 h-16 mx-auto text-amber-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You don't have permission to manage relationship types. This feature is only available to administrators."}),e.jsx(V,{to:"/settings",className:"btn-primary",children:"Back to Settings"})]})});const{data:h=[],isLoading:u}=$({queryKey:["relationship-types"],queryFn:async()=>(await v.getRelationshipTypes()).data}),[x,y]=a.useState(null),[r,d]=a.useState(""),[f,l]=a.useState(""),[g,m]=a.useState(""),[j,N]=a.useState(""),[w,s]=a.useState(!1),o=C({mutationFn:async({id:t,name:i,inverseId:n})=>{const b={name:i};return n&&(b.acf={inverse_relationship_type:parseInt(n,10)}),v.updateRelationshipType(t,b)},onSuccess:()=>{c.invalidateQueries({queryKey:["relationship-types"]}),y(null),d(""),l("")}}),p=C({mutationFn:async({name:t,inverseId:i})=>{const n={name:t};return i&&(n.acf={inverse_relationship_type:parseInt(i,10)}),v.createRelationshipType(n)},onSuccess:()=>{c.invalidateQueries({queryKey:["relationship-types"]}),m(""),N(""),s(!1)}}),S=C({mutationFn:t=>v.deleteRelationshipType(t),onSuccess:()=>{c.invalidateQueries({queryKey:["relationship-types"]})}}),k=C({mutationFn:()=>v.restoreRelationshipTypeDefaults(),onSuccess:()=>{c.invalidateQueries({queryKey:["relationship-types"]}),alert("Default relationship type configurations have been restored.")},onError:()=>{alert("Failed to restore defaults. Please try again.")}});function M(){return e.jsxs("button",{onClick:()=>{window.confirm("This will restore all default inverse mappings and gender-dependent settings. Continue?")&&k.mutate()},disabled:k.isPending,className:"btn-secondary flex items-center gap-2",title:"Restore default inverse mappings and gender-dependent settings",children:[k.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}):e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Restore Defaults"})]})}const _=t=>{var n;y(t.id),d(t.name);const i=(n=t.acf)==null?void 0:n.inverse_relationship_type;l(i?i.toString():"")},Q=()=>{y(null),d(""),l("")},K=()=>{if(!r.trim()){alert("Name is required");return}o.mutate({id:x,name:r.trim(),inverseId:f||null})},z=()=>{if(!g.trim()){alert("Name is required");return}p.mutate({name:g.trim(),inverseId:j||null})},B=(t,i)=>{window.confirm(`Are you sure you want to delete "${i}"? This cannot be undone.`)&&S.mutate(t)};return u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):e.jsx("div",{className:"max-w-4xl mx-auto space-y-6",children:e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Relationship Types"}),e.jsx("div",{className:"flex gap-2",children:!w&&e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsxs("button",{onClick:()=>s(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Add Relationship Type"})]})]})})]}),w&&e.jsxs("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Add New Relationship Type"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{type:"text",value:g,onChange:t=>m(t.target.value),className:"input",placeholder:"e.g., Parent, Spouse, Colleague"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Inverse Relationship Type"}),e.jsx(D,{value:j,onChange:N,relationshipTypes:h}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Select the inverse relationship type. For example, if this is "Parent", select "Child". If this is "Spouse" or "Acquaintance", select the same type (e.g., "Spouse" → "Spouse").'})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:z,disabled:p.isPending,className:"btn-primary flex items-center gap-2",children:[p.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Save"})]}),e.jsx("button",{onClick:()=>{s(!1),m(""),N("")},className:"btn-secondary",children:"Cancel"})]})]})]}),e.jsx("div",{className:"space-y-2",children:h.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No relationship types found."}):h.map(t=>{var A,q;const i=x===t.id,n=(A=t.acf)==null?void 0:A.inverse_relationship_type,b=typeof n=="object"&&(n!=null&&n.ID)?n.ID:typeof n=="object"&&(n!=null&&n.id)?n.id:n,I=b?h.find(P=>P.id===b):null;return e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50",children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name *"}),e.jsx("input",{type:"text",value:r,onChange:P=>d(P.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Inverse Relationship Type"}),e.jsx(D,{value:f,onChange:l,relationshipTypes:h,currentTypeId:t.id}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Select the inverse relationship type. For example, if this is "Parent", select "Child". If this is "Spouse" or "Acquaintance", select the same type (e.g., "Spouse" → "Spouse").'})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:K,disabled:o.isPending,className:"btn-primary flex items-center gap-2",children:[o.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Save"})]}),e.jsxs("button",{onClick:Q,className:"btn-secondary flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Cancel"})]})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:t.name}),I&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Inverse: ",e.jsx("span",{className:"font-medium",children:I.name})]}),!I&&((q=t.acf)==null?void 0:q.inverse_relationship_type)===null&&e.jsx("div",{className:"text-sm text-gray-400 mt-1 italic",children:"No inverse relationship"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_(t),className:"p-2 text-gray-600 hover:text-primary-600 hover:bg-primary-50 rounded",title:"Edit",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(t.id,t.name),className:"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded",title:"Delete",children:e.jsx(Z,{className:"w-4 h-4"})})]})]})},t.id)})})]})})}export{ae as default};
