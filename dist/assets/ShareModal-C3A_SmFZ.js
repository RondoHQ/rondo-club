import{c as u,p as d,X as P,Q as M}from"./main-D6r1FXj6.js";import{c as f,u as j,b,r as c,j as e}from"./vendor-CjdX6t1i.js";import{U as L}from"./user-plus-B27X-obe.js";import{T as Q}from"./trash-2-GMOh3z4B.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=u("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=u("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=u("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);function A(a,r){return f({queryKey:["shares",a,r],queryFn:async()=>(await d.getPostShares(r,a)).data,enabled:!!r})}function R(){const a=j();return b({mutationFn:async({postType:r,postId:t,userId:n,permission:o})=>(await d.sharePost(t,r,{user_id:n,permission:o})).data,onSuccess:(r,{postType:t,postId:n})=>{a.invalidateQueries({queryKey:["shares",t,n]})}})}function q(){const a=j();return b({mutationFn:async({postType:r,postId:t,userId:n})=>{await d.unsharePost(t,r,n)},onSuccess:(r,{postType:t,postId:n})=>{a.invalidateQueries({queryKey:["shares",t,n]})}})}function U(a){return f({queryKey:["users","search",a],queryFn:async()=>(await d.searchUsers(a)).data,enabled:(a==null?void 0:a.length)>=2})}function V({isOpen:a,onClose:r,postType:t,postId:n,postTitle:o}){const[i,m]=c.useState(""),[x,N]=c.useState("view"),h=c.useRef(null),{data:l=[],isLoading:w}=A(t,n),{data:y=[],isLoading:S}=U(i),g=R(),v=q();c.useEffect(()=>{a&&(m(""),setTimeout(()=>{var s;return(s=h.current)==null?void 0:s.focus()},100))},[a]);const p=y.filter(s=>!l.some(_=>_.user_id===s.id)),k=async s=>{await g.mutateAsync({postType:t,postId:n,userId:s.id,permission:x}),m("")},C=async s=>{await v.mutateAsync({postType:t,postId:n,userId:s})};return a?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:r}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Share"}),e.jsx("p",{className:"text-sm text-gray-500 truncate max-w-xs",children:o})]}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100",children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{ref:h,type:"text",value:i,onChange:s=>m(s.target.value),placeholder:"Search users by name or email...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Permission:"}),e.jsxs("select",{value:x,onChange:s=>N(s.target.value),className:"text-sm border border-gray-300 rounded-md px-2 py-1 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"view",children:"Can view"}),e.jsx("option",{value:"edit",children:"Can edit"})]})]}),i.length>=2&&e.jsx("div",{className:"mb-4",children:S?e.jsx("div",{className:"py-3 text-center text-sm text-gray-500",children:"Searching..."}):p.length===0?e.jsx("div",{className:"py-3 text-center text-sm text-gray-500",children:y.length===0?"No users found":"All matching users already have access"}):e.jsx("div",{className:"border border-gray-200 rounded-lg divide-y divide-gray-100",children:p.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 hover:bg-gray-50",children:[e.jsx("img",{src:s.avatar_url,alt:s.display_name,className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:s.display_name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:s.email})]}),e.jsx("button",{onClick:()=>k(s),disabled:g.isPending,className:"p-2 text-primary-600 hover:bg-primary-50 rounded-full",children:e.jsx(L,{className:"w-4 h-4"})})]},s.id))})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:["Shared with (",l.length,")"]}),w?e.jsx("div",{className:"py-3 text-center text-sm text-gray-500",children:"Loading..."}):l.length===0?e.jsx("div",{className:"py-6 text-center text-sm text-gray-500",children:"Not shared with anyone yet"}):e.jsx("div",{className:"border border-gray-200 rounded-lg divide-y divide-gray-100",children:l.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsx("img",{src:s.avatar_url,alt:s.display_name,className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:s.display_name}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Can ",s.permission]})]}),e.jsx("button",{onClick:()=>C(s.user_id),disabled:v.isPending,className:"p-2 text-red-600 hover:bg-red-50 rounded-full",children:e.jsx(Q,{className:"w-4 h-4"})})]},s.user_id))})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:r,className:"btn-secondary",children:"Done"})})]})})]}):null}export{G as C,H as G,D as S,V as a};
