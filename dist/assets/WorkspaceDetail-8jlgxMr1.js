import{r as x,j as e,m as U,e as $,L as M}from"./vendor-CjdX6t1i.js";import{c as j,a5 as T,X as V,a6 as L,a7 as P,a8 as F,a9 as q,aa as z,ab as B,C as D,k as O,p as H,U as X}from"./main-D6r1FXj6.js";import{u as G}from"./utils-D5Yy9kBW.js";import{M as J}from"./mail-DERmFBJJ.js";import{A as K}from"./arrow-left-C9KexAZo.js";import{U as I}from"./user-plus-B27X-obe.js";import{T as Q}from"./trash-2-GMOh3z4B.js";import{C as Y,E as Z}from"./eye-DamYVwHf.js";import{S as ee}from"./shield-znEaW7R6.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=j("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=j("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=j("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function re({isOpen:s,onClose:l,workspaceId:c,workspaceName:n}){var p,m,u;const a=T(),{register:i,handleSubmit:d,reset:o,formState:{errors:t}}=G({defaultValues:{email:"",role:"member"}});x.useEffect(()=>{s&&o({email:"",role:"member"})},[s,o]);const y=async h=>{await a.mutateAsync({workspaceId:c,email:h.email,role:h.role}),l()};return s?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:l}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-md bg-white rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Invite to Workspace"}),e.jsx("p",{className:"text-sm text-gray-500",children:n})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:d(y),children:[e.jsxs("div",{className:"px-6 py-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"email",...i("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email address"}}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"colleague@example.com"})]}),t.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),e.jsxs("select",{...i("role"),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"admin",children:"Admin - Can manage members and settings"}),e.jsx("option",{value:"member",children:"Member - Can view and edit contacts"}),e.jsx("option",{value:"viewer",children:"Viewer - Can only view contacts"})]})]}),a.isError&&e.jsx("p",{className:"text-sm text-red-600",children:((u=(m=(p=a.error)==null?void 0:p.response)==null?void 0:m.data)==null?void 0:u.message)||"Failed to send invitation"})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:a.isPending,className:"btn-primary",children:a.isPending?"Sending...":"Send Invitation"})]})]})]})})]}):null}function le({role:s,isOwner:l,small:c=!1}){if(l)return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 bg-yellow-100 text-yellow-800 rounded-full ${c?"text-xs":"text-sm"}`,children:[e.jsx(Y,{className:c?"w-3 h-3":"w-4 h-4"}),"Owner"]});const n={admin:{icon:ee,bg:"bg-purple-100",text:"text-purple-800",label:"Admin"},member:{icon:X,bg:"bg-blue-100",text:"text-blue-800",label:"Member"},viewer:{icon:Z,bg:"bg-gray-100",text:"text-gray-600",label:"Viewer"}},a=n[s]||n.member,i=a.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 ${a.bg} ${a.text} rounded-full ${c?"text-xs":"text-sm"}`,children:[e.jsx(i,{className:c?"w-3 h-3":"w-4 h-4"}),a.label]})}function ie({member:s,currentUserRole:l,onRemove:c,onChangeRole:n}){const[a,i]=x.useState(!1),d=l==="admin"||l==="owner",o=s.is_owner;return e.jsxs("div",{className:"flex items-center gap-3 p-3 hover:bg-gray-50",children:[e.jsx("img",{src:s.avatar_url,alt:s.display_name,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.display_name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email})]}),e.jsx(le,{role:s.role,isOwner:s.is_owner,small:!0}),d&&!o&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>i(!a),className:"p-2 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100",children:e.jsx(ae,{className:"w-4 h-4"})}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0",onClick:()=>i(!1)}),e.jsx("div",{className:"absolute right-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsx("button",{onClick:()=>{n(s.user_id,"admin"),i(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50",children:"Make Admin"}),e.jsx("button",{onClick:()=>{n(s.user_id,"member"),i(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50",children:"Make Member"}),e.jsx("button",{onClick:()=>{n(s.user_id,"viewer"),i(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50",children:"Make Viewer"}),e.jsx("hr",{className:"my-1"}),e.jsxs("button",{onClick:()=>{c(s.user_id),i(!1)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Remove"]})]})})]})]})]})}function ne({invite:s,onRevoke:l}){return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(I,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.email}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Invited as ",s.role," Â· Expires ",new Date(s.expires_at).toLocaleDateString()]})]}),e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs rounded-full",children:"Pending"}),e.jsx("button",{onClick:()=>l(s.id),className:"p-2 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50",title:"Revoke invite",children:e.jsx(Q,{className:"w-4 h-4"})})]})}function ge(){var w,N,k,C;const{id:s}=U(),l=$(),[c,n]=x.useState(!1),[a,i]=x.useState(null),[d,o]=x.useState(!1),{data:t,isLoading:y,error:p}=L(s),{data:m=[]}=P(s),u=F(),h=q(),S=z();x.useEffect(()=>{(async()=>{try{const b=await H.getIcalUrl();i(b.data.token)}catch{}})()},[]);const g=a&&t?`${window.location.origin}/workspace/${t.id}/calendar/${a}.ics`:null,_=()=>{g&&(navigator.clipboard.writeText(g),o(!0),setTimeout(()=>o(!1),2e3))},R=async r=>{confirm("Remove this member from the workspace?")&&await u.mutateAsync({workspaceId:parseInt(s),userId:r})},A=async(r,b)=>{await h.mutateAsync({workspaceId:parseInt(s),userId:r,role:b})},E=async r=>{await S.mutateAsync({workspaceId:parseInt(s),inviteId:r})};if(y)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});if(p||!t)return e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("p",{className:"text-red-600",children:"Failed to load workspace."}),e.jsx(M,{to:"/workspaces",className:"text-primary-600 hover:underline mt-2 inline-block",children:"Back to Workspaces"})]});const f=(w=t.current_user)!=null&&w.is_owner?"owner":(N=t.current_user)==null?void 0:N.role,v=f==="admin"||f==="owner",W=(k=t.current_user)==null?void 0:k.is_owner;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>l("/workspaces"),className:"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 mb-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Back to Workspaces"]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:t.title}),t.description&&e.jsx("p",{className:"text-gray-500 mt-1",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary",children:[e.jsx(I,{className:"w-4 h-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Invite"})]}),W&&e.jsxs(M,{to:`/workspaces/${s}/settings`,className:"btn-secondary",children:[e.jsx(B,{className:"w-4 h-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Settings"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["Members (",t.member_count,")"]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:(C=t.members)==null?void 0:C.map(r=>e.jsx(ie,{member:r,currentUserRole:f,onRemove:R,onChangeRole:A},r.user_id))})]}),v&&m.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-medium text-gray-900",children:["Pending Invites (",m.length,")"]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:m.map(r=>e.jsx(ne,{invite:r,onRevoke:E},r.id))})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Calendar Subscription"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Subscribe to important dates for all contacts in this workspace."}),a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:g||"",readOnly:!0,className:"flex-1 text-xs px-2 py-1.5 bg-gray-50 border border-gray-300 rounded font-mono",onClick:r=>r.target.select()}),e.jsxs("button",{onClick:_,className:"px-3 py-1.5 text-xs bg-primary-600 text-white rounded hover:bg-primary-700 flex items-center gap-1",children:[d?e.jsx(O,{className:"w-3 h-3"}):e.jsx(se,{className:"w-3 h-3"}),d?"Copied!":"Copy"]})]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Enable iCal feed in Settings to subscribe to workspace calendars."})]}),e.jsx(re,{isOpen:c,onClose:()=>n(!1),workspaceId:parseInt(s),workspaceName:t.title})]})}export{ge as default};
