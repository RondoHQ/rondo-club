import{r as p,j as e,L as b}from"./vendor-CjdX6t1i.js";import{W as v,f as D,Y as w,P as j,C,J as M}from"./main-D6r1FXj6.js";import{f}from"./utils-D5Yy9kBW.js";function k({person:t,dateType:l}){var m;return e.jsx("div",{className:"flex items-center gap-3 py-2",children:e.jsxs(b,{to:`/people/${t.id}`,className:"flex items-center gap-3 flex-1 min-w-0 hover:opacity-80",children:[t.thumbnail?e.jsx("img",{src:t.thumbnail,alt:t.name,loading:"lazy",className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-medium text-gray-500",children:(m=t.name)==null?void 0:m[0]})}),e.jsx("span",{className:"font-medium truncate",children:t.name}),e.jsx("span",{className:"text-sm text-gray-500 capitalize flex-shrink-0",children:l})]})})}function L({dates:t}){const l=t[0],o=l.days_until===0?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600",a=[];return t.forEach(n=>{var c,x;const i=((c=n.date_type)==null?void 0:c[0])||"Date";((x=n.related_people)==null?void 0:x.length)>0?n.related_people.forEach(u=>{a.push({person:u,dateType:i})}):a.push({person:{id:null,name:n.title,thumbnail:null},dateType:i})}),e.jsx("div",{className:"card p-4 break-inside-avoid mb-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-14 h-14 rounded-lg ${o} flex items-center justify-center flex-shrink-0`,children:e.jsx("span",{className:"text-2xl font-bold leading-none",children:f(new Date(l.next_occurrence),"d")})}),e.jsx("div",{className:"flex-1 min-w-0 divide-y divide-gray-100",children:a.map(({person:n,dateType:i},c)=>e.jsx(k,{person:n,dateType:i},n.id?`${n.id}-${i}`:`${c}-${i}`))})]})})}function E(){const[t,l]=p.useState(!1),[m,o]=p.useState(!1),{data:a,isLoading:n,error:i}=v(365),{data:c=[],isLoading:x}=D(),u=w({onSuccess:()=>l(!1)}),y=async s=>{o(!0);try{await u.mutateAsync(s)}finally{o(!1)}},g=(a==null?void 0:a.reduce((s,d)=>{const r=f(new Date(d.next_occurrence),"yyyy-MM-dd");return s[r]||(s[r]=[]),s[r].push(d),s},{}))||{},N=Object.entries(g).reduce((s,[d,r])=>{const h=f(new Date(d),"MMMM yyyy");return s[h]||(s[h]=[]),s[h].push(r),s},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-gray-600",children:[(a==null?void 0:a.length)||0," upcoming dates"]}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary",children:[e.jsx(j,{className:"w-4 h-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Add date"})]})]}),n&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}),i&&e.jsx("div",{className:"card p-6 text-center",children:e.jsx("p",{className:"text-red-600",children:"Failed to load dates."})}),!n&&!i&&(a==null?void 0:a.length)===0&&e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx(C,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"No important dates"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add birthdays, anniversaries, and more."}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary",children:[e.jsx(j,{className:"w-4 h-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Add date"})]})]}),Object.entries(N).map(([s,d])=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-4",children:s}),e.jsx("div",{className:"columns-1 md:columns-2 lg:columns-3 gap-4",children:d.map(r=>e.jsx(L,{dates:r},r[0].next_occurrence))})]},s)),e.jsx(M,{isOpen:t,onClose:()=>l(!1),onSubmit:y,isLoading:m,allPeople:c,isPeopleLoading:x})]})}export{E as default};
