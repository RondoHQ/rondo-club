import{r as t,u as se,b as R,j as e,o as ys,L as be}from"./vendor-CjdX6t1i.js";import{c as U,$ as _,a0 as K,a1 as V,a2 as $,U as Ce,B as Se,a3 as js,p as D,A as ve}from"./main-D6r1FXj6.js";import{C as O}from"./check-circle-CgK97bW_.js";import{L as q}from"./loader-2-CY1xq1CO.js";import{L as Ns}from"./link-DSACisY3.js";import{S as De,D as we}from"./sticky-note-CFyUUpSs.js";import{A as bs}from"./alert-triangle-CTx-MD4S.js";import{U as vs}from"./user-plus-B27X-obe.js";import{S as ws}from"./share-2-9jJxQyn6.js";import{S as ks}from"./shield-znEaW7R6.js";import"./utils-D5Yy9kBW.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=U("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=U("Cake",[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h0.01",key:"hsw7lv"}],["path",{d:"M12 4h0.01",key:"1e3d8f"}],["path",{d:"M17 4h0.01",key:"p7cxgy"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=U("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=U("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=U("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=U("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=U("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);function As(){var M,n,b;const[c,g]=t.useState(null),[f,j]=t.useState(""),[s,x]=t.useState(!1),[d,y]=t.useState(null),p=se(),N=R({mutationFn:async i=>{const k=new FormData;return k.append("file",i),(await _.post("/prm/v1/import/monica/validate",k,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:i=>{y(i)},onError:i=>{var k,u;y({valid:!1,error:((u=(k=i.response)==null?void 0:k.data)==null?void 0:u.message)||"Failed to validate file"})}}),r=R({mutationFn:async({file:i,monicaUrl:k})=>{const u=new FormData;return u.append("file",i),u.append("monica_url",k),(await _.post("/prm/v1/import/monica",u,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:()=>{p.invalidateQueries({queryKey:["people"]}),p.invalidateQueries({queryKey:["companies"]}),p.invalidateQueries({queryKey:["dates"]}),p.invalidateQueries({queryKey:["dashboard"]})}}),w=t.useCallback(i=>{i.preventDefault(),i.stopPropagation(),i.type==="dragenter"||i.type==="dragover"?x(!0):i.type==="dragleave"&&x(!1)},[]),T=t.useCallback(i=>{i.preventDefault(),i.stopPropagation(),x(!1),i.dataTransfer.files&&i.dataTransfer.files[0]&&C(i.dataTransfer.files[0])},[]),F=i=>{i.target.files&&i.target.files[0]&&C(i.target.files[0])},C=i=>{if(!i.name.endsWith(".sql")){y({valid:!1,error:"Please select a SQL file"});return}g(i),y(null),r.reset(),N.mutate(i)},A=()=>{if(!f.trim()){y(i=>({...i,urlError:"Please enter your Monica instance URL"}));return}c&&(d!=null&&d.valid)&&r.mutate({file:c,monicaUrl:f.trim()})},P=()=>{g(null),j(""),y(null),N.reset(),r.reset()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Import from Monica"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Import contacts, relationships, notes, and photos from a Monica CRM SQL export file. Reimporting the same file will update existing contacts instead of creating duplicates."}),r.isSuccess?e.jsx("div",{className:"rounded-lg border border-green-200 bg-green-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-green-900",children:"Import Complete"}),e.jsxs("div",{className:"mt-2 text-sm text-green-800 space-y-1",children:[e.jsxs("p",{children:["Contacts imported: ",r.data.stats.contacts_imported]}),e.jsxs("p",{children:["Contacts updated: ",r.data.stats.contacts_updated]}),e.jsxs("p",{children:["Contacts skipped (partial): ",r.data.stats.contacts_skipped]}),e.jsxs("p",{children:["Photos imported: ",r.data.stats.photos_imported]}),e.jsxs("p",{children:["Organizations created: ",r.data.stats.companies_created]}),e.jsxs("p",{children:["Relationships created: ",r.data.stats.relationships_created]}),e.jsxs("p",{children:["Important dates created: ",r.data.stats.dates_created]}),e.jsxs("p",{children:["Notes created: ",r.data.stats.notes_created]}),((M=r.data.stats.errors)==null?void 0:M.length)>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200",children:[e.jsx("p",{className:"font-medium",children:"Errors:"}),e.jsx("ul",{className:"list-disc list-inside",children:r.data.stats.errors.map((i,k)=>e.jsx("li",{children:i},k))})]})]}),e.jsx("button",{onClick:P,className:"mt-3 text-sm text-green-700 hover:text-green-800 font-medium",children:"Import another file"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative rounded-lg border-2 border-dashed p-8 text-center transition-colors ${s?"border-primary-500 bg-primary-50":c?"border-green-300 bg-green-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:T,children:[e.jsx("input",{type:"file",accept:".sql",onChange:F,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),N.isPending?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(q,{className:"h-8 w-8 text-primary-600 animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Validating file..."})]}):c?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(K,{className:"h-8 w-8 text-green-600"}),e.jsx("p",{className:"font-medium text-gray-900",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(c.size/1024/1024).toFixed(2)," MB"]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(V,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"Drag and drop your Monica SQL export file here, or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Supports SQL export files"})]})]}),d&&e.jsx("div",{className:`rounded-lg border p-4 ${d.valid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:d.valid?e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-green-900",children:"File validated successfully"}),e.jsxs("div",{className:"mt-2 text-sm text-green-800",children:[e.jsxs("p",{children:["Export format: ",d.version]}),e.jsxs("p",{children:["Contacts to import: ",d.summary.contacts]}),e.jsxs("p",{children:["Relationships: ",d.summary.relationships]}),e.jsxs("p",{children:["Notes: ",d.summary.notes]}),e.jsxs("p",{children:["Dates: ",d.summary.reminders]}),e.jsxs("p",{children:["Photos: ",d.summary.photos]}),e.jsxs("p",{children:["Organizations: ",d.summary.companies_count]})]})]})]}):e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-900",children:"Validation failed"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:d.error})]})]})}),(d==null?void 0:d.valid)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"monica-url",className:"block text-sm font-medium text-gray-700",children:"Monica Instance URL"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ns,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"url",id:"monica-url",value:f,onChange:i=>j(i.target.value),placeholder:"https://your-monica-instance.com",className:`block w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 ${d.urlError?"border-red-300":"border-gray-300"}`})]}),d.urlError&&e.jsx("p",{className:"text-sm text-red-600",children:d.urlError}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter the URL of your Monica instance to import photos. Photos will be downloaded from this URL."})]}),(d==null?void 0:d.valid)&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:A,disabled:r.isPending,className:"btn-primary flex items-center gap-2",children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"hidden md:inline",children:"Importing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Start Import"})]})}),e.jsx("button",{onClick:P,disabled:r.isPending,className:"btn-secondary",children:"Cancel"})]}),r.isError&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-900",children:"Import failed"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:((b=(n=r.error.response)==null?void 0:n.data)==null?void 0:b.message)||"An error occurred during import"})]})]})})]})]})}function Ms(){var A,P,M;const[c,g]=t.useState(null),[f,j]=t.useState(!1),[s,x]=t.useState(null),d=se(),y=R({mutationFn:async n=>{const b=new FormData;return b.append("file",n),(await _.post("/prm/v1/import/vcard/validate",b,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:n=>{x(n)},onError:n=>{var b,i;x({valid:!1,error:((i=(b=n.response)==null?void 0:b.data)==null?void 0:i.message)||"Failed to validate file"})}}),p=R({mutationFn:async n=>{const b=new FormData;return b.append("file",n),(await _.post("/prm/v1/import/vcard",b,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:()=>{d.invalidateQueries({queryKey:["people"]}),d.invalidateQueries({queryKey:["companies"]}),d.invalidateQueries({queryKey:["dates"]}),d.invalidateQueries({queryKey:["dashboard"]})}}),N=t.useCallback(n=>{n.preventDefault(),n.stopPropagation(),n.type==="dragenter"||n.type==="dragover"?j(!0):n.type==="dragleave"&&j(!1)},[]),r=t.useCallback(n=>{n.preventDefault(),n.stopPropagation(),j(!1),n.dataTransfer.files&&n.dataTransfer.files[0]&&T(n.dataTransfer.files[0])},[]),w=n=>{n.target.files&&n.target.files[0]&&T(n.target.files[0])},T=n=>{const b=n.name.split(".").pop().toLowerCase();if(b!=="vcf"&&b!=="vcard"){x({valid:!1,error:"Please select a vCard file (.vcf)"});return}g(n),x(null),p.reset(),y.mutate(n)},F=()=>{c&&(s!=null&&s.valid)&&p.mutate(c)},C=()=>{g(null),x(null),y.reset(),p.reset()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Import from vCard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Import contacts from a vCard (.vcf) file. vCard is a standard format supported by most contact apps including Apple Contacts, Outlook, and Android. Files can contain one or multiple contacts."}),p.isSuccess?e.jsx("div",{className:"rounded-lg border border-green-200 bg-green-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-green-900",children:"Import Complete"}),e.jsxs("div",{className:"mt-2 text-sm text-green-800 space-y-1",children:[e.jsxs("p",{children:["Contacts imported: ",p.data.stats.contacts_imported]}),e.jsxs("p",{children:["Contacts updated: ",p.data.stats.contacts_updated]}),e.jsxs("p",{children:["Contacts skipped: ",p.data.stats.contacts_skipped]}),e.jsxs("p",{children:["Photos imported: ",p.data.stats.photos_imported]}),e.jsxs("p",{children:["Organizations created: ",p.data.stats.companies_created]}),e.jsxs("p",{children:["Birthdays created: ",p.data.stats.dates_created]}),e.jsxs("p",{children:["Notes created: ",p.data.stats.notes_created]}),((A=p.data.stats.errors)==null?void 0:A.length)>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200",children:[e.jsx("p",{className:"font-medium",children:"Errors:"}),e.jsx("ul",{className:"list-disc list-inside",children:p.data.stats.errors.map((n,b)=>e.jsx("li",{children:n},b))})]})]}),e.jsx("button",{onClick:C,className:"mt-3 text-sm text-green-700 hover:text-green-800 font-medium",children:"Import another file"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative rounded-lg border-2 border-dashed p-8 text-center transition-colors ${f?"border-primary-500 bg-primary-50":c?"border-green-300 bg-green-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:N,onDragLeave:N,onDragOver:N,onDrop:r,children:[e.jsx("input",{type:"file",accept:".vcf,.vcard",onChange:w,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),y.isPending?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(q,{className:"h-8 w-8 text-primary-600 animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Validating file..."})]}):c?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(K,{className:"h-8 w-8 text-green-600"}),e.jsx("p",{className:"font-medium text-gray-900",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(c.size/1024).toFixed(2)," KB"]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(V,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"Drag and drop your vCard file here, or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Supports .vcf and .vcard files"})]})]}),s&&e.jsx("div",{className:`rounded-lg border p-4 ${s.valid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:s.valid?e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-green-900",children:"File validated successfully"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.contacts," contacts"]})]}),s.summary.companies_count>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.companies_count," organizations"]})]}),s.summary.birthdays>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.birthdays," birthdays"]})]}),s.summary.photos>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.photos," photos"]})]}),s.summary.notes>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.notes," notes"]})]})]})]})]}):e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-900",children:"Validation failed"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:s.error})]})]})}),(s==null?void 0:s.valid)&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:F,disabled:p.isPending,className:"btn-primary flex items-center gap-2",children:p.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"hidden md:inline",children:"Importing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Start Import"})]})}),e.jsx("button",{onClick:C,disabled:p.isPending,className:"btn-secondary",children:"Cancel"})]}),p.isError&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-900",children:"Import failed"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:((M=(P=p.error.response)==null?void 0:P.data)==null?void 0:M.message)||"An error occurred during import"})]})]})})]})]})}function Ps(){var i,k,u;const[c,g]=t.useState(null),[f,j]=t.useState(!1),[s,x]=t.useState(null),[d,y]=t.useState({}),p=se(),N=R({mutationFn:async o=>{const h=new FormData;return h.append("file",o),(await _.post("/prm/v1/import/google-contacts/validate",h,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:o=>{var h;if(x(o),((h=o.duplicates)==null?void 0:h.length)>0){const S={};o.duplicates.forEach(L=>{S[L.index]="merge"}),y(S)}},onError:o=>{var h,S;x({valid:!1,error:((S=(h=o.response)==null?void 0:h.data)==null?void 0:S.message)||"Failed to validate file"})}}),r=R({mutationFn:async({file:o,decisions:h})=>{const S=new FormData;return S.append("file",o),S.append("decisions",JSON.stringify(h)),(await _.post("/prm/v1/import/google-contacts",S,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:()=>{p.invalidateQueries({queryKey:["people"]}),p.invalidateQueries({queryKey:["companies"]}),p.invalidateQueries({queryKey:["dates"]}),p.invalidateQueries({queryKey:["dashboard"]})}}),w=t.useCallback(o=>{o.preventDefault(),o.stopPropagation(),o.type==="dragenter"||o.type==="dragover"?j(!0):o.type==="dragleave"&&j(!1)},[]),T=t.useCallback(o=>{o.preventDefault(),o.stopPropagation(),j(!1),o.dataTransfer.files&&o.dataTransfer.files[0]&&C(o.dataTransfer.files[0])},[]),F=o=>{o.target.files&&o.target.files[0]&&C(o.target.files[0])},C=o=>{if(!o.name.endsWith(".csv")){x({valid:!1,error:"Please select a CSV file"});return}g(o),x(null),y({}),r.reset(),N.mutate(o)},A=(o,h)=>{y(S=>({...S,[o]:h}))},P=()=>{c&&(s!=null&&s.valid)&&r.mutate({file:c,decisions:d})},M=()=>{g(null),x(null),y({}),N.reset(),r.reset()},n=(s==null?void 0:s.duplicates)||[],b=n.length>0;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Import from Google Contacts"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Import contacts from a Google Contacts CSV export. To export from Google:"}),e.jsxs("ol",{className:"text-sm text-gray-600 list-decimal list-inside space-y-1 ml-2",children:[e.jsxs("li",{children:["Go to ",e.jsx("a",{href:"https://contacts.google.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:underline",children:"contacts.google.com"})]}),e.jsx("li",{children:'Click "Export" in the left sidebar'}),e.jsx("li",{children:'Select "Google CSV" format and click "Export"'})]}),r.isSuccess?e.jsx("div",{className:"rounded-lg border border-green-200 bg-green-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-green-900",children:"Import Complete"}),e.jsxs("div",{className:"mt-2 text-sm text-green-800 space-y-1",children:[e.jsxs("p",{children:["Contacts imported: ",r.data.stats.contacts_imported]}),e.jsxs("p",{children:["Contacts updated: ",r.data.stats.contacts_updated]}),e.jsxs("p",{children:["Contacts skipped: ",r.data.stats.contacts_skipped]}),e.jsxs("p",{children:["Organizations created: ",r.data.stats.companies_created]}),e.jsxs("p",{children:["Birthdays created: ",r.data.stats.dates_created]}),e.jsxs("p",{children:["Notes created: ",r.data.stats.notes_created]}),e.jsxs("p",{children:["Photos imported: ",r.data.stats.photos_imported]}),((i=r.data.stats.errors)==null?void 0:i.length)>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-green-200",children:[e.jsx("p",{className:"font-medium",children:"Errors:"}),e.jsx("ul",{className:"list-disc list-inside",children:r.data.stats.errors.map((o,h)=>e.jsx("li",{children:o},h))})]})]}),e.jsx("button",{onClick:M,className:"mt-3 text-sm text-green-700 hover:text-green-800 font-medium",children:"Import another file"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative rounded-lg border-2 border-dashed p-8 text-center transition-colors ${f?"border-primary-500 bg-primary-50":c?"border-green-300 bg-green-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:T,children:[e.jsx("input",{type:"file",accept:".csv",onChange:F,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),N.isPending?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(q,{className:"h-8 w-8 text-primary-600 animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Validating file..."})]}):c?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ae,{className:"h-8 w-8 text-green-600"}),e.jsx("p",{className:"font-medium text-gray-900",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(c.size/1024).toFixed(2)," KB"]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(V,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"Drag and drop your Google Contacts CSV here, or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Supports Google CSV format"})]})]}),s&&e.jsx("div",{className:`rounded-lg border p-4 ${s.valid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:s.valid?e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-green-900",children:"File validated successfully"}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.contacts," contacts"]})]}),s.summary.companies_count>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.companies_count," organizations"]})]}),s.summary.birthdays>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.birthdays," birthdays"]})]}),s.summary.notes>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.notes," notes"]})]}),s.summary.photos>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-800",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.summary.photos," photos"]})]})]})]})]}):e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-900",children:"Validation failed"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:s.error})]})]})}),(s==null?void 0:s.valid)&&b&&e.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(bs,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-amber-900",children:[n.length," contact",n.length>1?"s":""," may already exist"]}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"Choose how to handle each potential duplicate:"}),e.jsx("div",{className:"mt-4 space-y-4",children:n.map(o=>e.jsx(Ts,{duplicate:o,decision:d[o.index]||"merge",onDecision:h=>A(o.index,h)},o.index))})]})]})}),(s==null?void 0:s.valid)&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:P,disabled:r.isPending,className:"btn-primary flex items-center gap-2",children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"hidden md:inline",children:"Importing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Start Import"})]})}),e.jsx("button",{onClick:M,disabled:r.isPending,className:"btn-secondary",children:"Cancel"})]}),r.isError&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-900",children:"Import failed"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:((u=(k=r.error.response)==null?void 0:k.data)==null?void 0:u.message)||"An error occurred during import"})]})]})})]})]})}function Ts({duplicate:c,decision:g,onDecision:f}){var j,s;return e.jsxs("div",{className:"bg-white rounded-lg border border-amber-200 p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"From CSV"}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:c.csv_name}),c.csv_org&&e.jsx("p",{className:"text-sm text-gray-600 truncate",children:c.csv_org}),c.csv_email&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:c.csv_email})]}),e.jsx("div",{className:"hidden sm:flex items-center text-gray-400",children:e.jsx("span",{className:"text-lg",children:"→"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:"Existing Contact"}),e.jsxs("div",{className:"flex items-start gap-3",children:[c.existing_photo?e.jsx("img",{src:c.existing_photo,alt:"",className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-gray-500 text-sm font-medium",children:((s=(j=c.existing_name)==null?void 0:j.charAt(0))==null?void 0:s.toUpperCase())||"?"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:c.existing_name}),c.existing_org&&e.jsx("p",{className:"text-sm text-gray-600 truncate",children:c.existing_org}),c.existing_email&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:c.existing_email})]})]})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>f("merge"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${g==="merge"?"bg-primary-100 text-primary-800 ring-2 ring-primary-500":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(js,{className:"h-4 w-4"}),"Update existing"]}),e.jsxs("button",{type:"button",onClick:()=>f("new"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${g==="new"?"bg-green-100 text-green-800 ring-2 ring-green-500":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(vs,{className:"h-4 w-4"}),"Create new"]}),e.jsxs("button",{type:"button",onClick:()=>f("skip"),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${g==="skip"?"bg-gray-200 text-gray-800 ring-2 ring-gray-500":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Ds,{className:"h-4 w-4"}),"Skip"]})]})]})}const Fs=[{id:"sync",label:"Sync",icon:ws},{id:"notifications",label:"Notifications",icon:Cs},{id:"data",label:"Data",icon:Me},{id:"admin",label:"Admin",icon:ks,adminOnly:!0},{id:"about",label:"About",icon:Ss}];function Ys(){const[c,g]=ys(),f=window.prmConfig||{},j=f.isAdmin||!1,s=f.userId,x=c.get("tab")||"sync",d=a=>{g({tab:a})},y=Fs.filter(a=>!a.adminOnly||j),[p,N]=t.useState(""),[r,w]=t.useState(""),[T,F]=t.useState(!0),[C,A]=t.useState(!1),[P,M]=t.useState(!1),[n,b]=t.useState([]),[i,k]=t.useState(!0),[u,o]=t.useState(""),[h,S]=t.useState(!1),[L,B]=t.useState(null),[Te,te]=t.useState(!1),[Fe,Ie]=t.useState(null),[Q,re]=t.useState([]),[_e,Le]=t.useState(""),[G,W]=t.useState(!1),[Ue,Y]=t.useState(""),[Ee,H]=t.useState("09:00"),[ne,J]=t.useState("digest"),[Re,Ve]=t.useState(!0),[$e,ie]=t.useState(!1),[Oe,le]=t.useState(!1),[qe,ce]=t.useState(!1),[Qe,E]=t.useState(""),[ze,oe]=t.useState(!1),[Ke,de]=t.useState([]),[Be,me]=t.useState([]),[z,Z]=t.useState([]),[Ge,xe]=t.useState(!1),[We,pe]=t.useState(!1),[Ye,he]=t.useState(!1),[He,X]=t.useState(""),[Je,ue]=t.useState(!1),[Ze,ee]=t.useState("");t.useEffect(()=>{(async()=>{try{const l=await _.get("/prm/v1/user/ical-url");N(l.data.url),w(l.data.webcal_url)}catch{}finally{F(!1)}})()},[]),t.useEffect(()=>{s&&(async()=>{try{const[l,m]=await Promise.all([D.getAppPasswords(s),D.getCardDAVUrls()]);b(l.data||[]),Ie(m.data)}catch{}finally{k(!1)}})()},[s]);const ge=async()=>{xe(!0);try{const[a,l]=await Promise.all([D.getSlackChannels(),D.getSlackTargets()]);de(a.data.channels||[]),me(a.data.users||[]),Z(l.data.targets||[])}catch{E("Failed to load Slack channels and users. Please try refreshing the page.")}finally{xe(!1)}};t.useEffect(()=>{(async()=>{try{const l=await D.getNotificationChannels();re(l.data.channels||["email"]),Le(l.data.slack_webhook||""),H(l.data.notification_time||"09:00"),J(l.data.mention_notifications||"digest");const m=await D.getSlackStatus(),v=m.data.connected||!1;W(v),Y(m.data.workspace_name||""),v&&await ge()}catch{}finally{Ve(!1)}})()},[]),t.useEffect(()=>{G&&ge()},[G]),t.useEffect(()=>{const a=new URLSearchParams(window.location.search),l=a.get("slack_connected"),m=a.get("slack_error");l==="1"?(E("Slack connected successfully!"),d("notifications"),D.getSlackStatus().then(v=>{W(v.data.connected||!1),Y(v.data.workspace_name||"")}),g({tab:"notifications"})):m&&(E(`Slack connection failed: ${m}`),d("notifications"),g({tab:"notifications"}))},[]);const Xe=async()=>{var a,l;try{const m=await _.get("/prm/v1/slack/oauth/authorize");window.location.href=m.data.oauth_url}catch(m){alert(((l=(a=m.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to connect Slack")}},es=async()=>{var a,l;if(confirm("Are you sure you want to disconnect Slack? You will stop receiving Slack notifications.")){oe(!0);try{await D.disconnectSlack(),W(!1),Y(""),de([]),me([]),Z([]),E("Slack disconnected successfully"),Q.includes("slack")&&await fe("slack")}catch(m){alert(((l=(a=m.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to disconnect Slack")}finally{oe(!1)}}},ss=a=>{const l=z.includes(a)?z.filter(m=>m!==a):[...z,a];Z(l)},as=async()=>{var a,l;pe(!0);try{await D.updateSlackTargets(z),E("Notification targets saved successfully"),setTimeout(()=>E(""),3e3)}catch(m){alert(((l=(a=m.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to save notification targets")}finally{pe(!1)}},ts=async()=>{try{await navigator.clipboard.writeText(p),A(!0),setTimeout(()=>A(!1),2e3)}catch{}},rs=async a=>{var l,m;if(a.preventDefault(),!!u.trim()){S(!0);try{const v=await D.createAppPassword(s,u.trim());B(v.data.password),b([...n,v.data]),o("")}catch(v){alert(((m=(l=v.response)==null?void 0:l.data)==null?void 0:m.message)||"Failed to create app password")}finally{S(!1)}}},ns=async(a,l)=>{var m,v;if(confirm(`Are you sure you want to revoke the app password "${l}"? Any devices using this password will no longer be able to sync.`))try{await D.deleteAppPassword(s,a),b(n.filter(I=>I.uuid!==a))}catch(I){alert(((v=(m=I.response)==null?void 0:m.data)==null?void 0:v.message)||"Failed to revoke app password")}},is=async()=>{try{await navigator.clipboard.writeText(L),te(!0),setTimeout(()=>te(!1),2e3)}catch{}},ls=async a=>{try{await navigator.clipboard.writeText(a)}catch{}},cs=a=>{if(!a)return"Never";const l=new Date(a);return l.toLocaleDateString("en-US",{month:"short",day:"numeric",year:l.getFullYear()!==new Date().getFullYear()?"numeric":void 0})},os=async()=>{if(confirm("Are you sure you want to regenerate your calendar URL? Any existing calendar subscriptions will stop working until you update them with the new URL.")){M(!0);try{const a=await _.post("/prm/v1/user/regenerate-ical-token");N(a.data.url),w(a.data.webcal_url)}catch{}finally{M(!1)}}},fe=async a=>{var m,v;const l=Q.includes(a)?Q.filter(I=>I!==a):[...Q,a];ie(!0);try{await D.updateNotificationChannels(l),re(l)}catch(I){alert(((v=(m=I.response)==null?void 0:m.data)==null?void 0:v.message)||"Failed to update notification channels")}finally{ie(!1)}},ds=async a=>{var je,Ne;const[l,m]=a.split(":").map(Number),v=Math.round(m/5)*5,I=v===60?(l+1)%24:l,us=v===60?0:v,ye=`${String(I).padStart(2,"0")}:${String(us).padStart(2,"0")}`;H(ye),le(!0);try{await D.updateNotificationTime(ye)}catch(gs){alert(((Ne=(je=gs.response)==null?void 0:je.data)==null?void 0:Ne.message)||"Failed to update notification time");const fs=await D.getNotificationChannels();H(fs.data.notification_time||"09:00")}finally{le(!1)}},ms=async a=>{var m,v;ce(!0);const l=ne;J(a);try{await D.updateMentionNotifications(a)}catch(I){alert(((v=(m=I.response)==null?void 0:m.data)==null?void 0:v.message)||"Failed to update mention notification preference"),J(l)}finally{ce(!1)}},xs=async()=>{var a,l;if(confirm("This will send reminder emails for all reminders due today. Continue?")){he(!0),X("");try{const m=await D.triggerReminders();X(m.data.message||"Reminders triggered successfully.")}catch(m){X(((l=(a=m.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to trigger reminders. Please check server logs.")}finally{he(!1)}}},ps=async()=>{var a,l;if(confirm("This will reschedule all user reminder cron jobs based on their notification time preferences. Continue?")){ue(!0),ee("");try{const m=await D.rescheduleCronJobs();ee(m.data.message||"Cron jobs rescheduled successfully.")}catch(m){ee(((l=(a=m.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to reschedule cron jobs. Please check server logs.")}finally{ue(!1)}}},hs=()=>{switch(x){case"sync":return e.jsx(Is,{icalUrl:p,webcalUrl:r,icalLoading:T,icalCopied:C,copyIcalUrl:ts,regenerateIcalToken:os,regenerating:P,appPasswords:n,appPasswordsLoading:i,carddavUrls:Fe,config:f,newPasswordName:u,setNewPasswordName:o,handleCreateAppPassword:rs,creatingPassword:h,newPassword:L,setNewPassword:B,copyNewPassword:is,passwordCopied:Te,handleDeleteAppPassword:ns,formatDate:cs,copyCarddavUrl:ls});case"notifications":return e.jsx(_s,{notificationsLoading:Re,notificationChannels:Q,toggleChannel:fe,savingChannels:$e,slackConnected:G,slackWorkspaceName:Ue,handleConnectSlack:Xe,handleDisconnectSlack:es,disconnectingSlack:ze,webhookTestMessage:Qe,slackChannels:Ke,slackUsers:Be,slackTargets:z,loadingSlackData:Ge,handleToggleSlackTarget:ss,handleSaveSlackTargets:as,savingSlackTargets:We,slackWebhook:_e,notificationTime:Ee,handleNotificationTimeChange:ds,savingTime:Oe,mentionNotifications:ne,handleMentionNotificationsChange:ms,savingMentionPref:qe});case"data":return e.jsx(Ls,{});case"admin":return j?e.jsx(Us,{handleTriggerReminders:xs,triggeringReminders:Ye,reminderMessage:He,handleRescheduleCron:ps,reschedulingCron:Je,cronMessage:Ze}):null;case"about":return e.jsx(Es,{config:f});default:return null}};return e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:y.map(a=>{const l=a.icon,m=x===a.id;return e.jsxs("button",{onClick:()=>d(a.id),className:`
                  flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap
                  ${m?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx(l,{className:"w-4 h-4"}),a.label]},a.id)})})}),e.jsx("div",{className:"space-y-6",children:hs()})]})}function Is({icalUrl:c,webcalUrl:g,icalLoading:f,icalCopied:j,copyIcalUrl:s,regenerateIcalToken:x,regenerating:d,appPasswords:y,appPasswordsLoading:p,carddavUrls:N,config:r,newPasswordName:w,setNewPasswordName:T,handleCreateAppPassword:F,creatingPassword:C,newPassword:A,setNewPassword:P,copyNewPassword:M,passwordCopied:n,handleDeleteAppPassword:b,formatDate:i,copyCarddavUrl:k}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Calendar subscription"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Subscribe to your important dates in any calendar app (Apple Calendar, Google Calendar, Outlook, etc.)"}),f?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-10 bg-gray-200 rounded mb-3"}),e.jsx("div",{className:"h-9 bg-gray-200 rounded w-24"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label mb-1",children:"Your calendar feed URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:c,className:"input flex-1 text-sm font-mono bg-gray-50",onClick:u=>u.target.select()}),e.jsx("button",{onClick:s,className:"btn-secondary whitespace-nowrap",title:"Copy URL",children:j?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Copied"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})}),"Copy"]})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("a",{href:g,className:"btn-primary",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Subscribe in calendar app"]})}),e.jsx("button",{onClick:x,disabled:d,className:"btn-secondary",children:d?"Regenerating...":"Regenerate URL"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:'Keep this URL private. Anyone with access to it can see your important dates. If you think it has been compromised, click "Regenerate URL" to get a new one.'})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"CardDAV sync"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Sync your contacts with apps like Apple Contacts, Android Contacts, or Thunderbird using CardDAV."}),p?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-10 bg-gray-200 rounded mb-3"}),e.jsx("div",{className:"h-24 bg-gray-200 rounded"})]}):e.jsxs("div",{className:"space-y-4",children:[N&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg space-y-3",children:[e.jsx("h3",{className:"font-medium text-sm",children:"Connection details"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Server URL (for most apps)"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("input",{type:"text",readOnly:!0,value:N.addressbook,className:"input flex-1 text-xs font-mono bg-white",onClick:u=>u.target.select()}),e.jsx("button",{onClick:()=>k(N.addressbook),className:"btn-secondary text-xs px-2",title:"Copy URL",children:"Copy"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Username"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("input",{type:"text",readOnly:!0,value:r.userLogin||"",className:"input flex-1 text-xs font-mono bg-white",onClick:u=>u.target.select()}),e.jsx("button",{onClick:()=>k(r.userLogin),className:"btn-secondary text-xs px-2",title:"Copy username",children:"Copy"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use one of the app passwords below instead of your regular password."})]}),e.jsxs("form",{onSubmit:F,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:w,onChange:u=>T(u.target.value),placeholder:"Password name (e.g., iPhone Contacts)",className:"input flex-1",disabled:C}),e.jsx("button",{type:"submit",disabled:C||!w.trim(),className:"btn-primary whitespace-nowrap",children:C?"Creating...":"Create password"})]}),A&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-green-800 font-medium mb-2",children:"Your new app password (copy it now, it won't be shown again):"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:A,className:"input flex-1 font-mono text-sm bg-white",onClick:u=>u.target.select()}),e.jsx("button",{onClick:M,className:"btn-primary whitespace-nowrap",children:n?"Copied!":"Copy"})]}),e.jsx("button",{onClick:()=>P(null),className:"text-xs text-green-700 mt-2 hover:underline",children:"I've saved this password, hide it"})]}),y.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Your app passwords"}),e.jsx("div",{className:"space-y-2",children:y.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:u.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Created ",i(u.created)," · Last used ",i(u.last_used)]})]}),e.jsx("button",{onClick:()=>b(u.uuid,u.name),className:"text-red-600 hover:text-red-700 text-sm font-medium",children:"Revoke"})]},u.uuid))})]}),y.length===0&&!A&&e.jsx("p",{className:"text-sm text-gray-500",children:"No app passwords yet. Create one to start syncing your contacts."})]})]})]})}function _s({notificationsLoading:c,notificationChannels:g,toggleChannel:f,savingChannels:j,slackConnected:s,slackWorkspaceName:x,handleConnectSlack:d,handleDisconnectSlack:y,disconnectingSlack:p,webhookTestMessage:N,slackChannels:r,slackUsers:w,slackTargets:T,loadingSlackData:F,handleToggleSlackTarget:C,handleSaveSlackTargets:A,savingSlackTargets:P,slackWebhook:M,notificationTime:n,handleNotificationTimeChange:b,savingTime:i,mentionNotifications:k,handleMentionNotificationsChange:u,savingMentionPref:o}){return e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Choose how you want to receive daily reminders about your important dates."}),c?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-10 bg-gray-200 rounded mb-3"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive daily digest emails"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.includes("email"),onChange:()=>f("email"),disabled:j,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-gray-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Slack"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive notifications in Slack"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.includes("slack"),onChange:()=>f("slack"),disabled:j||!s,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]}),e.jsx("div",{children:s?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Connected to Slack"}),x&&e.jsxs("p",{className:"text-sm text-green-700",children:["Workspace: ",x]})]}),e.jsx("button",{onClick:y,disabled:p,className:"btn-secondary text-sm",children:p?"Disconnecting...":"Disconnect"})]})}),N&&e.jsx("p",{className:`text-sm ${N.includes("successfully")||N.includes("disconnected")?"text-green-600":"text-red-600"}`,children:N}),g.includes("slack")&&e.jsxs("div",{className:"mt-4 p-4 border border-gray-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Notification targets"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Choose where to send Slack notifications. You can select multiple channels and users."}),F?e.jsx("p",{className:"text-sm text-gray-500",children:"Loading channels and users..."}):e.jsxs(e.Fragment,{children:[r.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Channels"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:r.map(h=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.includes(h.id),onChange:()=>C(h.id),className:"mr-2 cursor-pointer"}),e.jsx("span",{className:"text-sm",children:h.name})]},h.id))})]}),w.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Direct messages"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:w.map(h=>e.jsxs("label",{className:"flex items-center p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.includes(h.id),onChange:()=>C(h.id),className:"mr-2 cursor-pointer"}),e.jsxs("span",{className:"text-sm",children:[h.name,h.is_me&&e.jsx("span",{className:"text-gray-500 ml-1",children:"(you)"})]})]},h.id))})]}),r.length===0&&w.length===0&&!F&&e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"No channels or users found. Make sure the Slack app has the necessary permissions."}),e.jsx("button",{onClick:A,disabled:P,className:"btn-primary text-sm mt-4",children:P?"Saving...":"Save targets"})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:d,className:"btn-primary w-full",disabled:p,children:"Connect Slack"}),N&&e.jsx("p",{className:`text-sm ${N.includes("successfully")?"text-green-600":"text-red-600"}`,children:N}),e.jsx("p",{className:"text-xs text-gray-500",children:"Connect your Slack workspace to receive daily reminder notifications. You'll be able to message channels or receive direct messages."})]})}),M&&!s&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Legacy webhook detected."})," Please connect via OAuth for better functionality. Your webhook will continue to work until you connect via OAuth."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"label mb-1",children:"Notification time (UTC)"}),e.jsx("input",{type:"time",value:n,onChange:h=>b(h.target.value),className:"input",disabled:i,step:"300"}),n&&e.jsxs("div",{className:"mt-2 p-2 bg-gray-50 rounded text-sm",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"UTC:"})," ",n]}),e.jsxs("p",{className:"text-gray-700 mt-1",children:[e.jsxs("span",{className:"font-medium",children:["Your time (",Intl.DateTimeFormat().resolvedOptions().timeZone,"):"]})," ",(()=>{try{const[h,S]=n.split(":"),L=new Date;return L.setUTCHours(parseInt(h),parseInt(S),0,0),L.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return n}})()]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose the UTC time when you want to receive your daily reminder digest. Reminders are sent within a 1-hour window of your selected time."})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mention notifications"}),e.jsxs("select",{value:k,onChange:h=>u(h.target.value),className:"input",disabled:o,children:[e.jsx("option",{value:"digest",children:"Include in daily digest (default)"}),e.jsx("option",{value:"immediate",children:"Send immediately"}),e.jsx("option",{value:"never",children:"Don't notify me"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose when to receive notifications when someone @mentions you in a note."})]})]})]})}const ke=[{id:"vcard",name:"vCard",description:"Apple Contacts, Outlook, Android",icon:K,component:Ms},{id:"google",name:"Google Contacts",description:"CSV export from Google",icon:ae,component:Ps},{id:"monica",name:"Monica CRM",description:"SQL export from Monica",icon:Me,component:As}];function Ls(){var s;const[c,g]=t.useState("vcard"),f=x=>{x==="vcard"?window.location.href="/wp-json/prm/v1/export/vcard":x==="google-csv"&&(window.location.href="/wp-json/prm/v1/export/google-csv")},j=(s=ke.find(x=>x.id===c))==null?void 0:s.component;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Import data"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Import your contacts from various sources. Existing contacts with matching names will be updated instead of duplicated."}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-6","aria-label":"Import types",children:ke.map(x=>{const d=x.icon,y=c===x.id;return e.jsxs("button",{onClick:()=>g(x.id),className:`group inline-flex items-center py-3 px-1 border-b-2 font-medium text-sm transition-colors ${y?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(d,{className:`mr-2 h-5 w-5 ${y?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"block",children:x.name}),e.jsx("span",{className:`block text-xs font-normal ${y?"text-primary-400":"text-gray-400"}`,children:x.description})]})]},x.id)})})}),j&&e.jsx(j,{})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Export data"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Export all your contacts in a format compatible with other contact management systems."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>f("vcard"),className:"w-full p-4 rounded-lg border border-gray-200 hover:bg-gray-50 text-left flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-50 rounded-lg",children:e.jsx(K,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Export as vCard (.vcf)"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Compatible with Apple Contacts, Outlook, Android, and most contact apps"})]}),e.jsx(we,{className:"w-5 h-5 text-gray-400"})]}),e.jsxs("button",{onClick:()=>f("google-csv"),className:"w-full p-4 rounded-lg border border-gray-200 hover:bg-gray-50 text-left flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-50 rounded-lg",children:e.jsx(ae,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Export as Google Contacts CSV"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Import directly into Google Contacts or other CSV-compatible systems"})]}),e.jsx(we,{className:"w-5 h-5 text-gray-400"})]})]})]})]})}function Us({handleTriggerReminders:c,triggeringReminders:g,reminderMessage:f,handleRescheduleCron:j,reschedulingCron:s,cronMessage:x}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"User management"}),e.jsx("div",{className:"space-y-3",children:e.jsxs(be,{to:"/settings/user-approval",className:"block p-4 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-colors",children:[e.jsx("p",{className:"font-medium",children:"User approval"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Approve or deny access for new users"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Configuration"}),e.jsx("div",{className:"space-y-3",children:e.jsxs(be,{to:"/settings/relationship-types",className:"block p-4 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-colors",children:[e.jsx("p",{className:"font-medium",children:"Relationship types"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage relationship types and their inverse mappings"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"System actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:c,disabled:g,className:"w-full text-left p-4 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("p",{className:"font-medium",children:"Trigger reminders"}),e.jsx("p",{className:"text-sm text-gray-500",children:g?"Sending...":"Manually send reminders for today"}),f&&e.jsx("p",{className:"text-sm text-green-600 mt-1",children:f})]}),e.jsxs("button",{onClick:j,disabled:s,className:"w-full text-left p-4 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("p",{className:"font-medium",children:"Reschedule cron jobs"}),e.jsx("p",{className:"text-sm text-gray-500",children:s?"Rescheduling...":"Reschedule all user reminder cron jobs"}),x&&e.jsx("p",{className:"text-sm text-green-600 mt-1",children:x})]})]})]})]})}function Es({config:c}){return e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4",children:["About ",ve]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Version ",c.version||"1.0.0"]})}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[ve," is a personal CRM system that helps you manage your contacts, track important dates, and maintain meaningful relationships."]})}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Built with WordPress, React, and Tailwind CSS."})})]})]})}export{Ys as default};
