import{r as o,j as e,L as Q}from"./vendor-CjdX6t1i.js";import{H as R,a as U,b as J,Z,d as z,P as B,e as C,_ as K}from"./main-D6r1FXj6.js";import{C as V,Q as W,i as X}from"./QuickActivityModal-D0TGGdB1.js";import{T as Y,P as ee}from"./TodoModal-CYviMd3i.js";import{s as te,p as se,i as ae,f as oe}from"./utils-D5Yy9kBW.js";import{F as le}from"./filter-Bd647nZv.js";import{S as D}from"./square-CumeHu_S.js";import{C as ne}from"./clock-C3q_yH8K.js";import{T as ie}from"./trash-2-GMOh3z4B.js";import"./link-DSACisY3.js";import"./mail-DERmFBJJ.js";function je(){R("Todos");const[s,h]=o.useState(!1),[c,i]=o.useState(null),[r,l]=o.useState(!1),[k,_]=o.useState(!1),[a,m]=o.useState(null),[I,u]=o.useState(!1),[O,y]=o.useState(!1),[E,f]=o.useState(null),{data:g,isLoading:P}=U(!0),p=J(),L=Z(),S=z(),A=o.useMemo(()=>te(new Date,3),[]),{incompleteTodos:j,recentlyCompletedTodos:x,olderCompletedTodos:M}=o.useMemo(()=>{if(!g)return{incompleteTodos:[],recentlyCompletedTodos:[],olderCompletedTodos:[]};const t=[],n=[],b=[];return g.forEach(d=>{if(!d.is_completed)t.push(d);else try{const H=se(d.created);ae(H,A)?n.push(d):b.push(d)}catch{b.push(d)}}),{incompleteTodos:t,recentlyCompletedTodos:n,olderCompletedTodos:b}},[g,A]),v=t=>{if(!t.is_completed){m(t),u(!0);return}p.mutate({todoId:t.id,data:{content:t.content,due_date:t.due_date,is_completed:!1}})},$=()=>{a&&(p.mutate({todoId:a.id,data:{content:a.content,due_date:a.due_date,is_completed:!0}}),u(!1),m(null))},F=()=>{if(!a)return;const t=new Date().toISOString().split("T")[0];f({content:a.content,activity_date:t,activity_type:"note",participants:[]}),u(!1),y(!0)},G=async t=>{if(a)try{await S.mutateAsync({personId:a.person_id,data:t}),await p.mutateAsync({todoId:a.id,data:{content:a.content,due_date:a.due_date,is_completed:!0}}),y(!1),m(null),f(null)}catch{alert("Failed to create activity. Please try again.")}},q=async t=>{c&&(await p.mutateAsync({todoId:c.id,data:t}),l(!1),i(null))},N=async t=>{window.confirm("Are you sure you want to delete this todo?")&&await L.mutateAsync(t)};if(P)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});const T=[...x,...M];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Todos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[M.length>0&&e.jsxs("button",{onClick:()=>h(!s),className:`btn-secondary text-sm flex items-center gap-2 ${s?"bg-primary-50 border-primary-300":""}`,children:[e.jsx(le,{className:"w-4 h-4"}),s?"Hide older":"Show all completed"]}),e.jsxs("button",{onClick:()=>_(!0),className:"btn-primary text-sm flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),"Add todo"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("h2",{className:"font-semibold flex items-center",children:[e.jsx(D,{className:"w-5 h-5 mr-2 text-gray-500"}),"Open todos (",j.length,")"]})}),j.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:j.map(t=>e.jsx(w,{todo:t,onToggle:v,onEdit:n=>{i(n),l(!0)},onDelete:N},t.id))}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(C,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No open todos"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Create todos from a person's detail page"})]})]}),x.length>0&&!s&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("h2",{className:"font-semibold flex items-center",children:[e.jsx(ne,{className:"w-5 h-5 mr-2 text-primary-600"}),"Recently completed (",x.length,")"]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:x.map(t=>e.jsx(w,{todo:t,onToggle:v,onEdit:n=>{i(n),l(!0)},onDelete:N},t.id))})]}),s&&T.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("h2",{className:"font-semibold flex items-center",children:[e.jsx(C,{className:"w-5 h-5 mr-2 text-primary-600"}),"All completed todos (",T.length,")"]})}),e.jsx("div",{className:"divide-y divide-gray-100",children:T.map(t=>e.jsx(w,{todo:t,onToggle:v,onEdit:n=>{i(n),l(!0)},onDelete:N},t.id))})]}),e.jsx(Y,{isOpen:r,onClose:()=>{l(!1),i(null)},onSubmit:q,isLoading:p.isPending,todo:c}),e.jsx(K,{isOpen:k,onClose:()=>_(!1)}),e.jsx(V,{isOpen:I,onClose:()=>{u(!1),m(null)},todo:a,onComplete:$,onCompleteAsActivity:F}),e.jsx(W,{isOpen:O,onClose:()=>{y(!1),m(null),f(null)},onSubmit:G,isLoading:S.isPending,personId:a==null?void 0:a.person_id,initialData:E})]})}function w({todo:s,onToggle:h,onEdit:c,onDelete:i}){var l;const r=X(s);return e.jsxs("div",{className:"flex items-start p-4 hover:bg-gray-50 transition-colors group",children:[e.jsx("button",{onClick:()=>h(s),className:"mt-0.5 mr-3 flex-shrink-0",title:s.is_completed?"Mark as incomplete":"Mark as complete",children:s.is_completed?e.jsx(C,{className:"w-5 h-5 text-primary-600"}):e.jsx(D,{className:`w-5 h-5 ${r?"text-red-600":"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm ${s.is_completed?"line-through text-gray-400":r?"text-red-600 font-medium":"text-gray-900"}`,children:s.content}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2",children:[e.jsxs(Q,{to:`/people/${s.person_id}`,className:"flex items-center gap-2 text-xs text-primary-600 hover:text-primary-700 hover:underline",children:[s.person_thumbnail?e.jsx("img",{src:s.person_thumbnail,alt:s.person_name,className:"w-5 h-5 rounded-full object-cover"}):e.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500",children:(l=s.person_name)==null?void 0:l[0]})}),s.person_name]}),s.due_date&&e.jsxs("span",{className:`text-xs ${r&&!s.is_completed?"text-red-600 font-medium":"text-gray-500"}`,children:["Due: ",oe(new Date(s.due_date),"MMM d, yyyy"),r&&!s.is_completed&&" (overdue)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity ml-2",children:[e.jsx("button",{onClick:()=>c(s),className:"p-1 hover:bg-gray-100 rounded",title:"Edit todo",children:e.jsx(ee,{className:"w-4 h-4 text-gray-400 hover:text-gray-600"})}),e.jsx("button",{onClick:()=>i(s.id),className:"p-1 hover:bg-red-50 rounded",title:"Delete todo",children:e.jsx(ie,{className:"w-4 h-4 text-gray-400 hover:text-red-600"})})]})]})}export{je as default};
