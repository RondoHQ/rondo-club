import{m as ae,e as te,u as re,r as y,c as g,b as U,j as e,L as d}from"./vendor-CjdX6t1i.js";import{c as ie,H as ne,j as o,B as v,U as R,T as D,V as le,R as ce,w as x,p as q,I as de}from"./main-D6r1FXj6.js";import{S as oe,C as me,G as ue,a as xe}from"./ShareModal-C3A_SmFZ.js";import{A as he}from"./arrow-left-C9KexAZo.js";import{S as pe}from"./share-2-9jJxQyn6.js";import{T as ye}from"./trash-2-GMOh3z4B.js";import"./utils-D5Yy9kBW.js";import"./user-plus-B27X-obe.js";/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=ie("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);function Ce(){var $,L,Q,M,B,A,E;const{id:r}=ae(),w=te(),l=re(),b=y.useRef(null),[S,k]=y.useState(!1),[O,_]=y.useState(!1),[H,z]=y.useState(!1),[V,K]=y.useState(!1),{data:a,isLoading:W,error:J}=g({queryKey:["company",r],queryFn:async()=>(await x.getCompany(r,{_embed:!0})).data}),{data:c}=g({queryKey:["company-people",r],queryFn:async()=>(await q.getCompanyPeople(r)).data}),{data:C}=g({queryKey:["company",a==null?void 0:a.parent],queryFn:async()=>(await x.getCompany(a.parent,{_embed:!0})).data,enabled:!!(a!=null&&a.parent)}),{data:F=[]}=g({queryKey:["company-children",r],queryFn:async()=>(await x.getCompanies({parent:r,per_page:100,_embed:!0})).data}),h=(($=a==null?void 0:a.acf)==null?void 0:$.investors)||[],{data:I=[]}=g({queryKey:["company-investors",r,h],queryFn:async()=>{if(!h.length)return[];const[s,t]=await Promise.all([x.getPeople({per_page:100,include:h.join(","),_embed:!0}),x.getCompanies({per_page:100,include:h.join(","),_embed:!0})]),i=(s.data||[]).map(n=>{var u,j,f,T;return{id:n.id,type:"person",name:de(((u=n.title)==null?void 0:u.rendered)||""),thumbnail:(T=(f=(j=n._embedded)==null?void 0:j["wp:featuredmedia"])==null?void 0:f[0])==null?void 0:T.source_url}}),p=(t.data||[]).map(n=>{var u,j,f;return{id:n.id,type:"company",name:o(n),thumbnail:(f=(j=(u=n._embedded)==null?void 0:u["wp:featuredmedia"])==null?void 0:j[0])==null?void 0:f.source_url}}),N=[...i,...p];return h.map(n=>N.find(u=>u.id===n)).filter(Boolean)},enabled:h.length>0}),{data:P=[]}=g({queryKey:["investments",r],queryFn:async()=>(await q.getInvestments(r)).data,enabled:!!r}),X=U({mutationFn:()=>x.deleteCompany(r,{force:!0}),onSuccess:()=>{l.invalidateQueries({queryKey:["companies"]}),l.invalidateQueries({queryKey:["dashboard"]}),w("/companies")}}),Y=U({mutationFn:s=>x.updateCompany(r,s),onSuccess:()=>{l.invalidateQueries({queryKey:["company",r]}),l.invalidateQueries({queryKey:["companies"]}),l.invalidateQueries({queryKey:["company-investors",r]}),l.invalidateQueries({queryKey:["dashboard"]})}});ne(o(a)||"Organization"),y.useEffect(()=>{(a==null?void 0:a.status)==="trash"&&w("/companies",{replace:!0})},[a,w]);const Z=async()=>{if(window.confirm("Are you sure you want to delete this organization?"))try{await X.mutateAsync()}catch{alert("Failed to delete organization. Please try again.")}},ee=async s=>{var t,i;K(!0);try{const p={title:s.title,parent:s.parentId||0,acf:{website:s.website,industry:s.industry,investors:s.investors||[],_visibility:s.visibility||((t=a.acf)==null?void 0:t._visibility)||"private",_assigned_workspaces:s.assigned_workspaces||((i=a.acf)==null?void 0:i._assigned_workspaces)||[]}};await Y.mutateAsync(p),_(!1)}catch{alert("Failed to save organization. Please try again.")}finally{K(!1)}},se=async s=>{var i;const t=(i=s.target.files)==null?void 0:i[0];if(t){if(!t.type.startsWith("image/")){alert("Please select an image file");return}if(t.size>5*1024*1024){alert("Image size must be less than 5MB");return}k(!0);try{await q.uploadCompanyLogo(r,t),l.invalidateQueries({queryKey:["company",r]}),l.invalidateQueries({queryKey:["companies"]})}catch{alert("Failed to upload logo. Please try again.")}finally{k(!1),b.current&&(b.current.value="")}}};if(W)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});if(J||!a)return e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("p",{className:"text-red-600",children:"Failed to load organization."}),e.jsx(d,{to:"/companies",className:"btn-secondary mt-4",children:"Back to organizations"})]});if(a.status==="trash")return null;const m=a.acf||{};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(d,{to:"/companies",className:"flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(he,{className:"w-4 h-4 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Back to organizations"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>z(!0),className:"btn-secondary",title:"Share",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsxs("button",{onClick:()=>_(!0),className:"btn-secondary",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs("button",{onClick:Z,className:"btn-danger",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative group",children:[(M=(Q=(L=a._embedded)==null?void 0:L["wp:featuredmedia"])==null?void 0:Q[0])!=null&&M.source_url?e.jsx("img",{src:a._embedded["wp:featuredmedia"][0].source_url,alt:o(a),className:"w-24 h-24 rounded-lg object-contain bg-white"}):e.jsx("div",{className:"w-24 h-24 bg-white rounded-lg flex items-center justify-center border border-gray-200",children:e.jsx(v,{className:"w-12 h-12 text-gray-400"})}),e.jsx("div",{className:"absolute inset-0 rounded-lg bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center cursor-pointer",onClick:()=>{var s;return(s=b.current)==null?void 0:s.click()},children:S?e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"}):e.jsx(me,{className:"w-6 h-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:se,className:"hidden",disabled:S})]}),e.jsxs("div",{children:[C&&e.jsxs(d,{to:`/companies/${C.id}`,className:"text-sm text-primary-600 hover:underline flex items-center mb-1",children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),"Subsidiary of ",o(C)]}),e.jsx("h1",{className:"text-2xl font-bold",children:o(a)}),m.industry&&e.jsx("p",{className:"text-gray-500",children:m.industry}),m.website&&e.jsxs("a",{href:m.website,target:"_blank",rel:"noopener noreferrer",className:"text-primary-600 hover:underline flex items-center mt-1",children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),m.website]})]})]})}),F.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Subsidiaries"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:F.map(s=>{var t,i,p,N;return e.jsxs(d,{to:`/companies/${s.id}`,className:"flex items-center p-3 rounded-lg hover:bg-gray-50 border border-gray-200",children:[(p=(i=(t=s._embedded)==null?void 0:t["wp:featuredmedia"])==null?void 0:i[0])!=null&&p.source_url?e.jsx("img",{src:s._embedded["wp:featuredmedia"][0].source_url,alt:o(s),className:"w-10 h-10 rounded object-contain bg-white"}):e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium",children:o(s)}),((N=s.acf)==null?void 0:N.industry)&&e.jsx("p",{className:"text-xs text-gray-500",children:s.acf.industry})]})]},s.id)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Current employees"]}),((B=c==null?void 0:c.current)==null?void 0:B.length)>0?e.jsx("div",{className:"space-y-2",children:c.current.map(s=>{var t;return e.jsxs(d,{to:`/people/${s.id}`,className:"flex items-center p-2 rounded hover:bg-gray-50",children:[s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:"",loading:"lazy",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-gray-500",children:((t=s.name)==null?void 0:t[0])||"?"})}),e.jsxs("div",{className:"ml-2",children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),s.job_title&&e.jsx("p",{className:"text-xs text-gray-500",children:s.job_title})]})]},s.id)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No current employees."})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Former employees"]}),((A=c==null?void 0:c.former)==null?void 0:A.length)>0?e.jsx("div",{className:"space-y-2",children:c.former.map(s=>{var t;return e.jsxs(d,{to:`/people/${s.id}`,className:"flex items-center p-2 rounded hover:bg-gray-50",children:[s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:"",loading:"lazy",className:"w-8 h-8 rounded-full opacity-75"}):e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center opacity-75",children:e.jsx("span",{className:"text-xs text-gray-500",children:((t=s.name)==null?void 0:t[0])||"?"})}),e.jsxs("div",{className:"ml-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:s.name}),s.job_title&&e.jsx("p",{className:"text-xs text-gray-500",children:s.job_title})]})]},s.id)})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No former employees."})]})]}),I.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"Investors"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:I.map(s=>{const t=s.type==="person",i=t?`/people/${s.id}`:`/companies/${s.id}`;return e.jsxs(d,{to:i,className:"flex items-center p-3 rounded-lg hover:bg-gray-50 border border-gray-200",children:[s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:s.name,loading:"lazy",className:`w-10 h-10 object-cover ${t?"rounded-full":"rounded"}`}):e.jsx("div",{className:`w-10 h-10 bg-gray-100 flex items-center justify-center ${t?"rounded-full":"rounded"}`,children:t?e.jsx(le,{className:"w-5 h-5 text-gray-400"}):e.jsx(v,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?"Person":"Organization"})]})]},`${s.type}-${s.id}`)})})]}),P.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"Invested in"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:P.map(s=>e.jsxs(d,{to:`/companies/${s.id}`,className:"flex items-center p-3 rounded-lg hover:bg-gray-50 border border-gray-200",children:[s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:s.name,loading:"lazy",className:"w-10 h-10 object-contain rounded"}):e.jsx("div",{className:"w-10 h-10 bg-gray-100 flex items-center justify-center rounded",children:e.jsx(v,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),s.industry&&e.jsx("p",{className:"text-xs text-gray-500",children:s.industry})]})]},s.id))})]}),((E=m.contact_info)==null?void 0:E.length)>0&&e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"font-semibold mb-4",children:"Contact information"}),e.jsx("div",{className:"space-y-3",children:m.contact_info.map((s,t)=>e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[s.contact_label||s.contact_type,":"]}),e.jsx("span",{className:"ml-2",children:s.contact_value})]},t))})]}),e.jsx(ce,{isOpen:O,onClose:()=>_(!1),onSubmit:ee,isLoading:V,company:a}),e.jsx(xe,{isOpen:H,onClose:()=>z(!1),postType:"companies",postId:a.id,postTitle:o(a)})]})}export{Ce as default};
