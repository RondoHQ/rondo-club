# Milestone v4.0: Calendar Integration

**Status:** SHIPPED 2026-01-15
**Phases:** 47-55
**Total Plans:** 11

## Overview

Connect calendars to auto-log meetings and surface upcoming meetings on contact profiles. Full integration with Google Calendar (OAuth2) and CalDAV providers (iCloud, Fastmail, Nextcloud, generic servers).

## Phases

### Phase 47: Infrastructure

**Goal**: calendar_event CPT, user meta helpers, REST endpoint structure
**Depends on**: Previous milestone complete
**Plans**: 2/2 complete

Plans:
- [x] 47-01: Calendar infrastructure (CPT, connections helper, encryption)
- [x] 47-02: REST API skeleton (connection CRUD, OAuth stubs, events stubs)

**Key files:**
- `includes/class-calendar-connections.php` - Connection CRUD helper
- `includes/class-credential-encryption.php` - Sodium encryption for OAuth tokens
- `includes/class-post-types.php` - calendar_event CPT registration

### Phase 48: Google OAuth

**Goal**: Credential encryption, OAuth2 flow, token storage/refresh
**Depends on**: Phase 47
**Plans**: 1/1 complete

Plans:
- [x] 48-01: Google OAuth flow (google/apiclient, RONDO_Google_OAuth class, REST endpoints)

**Key files:**
- `includes/class-google-oauth.php` - OAuth2 flow with token refresh
- `composer.json` - Added google/apiclient ^2.15

### Phase 49: Google Calendar Provider

**Goal**: Sync logic, event upsert, attendee extraction
**Depends on**: Phase 48
**Plans**: 1/1 complete

Plans:
- [x] 49-01: Google Calendar sync provider (RONDO_Google_Calendar_Provider, trigger_sync, get_events)

**Key files:**
- `includes/class-google-calendar-provider.php` - Event sync with meeting URL extraction

### Phase 50: CalDAV Provider

**Goal**: sabre/dav integration, generic CalDAV sync for iCloud/Outlook/Fastmail/Nextcloud
**Depends on**: Phase 47
**Plans**: 1/1 complete

Plans:
- [x] 50-01: CalDAV provider (RONDO_CalDAV_Provider, test_caldav, sync for iCloud/Fastmail/Nextcloud)

**Key files:**
- `includes/class-caldav-provider.php` - CalDAV sync using Sabre DAV

### Phase 51: Contact Matching

**Goal**: Email-first algorithm, fuzzy name matching, transient cache optimization
**Depends on**: Phase 49, Phase 50
**Plans**: 1/1 complete

Plans:
- [x] 51-01: Contact matching (RONDO_Calendar_Matcher class, provider integration, meetings endpoint)

**Key files:**
- `includes/class-calendar-matcher.php` - Email-first matching with confidence scores

### Phase 52: Settings UI

**Goal**: Calendar connections page at /settings/calendars, add/edit/delete connections, sync status display
**Depends on**: Phase 48
**Plans**: 2/2 complete

Plans:
- [x] 52-01: Calendar settings UI (CalendarsTab, connection modals, sync status)
- [x] 52-FIX: Google OAuth redirect fix

**Key files:**
- `src/pages/Settings/Settings.jsx` - CalendarsTab, CalDAVModal, EditConnectionModal components

### Phase 53: Person Meetings Section

**Goal**: Upcoming/past meetings display in PersonDetail, "Log as Activity" functionality
**Depends on**: Phase 51
**Plans**: 1/1 complete

Plans:
- [x] 53-01: Person meetings section (MeetingsSection component, usePersonMeetings hook, log as activity)

**Key files:**
- `src/hooks/useMeetings.js` - TanStack Query hooks for meetings
- `src/pages/People/PersonDetail.jsx` - Meetings tab with MeetingCard

### Phase 54: Background Sync + Auto-Logging

**Goal**: WP-Cron jobs for 15-minute sync, rate limiting, activity creation from past meetings
**Depends on**: Phase 51
**Plans**: 1/1 complete

Plans:
- [x] 54-01: Background sync (RONDO_Calendar_Sync class, WP-Cron, auto-logging, WP-CLI commands)

**Key files:**
- `includes/class-calendar-sync.php` - Background sync with round-robin rate limiting
- `includes/class-wp-cli.php` - Calendar CLI commands

### Phase 55: Dashboard Widget + Polish

**Goal**: "Today's Meetings" widget above Favorites, testing, error handling
**Depends on**: Phase 53
**Plans**: 1/1 complete

Plans:
- [x] 55-01: Today's Meetings dashboard widget (REST endpoint, hook, MeetingCard component)

**Key files:**
- `src/pages/Dashboard.jsx` - Today's Meetings widget with MeetingCard

---

## Milestone Summary

**Key Decisions:**

- Google OAuth with google/apiclient library for reliable OAuth2 implementation
- Sodium encryption for OAuth tokens using AUTH_KEY-derived key
- Event uniqueness via _event_uid + _connection_id combination
- Email-first contact matching to avoid false positives from common names
- 24-hour transient cache for email lookups
- 15-minute cron interval for background sync
- One user per cron run for API rate limiting
- Conditional dashboard widget based on has_connections flag

**Issues Resolved:**

- OAuth redirect issues fixed with transient tokens and correct callback URLs

**Issues Deferred:**

- None

**Technical Debt Incurred:**

- ESLint config missing from project (pre-existing, not from this milestone)

---

_For current project status, see .planning/ROADMAP.md_
