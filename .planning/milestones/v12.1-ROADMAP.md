# Milestone v12.1: Contributie Forecast

**Status:** SHIPPED 2026-02-03
**Phases:** 129-131
**Total Plans:** 3

## Overview

Add next season forecast capability to the contributie page, enabling budget planning. Users can toggle between current season (actual billing data) and next season (projected fees based on current membership). Builds on v12.0 fee calculation infrastructure with minimal new complexity.

## Phases

### Phase 129: Backend Forecast Calculation

**Goal**: API returns forecast data for next season with correct fee calculations
**Depends on**: v12.0 (existing fee calculation infrastructure)
**Requirements**: FORE-01, FORE-02, FORE-03, FORE-04, FORE-05, API-01, API-02, API-03
**Plans**: 1 plan

Plans:
- [x] 129-01: Add forecast parameter to /fees endpoint with next season calculation

**Success Criteria** (verified):
1. API accepts `forecast=true` parameter and returns next season key (2026-2027)
2. Forecast response includes all current season members with 100% pro-rata fees
3. Forecast correctly applies family discounts based on current address groupings
4. Forecast response omits nikki_total and nikki_saldo fields (no billing data exists)

**Key Decisions:**
- Forecast ignores season parameter - always uses next season for consistency
- 100% pro-rata for all forecast members (full year assumption)
- Nikki billing data omitted from forecast (not available for future)

### Phase 130: Frontend Season Selector

**Goal**: Users can switch between current and forecast view with clear visual distinction
**Depends on**: Phase 129
**Requirements**: UI-01, UI-02, UI-03, UI-04, UI-05, UI-06
**Plans**: 1 plan

Plans:
- [x] 130-01: Add season dropdown with forecast toggle and conditional column rendering

**Success Criteria** (verified):
1. Season dropdown shows current season with "(huidig)" and next season with "(prognose)"
2. Selecting forecast updates table to show projected fees
3. Forecast view hides Nikki and Saldo columns
4. Clear visual indicator (label/badge) shows this is a projection, not actual data

**Key Decisions:**
- Native select element for season dropdown (consistent with existing UI)
- Instant column hiding without animation (immediate table reflow)
- Forecast indicator includes TrendingUp icon for visual clarity
- Filter buttons hidden in forecast mode (Geen Nikki, Afwijking rely on Nikki data)
- Auto-reset sort when entering forecast while sorting by Nikki columns

### Phase 131: Forecast Export

**Goal**: Users can export forecast data to Google Sheets for budget planning
**Depends on**: Phase 130
**Requirements**: EXP-01, EXP-02, EXP-03
**Plans**: 1 plan

Plans:
- [x] 131-01: Add forecast parameter to export-fees endpoint with conditional columns

**Success Criteria** (verified):
1. Export button works when viewing forecast
2. Exported sheet title includes season and "(Prognose)" indicator
3. Exported forecast excludes Nikki columns

**Key Decisions:**
- Forecast export title format: "Contributie YYYY-YYYY (Prognose) - DATE"
- Forecast exports use 8-column layout (no Nikki columns)

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**
- Forecast ignores season parameter - always uses next season (consistency)
- 100% pro-rata for all forecast members (full year assumption for budget planning)
- Nikki billing data omitted from forecast (not available for future season)
- Native select element for season dropdown (consistent with existing UI patterns)
- Instant column hiding without animation (immediate table reflow per UX decision)
- Forecast indicator includes TrendingUp icon for visual clarity
- Filter buttons hidden in forecast mode (rely on Nikki data)
- Forecast export title includes "(Prognose)" suffix
- Forecast exports use 8-column layout (Nikki columns excluded)

**Issues Resolved:**
- Fixed undefined variable bug in sort function (`$a['name']` â†’ `$a['first_name'] . ' ' . $a['last_name']`)

**Issues Deferred:** None

**Technical Debt Incurred:** None

---

*For current project status, see .planning/ROADMAP.md*
