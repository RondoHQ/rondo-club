# Milestone v6.0: Custom Fields

**Status:** SHIPPED 2026-01-21
**Phases:** 87-94
**Total Plans:** 15

## Overview

Transform Stadion into a flexible CRM with admin-defined custom fields for People and Teams. Using ACF-native storage (field groups and fields as CPTs), this milestone delivers 14 field types with full CRUD management, detail view integration, list view columns, and search capabilities.

## Phases

### Phase 87: ACF Foundation
**Goal**: Establish PHP infrastructure for managing custom field definitions programmatically via ACF
**Depends on**: Nothing (first phase)
**Requirements**: MGMT-01, MGMT-02, MGMT-03, MGMT-04, MGMT-06
**Plans**: 2 plans

Plans:
- [x] 87-01-PLAN.md - Create CustomFields Manager class with CRUD operations
- [x] 87-02-PLAN.md - Create REST API endpoints for custom field management

**Key Deliverables:**
- CustomFields Manager class with CRUD operations
- ACF database persistence via acf_import_field_group() and acf_update_field()
- Field key naming pattern: field_custom_{post_type}_{slug}
- Soft delete strategy via active flag to preserve stored data

### Phase 88: Settings UI
**Goal**: Admin can manage custom field definitions through a Settings subtab
**Depends on**: Phase 87
**Requirements**: SETT-01, SETT-02, SETT-03, SETT-04
**Plans**: 2 plans

Plans:
- [x] 88-01-PLAN.md - Custom fields page with API client, tab navigation, and field list
- [x] 88-02-PLAN.md - Add/edit slide-out panel and delete confirmation dialog

**Key Deliverables:**
- Custom Fields subtab in Settings (/settings/custom-fields)
- People/Teams field list tabs with localStorage persistence
- FieldFormPanel slide-out component for add/edit
- DeleteFieldDialog with archive vs permanent delete options

### Phase 89: Basic Field Types
**Goal**: Support 9 fundamental field types for text, numbers, choices, and dates
**Depends on**: Phase 88
**Requirements**: TYPE-01 through TYPE-09
**Plans**: 2 plans

Plans:
- [x] 89-01-PLAN.md - Extend backend for type-specific options (min/max, choices, formats)
- [x] 89-02-PLAN.md - Add type-specific configuration UI to FieldFormPanel

**Key Deliverables:**
- Text, Textarea, Number, Email, URL, Date, Select, Checkbox, True/False field types
- Type-specific options (min/max for Number, formats for Date, layouts for Select/Checkbox)
- Extended UPDATABLE_PROPERTIES in Manager class

### Phase 90: Extended Field Types
**Goal**: Support 5 advanced field types for media, links, colors, and relationships
**Depends on**: Phase 89
**Requirements**: TYPE-10 through TYPE-14
**Plans**: 2 plans

Plans:
- [x] 90-01-PLAN.md - Extend backend for extended type options (image, file, link, color, relationship)
- [x] 90-02-PLAN.md - Add extended type configuration UI to FieldFormPanel

**Key Deliverables:**
- Image, File, Link, Color Picker, Relationship field types
- @uiw/react-color-sketch for color picker in Settings UI
- Full 14 field types now available

### Phase 91: Detail View Integration
**Goal**: Custom fields appear in dedicated section on Person and Team detail pages
**Depends on**: Phase 90
**Requirements**: DISP-01 through DISP-04
**Plans**: 2 plans

Plans:
- [x] 91-01-PLAN.md - Expose field metadata to non-admins via REST API
- [x] 91-02-PLAN.md - CustomFieldsSection component and detail page integration

**Key Deliverables:**
- Read-only REST endpoint /stadion/v1/custom-fields/{post_type}/metadata
- CustomFieldsSection React component with type-appropriate rendering
- CustomFieldsEditModal for editing all custom field values

### Phase 92: List View Integration
**Goal**: Custom fields can appear as columns in People and Teams list views
**Depends on**: Phase 91
**Requirements**: DISP-05 through DISP-07, SETT-06, SETT-07
**Plans**: 2 plans

Plans:
- [x] 92-01-PLAN.md - Backend support for show_in_list_view and list_view_order field properties
- [x] 92-02-PLAN.md - FieldFormPanel settings, CustomFieldColumn component, and list view integration

**Key Deliverables:**
- show_in_list_view and list_view_order properties
- CustomFieldColumn React component for compact list rendering
- Dynamic columns in PeopleList and TeamsList

### Phase 93: Search Integration
**Goal**: Custom field values are included in global search results
**Depends on**: Phase 91
**Requirements**: SRCH-01 through SRCH-03
**Plans**: 1 plan

Plans:
- [x] 93-01-PLAN.md - Add custom field search to global_search() with helper methods and scoring

**Key Deliverables:**
- Custom field search in global_search() for People and Teams
- Scored search results with custom field matches at priority 30
- Helper methods for building custom field meta queries

### Phase 94: Polish
**Goal**: Complete field management UX with drag-and-drop ordering and validation options
**Depends on**: Phase 92
**Requirements**: MGMT-05, MGMT-07, MGMT-08, SETT-05
**Plans**: 2 plans

Plans:
- [x] 94-01-PLAN.md - Backend: menu_order, reorder endpoint, unique validation
- [x] 94-02-PLAN.md - Frontend: drag-and-drop, required/unique toggles, placeholder expansion

**Key Deliverables:**
- Drag-and-drop field reordering via dnd-kit
- Required field validation (enforced on save)
- Unique field validation (prevents duplicate values)
- Placeholder text support for empty fields

## Progress

| Phase | Plans Complete | Status | Completed |
|-------|----------------|--------|-----------|
| 87. ACF Foundation | 2/2 | Complete | 2026-01-18 |
| 88. Settings UI | 2/2 | Complete | 2026-01-18 |
| 89. Basic Field Types | 2/2 | Complete | 2026-01-18 |
| 90. Extended Field Types | 2/2 | Complete | 2026-01-18 |
| 91. Detail View Integration | 2/2 | Complete | 2026-01-19 |
| 92. List View Integration | 2/2 | Complete | 2026-01-20 |
| 93. Search Integration | 1/1 | Complete | 2026-01-20 |
| 94. Polish | 2/2 | Complete | 2026-01-20 |

---

## Milestone Summary

**Key Decisions:**
- ACF-native storage using field groups per post type (group_custom_fields_{post_type})
- Field key naming pattern: field_custom_{post_type}_{slug}
- Soft delete via active flag to preserve stored data
- Separate /metadata endpoint for non-admin read access
- Custom field search scores at priority 30 (lower than name matches)
- menu_order starts at 1, not 0 (ACF convention)
- Unique validation scoped to current user's posts
- SortableFieldRow pattern for drag-drop in tables using dnd-kit

**Issues Resolved:**
- Relationship fields in list view columns now fetch and display names (fixed 2026-01-21)
- Field creation bugs fixed during UAT (error handling for ensure_field_group)
- Detail view integration improved (dropdown overflow, search response format)

**Technical Debt Incurred:**
- None

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-01-21*
