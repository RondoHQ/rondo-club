# Milestone v4.5: Calendar Sync Control

**Status:** SHIPPED 2026-01-16
**Phases:** 67-68
**Total Plans:** 3

## Overview

Give users control over calendar sync behavior - date range limits, sync frequency, and calendar selection per connection.

## Phases

### Phase 67: Sync Range & Frequency

**Goal**: Add settings for configuring how far back/forward to sync events and how often to sync
**Depends on**: v4.4 complete
**Plans**: 2/2 complete

Plans:
- [x] 67-01: Sync settings data model and UI
- [x] 67-02: Background sync frequency enforcement

**Details:**

Task 67-01 added:
- `sync_to_days` and `sync_frequency` fields to connection data model
- Calendar providers updated to use configurable sync_to_days
- Settings UI with sync range dropdown (1 week to 90 days)
- Settings UI with frequency dropdown (15 min to daily)
- Server-side validation for frequency values

Task 67-02 added:
- `is_sync_due()` helper for per-connection frequency checking
- Background sync skips connections not yet due
- `next_sync` timestamp in sync status endpoint

### Phase 68: Calendar Selection UI

**Goal**: Add calendar picker to settings allowing users to select which calendars to sync per connection
**Depends on**: Phase 67
**Plans**: 1/1 complete

Plans:
- [x] 68-01: Calendar list endpoint and selection UI

**Details:**

- Added `list_calendars()` method to GoogleProvider
- REST endpoint `GET /rondo/v1/calendar/connections/{id}/calendars`
- CalDAV uses existing `discover_calendars()` method
- EditConnectionModal enhanced with calendar dropdown selector
- Connection card shows selected calendar name
- API client `getConnectionCalendars()` method

### Bug Fixes (during milestone)

- **Duplicate events fix:** Added transient-based sync lock to prevent race conditions
- **Namespace fixes:** Added absolute namespace for Google vendor classes
- **Contact matching fix:** Set user context in calendar matcher for CLI/cron access control

---

## Milestone Summary

**Key Decisions:**
- sync_frequency values in minutes (15, 30, 60, 240, 1440) for WP cron consistency
- Server-side validation ensures only valid frequency values accepted
- Backward compatibility: providers default to 30 days when field not present
- Calendar name saved alongside calendar_id for display purposes
- User context switching in matcher for access control in background contexts

**Issues Resolved:**
- Duplicate calendar events (race condition in concurrent syncs)
- Missing contact matches (access control blocking queries in CLI/cron)
- Google vendor class namespace resolution errors

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
