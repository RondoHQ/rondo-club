# Milestone v8.0: PWA Enhancement

**Status:** SHIPPED 2026-01-28
**Phases:** 107-110
**Total Plans:** 15

## Overview

Transform Stadion into an installable Progressive Web App with native-like UX on iOS and Android. Enables offline access to cached data, pull-to-refresh gestures, smart install prompts, and automatic update notifications.

## Phases

### Phase 107: PWA Foundation

**Goal**: Make Stadion installable on iOS and Android with proper platform-specific support
**Depends on**: Nothing (first phase of milestone)
**Plans**: 4 plans

Plans:
- [x] 107-01: Install vite-plugin-pwa and generate PWA icons
- [x] 107-02: iOS meta tags and safe area CSS
- [x] 107-03: ReloadPrompt component and dynamic theme color
- [x] 107-04: Deploy and verify on devices

**Details:**
- Web App Manifest with name, short_name, icons, theme_color, background_color, display: standalone
- Service worker registration enabling browser install prompt on Android
- Apple Touch icons and iOS-specific meta tags for Add to Home Screen
- Safe area insets for notched devices (iPhone X+)
- Dynamic theme color matching user's configured accent color setting

### Phase 108: Offline Support

**Goal**: Enable basic offline functionality showing cached data when network unavailable
**Depends on**: Phase 107 (service worker must be registered)
**Plans**: 4 plans

Plans:
- [x] 108-01: Core infrastructure (useOnlineStatus hook, TanStack Query integration, offline.html)
- [x] 108-02: OfflineBanner component and App.jsx mounting
- [x] 108-03: Form disabling in edit modals when offline
- [x] 108-04: Deploy and verify offline functionality

**Details:**
- Static assets (JS, CSS, fonts) cached via service worker for offline access
- Offline fallback page when network unavailable and no cached content
- Cached API data (contacts, teams, etc.) displayed when offline (read-only)
- Offline indicator banner when network unavailable
- Edit form mutations disabled when offline to prevent data loss

### Phase 109: Mobile UX

**Goal**: Provide native-like mobile gestures and prevent iOS-specific UX issues
**Depends on**: Phase 108 (offline support should work before adding gestures)
**Plans**: 3 plans

Plans:
- [x] 109-01: Install react-simple-pull-to-refresh and create PullToRefreshWrapper component, add overscroll CSS
- [x] 109-02: Integrate pull-to-refresh into all list views, detail views, and Dashboard
- [x] 109-03: Deploy and verify on devices

**Details:**
- Pull-to-refresh on mobile to reload current view
- iOS standalone mode does not accidentally reload page from overscroll bounce
- Pull-to-refresh gesture feels native and responsive
- Integrated across People, Teams, Commissies, Dates, Todos, Feedback lists, all detail views, and Dashboard

### Phase 110: Install & Polish

**Goal**: Optimize install experience and handle app updates gracefully
**Depends on**: Phase 109 (core PWA functionality complete)
**Plans**: 4 plans

Plans:
- [x] 110-01: Install prompt infrastructure (hooks and utilities)
- [x] 110-02: Install UI components (Android banner, iOS modal)
- [x] 110-03: Update notification enhancement and Dutch localization
- [x] 110-04: Deploy, Lighthouse audit, and device verification

**Details:**
- Android users see smart install prompt after viewing 2 people or adding 1 note
- iOS users can access manual install instructions explaining Add to Home Screen
- Users see update notification when new version available with refresh button
- App passes Lighthouse PWA audit with score above 90
- App works correctly in standalone mode on real iOS and Android devices

---

## Milestone Summary

**Key Decisions:**

- vite-plugin-pwa with generateSW strategy for service worker generation
- NetworkFirst cache strategy for API endpoints to avoid double-caching with TanStack Query
- registerType: 'prompt' to give users control over when to refresh for updates
- Status bar style: "default" for dark text on light backgrounds
- Dual theme-color meta tags with prefers-color-scheme media queries
- Safe area padding: horizontal on body, vertical at component level
- Engagement-based install prompts (2 page views or 1 note) to avoid annoying users
- 7-day cooldown after install prompt dismissal
- Hourly service worker update checking

**Issues Resolved:**

- iOS overscroll bounce causing accidental page reloads in standalone mode
- Service worker navigateFallback path needed WordPress theme base path
- Form mutations needed protection when offline to prevent data loss

**Issues Deferred:**

- iOS 7-day storage eviction: Accept as platform limitation, document for users
- WordPress nonce expiration: Documented for future enhancement
- People list slow when offline: Large data volume, consider optimization in future

**Technical Debt Incurred:**

None

---

_For current project status, see .planning/PROJECT.md_
