# Milestone v9.0: People List Performance & Customization

**Status:** ✅ SHIPPED 2026-01-29
**Phases:** 111-115
**Total Plans:** 10

## Overview

This milestone transforms the People list from load-all-at-once to server-side pagination with filtering/sorting, and adds dynamic per-user column customization. Enables Stadion to scale beyond 1400+ contacts by moving data operations from client-side JavaScript to server-side SQL queries.

## Phases

### Phase 111: Server-Side Foundation

**Goal:** People data can be filtered and sorted at the database layer.
**Depends on:** None
**Plans:** 2 plans

Plans:
- [x] 111-01: Backend Filtered Endpoint — New `/stadion/v1/people/filtered` endpoint with wpdb JOINs
- [x] 111-02: Frontend Hook Integration — useFilteredPeople hook with TanStack Query

**Requirements covered:** DATA-01, DATA-02, DATA-03, DATA-04, DATA-06, DATA-07, DATA-08, DATA-10, DATA-13, DATA-14

---

### Phase 112: Birthdate Denormalization

**Goal:** Birthdate is fast to filter without ACF repeater queries.
**Depends on:** Phase 111
**Plans:** 2 plans

Plans:
- [x] 112-01: Birthdate Denormalization Infrastructure — Sync hooks and WP-CLI migration
- [x] 112-02: Birth Year Filter — Add birth_year parameter to filtered endpoint

**Requirements covered:** DATA-05, DATA-11, DATA-12

---

### Phase 113: Frontend Pagination

**Goal:** People list displays paginated data with navigation controls and custom field sorting.
**Depends on:** Phase 112
**Plans:** 2 plans

Plans:
- [x] 113-01: Backend Custom Field Sorting — Type-appropriate ORDER BY clauses
- [x] 113-02: Frontend Pagination UI — Pagination component and page navigation

**Requirements covered:** PAGE-01, PAGE-02, PAGE-03, PAGE-04, PAGE-05, PAGE-06, DATA-09

---

### Phase 114: User Preferences Backend

**Goal:** Column preferences persist per user in server storage.
**Depends on:** Phase 113
**Plans:** 1 plan

Plans:
- [x] 114-01: REST API Endpoints — GET/PATCH /stadion/v1/user/list-preferences

**Requirements covered:** COL-03

---

### Phase 115: Column Preferences UI

**Goal:** Users can customize which columns appear and in what order.
**Depends on:** Phase 114
**Plans:** 5 plans

Plans:
- [x] 115-01: Preferences API and Hook — Backend column_order/column_widths storage + useListPreferences hook
- [x] 115-02: ColumnSettingsModal — Drag-drop reordering with @dnd-kit
- [x] 115-03: useColumnResize Hook — Pointer events for column width adjustment
- [x] 115-04: PeopleList Integration — Wire up preferences, modal, and resize
- [x] 115-05: Remove List View Settings — Remove show_in_list_view from custom field form

**Requirements covered:** COL-01, COL-02, COL-04, COL-05, COL-06, COL-07

---

## Milestone Summary

**Key Decisions:**

| ID | Decision | Rationale |
|----|----------|-----------|
| 111-01-001 | Use wpdb with LEFT JOIN for meta fields | Ensures people without first_name/last_name are still returned |
| 111-01-002 | Use INNER JOIN for taxonomy filters | Only want people WITH matching labels |
| 112-01-001 | Store birthdate as YYYY-MM-DD in _birthdate meta | MySQL DATE type enables YEAR() function |
| 113-01-001 | Use Manager::get_fields() for validation | Reuses existing CustomFields Manager infrastructure |
| 114-01-001 | Store preferences in wp_usermeta | Follows theme_preferences pattern |
| 115-01-003 | Use localStorage as instant cache for column widths | Prevents visual flicker on page load |
| 115-01-004 | Debounce width updates by 300ms | Prevents excessive API calls during resize |
| 115-04-001 | Combined first_name/last_name into single "Naam" column | Cleaner UI, saves horizontal space |

**Issues Resolved:**

- Performance with 1400+ contacts (reduced data transfer 14x)
- Slow birth year filtering (denormalized to avoid ACF repeater LIKE queries)
- No column customization (users can now show/hide and reorder)

**Tech Debt Incurred:**

- Cross-tab synchronization not implemented (localStorage event listener or BroadcastChannel)
- refetchOnWindowFocus not enabled in TanStack Query config

---

_For current project status, see .planning/ROADMAP.md (next milestone)_
_Archived: 2026-01-29 as part of v9.0 milestone completion_
