# Milestone v20.0: Configurable Roles

**Status:** SHIPPED 2026-02-08
**Phases:** 151-154
**Total Plans:** 4

## Overview

Replace hardcoded club-specific arrays with database-driven settings and dynamic queries so any sports club can use Rondo Club without code changes. This milestone removes the last club-specific assumptions from the codebase by making filter options dynamic, role classifications configurable, and cleaning up default fallbacks from the sync layer.

## Phases

### Phase 151: Dynamic Filters

**Goal**: Filter options on the People list are derived from actual data in the database, not hardcoded arrays
**Depends on**: Nothing (first phase in milestone)
**Requirements**: FILT-01, FILT-02, FILT-03, FILT-04
**Plans**: 2 plans

Plans:
- [x] 151-01-PLAN.md -- Backend REST endpoint for filter options with generic infrastructure
- [x] 151-02-PLAN.md -- Frontend hook, dynamic dropdowns, documentation

**Details:**
- Created `/rondo/v1/people/filter-options` endpoint with 401 permission check
- Implemented generic filter infrastructure via `get_dynamic_filter_config()`
- Smart age group sorting (numeric extraction + gender variant detection)
- Member type priority sorting (Junior=1, Senior=2, etc.)
- Frontend useFilterOptions hook with 5-minute staleTime caching
- Dynamic dropdowns with loading/error/success states and count display
- Stale URL params cleared silently for better UX

### Phase 152: Role Settings

**Goal**: Admins can configure which job titles are "player roles" and which are "excluded/honorary roles" via the Settings UI
**Depends on**: Nothing (independent of Phase 151)
**Requirements**: ROLE-01, ROLE-02, ROLE-03, ROLE-04, ROLE-08
**Plans**: 0 plans (pre-existing implementation satisfied all criteria)

**Details:**
Pre-existing from v19.1.0. Role settings UI, REST API (`/rondo/v1/volunteer-roles/available`, `/rondo/v1/volunteer-roles/settings`), and WordPress options storage (`rondo_player_roles`, `rondo_excluded_roles`) were already implemented. All success criteria verified met.

### Phase 153: Wire Up Role Settings

**Goal**: Business logic uses configured role settings instead of hardcoded arrays
**Depends on**: Phase 152 (settings must exist before they can be consumed)
**Requirements**: ROLE-05, ROLE-06, ROLE-07
**Plans**: 1 plan

Plans:
- [x] 153-01-PLAN.md -- Fix API permission, create useVolunteerRoleSettings hook, wire TeamDetail

**Details:**
- Created useVolunteerRoleSettings hook following TanStack Query pattern
- Removed hardcoded 9-element playerRoles array from TeamDetail.jsx
- Fixed API permission: GET endpoint accessible to all authenticated users (was admin-only)
- Team detail page player/staff split driven by configured settings
- Empty array fallback for graceful degradation if settings unavailable

### Phase 154: Sync Cleanup

**Goal**: Rondo-sync no longer ships with default role fallbacks, relying entirely on Rondo Club settings
**Depends on**: Phase 153 (settings must be wired up before removing fallbacks)
**Requirements**: SYNC-01
**Plans**: 1 plan

Plans:
- [x] 154-01-PLAN.md -- Remove hardcoded role fallbacks, drop member_type column, simplify role lookup

**Details:**
- Zero hardcoded role fallback values ('Speler', 'Staflid', 'Lid') remain in JavaScript codebase
- sportlink_team_members table simplified — member_type column removed with migration
- Sync passes through Sportlink-provided role descriptions without modification
- Missing role descriptions trigger skip-and-warn behavior instead of silent fallbacks
- Dead getTeamMemberCounts function removed
- Cross-repo changes: rondo-sync updated in separate repository

---

## Milestone Summary

**Key Decisions:**
- Generic filter config pattern makes future dynamic filters a one-line addition
- Smart age group sorting uses numeric extraction with gender variant detection
- Member types use priority array with unknown types at end
- 5-minute staleTime for filter options and role settings (rarely-changing data)
- GET /rondo/v1/volunteer-roles/settings accessible to all authenticated users, POST admin-only
- Skip-and-warn pattern for missing data instead of silent fallbacks
- rondo-sync passes through Sportlink role descriptions without modification
- Database migrations use PRAGMA table_info checks before ALTER TABLE

**Issues Resolved:**
- Age group and member type filters were hardcoded to AWC-specific values
- Player role classification was hardcoded in both frontend and sync layer
- Sync layer had hidden fallback values masking data quality issues

**Issues Deferred:**
None — all v20.0 requirements fully addressed.

**Technical Debt Incurred:**
None — clean implementation with no deferred items or workarounds.

---

_For current project status, see .planning/ROADMAP.md_
