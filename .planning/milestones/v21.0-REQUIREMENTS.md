# Requirements Archive: v21.0 Per-Season Fee Categories

**Archived:** 2026-02-09
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: Rondo Club v21.0 Per-Season Fee Categories

**Defined:** 2026-02-07
**Core Value:** Fee categories are fully configurable per season, removing all hardcoded category definitions from the codebase.

## v21.0 Requirements

### Data Model

- [x] **DATA-01**: Fee category definitions (slug, label, amount, age_classes, is_youth, sort_order) are stored per season in the existing `rondo_membership_fees_{season}` WordPress option
- [x] **DATA-02**: On first load, current season option is auto-enriched with today's hardcoded category values (migration) *(Intentionally skipped per CONTEXT.md: no auto-migration, manual data population for single-club app)*
- [x] **DATA-03**: Creating a new season auto-copies the full category configuration from the previous season

### Backend Logic

- [x] **LOGIC-01**: `parse_age_group()` is replaced by `get_category_by_age_class()` which matches Sportlink age class strings against season category `age_classes` arrays
- [x] **LOGIC-02**: `VALID_TYPES` is derived from season category config (no hardcoded constant)
- [x] **LOGIC-03**: `youth_categories` is derived from `is_youth` flag in category config (no hardcoded arrays)
- [x] **LOGIC-04**: Category sort order is derived from config (removing duplicated `category_order` arrays from `class-rest-api.php`, `class-rest-google-sheets.php`, and `ContributieList.jsx`)
- [x] **LOGIC-05**: Fee calculation correctly uses per-season categories for both current and forecast modes

### REST API

- [x] **API-01**: Fee settings GET endpoint returns full category definitions per season (not just amounts)
- [x] **API-02**: Fee settings POST endpoint accepts category add, edit, remove, and reorder operations
- [x] **API-03**: Fee list endpoint includes category metadata (labels, sort order) in response so frontend does not need hardcoded mappings
- [x] **API-04**: Category validation: no duplicate slugs, required fields (slug, label, amount), duplicate age class assignment warning

### Settings UI

- [x] **UI-01**: Admin can manage fee categories in the fee settings section (add, edit, remove categories)
- [x] **UI-02**: Per-category fields editable: slug (auto-derived from label), label, amount, age_classes (database-driven multi-select), youth/familiekorting flag
- [x] **UI-03**: Season selector for managing category configs of different seasons
- [x] **UI-04**: Drag-and-drop reordering of categories in the settings UI
- [x] **UI-05**: Visual age class coverage display showing which Sportlink age classes are assigned to which categories

### Frontend Display

- [x] **DISPLAY-01**: Fee list category badges (labels, colors) are derived from API response, not hardcoded `FEE_CATEGORIES`
- [x] **DISPLAY-02**: Category colors are auto-assigned from a fixed palette based on sort order
- [x] **DISPLAY-03**: Google Sheets export uses dynamic category definitions from config

## Future Requirements

- Configurable category colors per category — deferred, auto-assigned palette sufficient for now
- Per-category discount rules — currently family discount is universal, could be per-category in future

## Out of Scope

| Feature | Reason |
|---------|--------|
| Custom category colors | Auto-assigned palette is simpler and consistent |
| Category archival/history | Seasons already provide temporal separation |
| Category import/export | WordPress options are portable enough |
| Auto-detect age classes from Sportlink | Age classes are configured manually per category; auto-populate from Sportlink member data could be added later |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| DATA-01 | 155 | Complete |
| DATA-02 | 155 | Complete (skipped per CONTEXT.md) |
| DATA-03 | 155 | Complete |
| LOGIC-01 | 156 | Complete |
| LOGIC-02 | 156 | Complete |
| LOGIC-03 | 156 | Complete |
| LOGIC-04 | 156 | Complete |
| LOGIC-05 | 156 | Complete |
| API-01 | 157 | Complete |
| API-02 | 157 | Complete |
| API-03 | 157 | Complete |
| API-04 | 157 | Complete |
| UI-01 | 158 | Complete |
| UI-02 | 158 | Complete |
| UI-03 | 158 | Complete |
| UI-04 | 158 | Complete |
| UI-05 | 158 | Complete |
| DISPLAY-01 | 159 | Complete |
| DISPLAY-02 | 159 | Complete |
| DISPLAY-03 | 159 | Complete |

**Coverage:**
- v21.0 requirements: 20 total
- Mapped to phases: 20
- Unmapped: 0

---
*Requirements defined: 2026-02-07*
*Last updated: 2026-02-09 — Phase 157 requirements marked Complete*
