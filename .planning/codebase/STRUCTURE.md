# Codebase Structure

**Analysis Date:** 2025-01-13

## Directory Layout

```
caelis/
├── index.php              # WordPress template (React mount point)
├── functions.php          # Theme setup & class initialization
├── style.css              # Theme header (version metadata)
├── vite.config.js         # Vite build configuration
├── package.json           # JS dependencies & scripts
├── composer.json          # PHP dependencies
├── tailwind.config.js     # Tailwind CSS config
├── postcss.config.js      # PostCSS config
├── README.md              # Project documentation
│
├── src/                   # React application source
│   ├── main.jsx          # React bootstrap
│   ├── App.jsx           # Route definitions
│   ├── index.css         # Global styles (Tailwind base)
│   ├── api/              # API client
│   ├── components/       # Reusable UI components
│   ├── hooks/            # React Query & custom hooks
│   ├── pages/            # Route page components
│   ├── utils/            # Helper functions
│   └── constants/        # App constants
│
├── includes/             # PHP backend services
│   ├── class-*.php       # Service classes
│   └── carddav/          # CardDAV protocol implementation
│
├── dist/                 # Vite build output (gitignored)
│   ├── assets/           # Bundled JS/CSS
│   └── .vite/            # Asset manifest
│
├── acf-json/             # ACF Pro field exports
├── docs/                 # Documentation files
├── node_modules/         # JS dependencies (gitignored)
└── vendor/               # PHP dependencies (gitignored)
```

## Directory Purposes

**src/**
- Purpose: React SPA source code
- Contains: JSX components, JavaScript modules
- Key files: `main.jsx` (entry), `App.jsx` (router)
- Subdirectories: api, components, hooks, pages, utils, constants

**src/api/**
- Purpose: API client and endpoint definitions
- Contains: `client.js` with Axios instance and API facades
- Key files: `client.js` (wpApi and prmApi objects)

**src/components/**
- Purpose: Reusable UI components
- Contains: Modal dialogs, layout, import wizards, timeline views
- Key files: `*EditModal.jsx`, `RichTextEditor.jsx`
- Subdirectories: `layout/`, `Timeline/`, `family-tree/`, `import/`

**src/hooks/**
- Purpose: React Query hooks and custom hooks
- Contains: Data fetching, mutations, utility hooks
- Key files: `usePeople.js`, `useDashboard.js`, `useAuth.js`, `useVersionCheck.js`

**src/pages/**
- Purpose: Route page components
- Contains: Full page views for each route
- Key files: `Dashboard.jsx`, `Login.jsx`
- Subdirectories: `People/`, `Companies/`, `Dates/`, `Todos/`, `Settings/`

**src/utils/**
- Purpose: Pure utility functions
- Contains: Formatters, timeline helpers, vCard parser, tree builder
- Key files: `formatters.js`, `timeline.js`, `vcard.js`, `familyTreeBuilder.js`

**includes/**
- Purpose: PHP backend services
- Contains: WordPress hooks, REST endpoints, integrations
- Key files: `class-rest-api.php` (largest, ~107KB), `class-reminders.php`, `class-access-control.php`
- Subdirectories: `carddav/` (CardDAV protocol)

**includes/carddav/**
- Purpose: CardDAV protocol implementation
- Contains: Sabre DAV backends
- Key files: `class-carddav-backend.php`, `class-auth-backend.php`, `class-principal-backend.php`

**dist/**
- Purpose: Production build output
- Contains: Bundled and minified assets
- Source: Generated by `npm run build`
- Committed: No (gitignored)

**acf-json/**
- Purpose: ACF Pro field group exports
- Contains: JSON field definitions
- Source: Auto-generated by ACF sync feature

## Key File Locations

**Entry Points:**
- `index.php` - WordPress template, renders `<div id="root">`
- `src/main.jsx` - React bootstrap, QueryClient setup
- `src/App.jsx` - Route definitions, auth guards
- `functions.php` - PHP initialization, class loading

**Configuration:**
- `vite.config.js` - Build tool config
- `tailwind.config.js` - CSS framework config
- `package.json` - Dependencies and scripts
- `composer.json` - PHP dependencies

**Core Logic:**
- `src/api/client.js` - All API endpoint definitions
- `includes/class-rest-api.php` - Custom REST endpoints
- `includes/class-access-control.php` - Data isolation
- `includes/class-reminders.php` - Notification system

**Testing:**
- No test files currently exist

**Documentation:**
- `README.md` - Main project documentation
- `docs/` - Additional documentation files

## Naming Conventions

**Files:**
- React components: PascalCase (`PersonEditModal.jsx`, `Dashboard.jsx`)
- React hooks: camelCase with `use` prefix (`usePeople.js`, `useAuth.js`)
- Utilities: camelCase (`formatters.js`, `timeline.js`)
- PHP classes: kebab-case with `class-` prefix (`class-rest-api.php`)
- Config files: lowercase with dots (`vite.config.js`)

**Directories:**
- lowercase for all directories
- Plural for collections (`components/`, `hooks/`, `pages/`)
- PascalCase for page subdirectories (`People/`, `Companies/`)

**Special Patterns:**
- `*Modal.jsx` - Modal dialog components
- `use*.js` - React hooks
- `class-*.php` - PHP service classes
- `PRM_*` - PHP class name prefix

## Where to Add New Code

**New Feature (full-stack):**
- Page component: `src/pages/{Feature}/{FeaturePage}.jsx`
- Hook: `src/hooks/use{Feature}.js`
- API endpoints: Add to `src/api/client.js`
- Backend: `includes/class-{feature}.php`
- Route: Add to `src/App.jsx`

**New Component:**
- Implementation: `src/components/{ComponentName}.jsx`
- Modal: `src/components/{Resource}EditModal.jsx`

**New React Hook:**
- Implementation: `src/hooks/use{HookName}.js`
- Pattern: TanStack Query wrapper with query key

**New REST Endpoint:**
- PHP handler: `includes/class-rest-api.php` (add route registration)
- Client method: `src/api/client.js` (add to wpApi or prmApi)

**New Utility Function:**
- Implementation: `src/utils/{domain}.js`
- Export from appropriate utils file

**New PHP Service:**
- Implementation: `includes/class-{service-name}.php`
- Instantiation: Add to `prm_init()` in `functions.php`

## Special Directories

**dist/**
- Purpose: Production build output
- Source: Generated by `npm run build`
- Committed: No (in `.gitignore`)

**node_modules/**
- Purpose: JavaScript dependencies
- Source: Installed by `npm install`
- Committed: No (in `.gitignore`)

**vendor/**
- Purpose: PHP dependencies
- Source: Installed by `composer install`
- Committed: No (in `.gitignore`)

**acf-json/**
- Purpose: ACF field group sync
- Source: Auto-generated by ACF Pro
- Committed: Yes (version controlled)

---

*Structure analysis: 2025-01-13*
*Update when directory structure changes*
