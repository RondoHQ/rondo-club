---
phase: 09-sharing-ui
plan: 01
type: execute
depends_on: []
files_modified: [src/api/client.js, src/hooks/useWorkspaces.js]
---

<objective>
Create TanStack Query hooks and API client methods for workspace and sharing operations.

Purpose: Establish the data layer foundation that all UI components in Phase 9 depend on.
Output: Working API client methods and React hooks for workspaces, members, invites, and shares.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-workspace-infrastructure/08-01-SUMMARY.md
@.planning/phases/08-workspace-infrastructure/08-02-SUMMARY.md
@src/api/client.js
@src/hooks/usePeople.js

**Available REST Endpoints (from Phase 8):**
- GET/POST /prm/v1/workspaces - List/create workspaces
- GET/PUT/DELETE /prm/v1/workspaces/{id} - Workspace CRUD
- POST/DELETE/PUT /prm/v1/workspaces/{id}/members - Member management
- GET/POST /prm/v1/workspaces/{id}/invites - Invite management
- DELETE /prm/v1/workspaces/{id}/invites/{invite_id} - Revoke invite
- GET /prm/v1/invites/{token} - Validate invite (public)
- POST /prm/v1/invites/{token}/accept - Accept invite

**Established Patterns:**
- API client uses `api.get/post/put/delete` with axios
- Hooks use TanStack Query with `useQuery` and `useMutation`
- Query keys follow pattern: `['resource']`, `['resource', id]`
- Mutations invalidate related queries on success
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add workspace and sharing API methods to client.js</name>
  <files>src/api/client.js</files>
  <action>
Add workspace methods to the `prmApi` object following existing patterns:

```javascript
// Workspaces
getWorkspaces: () => api.get('/prm/v1/workspaces'),
getWorkspace: (id) => api.get(`/prm/v1/workspaces/${id}`),
createWorkspace: (data) => api.post('/prm/v1/workspaces', data),
updateWorkspace: (id, data) => api.put(`/prm/v1/workspaces/${id}`, data),
deleteWorkspace: (id) => api.delete(`/prm/v1/workspaces/${id}`),

// Workspace members
addWorkspaceMember: (workspaceId, data) => api.post(`/prm/v1/workspaces/${workspaceId}/members`, data),
removeWorkspaceMember: (workspaceId, userId) => api.delete(`/prm/v1/workspaces/${workspaceId}/members/${userId}`),
updateWorkspaceMember: (workspaceId, userId, data) => api.put(`/prm/v1/workspaces/${workspaceId}/members/${userId}`, data),

// Workspace invites
getWorkspaceInvites: (workspaceId) => api.get(`/prm/v1/workspaces/${workspaceId}/invites`),
createWorkspaceInvite: (workspaceId, data) => api.post(`/prm/v1/workspaces/${workspaceId}/invites`, data),
revokeWorkspaceInvite: (workspaceId, inviteId) => api.delete(`/prm/v1/workspaces/${workspaceId}/invites/${inviteId}`),

// Public invite endpoints (no auth required for validation)
validateInvite: (token) => api.get(`/prm/v1/invites/${token}`),
acceptInvite: (token) => api.post(`/prm/v1/invites/${token}/accept`),

// Sharing (for ShareModal - uses existing _shared_with meta)
getPostShares: (postId, postType) => api.get(`/prm/v1/${postType}/${postId}/shares`),
sharePost: (postId, postType, data) => api.post(`/prm/v1/${postType}/${postId}/shares`, data),
unsharePost: (postId, postType, userId) => api.delete(`/prm/v1/${postType}/${postId}/shares/${userId}`),

// User search for sharing
searchUsers: (query) => api.get('/prm/v1/users/search', { params: { q: query } }),
```

Note: The sharing endpoints don't exist yet in the backend - they will need to be added. For now, add the client methods so the UI can be built. The backend will be added if needed or sharing can use direct ACF field updates.
  </action>
  <verify>No syntax errors in client.js - check with `npm run lint`</verify>
  <done>All workspace, member, invite, and sharing API methods added to prmApi object</done>
</task>

<task type="auto">
  <name>Task 2: Create useWorkspaces.js hook</name>
  <files>src/hooks/useWorkspaces.js</files>
  <action>
Create a new hook file following the pattern from usePeople.js:

```javascript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { prmApi } from '@/api/client';

// List all workspaces for current user
export function useWorkspaces() {
  return useQuery({
    queryKey: ['workspaces'],
    queryFn: async () => {
      const response = await prmApi.getWorkspaces();
      return response.data;
    },
  });
}

// Get single workspace with members
export function useWorkspace(id) {
  return useQuery({
    queryKey: ['workspaces', id],
    queryFn: async () => {
      const response = await prmApi.getWorkspace(id);
      return response.data;
    },
    enabled: !!id,
  });
}

// Create workspace mutation
export function useCreateWorkspace() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async (data) => {
      const response = await prmApi.createWorkspace(data);
      return response.data;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['workspaces'] });
    },
  });
}

// Update workspace mutation
export function useUpdateWorkspace() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ id, data }) => {
      const response = await prmApi.updateWorkspace(id, data);
      return response.data;
    },
    onSuccess: (_, { id }) => {
      queryClient.invalidateQueries({ queryKey: ['workspaces'] });
      queryClient.invalidateQueries({ queryKey: ['workspaces', id] });
    },
  });
}

// Delete workspace mutation
export function useDeleteWorkspace() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async (id) => {
      await prmApi.deleteWorkspace(id);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['workspaces'] });
    },
  });
}

// Member management
export function useAddWorkspaceMember() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ workspaceId, userId, role }) => {
      const response = await prmApi.addWorkspaceMember(workspaceId, { user_id: userId, role });
      return response.data;
    },
    onSuccess: (_, { workspaceId }) => {
      queryClient.invalidateQueries({ queryKey: ['workspaces', workspaceId] });
    },
  });
}

export function useRemoveWorkspaceMember() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ workspaceId, userId }) => {
      await prmApi.removeWorkspaceMember(workspaceId, userId);
    },
    onSuccess: (_, { workspaceId }) => {
      queryClient.invalidateQueries({ queryKey: ['workspaces', workspaceId] });
    },
  });
}

export function useUpdateWorkspaceMember() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ workspaceId, userId, role }) => {
      const response = await prmApi.updateWorkspaceMember(workspaceId, userId, { role });
      return response.data;
    },
    onSuccess: (_, { workspaceId }) => {
      queryClient.invalidateQueries({ queryKey: ['workspaces', workspaceId] });
    },
  });
}

// Invite management
export function useWorkspaceInvites(workspaceId) {
  return useQuery({
    queryKey: ['workspaces', workspaceId, 'invites'],
    queryFn: async () => {
      const response = await prmApi.getWorkspaceInvites(workspaceId);
      return response.data;
    },
    enabled: !!workspaceId,
  });
}

export function useCreateWorkspaceInvite() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ workspaceId, email, role }) => {
      const response = await prmApi.createWorkspaceInvite(workspaceId, { email, role });
      return response.data;
    },
    onSuccess: (_, { workspaceId }) => {
      queryClient.invalidateQueries({ queryKey: ['workspaces', workspaceId, 'invites'] });
    },
  });
}

export function useRevokeWorkspaceInvite() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ workspaceId, inviteId }) => {
      await prmApi.revokeWorkspaceInvite(workspaceId, inviteId);
    },
    onSuccess: (_, { workspaceId }) => {
      queryClient.invalidateQueries({ queryKey: ['workspaces', workspaceId, 'invites'] });
    },
  });
}

// Public invite validation (for accept page)
export function useValidateInvite(token) {
  return useQuery({
    queryKey: ['invite', token],
    queryFn: async () => {
      const response = await prmApi.validateInvite(token);
      return response.data;
    },
    enabled: !!token,
    retry: false, // Don't retry on invalid token
  });
}

export function useAcceptInvite() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async (token) => {
      const response = await prmApi.acceptInvite(token);
      return response.data;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['workspaces'] });
    },
  });
}
```

Use named exports (not default) following the pattern in usePeople.js.
  </action>
  <verify>`npm run lint` passes, no import errors</verify>
  <done>useWorkspaces.js hook created with all workspace, member, and invite operations</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes with no errors
- [ ] `npm run build` succeeds
- [ ] No TypeScript/import errors in new files
</verification>

<success_criteria>

- All workspace API methods added to client.js
- useWorkspaces.js hook created with all CRUD operations
- Member and invite management hooks working
- Lint and build pass
</success_criteria>

<output>
After completion, create `.planning/phases/09-sharing-ui/09-01-SUMMARY.md`
</output>
