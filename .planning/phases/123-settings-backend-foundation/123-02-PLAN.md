# Plan 123-02: Settings UI subtab with fee configuration form

---
wave: 2
depends_on:
  - 123-01
files_modified:
  - src/pages/Settings/Settings.jsx
autonomous: true
---

## Goal

Add a "Contributie" subtab to the Admin tab in Settings, displaying a form where administrators can configure the six membership fee amounts. The form should load current values, allow editing, and save changes to the backend.

## Context

- Depends on 123-01 (REST API endpoints must exist first)
- The Admin tab already exists in Settings.jsx with adminOnly: true
- Follow the VOGTab pattern for form structure and state management
- Use existing UI patterns: card layout, number inputs, save button with loading state
- Dutch labels as used throughout the application

## Tasks

<task id="1">
Add state variables for membership fee settings near the VOG settings state (around line 119-131):

```javascript
// Membership fee settings state
const [feeSettings, setFeeSettings] = useState({
  mini: 130,
  pupil: 180,
  junior: 230,
  senior: 255,
  recreant: 65,
  donateur: 55,
});
const [feeLoading, setFeeLoading] = useState(true);
const [feeSaving, setFeeSaving] = useState(false);
const [feeMessage, setFeeMessage] = useState('');
```
</task>

<task id="2">
Add useEffect to fetch membership fee settings on mount (admin only), near the VOG settings fetch (around line 288-309):

```javascript
// Fetch membership fee settings on mount (admin only)
useEffect(() => {
  const fetchFeeSettings = async () => {
    if (!isAdmin) {
      setFeeLoading(false);
      return;
    }
    try {
      const response = await prmApi.getMembershipFeeSettings();
      setFeeSettings(response.data);
    } catch {
      // Fee settings fetch failed silently
    } finally {
      setFeeLoading(false);
    }
  };
  fetchFeeSettings();
}, [isAdmin]);
```
</task>

<task id="3">
Add save handler for membership fee settings (near handleVogSave around line 311-330):

```javascript
// Handle membership fee settings save
const handleFeeSave = async () => {
  setFeeSaving(true);
  setFeeMessage('');
  try {
    const response = await prmApi.updateMembershipFeeSettings(feeSettings);
    setFeeSettings(response.data);
    setFeeMessage('Contributie-instellingen opgeslagen');
  } catch (error) {
    setFeeMessage('Fout bij opslaan: ' + (error.response?.data?.message || 'Onbekende fout'));
  } finally {
    setFeeSaving(false);
  }
};
```
</task>

<task id="4">
Add ADMIN_SUBTABS configuration near CONNECTION_SUBTABS (around line 27-33):

```javascript
// Admin subtabs configuration
const ADMIN_SUBTABS = [
  { id: 'users', label: 'Gebruikers', icon: Users },
  { id: 'fees', label: 'Contributie', icon: Coins },
];
```

Note: Import the `Coins` icon from lucide-react at the top of the file (add to existing import).
</task>

<task id="5">
Modify the Admin tab case in renderTabContent (around line 723-731) to use subtabs:

```javascript
case 'admin':
  return isAdmin ? (
    <AdminTabWithSubtabs
      activeSubtab={activeSubtab}
      setActiveSubtab={(subtab) => navigate(`/settings/admin/${subtab}`)}
      handleTriggerReminders={handleTriggerReminders}
      triggeringReminders={triggeringReminders}
      reminderMessage={reminderMessage}
      handleRescheduleCron={handleRescheduleCron}
      reschedulingCron={reschedulingCron}
      cronMessage={cronMessage}
      feeSettings={feeSettings}
      setFeeSettings={setFeeSettings}
      feeLoading={feeLoading}
      feeSaving={feeSaving}
      feeMessage={feeMessage}
      handleFeeSave={handleFeeSave}
    />
  ) : null;
```

Also update the setActiveTab function (around line 48-57) to handle admin tab with subtabs:
```javascript
} else if (tab === 'admin') {
  // Default to users subtab when switching to admin
  navigate(`/settings/${tab}/users`);
}
```
</task>

<task id="6">
Create the AdminTabWithSubtabs component. Add this before or after the existing AdminTab function (around line 3275):

```javascript
// Admin Tab with Subtabs
function AdminTabWithSubtabs({
  activeSubtab,
  setActiveSubtab,
  handleTriggerReminders,
  triggeringReminders,
  reminderMessage,
  handleRescheduleCron,
  reschedulingCron,
  cronMessage,
  feeSettings,
  setFeeSettings,
  feeLoading,
  feeSaving,
  feeMessage,
  handleFeeSave,
}) {
  return (
    <div className="space-y-6">
      {/* Subtab Navigation */}
      <div className="border-b border-gray-200 dark:border-gray-700">
        <nav className="-mb-px flex space-x-6" aria-label="Admin subtabs">
          {ADMIN_SUBTABS.map((subtab) => {
            const Icon = subtab.icon;
            const isActive = activeSubtab === subtab.id;
            return (
              <button
                key={subtab.id}
                onClick={() => setActiveSubtab(subtab.id)}
                className={`
                  flex items-center gap-2 py-3 px-1 border-b-2 font-medium text-sm whitespace-nowrap
                  ${isActive
                    ? 'border-accent-500 text-accent-600 dark:border-accent-400 dark:text-accent-400'
                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-600'}
                `}
              >
                <Icon className="w-4 h-4" />
                {subtab.label}
              </button>
            );
          })}
        </nav>
      </div>

      {/* Subtab Content */}
      {activeSubtab === 'users' || !activeSubtab ? (
        <AdminTab
          handleTriggerReminders={handleTriggerReminders}
          triggeringReminders={triggeringReminders}
          reminderMessage={reminderMessage}
          handleRescheduleCron={handleRescheduleCron}
          reschedulingCron={reschedulingCron}
          cronMessage={cronMessage}
        />
      ) : activeSubtab === 'fees' ? (
        <FeesSubtab
          feeSettings={feeSettings}
          setFeeSettings={setFeeSettings}
          feeLoading={feeLoading}
          feeSaving={feeSaving}
          feeMessage={feeMessage}
          handleFeeSave={handleFeeSave}
        />
      ) : null}
    </div>
  );
}
```
</task>

<task id="7">
Create the FeesSubtab component (add near AdminTabWithSubtabs):

```javascript
// Fees Subtab Component
function FeesSubtab({
  feeSettings,
  setFeeSettings,
  feeLoading,
  feeSaving,
  feeMessage,
  handleFeeSave,
}) {
  const FEE_TYPES = [
    { key: 'mini', label: 'Mini', description: 'Leeftijd 4-6 jaar' },
    { key: 'pupil', label: 'Pupil', description: 'Leeftijd 7-12 jaar' },
    { key: 'junior', label: 'Junior', description: 'Leeftijd 13-17 jaar' },
    { key: 'senior', label: 'Senior', description: 'Leeftijd 18+ jaar' },
    { key: 'recreant', label: 'Recreant', description: 'Recreatief lid' },
    { key: 'donateur', label: 'Donateur', description: 'Steunend lid' },
  ];

  return (
    <div className="space-y-6">
      <div>
        <h3 className="text-lg font-medium text-gray-900 dark:text-gray-100">
          Contributie-instellingen
        </h3>
        <p className="mt-1 text-sm text-gray-500 dark:text-gray-400">
          Configureer de contributiebedragen per leeftijdscategorie.
        </p>
      </div>

      {feeLoading ? (
        <div className="flex items-center justify-center py-8">
          <Loader2 className="w-6 h-6 animate-spin text-accent-500" />
        </div>
      ) : (
        <div className="space-y-4">
          {FEE_TYPES.map(({ key, label, description }) => (
            <div key={key} className="flex items-center gap-4">
              <div className="flex-1">
                <label
                  htmlFor={`fee-${key}`}
                  className="block text-sm font-medium text-gray-700 dark:text-gray-300"
                >
                  {label}
                </label>
                <p className="text-xs text-gray-500 dark:text-gray-400">{description}</p>
              </div>
              <div className="relative">
                <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400">
                  &euro;
                </span>
                <input
                  type="number"
                  id={`fee-${key}`}
                  min="0"
                  step="1"
                  value={feeSettings[key] ?? 0}
                  onChange={(e) =>
                    setFeeSettings((prev) => ({
                      ...prev,
                      [key]: parseInt(e.target.value, 10) || 0,
                    }))
                  }
                  className="w-28 pl-8 pr-3 py-2 text-right rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-accent-500 focus:ring-accent-500 sm:text-sm"
                />
              </div>
            </div>
          ))}

          {/* Save button and message */}
          <div className="flex items-center gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
            <button
              onClick={handleFeeSave}
              disabled={feeSaving}
              className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-accent-600 hover:bg-accent-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-500 disabled:opacity-50"
            >
              {feeSaving ? (
                <>
                  <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                  Opslaan...
                </>
              ) : (
                'Opslaan'
              )}
            </button>
            {feeMessage && (
              <span
                className={`text-sm ${
                  feeMessage.startsWith('Fout')
                    ? 'text-red-600 dark:text-red-400'
                    : 'text-green-600 dark:text-green-400'
                }`}
              >
                {feeMessage}
              </span>
            )}
          </div>
        </div>
      )}
    </div>
  );
}
```
</task>

<task id="8">
Add `Coins` to the lucide-react import at the top of the file (line 3):

Find:
```javascript
import { Share2, Bell, Database, Shield, Info, FileCode, FileSpreadsheet, Download, Palette, Sun, Moon, Monitor, Calendar, RefreshCw, Trash2, Edit2, ExternalLink, AlertCircle, Check, X, Users, MessageSquare, Search, User, Link as LinkIcon, Loader2, CheckCircle, Key, Copy, FileCheck } from 'lucide-react';
```

Add `Coins` after `Check` or at an appropriate position in alphabetical order.
</task>

<task id="9">
Build, deploy and verify:
1. Run `npm run lint` to check for errors
2. Run `npm run build` to compile frontend
3. Deploy using `bin/deploy.sh`
4. Verify in browser:
   - Navigate to Settings > Admin
   - Subtabs "Gebruikers" and "Contributie" should appear
   - Contributie tab shows form with 6 fee inputs
   - Change values and save, reload to verify persistence
</task>

## Verification

After completing all tasks:
- [ ] Admin tab has subtab navigation with "Gebruikers" and "Contributie"
- [ ] Contributie subtab displays form with 6 fee inputs (Mini, Pupil, Junior, Senior, Recreant, Donateur)
- [ ] Each input shows current value from backend
- [ ] Editing a value and clicking save updates the backend
- [ ] Success/error messages display appropriately
- [ ] Reloading the page shows persisted values
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds

## must_haves

These criteria verify the phase goal "Admin can configure all fee amounts through settings UI":

1. Admin sees "Contributie" subtab under Settings > Admin
2. Admin can set Mini fee amount (default: 130)
3. Admin can set Pupil fee amount (default: 180)
4. Admin can set Junior fee amount (default: 230)
5. Admin can set Senior fee amount (default: 255)
6. Admin can set Recreant fee amount (default: 65)
7. Admin can set Donateur fee amount (default: 55)
8. Fee amounts persist across page reloads
