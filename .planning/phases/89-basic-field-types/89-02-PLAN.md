---
phase: 89-basic-field-types
plan: 02
type: execute
wave: 2
depends_on: [89-01]
files_modified:
  - src/components/FieldFormPanel.jsx
autonomous: true

must_haves:
  truths:
    - "Admin sees relevant options when selecting Number type (min, max, step)"
    - "Admin sees choices editor when selecting Select or Checkbox type"
    - "Admin sees format options when selecting Date type"
    - "Admin sees toggle options when selecting True/False type"
    - "Type-specific options are sent to API on save"
  artifacts:
    - path: "src/components/FieldFormPanel.jsx"
      provides: "Type-specific option fields in form"
      contains: "min, max, choices, display_format"
  key_links:
    - from: "src/components/FieldFormPanel.jsx"
      to: "src/api/client.js"
      via: "onSubmit callback with type-specific data"
      pattern: "onSubmit.*label.*type"
---

<objective>
Add type-specific configuration options to FieldFormPanel that appear dynamically based on selected field type.

Purpose: Admins need to configure type-specific options (min/max for numbers, choices for selects, format for dates) when creating/editing custom fields. Currently the panel only captures label, type, and instructions.

Output: FieldFormPanel that renders appropriate configuration options for each of the 9 basic field types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/89-basic-field-types/89-01-SUMMARY.md

@src/components/FieldFormPanel.jsx
@src/api/client.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add type-specific options to FieldFormPanel</name>
  <files>src/components/FieldFormPanel.jsx</files>
  <action>
Extend FieldFormPanel to show type-specific configuration options based on selected field type. Add after the Type selector and before the Description field.

**Form state changes:**
Update formData state to include all type-specific options:
```javascript
const [formData, setFormData] = useState({
  label: '',
  type: 'text',
  instructions: '',
  // Number options
  min: '',
  max: '',
  step: '',
  prepend: '',
  append: '',
  // Date options
  display_format: 'd/m/Y',
  return_format: 'd/m/Y',
  first_day: 1,
  // Select/Checkbox options
  choices: '',  // Store as newline-separated string for editing
  allow_null: false,
  multiple: false,
  layout: 'vertical',
  toggle: false,
  // True/False options
  ui: true,
  ui_on_text: 'Yes',
  ui_off_text: 'No',
  // Text options
  maxlength: '',
  placeholder: '',
});
```

**Update useEffect reset logic:**
When loading an existing field, map its choices object to newline-separated string:
```javascript
// Convert choices object to newline-separated string for editing
const choicesString = field.choices
  ? Object.entries(field.choices).map(([k, v]) => k === v ? v : `${k} : ${v}`).join('\n')
  : '';
```

When loading existing field, populate all type-specific options from field data.

**Render type-specific options section:**
Add a conditional section after the Type selector:

```jsx
{/* Type-specific options */}
{renderTypeOptions()}
```

Create helper function `renderTypeOptions()` that returns appropriate fields based on `formData.type`:

**For 'number' type:**
- Min: number input (optional)
- Max: number input (optional)
- Step: number input, default 1 (optional)
- Prepend: text input for prefix like "$" (optional)
- Append: text input for suffix like "kg" (optional)

**For 'date' type:**
- Display Format: select dropdown with common options (d/m/Y, m/d/Y, Y-m-d, F j, Y)
- Return Format: select dropdown with same options
- Week Starts On: select with Sunday/Monday

**For 'select' type:**
- Choices: textarea (one per line, format "value : label" or just "label")
- Allow Null: checkbox
- Multiple: checkbox (hidden for now, optional feature)

**For 'checkbox' type:**
- Choices: textarea (same as select)
- Layout: radio buttons (Vertical/Horizontal)
- Toggle All: checkbox

**For 'true_false' type:**
- Use Toggle UI: checkbox (default true)
- ON Text: text input (default "Yes")
- OFF Text: text input (default "No")

**For 'text' type:**
- Max Length: number input (optional)
- Placeholder: text input (optional)
- Prepend: text input (optional)
- Append: text input (optional)

**For 'textarea' type:**
- Max Length: number input (optional)
- Placeholder: text input (optional)
- Rows: number input (default 4)

**For 'email' and 'url' types:**
- Placeholder: text input (optional)
- Prepend: text input (optional, e.g., "https://" for URL)

**Update handleSubmit:**
Convert choices string back to object before submitting:
```javascript
const submitData = {
  label: formData.label.trim(),
  type: formData.type,
  instructions: formData.instructions.trim(),
};

// Add type-specific options based on type
if (formData.type === 'number') {
  if (formData.min !== '') submitData.min = Number(formData.min);
  if (formData.max !== '') submitData.max = Number(formData.max);
  if (formData.step !== '') submitData.step = Number(formData.step);
  if (formData.prepend) submitData.prepend = formData.prepend;
  if (formData.append) submitData.append = formData.append;
}

if (formData.type === 'select' || formData.type === 'checkbox') {
  // Convert newline-separated choices to object
  const choicesObj = {};
  formData.choices.split('\n').filter(line => line.trim()).forEach(line => {
    const [key, label] = line.includes(':')
      ? line.split(':').map(s => s.trim())
      : [line.trim(), line.trim()];
    choicesObj[key] = label;
  });
  if (Object.keys(choicesObj).length > 0) {
    submitData.choices = choicesObj;
  }
  if (formData.type === 'select') {
    submitData.allow_null = formData.allow_null;
  }
  if (formData.type === 'checkbox') {
    submitData.layout = formData.layout;
    submitData.toggle = formData.toggle;
  }
}

if (formData.type === 'date') {
  submitData.display_format = formData.display_format;
  submitData.return_format = formData.return_format;
  submitData.first_day = formData.first_day;
}

if (formData.type === 'true_false') {
  submitData.ui = formData.ui;
  submitData.ui_on_text = formData.ui_on_text;
  submitData.ui_off_text = formData.ui_off_text;
}

if (['text', 'textarea', 'email', 'url'].includes(formData.type)) {
  if (formData.placeholder) submitData.placeholder = formData.placeholder;
  if (formData.maxlength !== '') submitData.maxlength = Number(formData.maxlength);
}

// etc for other types
await onSubmit(submitData);
```

**Styling:**
- Use consistent input styling with existing fields
- Group related options in subtle bordered sections
- Use small/muted text for option labels
- Add helpful hint text where appropriate (e.g., "Enter one choice per line")

**Implementation notes:**
- Keep the panel scrollable (already has overflow-y-auto)
- Type selector disabled when editing, so type-specific options should reflect the locked type
- Clear type-specific values when type changes (in handleChange for 'type' field)
  </action>
  <verify>
Build succeeds: `npm run build`
No ESLint errors: `npm run lint`
  </verify>
  <done>FieldFormPanel shows appropriate type-specific options for each of the 9 basic field types</done>
</task>

<task type="auto">
  <name>Task 2: Deploy and verify type options UI</name>
  <files>None (deployment and manual testing)</files>
  <action>
Deploy and verify the type-specific options appear correctly in the UI.

1. Build: `npm run build`
2. Deploy: `bin/deploy.sh`

3. Open Settings > Custom Fields in production

4. Click "Add Field" and verify for each type:
   - Select "Number" -> should see Min, Max, Step, Prepend, Append fields
   - Select "Date" -> should see Display Format, Return Format, Week Starts On dropdowns
   - Select "Select" -> should see Choices textarea, Allow Null checkbox
   - Select "Checkbox" -> should see Choices textarea, Layout radio, Toggle All checkbox
   - Select "True/False" -> should see Toggle UI checkbox, ON/OFF text inputs
   - Select "Text" -> should see Max Length, Placeholder, Prepend, Append
   - Select "Textarea" -> should see Max Length, Placeholder
   - Select "Email" -> should see Placeholder
   - Select "URL" -> should see Placeholder, Prepend

5. Create a test Number field with min=0, max=100, step=5

6. Verify the field appears in the list

7. Edit the field and verify the min/max/step values are populated

8. Create a test Select field with choices:
   ```
   red : Red
   green : Green
   blue : Blue
   ```

9. Edit the Select field and verify choices are displayed correctly

10. Delete test fields to clean up
  </action>
  <verify>
- Type-specific options appear when selecting each type
- Creating fields with options saves them correctly
- Editing fields shows the previously saved options
- Choices editor works for Select/Checkbox types
  </verify>
  <done>Type-specific options UI fully functional for all 9 basic field types</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. FieldFormPanel renders type-specific options dynamically
2. Number type shows min/max/step inputs
3. Select/Checkbox types show choices editor
4. Date type shows format dropdowns
5. True/False type shows toggle options
6. Text/Textarea show placeholder and maxlength
7. Options save correctly and appear when editing existing fields
</verification>

<success_criteria>
- TYPE-01 through TYPE-09 requirements addressed:
  - Text (TYPE-01): Max length, placeholder configurable
  - Textarea (TYPE-02): Max length, placeholder configurable
  - Number (TYPE-03): Min/max/step configurable
  - Email (TYPE-04): Placeholder configurable (validation is ACF native)
  - URL (TYPE-05): Placeholder configurable (validation is ACF native)
  - Date (TYPE-06): Display format and return format configurable
  - Select (TYPE-07): Choices and allow_null configurable
  - Checkbox (TYPE-08): Choices, layout, toggle configurable
  - True/False (TYPE-09): Toggle UI and on/off text configurable
- All type-specific options round-trip correctly (create -> edit shows saved values)
</success_criteria>

<output>
After completion, create `.planning/phases/89-basic-field-types/89-02-SUMMARY.md`
</output>
