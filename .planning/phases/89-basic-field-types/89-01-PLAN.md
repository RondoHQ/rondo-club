---
phase: 89-basic-field-types
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - includes/customfields/class-manager.php
  - includes/class-rest-custom-fields.php
autonomous: true

must_haves:
  truths:
    - "Number fields can be created with min/max/step constraints"
    - "Date fields can be created with display format options"
    - "Select/Checkbox fields can be created with choices"
    - "All type-specific options persist to database and return via API"
  artifacts:
    - path: "includes/customfields/class-manager.php"
      provides: "Extended UPDATABLE_PROPERTIES for type-specific options"
      contains: "min, max, step, display_format, return_format"
    - path: "includes/class-rest-custom-fields.php"
      provides: "REST API parameters for all type-specific options"
      contains: "min, max, step, display_format"
  key_links:
    - from: "includes/class-rest-custom-fields.php"
      to: "includes/customfields/class-manager.php"
      via: "create_field and update_field calls"
      pattern: "manager->create_field|manager->update_field"
---

<objective>
Extend PHP backend to support type-specific options for all 9 basic field types.

Purpose: The Manager class and REST API already support core field properties (label, type, instructions, choices). This plan adds support for Number's min/max/step, Date's display/return formats, Checkbox's layout/toggle, and other type-specific ACF options.

Output: Backend capable of persisting and returning all type-specific configuration needed by Phase 89 field types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/87-acf-foundation/87-01-SUMMARY.md
@.planning/phases/87-acf-foundation/87-02-SUMMARY.md

@includes/customfields/class-manager.php
@includes/class-rest-custom-fields.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend Manager class type-specific options</name>
  <files>includes/customfields/class-manager.php</files>
  <action>
Add the following to UPDATABLE_PROPERTIES array:

For Number fields:
- min (minimum value)
- max (maximum value)
- step (increment step, defaults to 1)
- prepend (visual text before input)
- append (visual text after input)

For Date fields:
- display_format (format shown in picker, default 'd/m/Y')
- return_format (format returned by ACF, default 'd/m/Y')
- first_day (week start day, 0=Sunday, 1=Monday)

For Select fields:
- allow_null (allow empty selection)
- multiple (allow multiple selections)
- ui (use Select2 UI)
- return_format (value, label, or array)

For Checkbox fields:
- layout (vertical or horizontal)
- toggle (show toggle all checkbox)
- return_format (value, label, or array)
- allow_custom (allow custom values)
- save_custom (save custom to choices)

For Text/Textarea:
- maxlength (character limit)

For True/False:
- ui (toggle switch vs checkbox)
- ui_on_text (label for ON state)
- ui_off_text (label for OFF state)

Note: prepend/append already covered under Text. rows already available for Textarea via ACF.

Update the UPDATABLE_PROPERTIES constant to include these new properties. ACF will handle unknown properties gracefully (ignored), so this is safe.
  </action>
  <verify>
Read the updated class-manager.php and confirm UPDATABLE_PROPERTIES includes: min, max, step, prepend, append, display_format, return_format, first_day, allow_null, multiple, ui, layout, toggle, allow_custom, save_custom, maxlength, ui_on_text, ui_off_text
  </verify>
  <done>Manager class accepts all type-specific options for basic field types</done>
</task>

<task type="auto">
  <name>Task 2: Update REST API parameters</name>
  <files>includes/class-rest-custom-fields.php</files>
  <action>
Update get_create_params() and the $optional_params array in create_item() to include all new type-specific parameters:

In get_create_params(), add:
```php
// Number field options
'min' => array(
    'type'        => 'number',
    'description' => 'Minimum allowed value (Number field)',
),
'max' => array(
    'type'        => 'number',
    'description' => 'Maximum allowed value (Number field)',
),
'step' => array(
    'type'        => 'number',
    'description' => 'Step increment (Number field)',
),
'prepend' => array(
    'type'        => 'string',
    'description' => 'Text displayed before input',
),
'append' => array(
    'type'        => 'string',
    'description' => 'Text displayed after input',
),
// Date field options
'display_format' => array(
    'type'        => 'string',
    'description' => 'Date display format (Date field)',
),
'return_format' => array(
    'type'        => 'string',
    'description' => 'Date/Select/Checkbox return format',
),
'first_day' => array(
    'type'        => 'integer',
    'description' => 'First day of week: 0=Sunday, 1=Monday (Date field)',
),
// Select/Checkbox options
'allow_null' => array(
    'type'        => 'boolean',
    'description' => 'Allow empty selection (Select field)',
),
'multiple' => array(
    'type'        => 'boolean',
    'description' => 'Allow multiple selections (Select field)',
),
'ui' => array(
    'type'        => 'boolean',
    'description' => 'Use enhanced UI (Select/True_False field)',
),
'layout' => array(
    'type'        => 'string',
    'description' => 'Layout: vertical or horizontal (Checkbox field)',
),
'toggle' => array(
    'type'        => 'boolean',
    'description' => 'Show toggle all checkbox (Checkbox field)',
),
'allow_custom' => array(
    'type'        => 'boolean',
    'description' => 'Allow custom values (Checkbox field)',
),
'save_custom' => array(
    'type'        => 'boolean',
    'description' => 'Save custom values to choices (Checkbox field)',
),
// Text/Textarea options
'maxlength' => array(
    'type'        => 'integer',
    'description' => 'Maximum character length (Text/Textarea field)',
),
// True/False options
'ui_on_text' => array(
    'type'        => 'string',
    'description' => 'Text for ON state (True/False field)',
),
'ui_off_text' => array(
    'type'        => 'string',
    'description' => 'Text for OFF state (True/False field)',
),
```

In create_item(), update $optional_params array to include all new params:
```php
$optional_params = array(
    'name', 'instructions', 'required', 'choices', 'default_value', 'placeholder',
    'min', 'max', 'step', 'prepend', 'append',
    'display_format', 'return_format', 'first_day',
    'allow_null', 'multiple', 'ui', 'layout', 'toggle', 'allow_custom', 'save_custom',
    'maxlength', 'ui_on_text', 'ui_off_text',
);
```

In update_item(), update $updatable_params array to match:
```php
$updatable_params = array(
    'label', 'name', 'instructions', 'required', 'choices', 'default_value', 'placeholder',
    'min', 'max', 'step', 'prepend', 'append',
    'display_format', 'return_format', 'first_day',
    'allow_null', 'multiple', 'ui', 'layout', 'toggle', 'allow_custom', 'save_custom',
    'maxlength', 'ui_on_text', 'ui_off_text',
);
```
  </action>
  <verify>
Read the updated class-rest-custom-fields.php and confirm:
1. get_create_params() includes all type-specific parameters with proper types
2. create_item() $optional_params includes all new params
3. update_item() $updatable_params includes all new params
  </verify>
  <done>REST API accepts all type-specific options for create and update operations</done>
</task>

<task type="auto">
  <name>Task 3: Test API with type-specific options</name>
  <files>None (deployment and testing)</files>
  <action>
Deploy to production and test creating fields with type-specific options:

1. Deploy: `bin/deploy.sh`

2. Test creating a Number field with min/max:
```bash
curl -X POST "PRODUCTION_URL/wp-json/prm/v1/custom-fields/person" \
  -H "Content-Type: application/json" \
  -H "X-WP-Nonce: NONCE" \
  --cookie "COOKIES" \
  -d '{"label":"Age","type":"number","min":0,"max":150,"step":1}'
```

3. Test creating a Select field with choices:
```bash
curl -X POST "PRODUCTION_URL/wp-json/prm/v1/custom-fields/person" \
  -H "Content-Type: application/json" \
  -H "X-WP-Nonce: NONCE" \
  --cookie "COOKIES" \
  -d '{"label":"Priority","type":"select","choices":{"low":"Low","medium":"Medium","high":"High"},"allow_null":true}'
```

4. Verify the created fields return the type-specific options in GET response.

5. Clean up test fields via DELETE endpoint.

Note: Use WP-CLI `wp eval` if curl testing is blocked, similar to Phase 87-02 testing approach.
  </action>
  <verify>
- Number field created with min=0, max=150, step=1 returns these values in GET
- Select field created with choices and allow_null returns these in GET
- Fields can be deleted after testing
  </verify>
  <done>Type-specific options persist correctly for Number and Select field types</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. UPDATABLE_PROPERTIES in Manager includes all type-specific options
2. REST API accepts and returns all type-specific options
3. Creating fields with type-specific options works via API
4. Options persist to database and return in GET responses
</verification>

<success_criteria>
- Number fields can be created with min, max, step constraints via API
- Select/Checkbox fields can be created with choices and layout options via API
- Date fields can be created with display_format and return_format via API
- All type-specific options round-trip correctly (create -> get returns same values)
</success_criteria>

<output>
After completion, create `.planning/phases/89-basic-field-types/89-01-SUMMARY.md`
</output>
