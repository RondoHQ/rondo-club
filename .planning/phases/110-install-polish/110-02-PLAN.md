---
phase: 110-install-polish
plan: 02
type: execute
wave: 2
depends_on: ["110-01"]
files_modified:
  - src/components/InstallPrompt.jsx
  - src/components/IOSInstallModal.jsx
  - src/App.jsx
autonomous: true

must_haves:
  truths:
    - "Android users see install banner after sufficient engagement"
    - "iOS Safari users see install instructions modal with Share icon and Add to Home Screen steps"
    - "Install prompts do not show when app is already in standalone mode"
    - "Install prompts do not overlap with update notifications"
    - "Prompts are dismissable and respect user preference via localStorage"
  artifacts:
    - path: "src/components/InstallPrompt.jsx"
      provides: "Android install banner component"
      exports: ["InstallPrompt"]
    - path: "src/components/IOSInstallModal.jsx"
      provides: "iOS install instructions modal"
      exports: ["IOSInstallModal"]
    - path: "src/App.jsx"
      provides: "App with install prompts integrated"
      contains: "InstallPrompt"
  key_links:
    - from: "src/components/InstallPrompt.jsx"
      to: "src/hooks/useInstallPrompt.js"
      via: "import useInstallPrompt"
      pattern: "import.*useInstallPrompt"
    - from: "src/components/IOSInstallModal.jsx"
      to: "src/utils/installTracking.js"
      via: "import installTracking"
      pattern: "import.*installTracking"
    - from: "src/App.jsx"
      to: "src/components/InstallPrompt.jsx"
      via: "import and render"
      pattern: "<InstallPrompt"
---

<objective>
Create install prompt UI components for Android and iOS, and integrate them into the app.

Purpose: Provide smart install prompts that encourage PWA installation without being intrusive. Android gets a banner with native install trigger, iOS gets a modal with manual instructions since Safari doesn't support automatic prompts.

Output: InstallPrompt.jsx (Android banner), IOSInstallModal.jsx (iOS modal), updated App.jsx with both components mounted.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/110-install-polish/110-RESEARCH.md
@.planning/phases/110-install-polish/110-01-SUMMARY.md

Reference existing components:
@src/components/ReloadPrompt.jsx
@src/components/OfflineBanner.jsx
@src/App.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InstallPrompt component for Android</name>
  <files>src/components/InstallPrompt.jsx</files>
  <action>
Create an Android PWA install banner component.

Based on 110-RESEARCH.md "Android Install Banner Component":

1. Import hooks: useInstallPrompt, useEngagementTracking
2. Import ReloadPrompt's needRefresh state via useRegisterSW OR add a prop/context to prevent overlap (simpler: check for .needRefresh element in DOM or use a shared state)
3. Get { canInstall, promptInstall, hidePrompt, isInstalled } from useInstallPrompt()
4. Get isEngaged from useEngagementTracking({ minPageViews: 2, minNotes: 1 })
5. Early return null if:
   - isInstalled is true
   - canInstall is false
   - isEngaged is false
6. Render a bottom banner (not overlapping with ReloadPrompt which is bottom-right):
   - Position: fixed bottom-20 (to avoid overlap with ReloadPrompt at bottom-4)
   - Left-right margins for mobile
   - Dutch text: "Installeer Stadion" / "Voor snellere toegang en offline gebruik"
   - Download icon from lucide-react
   - X button to dismiss (calls hidePrompt)
   - "Niet nu" and "Installeer" buttons
7. handleInstall: await promptInstall(), log outcome
8. Use same styling patterns as OfflineBanner.jsx and ReloadPrompt.jsx

IMPORTANT: All text must be in Dutch to match rest of app.
  </action>
  <verify>
File exists and contains Dutch text.
Run: grep -E "Installeer|Niet nu|snellere toegang" src/components/InstallPrompt.jsx
  </verify>
  <done>
InstallPrompt component shows Android install banner with Dutch text and proper positioning.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create IOSInstallModal component</name>
  <files>src/components/IOSInstallModal.jsx</files>
  <action>
Create an iOS install instructions modal component.

Based on 110-RESEARCH.md "Pattern 3: iOS Install Instructions Modal":

1. Import useState, useEffect from react
2. Import installTracking from '@/utils/installTracking'
3. Import Share, Plus, X from lucide-react
4. State: show (boolean)
5. useEffect on mount to detect iOS Safari:
   - const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent)
   - const isStandalone = window.navigator.standalone === true
   - const isSafari = /Safari/.test(navigator.userAgent) && !/CriOS|FxiOS|EdgiOS/.test(navigator.userAgent)
   - If isIOS && !isStandalone && isSafari:
     - Check installTracking.shouldShowIOSPrompt()
     - Check engagement: get page views from sessionStorage, show if >= 3
     - If both pass, setShow(true)
6. handleDismiss: installTracking.trackIOSDismissal(), setShow(false)
7. If !show, return null
8. Render modal:
   - Backdrop: fixed inset-0 z-50 bg-black/50
   - Modal: centered (sm:items-center) or bottom (items-end for mobile sheet style)
   - Header: "Installeer Stadion" with X close button
   - Intro text: "Voor snellere toegang kun je Stadion installeren op je beginscherm:"
   - Numbered steps (1, 2, 3) with icons:
     1. "Tik op het Deel-icoon" with Share icon
     2. "Scroll omlaag en kies 'Zet op beginscherm'" with Plus icon and text
     3. "Tik op 'Voeg toe'"
   - "Misschien later" dismiss button
9. Use same styling patterns as existing modals (rounded-2xl, shadow-lg, dark mode support)

All text in Dutch.
  </action>
  <verify>
File exists and contains Dutch iOS install instructions.
Run: grep -E "beginscherm|Deel-icoon|Voeg toe" src/components/IOSInstallModal.jsx
  </verify>
  <done>
IOSInstallModal component shows iOS install instructions in Dutch with visual step-by-step guide.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate install prompts into App.jsx</name>
  <files>src/App.jsx</files>
  <action>
Add InstallPrompt and IOSInstallModal to the app.

1. Add imports at top:
   - import { InstallPrompt } from '@/components/InstallPrompt';
   - import { IOSInstallModal } from '@/components/IOSInstallModal';
2. In App function, add both components after ReloadPrompt and OfflineBanner:
   - <InstallPrompt />
   - <IOSInstallModal />
3. Component order in JSX (for proper z-index stacking):
   - UpdateBanner (z-100, top)
   - ReloadPrompt (z-50, bottom-right)
   - OfflineBanner (fixed bottom)
   - InstallPrompt (z-40, bottom - above OfflineBanner when visible)
   - IOSInstallModal (z-50, modal overlay)

The components self-manage their visibility, so no conditional rendering needed in App.jsx.
  </action>
  <verify>
App.jsx imports and renders both new components.
Run: grep -E "InstallPrompt|IOSInstallModal" src/App.jsx
  </verify>
  <done>
App.jsx integrates InstallPrompt and IOSInstallModal for automatic display based on platform and engagement.
  </done>
</task>

</tasks>

<verification>
1. InstallPrompt.jsx exists and uses useInstallPrompt and useEngagementTracking hooks
2. IOSInstallModal.jsx exists with iOS detection and Dutch instructions
3. App.jsx imports and renders both components
4. All text is in Dutch
5. Components don't overlap (different positioning)
6. npm run build succeeds without errors
</verification>

<success_criteria>
- InstallPrompt component shows for Android users after viewing 2 people or adding 1 note
- IOSInstallModal shows for iOS Safari users after 3 page views (and not already installed)
- Both prompts are dismissable and remember dismissal preference
- Components integrate cleanly into existing App.jsx structure
- All UI text is in Dutch
</success_criteria>

<output>
After completion, create `.planning/phases/110-install-polish/110-02-SUMMARY.md`
</output>
