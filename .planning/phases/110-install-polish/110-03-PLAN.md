---
phase: 110-install-polish
plan: 03
type: execute
wave: 2
depends_on: ["110-01"]
files_modified:
  - src/components/ReloadPrompt.jsx
autonomous: true

must_haves:
  truths:
    - "ReloadPrompt checks for service worker updates periodically (every hour)"
    - "ReloadPrompt shows Dutch text for offline ready and update notifications"
    - "Periodic checking only happens when online and app is active"
    - "Update check uses cache-busting headers to avoid false positives"
  artifacts:
    - path: "src/components/ReloadPrompt.jsx"
      provides: "PWA reload prompt with periodic update checking and Dutch localization"
      exports: ["ReloadPrompt"]
  key_links:
    - from: "src/components/ReloadPrompt.jsx"
      to: "virtual:pwa-register/react"
      via: "useRegisterSW hook"
      pattern: "useRegisterSW"
---

<objective>
Enhance ReloadPrompt with periodic service worker update checking and localize all text to Dutch.

Purpose: Ensure users are notified of updates even during long sessions, and maintain consistency with the Dutch localization used throughout the app. The existing ReloadPrompt works but only detects updates on page load - periodic checking catches updates during extended use.

Output: Updated ReloadPrompt.jsx with periodic SW update checking and Dutch text.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/110-install-polish/110-RESEARCH.md

Reference current implementation:
@src/components/ReloadPrompt.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add periodic SW update checking to ReloadPrompt</name>
  <files>src/components/ReloadPrompt.jsx</files>
  <action>
Enhance ReloadPrompt with periodic service worker update checking.

Based on 110-RESEARCH.md "Pattern 4: Periodic Service Worker Update Checking":

1. Define intervalMS = 60 * 60 * 1000 (1 hour) at top of component
2. Enhance useRegisterSW options to add onRegisteredSW callback:
   ```javascript
   onRegisteredSW(swUrl, registration) {
     console.log('SW Registered:', registration);

     if (registration) {
       setInterval(async () => {
         // Only check when online
         if (navigator.onLine) {
           try {
             const resp = await fetch(swUrl, {
               cache: 'no-store',
               headers: {
                 'cache': 'no-store',
                 'cache-control': 'no-cache',
               },
             });

             if (resp?.status === 200) {
               await registration.update();
             }
           } catch (error) {
             console.debug('SW update check failed:', error);
           }
         }
       }, intervalMS);
     }
   }
   ```
3. Keep onRegisterError as is
4. This replaces the simpler onRegistered callback

Note: The interval runs even when the tab is in background. This is intentional - the SW update check is lightweight and important to catch.
  </action>
  <verify>
ReloadPrompt has periodic update checking.
Run: grep -E "setInterval|registration.update|60.*60.*1000" src/components/ReloadPrompt.jsx
  </verify>
  <done>
ReloadPrompt checks for SW updates every hour when online.
  </done>
</task>

<task type="auto">
  <name>Task 2: Localize ReloadPrompt text to Dutch</name>
  <files>src/components/ReloadPrompt.jsx</files>
  <action>
Update all user-facing text in ReloadPrompt to Dutch.

Text replacements:
- "Ready for offline use" -> "Klaar voor offline gebruik"
- "Stadion can now work offline" -> "Stadion werkt nu ook zonder internet"
- "Dismiss" (aria-label) -> "Sluiten"
- "Update available" -> "Update beschikbaar"
- "A new version of Stadion is ready" -> "Een nieuwe versie van Stadion is beschikbaar"
- "Later" -> "Later" (same in Dutch)
- "Reload now" -> "Nu herladen"

Apply consistent styling:
- Keep the green CheckCircle for offline ready
- Keep the accent-colored RefreshCw for updates
- Maintain dark mode support classes
  </action>
  <verify>
ReloadPrompt shows Dutch text.
Run: grep -E "offline gebruik|herladen|beschikbaar" src/components/ReloadPrompt.jsx
  </verify>
  <done>
ReloadPrompt displays all notifications in Dutch.
  </done>
</task>

</tasks>

<verification>
1. ReloadPrompt.jsx has periodic update check interval (1 hour)
2. onRegisteredSW callback sets up the interval
3. All user-visible text is in Dutch
4. Component still works correctly (can test by observing console.log on SW registration)
5. npm run build succeeds
</verification>

<success_criteria>
- Service worker updates are checked every hour (when online)
- All ReloadPrompt text is in Dutch
- Offline ready notification shows Dutch text
- Update available notification shows Dutch text with "Nu herladen" button
- No functional regressions in update detection
</success_criteria>

<output>
After completion, create `.planning/phases/110-install-polish/110-03-SUMMARY.md`
</output>
