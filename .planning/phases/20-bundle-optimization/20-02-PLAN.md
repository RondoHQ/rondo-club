---
phase: 20-bundle-optimization
plan: 02
type: execute
depends_on: ["20-01"]
files_modified: [src/App.jsx]
---

<objective>
Implement route-based lazy loading with React.lazy() and Suspense for all page components.

Purpose: Split application code by route so users only download code for the pages they visit. This dramatically reduces initial load time.

Output: All pages lazy-loaded, initial bundle contains only core app shell.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/20-bundle-optimization/20-01-SUMMARY.md
@src/App.jsx

**Current state (after Plan 01):**
- Vendor chunks separated
- All 16 page components still statically imported in App.jsx

**Pages to lazy load:**
- Dashboard
- PeopleList, PersonDetail, FamilyTree
- TeamsList, TeamDetail
- DatesList
- TodosList
- Settings, RelationshipTypes, UserApproval
- WorkspacesList, WorkspaceDetail, WorkspaceSettings, WorkspaceInviteAccept
- Login
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert all page imports to lazy imports with Suspense</name>
  <files>src/App.jsx</files>
  <action>
1. Import `lazy` and `Suspense` from 'react'

2. Replace all static page imports with lazy imports:
```javascript
const Dashboard = lazy(() => import('@/pages/Dashboard'));
const PeopleList = lazy(() => import('@/pages/People/PeopleList'));
const PersonDetail = lazy(() => import('@/pages/People/PersonDetail'));
// ... etc for all pages
```

3. Create a simple loading spinner component inline (not a new file):
```javascript
const PageLoader = () => (
  <div className="flex items-center justify-center min-h-[50vh]">
    <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
  </div>
);
```

4. Wrap the Routes inside Layout with Suspense:
```jsx
<Layout>
  <Suspense fallback={<PageLoader />}>
    <Routes>
      {/* routes */}
    </Routes>
  </Suspense>
</Layout>
```

Do NOT lazy load:
- Layout component (needed immediately for shell)
- ProtectedRoute/ApprovalCheck (auth flow)
- UpdateBanner (small, always visible)
  </action>
  <verify>npm run build shows separate chunks for each page</verify>
  <done>Build produces page-specific chunks, each page loads on demand</done>
</task>

<task type="auto">
  <name>Task 2: Verify lazy loading and measure final sizes</name>
  <files>None (verification only)</files>
  <action>
1. Run `npm run build` and capture complete output
2. Document all chunk sizes (raw and gzipped)
3. Calculate:
   - Initial load size (vendor + utils + main + shared)
   - Total size of all chunks
   - Comparison to original 1,646 KB baseline
4. Run `npm run preview` and test:
   - Initial page load (Dashboard)
   - Navigation to /people (verify chunk loads)
   - Navigation to /people/:id/family-tree (verify vis-network loads)
   - Check browser Network tab for chunk loading
5. Verify no console errors
  </action>
  <verify>npm run build shows page chunks, npm run preview shows dynamic chunk loading in Network tab</verify>
  <done>All pages lazy load correctly, initial bundle under 500KB, documented size comparison</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` produces separate chunks per page
- [ ] Initial bundle (vendor + utils + main) under target size
- [ ] `npm run preview` loads Dashboard without loading all page code
- [ ] Navigation to other pages triggers chunk downloads
- [ ] No React errors or warnings about Suspense
</verification>

<success_criteria>

- All 16 pages converted to lazy imports
- Suspense wrapper with loading spinner in place
- Build produces page-specific chunks
- Initial load size significantly reduced
- Navigation between pages works smoothly
  </success_criteria>

<output>
After completion, create `.planning/phases/20-bundle-optimization/20-02-SUMMARY.md`
</output>
