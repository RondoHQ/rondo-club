---
phase: 03-rest-api-integrations
plan: 02
type: execute
depends_on: []
files_modified: [includes/class-rest-import-export.php, includes/class-rest-api.php, functions.php]
---

<objective>
Extract import/export endpoints from RONDO_REST_API into a dedicated RONDO_REST_Import_Export class.

Purpose: Complete the REST API split for Phase 3 by isolating all import/export and CardDAV URL functionality into its own domain-specific class.
Output: New `class-rest-import-export.php` with export endpoints and CardDAV URLs, updated autoloader, cleaned `class-rest-api.php`.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (relevant to this work):
@.planning/phases/01-rest-api-infrastructure/01-01-SUMMARY.md
@.planning/phases/02-rest-api-people-teams/02-02-SUMMARY.md

# Source files:
@includes/class-rest-api.php
@includes/class-rest-base.php
@functions.php

**Tech stack available:** RONDO_REST_Base abstract class with shared permission and formatting methods
**Established patterns:** Domain-specific REST classes extend RONDO_REST_Base, register routes via rest_api_init hook
**Constraining decisions:**
- Phase 01-01: Base class is abstract, permission methods are public, formatting methods are protected
- Phase 02-02: Domain-specific classes instantiated after prior classes in rondo_init() to maintain route registration order
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RONDO_REST_Import_Export class with export and CardDAV endpoints</name>
  <files>includes/class-rest-import-export.php</files>
  <action>
Create new file `includes/class-rest-import-export.php`:
1. Class `RONDO_REST_Import_Export extends RONDO_REST_Base`
2. Constructor registers routes via `rest_api_init` hook (following established pattern)
3. Move the following routes from RONDO_REST_API:
   - `/export/vcard` (export_vcard)
   - `/export/google-csv` (export_google_csv)
   - `/carddav/urls` (get_carddav_urls)
4. Move ALL corresponding callback methods from RONDO_REST_API:
   - export_vcard()
   - export_google_csv()
   - get_carddav_urls()
5. Move helper methods used by export:
   - generate_vcard_from_person()
   - escape_vcard_value()
6. Keep all permission callbacks and validation logic intact
7. Ensure class uses `$this->` for any inherited methods from RONDO_REST_Base

Do NOT modify any business logic - pure extraction only.
  </action>
  <verify>File exists and contains all 3 route registrations and all callback/helper methods</verify>
  <done>class-rest-import-export.php exists with complete export/CardDAV implementation</done>
</task>

<task type="auto">
  <name>Task 2: Remove export/CardDAV code from RONDO_REST_API and update autoloader</name>
  <files>includes/class-rest-api.php, functions.php</files>
  <action>
1. In `includes/class-rest-api.php`:
   - Remove export route registrations (/export/vcard, /export/google-csv, /carddav/urls)
   - Remove callback methods: export_vcard, export_google_csv, get_carddav_urls
   - Remove helper methods: generate_vcard_from_person, escape_vcard_value
   - Keep all other routes and methods intact

2. In `functions.php`:
   - Add `require_once get_template_directory() . '/includes/class-rest-import-export.php';` after class-rest-slack.php (or class-rest-teams.php if Plan 01 not yet executed) in the require block
   - Add `new RONDO_REST_Import_Export();` after the Slack class (or Teams class if Plan 01 not yet executed) in rondo_init() function

Note: If Plan 03-01 has already been executed, add after class-rest-slack.php. If running in parallel, add after class-rest-teams.php.
  </action>
  <verify>grep -c "export_vcard\|export_google_csv\|carddav" includes/class-rest-api.php returns 0, grep -c "RONDO_REST_Import_Export" functions.php returns 2</verify>
  <done>Export/CardDAV code removed from RONDO_REST_API, autoloader updated with new class</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `class-rest-import-export.php` exists with all 3 routes registered
- [ ] `class-rest-api.php` contains no export/CardDAV-related code
- [ ] `functions.php` requires and instantiates RONDO_REST_Import_Export
- [ ] No PHP syntax errors: `php -l includes/class-rest-import-export.php`
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No export/CardDAV code remains in RONDO_REST_API
- RONDO_REST_Import_Export properly extends RONDO_REST_Base
- Route registration follows established pattern
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-rest-api-integrations/03-02-SUMMARY.md`
</output>
