---
phase: 03-rest-api-integrations
plan: 01
type: execute
depends_on: []
files_modified: [includes/class-rest-slack.php, includes/class-rest-api.php, functions.php]
---

<objective>
Extract Slack integration endpoints from STADION_REST_API into a dedicated STADION_REST_Slack class.

Purpose: Continue the REST API split by isolating all Slack-related functionality into its own domain-specific class, following the pattern established in Phases 1 and 2.
Output: New `class-rest-slack.php` with all Slack endpoints, updated autoloader in `functions.php`, cleaned `class-rest-api.php`.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (relevant to this work):
@.planning/phases/01-rest-api-infrastructure/01-01-SUMMARY.md
@.planning/phases/02-rest-api-people-companies/02-01-SUMMARY.md

# Source files:
@includes/class-rest-api.php
@includes/class-rest-base.php
@functions.php

**Tech stack available:** STADION_REST_Base abstract class with shared permission and formatting methods
**Established patterns:** Domain-specific REST classes extend STADION_REST_Base, register routes via rest_api_init hook
**Constraining decisions:**
- Phase 01-01: Base class is abstract, permission methods are public, formatting methods are protected
- Phase 02-01: Domain-specific classes instantiated after STADION_REST_API in stadion_init() to maintain route registration order
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create STADION_REST_Slack class with all Slack endpoints</name>
  <files>includes/class-rest-slack.php</files>
  <action>
Create new file `includes/class-rest-slack.php`:
1. Class `STADION_REST_Slack extends STADION_REST_Base`
2. Constructor registers routes via `rest_api_init` hook (following established pattern)
3. Move ALL Slack-related routes from STADION_REST_API:
   - `/slack/oauth/authorize` (slack_oauth_authorize)
   - `/slack/oauth/callback` (slack_oauth_callback)
   - `/slack/disconnect` (slack_disconnect)
   - `/user/slack-status` (get_slack_status)
   - `/slack/commands` (slack_commands)
   - `/slack/events` (slack_events)
   - `/slack/channels` (get_slack_channels)
   - `/slack/targets` GET (get_slack_targets)
   - `/slack/targets` POST (update_slack_targets)
4. Move ALL corresponding callback methods from STADION_REST_API
5. Keep all permission callbacks and validation logic intact
6. Ensure class uses `$this->` for any inherited methods from STADION_REST_Base

Do NOT modify any business logic - pure extraction only.
  </action>
  <verify>File exists and contains all 9 route registrations and all callback methods</verify>
  <done>class-rest-slack.php exists with complete Slack endpoint implementation</done>
</task>

<task type="auto">
  <name>Task 2: Remove Slack code from STADION_REST_API and update autoloader</name>
  <files>includes/class-rest-api.php, functions.php</files>
  <action>
1. In `includes/class-rest-api.php`:
   - Remove all Slack route registrations (lines 175-236 approximately)
   - Remove all Slack callback methods: slack_oauth_authorize, slack_oauth_callback, slack_disconnect, get_slack_status, slack_commands, slack_events, get_slack_channels, get_slack_targets, update_slack_targets
   - Keep all other routes and methods intact

2. In `functions.php`:
   - Add `require_once get_template_directory() . '/includes/class-rest-slack.php';` after class-rest-companies.php in the require block
   - Add `new STADION_REST_Slack();` after `new STADION_REST_Companies();` in stadion_init() function
  </action>
  <verify>grep -c "slack" includes/class-rest-api.php returns 0, grep -c "STADION_REST_Slack" functions.php returns 2</verify>
  <done>Slack code removed from STADION_REST_API, autoloader updated with new class</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `class-rest-slack.php` exists with all 9 Slack routes registered
- [ ] `class-rest-api.php` contains no Slack-related code
- [ ] `functions.php` requires and instantiates STADION_REST_Slack
- [ ] No PHP syntax errors: `php -l includes/class-rest-slack.php`
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No Slack code remains in STADION_REST_API
- STADION_REST_Slack properly extends STADION_REST_Base
- Route registration follows established pattern
</success_criteria>

<output>
After completion, create `.planning/phases/03-rest-api-integrations/03-01-SUMMARY.md`
</output>
