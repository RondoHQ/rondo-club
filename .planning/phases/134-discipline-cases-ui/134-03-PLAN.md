---
phase: 134-discipline-cases-ui
plan: 03
type: execute
wave: 2
depends_on: ["134-01"]
files_modified:
  - src/pages/People/PersonDetail.jsx
autonomous: true

must_haves:
  truths:
    - "Tuchtzaken tab shows all discipline cases linked to that person"
    - "Tab only visible to users with fairplay capability"
    - "Tab hidden entirely if person has zero discipline cases"
    - "Case details are read-only (match, charges, sanctions, fee displayed)"
  artifacts:
    - path: "src/pages/People/PersonDetail.jsx"
      provides: "Tuchtzaken tab with discipline cases table"
      contains: "usePersonDisciplineCases"
  key_links:
    - from: "src/pages/People/PersonDetail.jsx"
      to: "src/hooks/useDisciplineCases.js"
      via: "usePersonDisciplineCases hook"
      pattern: "usePersonDisciplineCases"
    - from: "src/pages/People/PersonDetail.jsx"
      to: "src/components/DisciplineCaseTable.jsx"
      via: "DisciplineCaseTable component"
      pattern: "DisciplineCaseTable"
---

<objective>
Integrate discipline cases into person detail page Tuchtzaken tab

Purpose: Allow fairplay users to see discipline cases linked to a specific person
Output: Tuchtzaken tab populated with person's discipline cases (or hidden if none)
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/134-discipline-cases-ui/134-01-SUMMARY.md
@.planning/phases/134-discipline-cases-ui/134-CONTEXT.md
@src/pages/People/PersonDetail.jsx
@src/components/DisciplineCaseTable.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update PersonDetail.jsx to show discipline cases in Tuchtzaken tab</name>
  <files>src/pages/People/PersonDetail.jsx</files>
  <action>
Update PersonDetail.jsx to:

1. Import the new hooks and component at the top:
```javascript
import { usePersonDisciplineCases } from '@/hooks/useDisciplineCases';
import DisciplineCaseTable from '@/components/DisciplineCaseTable';
```

2. Fetch person's discipline cases (after existing currentUser query, around line 76):
```javascript
// Fetch discipline cases for this person (fairplay users only)
const { data: disciplineCases, isLoading: isDisciplineCasesLoading } = usePersonDisciplineCases(id, {
  enabled: canAccessFairplay,
});

// Check if person has any discipline cases (for hiding empty tab)
const hasDisciplineCases = disciplineCases && disciplineCases.length > 0;
```

3. Update the Tuchtzaken TabButton conditional (around line 1280-1283) to also check for cases:
```javascript
{canAccessFairplay && hasDisciplineCases && (
  <TabButton label="Tuchtzaken" isActive={activeTab === 'discipline'} onClick={() => setActiveTab('discipline')} />
)}
```

Note: Per CONTEXT.md decision - "Hide Tuchtzaken tab entirely if person has zero discipline cases"

4. Update the tab content section (around line 1791-1802) to use DisciplineCaseTable:
```javascript
{/* Discipline Cases Tab */}
{activeTab === 'discipline' && canAccessFairplay && (
  <div className="card p-6">
    <div className="flex items-center gap-3 mb-4">
      <Gavel className="w-5 h-5 text-gray-500" />
      <h2 className="font-semibold">Tuchtzaken</h2>
    </div>
    <DisciplineCaseTable
      cases={disciplineCases}
      showPersonColumn={false}
      personMap={new Map()}
      isLoading={isDisciplineCasesLoading}
    />
  </div>
)}
```

Key changes:
- showPersonColumn={false} since we're already on this person's page
- personMap is empty (not needed when Person column hidden)
- No season filter on person tab (shows all their cases across seasons)
- Tab completely hidden if person has no discipline cases
- Loading state handled by DisciplineCaseTable component

5. Handle edge case: If user is on discipline tab but cases load and show zero, redirect to profile tab:
```javascript
// After the hasDisciplineCases calculation, add an effect:
useEffect(() => {
  // If on discipline tab but no cases (after loading), switch to profile
  if (activeTab === 'discipline' && !isDisciplineCasesLoading && !hasDisciplineCases && canAccessFairplay) {
    setActiveTab('profile');
  }
}, [activeTab, isDisciplineCasesLoading, hasDisciplineCases, canAccessFairplay]);
```

This handles the case where user navigates directly to discipline tab via deep link but person has no cases.
  </action>
  <verify>
1. npm run lint passes
2. Navigate to person detail page as fairplay user
3. If person has discipline cases: Tuchtzaken tab visible, clicking shows table
4. If person has no discipline cases: Tuchtzaken tab hidden entirely
5. Table shows Match (with date), Sanction, Fee columns (no Person column)
6. Row expansion shows charges, full sanction text
  </verify>
  <done>Tuchtzaken tab on person detail shows their discipline cases, hidden if zero cases</done>
</task>

<task type="auto">
  <name>Task 2: Verify integration and clean up placeholder message</name>
  <files>src/pages/People/PersonDetail.jsx</files>
  <action>
Ensure the old placeholder message is removed. The previous implementation (Phase 133) had:

```javascript
{activeTab === 'discipline' && canAccessFairplay && (
  <div className="card p-6">
    <div className="flex items-center gap-3 mb-4">
      <Gavel className="w-5 h-5 text-gray-500" />
      <h2 className="font-semibold">Tuchtzaken</h2>
    </div>
    <p className="text-sm text-gray-500 text-center py-8">
      Tuchtzaken worden in een volgende fase toegevoegd.
    </p>
  </div>
)}
```

This should be completely replaced with the DisciplineCaseTable implementation from Task 1. The placeholder message should NOT appear.

Verify the integration is complete:
- Import statement for usePersonDisciplineCases exists
- Import statement for DisciplineCaseTable exists
- Discipline cases query runs when canAccessFairplay is true
- hasDisciplineCases calculated correctly
- TabButton conditional includes hasDisciplineCases check
- Tab content uses DisciplineCaseTable component
- No placeholder text remains
  </action>
  <verify>
1. Search for "volgende fase" in PersonDetail.jsx - should find nothing
2. Search for "usePersonDisciplineCases" - should find import and usage
3. Search for "DisciplineCaseTable" - should find import and usage
4. Tab content renders table, not placeholder text
  </verify>
  <done>Placeholder removed, full implementation verified</done>
</task>

</tasks>

<verification>
1. npm run lint passes with no errors
2. npm run build succeeds
3. As fairplay user, visit person with discipline cases:
   - Tuchtzaken tab visible in tab bar
   - Clicking tab shows table with their cases
   - Table has Match, Sanction, Fee columns (no Person column)
   - Row expansion works
4. As fairplay user, visit person WITHOUT discipline cases:
   - Tuchtzaken tab NOT visible in tab bar
5. As non-fairplay user, visit any person:
   - Tuchtzaken tab NOT visible regardless of cases
</verification>

<success_criteria>
- Tuchtzaken tab shows discipline cases linked to person
- Tab visible only to fairplay users AND only when person has cases
- Table uses DisciplineCaseTable component (reused from Plan 02)
- showPersonColumn=false on person tab
- No season filter on person tab (shows all seasons)
- Placeholder message completely removed
- Cases display read-only (match, charges, sanctions, fee)
</success_criteria>

<output>
After completion, create `.planning/phases/134-discipline-cases-ui/134-03-SUMMARY.md`
</output>
