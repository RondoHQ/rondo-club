---
phase: 66-psr4-autoloader
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [includes/class-monica-import.php, includes/class-vcard-import.php, includes/class-google-contacts-import.php, includes/class-vcard-export.php, includes/class-ical-feed.php, includes/class-carddav-server.php, includes/class-inverse-relationships.php, includes/class-todo-migration.php, includes/class-credential-encryption.php]
autonomous: true
---

<objective>
Add PSR-4 namespaces to import, export, CardDAV, and data processing classes.

Purpose: Enable Composer autoloading for import/export functionality and data processing utilities.
Output: 9 PHP files with proper Stadion\Import, Stadion\Export, Stadion\CardDAV, and Stadion\Data namespace declarations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/64-audit-planning/AUDIT.md

Namespace mapping from AUDIT.md:
- STADION_Monica_Import → Stadion\Import\Monica
- STADION_VCard_Import → Stadion\Import\VCard
- STADION_Google_Contacts_Import → Stadion\Import\GoogleContacts
- STADION_VCard_Export → Stadion\Export\VCard
- STADION_ICal_Feed → Stadion\Export\ICalFeed
- STADION_CardDAV_Server → Stadion\CardDAV\Server
- STADION_Inverse_Relationships → Stadion\Data\InverseRelationships
- STADION_Todo_Migration → Stadion\Data\TodoMigration
- STADION_Credential_Encryption → Stadion\Data\CredentialEncryption

Note: The carddav/ subdirectory classes (AuthBackend, CardDAVBackend, PrincipalBackend) already have Stadion\CardDAV namespace - no changes needed for those.

Relevant source files:
@includes/class-vcard-import.php
@includes/class-carddav-server.php
@includes/class-credential-encryption.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add namespaces to Import/Export and CardDAV classes</name>
  <files>includes/class-monica-import.php, includes/class-vcard-import.php, includes/class-google-contacts-import.php, includes/class-vcard-export.php, includes/class-ical-feed.php, includes/class-carddav-server.php</files>
  <action>
For the 3 import class files, add namespace:
```php
namespace Stadion\Import;
```

Rename import classes:
- `class STADION_Monica_Import` → `class Monica`
- `class STADION_VCard_Import` → `class VCard`
- `class STADION_Google_Contacts_Import` → `class GoogleContacts`

---

For the 2 export class files, add namespace:
```php
namespace Stadion\Export;
```

Rename export classes:
- `class STADION_VCard_Export` → `class VCard`
- `class STADION_ICal_Feed` → `class ICalFeed`

---

For class-carddav-server.php, add namespace:
```php
namespace Stadion\CardDAV;
```

Rename:
- `class STADION_CardDAV_Server` → `class Server`

This places it in the same namespace as the existing carddav/ subdirectory classes (AuthBackend, CardDAVBackend, PrincipalBackend).

Example for class-vcard-import.php:
```php
<?php
/**
 * VCard Import Handler
 */

if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

namespace Stadion\Import;

class VCard {
    // ... rest unchanged
}
```
  </action>
  <verify>Verify namespaces: `grep "namespace Stadion" includes/class-monica-import.php includes/class-vcard-import.php includes/class-google-contacts-import.php includes/class-vcard-export.php includes/class-ical-feed.php includes/class-carddav-server.php`</verify>
  <done>3 import classes have Stadion\Import namespace, 2 export classes have Stadion\Export namespace, CardDAV server has Stadion\CardDAV namespace</done>
</task>

<task type="auto">
  <name>Task 2: Add namespaces to Data classes</name>
  <files>includes/class-inverse-relationships.php, includes/class-todo-migration.php, includes/class-credential-encryption.php</files>
  <action>
For each of the 3 data class files, add namespace:
```php
namespace Stadion\Data;
```

Rename data classes:
- `class STADION_Inverse_Relationships` → `class InverseRelationships`
- `class STADION_Todo_Migration` → `class TodoMigration`
- `class STADION_Credential_Encryption` → `class CredentialEncryption`

Keep ABSPATH check before namespace declaration.

Example for class-credential-encryption.php:
```php
<?php
/**
 * Credential Encryption using Sodium
 */

if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

namespace Stadion\Data;

class CredentialEncryption {
    // ... rest unchanged
}
```
  </action>
  <verify>Verify namespaces: `grep "namespace Stadion\\\\Data" includes/class-inverse-relationships.php includes/class-todo-migration.php includes/class-credential-encryption.php`</verify>
  <done>3 data classes have Stadion\Data namespace and renamed class names</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 9 files have namespace declarations
- [ ] All class names are renamed (no STADION_ prefix)
- [ ] ABSPATH checks remain before namespace
- [ ] `php -l` passes on all modified files
- [ ] CardDAV Server is in same namespace as existing carddav/ classes
</verification>

<success_criteria>
- All tasks completed
- 3 Import classes namespaced as Stadion\Import\*
- 2 Export classes namespaced as Stadion\Export\*
- 1 CardDAV class namespaced as Stadion\CardDAV\*
- 3 Data classes namespaced as Stadion\Data\*
- No PHP syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/66-psr4-autoloader/66-03-SUMMARY.md`
</output>
