---
phase: 66-psr4-autoloader
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [includes/class-monica-import.php, includes/class-vcard-import.php, includes/class-google-contacts-import.php, includes/class-vcard-export.php, includes/class-ical-feed.php, includes/class-carddav-server.php, includes/class-inverse-relationships.php, includes/class-todo-migration.php, includes/class-credential-encryption.php]
autonomous: true
---

<objective>
Add PSR-4 namespaces to import, export, CardDAV, and data processing classes.

Purpose: Enable Composer autoloading for import/export functionality and data processing utilities.
Output: 9 PHP files with proper Caelis\Import, Caelis\Export, Caelis\CardDAV, and Caelis\Data namespace declarations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/64-audit-planning/AUDIT.md

Namespace mapping from AUDIT.md:
- PRM_Monica_Import → Caelis\Import\Monica
- PRM_VCard_Import → Caelis\Import\VCard
- PRM_Google_Contacts_Import → Caelis\Import\GoogleContacts
- PRM_VCard_Export → Caelis\Export\VCard
- PRM_ICal_Feed → Caelis\Export\ICalFeed
- PRM_CardDAV_Server → Caelis\CardDAV\Server
- PRM_Inverse_Relationships → Caelis\Data\InverseRelationships
- PRM_Todo_Migration → Caelis\Data\TodoMigration
- PRM_Credential_Encryption → Caelis\Data\CredentialEncryption

Note: The carddav/ subdirectory classes (AuthBackend, CardDAVBackend, PrincipalBackend) already have Caelis\CardDAV namespace - no changes needed for those.

Relevant source files:
@includes/class-vcard-import.php
@includes/class-carddav-server.php
@includes/class-credential-encryption.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add namespaces to Import/Export and CardDAV classes</name>
  <files>includes/class-monica-import.php, includes/class-vcard-import.php, includes/class-google-contacts-import.php, includes/class-vcard-export.php, includes/class-ical-feed.php, includes/class-carddav-server.php</files>
  <action>
For the 3 import class files, add namespace:
```php
namespace Caelis\Import;
```

Rename import classes:
- `class PRM_Monica_Import` → `class Monica`
- `class PRM_VCard_Import` → `class VCard`
- `class PRM_Google_Contacts_Import` → `class GoogleContacts`

---

For the 2 export class files, add namespace:
```php
namespace Caelis\Export;
```

Rename export classes:
- `class PRM_VCard_Export` → `class VCard`
- `class PRM_ICal_Feed` → `class ICalFeed`

---

For class-carddav-server.php, add namespace:
```php
namespace Caelis\CardDAV;
```

Rename:
- `class PRM_CardDAV_Server` → `class Server`

This places it in the same namespace as the existing carddav/ subdirectory classes (AuthBackend, CardDAVBackend, PrincipalBackend).

Example for class-vcard-import.php:
```php
<?php
/**
 * VCard Import Handler
 */

if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

namespace Caelis\Import;

class VCard {
    // ... rest unchanged
}
```
  </action>
  <verify>Verify namespaces: `grep "namespace Caelis" includes/class-monica-import.php includes/class-vcard-import.php includes/class-google-contacts-import.php includes/class-vcard-export.php includes/class-ical-feed.php includes/class-carddav-server.php`</verify>
  <done>3 import classes have Caelis\Import namespace, 2 export classes have Caelis\Export namespace, CardDAV server has Caelis\CardDAV namespace</done>
</task>

<task type="auto">
  <name>Task 2: Add namespaces to Data classes</name>
  <files>includes/class-inverse-relationships.php, includes/class-todo-migration.php, includes/class-credential-encryption.php</files>
  <action>
For each of the 3 data class files, add namespace:
```php
namespace Caelis\Data;
```

Rename data classes:
- `class PRM_Inverse_Relationships` → `class InverseRelationships`
- `class PRM_Todo_Migration` → `class TodoMigration`
- `class PRM_Credential_Encryption` → `class CredentialEncryption`

Keep ABSPATH check before namespace declaration.

Example for class-credential-encryption.php:
```php
<?php
/**
 * Credential Encryption using Sodium
 */

if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

namespace Caelis\Data;

class CredentialEncryption {
    // ... rest unchanged
}
```
  </action>
  <verify>Verify namespaces: `grep "namespace Caelis\\\\Data" includes/class-inverse-relationships.php includes/class-todo-migration.php includes/class-credential-encryption.php`</verify>
  <done>3 data classes have Caelis\Data namespace and renamed class names</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 9 files have namespace declarations
- [ ] All class names are renamed (no PRM_ prefix)
- [ ] ABSPATH checks remain before namespace
- [ ] `php -l` passes on all modified files
- [ ] CardDAV Server is in same namespace as existing carddav/ classes
</verification>

<success_criteria>
- All tasks completed
- 3 Import classes namespaced as Caelis\Import\*
- 2 Export classes namespaced as Caelis\Export\*
- 1 CardDAV class namespaced as Caelis\CardDAV\*
- 3 Data classes namespaced as Caelis\Data\*
- No PHP syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/66-psr4-autoloader/66-03-SUMMARY.md`
</output>
