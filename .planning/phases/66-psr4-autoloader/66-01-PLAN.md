---
phase: 66-psr4-autoloader
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [includes/class-post-types.php, includes/class-taxonomies.php, includes/class-access-control.php, includes/class-visibility.php, includes/class-user-roles.php, includes/class-auto-title.php, includes/class-rest-base.php, includes/class-rest-api.php, includes/class-rest-people.php, includes/class-rest-companies.php, includes/class-rest-todos.php, includes/class-rest-workspaces.php, includes/class-rest-slack.php, includes/class-rest-import-export.php, includes/class-rest-calendar.php]
autonomous: true
---

<objective>
Add PSR-4 namespaces to core WordPress integration and REST API controller classes.

Purpose: Enable Composer autoloading by adding namespace declarations to the foundational classes that other classes depend on.
Output: 15 PHP files with proper Caelis\Core and Caelis\REST namespace declarations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/64-audit-planning/AUDIT.md
@.planning/phases/65-split-reorganize/65-01-SUMMARY.md

Namespace mapping from AUDIT.md:
- PRM_Post_Types → Caelis\Core\PostTypes
- PRM_Taxonomies → Caelis\Core\Taxonomies
- PRM_Access_Control → Caelis\Core\AccessControl
- PRM_Visibility → Caelis\Core\Visibility
- PRM_User_Roles → Caelis\Core\UserRoles
- PRM_Auto_Title → Caelis\Core\AutoTitle
- PRM_REST_Base → Caelis\REST\Base
- PRM_REST_API → Caelis\REST\Api
- PRM_REST_People → Caelis\REST\People
- PRM_REST_Companies → Caelis\REST\Companies
- PRM_REST_Todos → Caelis\REST\Todos
- PRM_REST_Workspaces → Caelis\REST\Workspaces
- PRM_REST_Slack → Caelis\REST\Slack
- PRM_REST_Import_Export → Caelis\REST\ImportExport
- PRM_REST_Calendar → Caelis\REST\Calendar

Relevant source files:
@includes/class-post-types.php
@includes/class-rest-base.php
@functions.php (for understanding current class loading)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add namespaces to Core classes</name>
  <files>includes/class-post-types.php, includes/class-taxonomies.php, includes/class-access-control.php, includes/class-visibility.php, includes/class-user-roles.php, includes/class-auto-title.php</files>
  <action>
For each of the 6 core class files:

1. Add namespace declaration after the opening PHP tag and file docblock:
   ```php
   namespace Caelis\Core;
   ```

2. Rename the class to remove PRM_ prefix:
   - `class PRM_Post_Types` → `class PostTypes`
   - `class PRM_Taxonomies` → `class Taxonomies`
   - `class PRM_Access_Control` → `class AccessControl`
   - `class PRM_Visibility` → `class Visibility`
   - `class PRM_User_Roles` → `class UserRoles`
   - `class PRM_Auto_Title` → `class AutoTitle`

3. Keep the ABSPATH check BEFORE the namespace declaration (WordPress security pattern).

4. Do NOT add `use` statements yet - those will be added in Plan 66-04 when updating references.

Example transformation for class-post-types.php:
```php
<?php
/**
 * Custom Post Types Registration
 */

if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

namespace Caelis\Core;

class PostTypes {
    // ... rest of class unchanged
}
```
  </action>
  <verify>Each file has `namespace Caelis\Core;` and class name without PRM_ prefix: `grep -l "namespace Caelis\\\\Core" includes/class-post-types.php includes/class-taxonomies.php includes/class-access-control.php includes/class-visibility.php includes/class-user-roles.php includes/class-auto-title.php`</verify>
  <done>6 core classes have Caelis\Core namespace and renamed class names</done>
</task>

<task type="auto">
  <name>Task 2: Add namespaces to REST classes</name>
  <files>includes/class-rest-base.php, includes/class-rest-api.php, includes/class-rest-people.php, includes/class-rest-companies.php, includes/class-rest-todos.php, includes/class-rest-workspaces.php, includes/class-rest-slack.php, includes/class-rest-import-export.php, includes/class-rest-calendar.php</files>
  <action>
For each of the 9 REST class files:

1. Add namespace declaration after ABSPATH check:
   ```php
   namespace Caelis\REST;
   ```

2. Rename the class to remove PRM_REST_ prefix:
   - `class PRM_REST_Base` → `class Base`
   - `class PRM_REST_API` → `class Api`
   - `class PRM_REST_People` → `class People`
   - `class PRM_REST_Companies` → `class Companies`
   - `class PRM_REST_Todos` → `class Todos`
   - `class PRM_REST_Workspaces` → `class Workspaces`
   - `class PRM_REST_Slack` → `class Slack`
   - `class PRM_REST_Import_Export` → `class ImportExport`
   - `class PRM_REST_Calendar` → `class Calendar`

3. For classes that extend PRM_REST_Base, update the extends clause:
   - `extends PRM_REST_Base` → `extends Base`
   (This works because they're in the same namespace)

4. Keep ABSPATH check before namespace declaration.

Example for class-rest-people.php:
```php
<?php
/**
 * People REST API
 */

if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

namespace Caelis\REST;

class People extends Base {
    // ... rest unchanged
}
```
  </action>
  <verify>Each REST file has `namespace Caelis\REST;` and proper class names: `grep -l "namespace Caelis\\\\REST" includes/class-rest-*.php`</verify>
  <done>9 REST classes have Caelis\REST namespace and renamed class names, extends clauses updated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 15 files have namespace declarations
- [ ] All class names are renamed (no PRM_ prefix)
- [ ] REST classes extending Base use `extends Base` (same namespace)
- [ ] ABSPATH checks remain in place before namespace
- [ ] `php -l` passes on all modified files (syntax check)
</verification>

<success_criteria>
- All tasks completed
- 6 Core classes namespaced as Caelis\Core\*
- 9 REST classes namespaced as Caelis\REST\*
- No PHP syntax errors
- Files follow PSR-4 naming convention ready for autoloading
</success_criteria>

<output>
After completion, create `.planning/phases/66-psr4-autoloader/66-01-SUMMARY.md`
</output>
