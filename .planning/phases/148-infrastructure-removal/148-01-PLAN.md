---
phase: 148-infrastructure-removal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - includes/class-post-types.php
  - includes/class-taxonomies.php
  - includes/class-access-control.php
  - includes/class-rest-api.php
  - includes/class-reminders.php
  - includes/class-ical-feed.php
  - acf-json/group_important_date_fields.json
  - bin/cleanup-duplicate-dates.php
  - tests/Wpunit/CptCrudTest.php
  - tests/Support/StadionTestCase.php
autonomous: true

must_haves:
  truths:
    - "All important_date posts deleted from production database"
    - "All date_type taxonomy terms deleted from production database"
    - "WordPress admin shows no Important Dates menu"
    - "REST API /wp/v2/important-dates returns 404"
  artifacts:
    - path: "includes/class-post-types.php"
      provides: "CPT registration without important_date"
      not_contains: "register_important_date_post_type"
    - path: "includes/class-taxonomies.php"
      provides: "Taxonomy registration without date_type"
      not_contains: "register_date_type_taxonomy"
    - path: "includes/class-access-control.php"
      provides: "Access control without important_date"
      not_contains: "important_date"
    - path: "acf-json/group_important_date_fields.json"
      provides: "Removed - should not exist"
      exists: false
  key_links:
    - from: "includes/class-post-types.php"
      to: "WordPress"
      via: "register_post_types() no longer calls register_important_date_post_type()"
    - from: "includes/class-taxonomies.php"
      to: "WordPress"
      via: "register_taxonomies() no longer calls register_date_type_taxonomy()"
---

<objective>
Delete Important Date data and remove backend code

Purpose: Remove obsolete Important Dates infrastructure from PHP codebase after Phase 147 moved birthdate to person records
Output: Clean backend without important_date CPT, date_type taxonomy, or related code
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/148-infrastructure-removal/148-CONTEXT.md
@.planning/phases/148-infrastructure-removal/148-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete production data via WP-CLI</name>
  <files>N/A (production database operations)</files>
  <action>
Delete all important_date posts and date_type taxonomy terms from production database using WP-CLI.

Steps:
1. SSH to production server
2. Check count first: `wp post list --post_type='important_date' --format=count`
3. Delete all important_date posts (using xargs for safety with large datasets):
   `wp post list --post_type='important_date' --format=ids | xargs -n 100 wp post delete --force`
4. Delete all date_type taxonomy terms:
   `wp term list date_type --field=term_id | xargs -n1 wp term delete date_type`
5. Verify deletion: `wp post list --post_type='important_date'` should return empty
6. Verify taxonomy: `wp term list date_type` should return empty

Use SSH command format from AGENTS.md:
```bash
source .env && ssh -p "$DEPLOY_SSH_PORT" "$DEPLOY_SSH_USER@$DEPLOY_SSH_HOST" "cd $DEPLOY_REMOTE_THEME_PATH && <wp-cli-command>"
```

DO NOT deploy any code yet - data must be deleted while CPT is still registered.
  </action>
  <verify>SSH to production and verify both commands return empty lists</verify>
  <done>Production database has zero important_date posts and zero date_type terms</done>
</task>

<task type="auto">
  <name>Task 2: Remove backend PHP code</name>
  <files>
includes/class-post-types.php
includes/class-taxonomies.php
includes/class-access-control.php
includes/class-rest-api.php
includes/class-reminders.php
includes/class-ical-feed.php
  </files>
  <action>
Remove all Important Dates infrastructure from PHP files.

**class-post-types.php:**
- Remove call to `$this->register_important_date_post_type();` from `register_post_types()` method
- Delete entire `register_important_date_post_type()` method (lines ~160-195)

**class-taxonomies.php:**
- Remove call to `$this->register_date_type_taxonomy();` from `register_taxonomies()` method
- Delete entire `register_date_type_taxonomy()` method
- Delete entire `add_default_date_types()` method

**class-access-control.php:**
- Remove `'important_date'` from `$controlled_post_types` array
- Remove the REST filter: `add_filter( 'rest_important_date_query', ... )`
- Remove the REST prepare filter: `add_filter( 'rest_prepare_important_date', ... )`

**class-rest-api.php:**
- Line ~915: Remove `'important_date'` from post types array
- Line ~2015: Remove `$total_dates = wp_count_posts( 'important_date' )->publish;`
- Line ~2015 area: Remove `'total_dates' => $total_dates` from stats array
- Line ~2418: Remove `'important_date'` from `$post_types` array

**class-reminders.php:**
- Delete entire `get_all_users_to_notify()` method (lines ~652-704) - this queries important_date posts which no longer exist

**class-ical-feed.php:**
- Remove `get_workspace_important_dates()` method
- Remove Important Dates from iCal feed generation
- Keep birthdate-based iCal functionality if it exists
- Search for all occurrences of `important_date` and `date_type` and remove related code blocks
  </action>
  <verify>
Run: `grep -r "important_date\|register_important_date\|date_type\|register_date_type" includes/*.php` - should return nothing
  </verify>
  <done>No PHP files reference important_date or date_type CPT/taxonomy</done>
</task>

<task type="auto">
  <name>Task 3: Remove ACF, utility scripts, and test fixtures</name>
  <files>
acf-json/group_important_date_fields.json
bin/cleanup-duplicate-dates.php
tests/Wpunit/CptCrudTest.php
tests/Support/StadionTestCase.php
  </files>
  <action>
Remove remaining backend artifacts.

**ACF field group:**
- Delete file: `acf-json/group_important_date_fields.json`

**Utility script:**
- Delete file: `bin/cleanup-duplicate-dates.php`

**Test files - CptCrudTest.php:**
- Remove fixture definition for `important_date` from class properties
- Delete test methods:
  - `test_important_date_create_via_rest_api()`
  - `test_important_date_read_access_control()`
  - `test_important_date_update_access_control()`
  - `test_important_date_delete_as_owner()`
  - `test_important_date_delete_denied_for_non_owner()`
  - `test_important_date_acf_fields_in_rest_response()`
- Remove any `important_date` references in remaining test methods

**Test files - StadionTestCase.php:**
- Remove `important_date` factory method if exists
- Remove any helper methods for creating test important_date posts

**Other test files (check and clean):**
- `tests/Wpunit/SmokeTest.php`
- `tests/Wpunit/UserIsolationTest.php`
- `tests/Wpunit/SearchDashboardTest.php`
- `tests/Wpunit/RelationshipsSharesTest.php`
Remove any references to important_date in assertions or fixture data.
  </action>
  <verify>
- File `acf-json/group_important_date_fields.json` does not exist
- File `bin/cleanup-duplicate-dates.php` does not exist
- `grep -r "important_date" tests/` returns no results
  </verify>
  <done>ACF field group deleted, utility script deleted, test files cleaned</done>
</task>

</tasks>

<verification>
After all tasks:
1. No PHP files reference important_date or date_type
2. No ACF JSON file for important dates exists
3. No utility scripts for date cleanup exist
4. All test files pass without important_date references
5. Production data already deleted (Task 1)
</verification>

<success_criteria>
- [ ] Production database has zero important_date posts
- [ ] Production database has zero date_type terms
- [ ] `grep -r "important_date" includes/` returns empty
- [ ] `grep -r "date_type" includes/` returns empty (except unrelated uses)
- [ ] `acf-json/group_important_date_fields.json` does not exist
- [ ] `bin/cleanup-duplicate-dates.php` does not exist
- [ ] `grep -r "important_date" tests/` returns empty

DO NOT deploy yet - wait for Plan 02 to complete frontend removal for single deploy.
</success_criteria>

<output>
After completion, create `.planning/phases/148-infrastructure-removal/148-01-SUMMARY.md`
</output>
