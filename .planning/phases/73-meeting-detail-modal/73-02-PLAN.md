---
phase: 73-meeting-detail-modal
plan: 02
type: execute
wave: 2
depends_on: ["73-01"]
files_modified:
  - src/components/MeetingDetailModal.jsx
  - src/pages/Dashboard.jsx
autonomous: true

must_haves:
  truths:
    - "User can click any meeting in dashboard to open detail modal"
    - "Modal displays title, time, duration, location, and description"
    - "Modal shows attendee list with avatars"
    - "Known attendees are visually distinguished and clickable to profile"
    - "Unknown attendees display email with placeholder avatar"
    - "Modal includes notes section that persists across page refresh"
  artifacts:
    - path: "src/components/MeetingDetailModal.jsx"
      provides: "Meeting detail modal component"
      min_lines: 150
    - path: "src/pages/Dashboard.jsx"
      provides: "MeetingCard with onClick handler"
      contains: "MeetingDetailModal"
  key_links:
    - from: "src/pages/Dashboard.jsx"
      to: "src/components/MeetingDetailModal.jsx"
      via: "import and state management"
      pattern: "setSelectedMeeting"
    - from: "src/components/MeetingDetailModal.jsx"
      to: "/stadion/v1/calendar/events/{id}/notes"
      via: "useMeetingNotes hook"
      pattern: "useMeetingNotes|useUpdateMeetingNotes"
---

<objective>
Create the MeetingDetailModal component and integrate it with the Dashboard's Today's Meetings widget.

Purpose: Allow users to view full meeting details including attendees and add prep notes.

Output:
- MeetingDetailModal.jsx - Modal component following TodoModal patterns
- Updated Dashboard.jsx - MeetingCard is clickable, opens modal
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/73-meeting-detail-modal/73-RESEARCH.md
@.planning/phases/73-meeting-detail-modal/73-01-SUMMARY.md

Key files:
@src/components/Timeline/TodoModal.jsx (modal pattern reference)
@src/components/ImportantDateModal.jsx (scrollable modal pattern)
@src/pages/Dashboard.jsx (MeetingCard component)
@src/hooks/useMeetings.js (useMeetingNotes, useUpdateMeetingNotes)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MeetingDetailModal component</name>
  <files>src/components/MeetingDetailModal.jsx</files>
  <action>
Create a new file at src/components/MeetingDetailModal.jsx following the TodoModal view-mode pattern.

Structure:
1. Modal wrapper with backdrop (fixed inset-0 z-50)
2. Header with meeting title and close button
3. Scrollable content area with:
   - Time and duration row (format: "Friday, January 17, 2026 at 10:00 AM - 11:00 AM (1 hour)")
   - Location (if present) with MapPin icon
   - Meeting URL (if present) with Video icon and clickable link
   - Description section (if present) - read-only, from calendar
   - Attendees list with matched/unmatched distinction
   - Notes section with RichTextEditor for meeting prep
4. Footer with Close button

Attendees list pattern (from RESEARCH.md):
- Known attendees: Clickable Link to /people/{id}, accent-colored name, avatar with photo
- Unknown attendees: Not clickable, gray text, User icon placeholder avatar
- Sort: matched attendees first, then alphabetically

Notes section:
- Collapsible like TodoModal notes
- Use RichTextEditor component
- Auto-save on blur or after 2 second debounce
- Show saving indicator

Props:
- isOpen: boolean
- onClose: () => void
- meeting: object (from Dashboard's meeting data)

```jsx
import { useState, useEffect, useCallback } from 'react';
import { Link } from 'react-router-dom';
import { X, MapPin, Video, Clock, User, ChevronDown } from 'lucide-react';
import { format } from 'date-fns';
import RichTextEditor from '@/components/RichTextEditor';
import { useMeetingNotes, useUpdateMeetingNotes } from '@/hooks/useMeetings';

export default function MeetingDetailModal({ isOpen, onClose, meeting }) {
  // State for notes
  const [notes, setNotes] = useState('');
  const [showNotes, setShowNotes] = useState(false);
  const [hasChanges, setHasChanges] = useState(false);

  // Fetch existing notes
  const { data: notesData, isLoading: isLoadingNotes } = useMeetingNotes(meeting?.id);
  const updateNotes = useUpdateMeetingNotes();

  // Initialize notes from fetched data
  useEffect(() => {
    if (notesData?.notes !== undefined) {
      setNotes(notesData.notes);
      setShowNotes(!!notesData.notes); // Auto-expand if notes exist
    }
  }, [notesData]);

  // Reset state when modal closes
  useEffect(() => {
    if (!isOpen) {
      setHasChanges(false);
    }
  }, [isOpen]);

  // Handle notes change with debounced auto-save
  const handleNotesChange = useCallback((value) => {
    setNotes(value);
    setHasChanges(true);
  }, []);

  // Save notes on blur
  const handleNotesSave = useCallback(() => {
    if (hasChanges && meeting?.id) {
      updateNotes.mutate({ eventId: meeting.id, notes });
      setHasChanges(false);
    }
  }, [hasChanges, meeting?.id, notes, updateNotes]);

  if (!isOpen || !meeting) return null;

  // Parse times
  const startDate = new Date(meeting.start_time);
  const endDate = new Date(meeting.end_time);

  // Calculate duration in minutes
  const durationMs = endDate - startDate;
  const durationMinutes = Math.round(durationMs / (1000 * 60));
  const durationHours = Math.floor(durationMinutes / 60);
  const durationMins = durationMinutes % 60;

  let durationText = '';
  if (durationHours > 0 && durationMins > 0) {
    durationText = `${durationHours}h ${durationMins}m`;
  } else if (durationHours > 0) {
    durationText = durationHours === 1 ? '1 hour' : `${durationHours} hours`;
  } else {
    durationText = `${durationMins} min`;
  }

  // Format time display
  const dateStr = format(startDate, 'EEEE, MMMM d, yyyy');
  const timeStr = meeting.all_day
    ? 'All day'
    : `${format(startDate, 'h:mm a')} - ${format(endDate, 'h:mm a')} (${durationText})`;

  // Sort attendees: matched first, then alphabetically
  const sortedAttendees = [...(meeting.attendees || [])].sort((a, b) => {
    if (a.matched !== b.matched) return b.matched - a.matched;
    return (a.name || a.email || '').localeCompare(b.name || b.email || '');
  });

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
      <div className="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg mx-4 max-h-[90vh] overflow-hidden flex flex-col">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
          <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-50 pr-4">{meeting.title}</h2>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 flex-shrink-0"
          >
            <X className="w-5 h-5" />
          </button>
        </div>

        {/* Content - scrollable */}
        <div className="flex-1 overflow-y-auto p-4 space-y-4">
          {/* Date and time */}
          <div className="flex items-start gap-3">
            <Clock className="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" />
            <div>
              <p className="text-sm font-medium text-gray-900 dark:text-gray-50">{dateStr}</p>
              <p className="text-sm text-gray-600 dark:text-gray-400">{timeStr}</p>
            </div>
          </div>

          {/* Location */}
          {meeting.location && (
            <div className="flex items-start gap-3">
              <MapPin className="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" />
              <p className="text-sm text-gray-600 dark:text-gray-400">{meeting.location}</p>
            </div>
          )}

          {/* Meeting URL */}
          {meeting.meeting_url && (
            <div className="flex items-start gap-3">
              <Video className="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" />
              <a
                href={meeting.meeting_url}
                target="_blank"
                rel="noopener noreferrer"
                className="text-sm text-accent-600 dark:text-accent-400 hover:underline break-all"
              >
                Join meeting
              </a>
            </div>
          )}

          {/* Description from calendar */}
          {meeting.description && (
            <div>
              <p className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</p>
              <div
                className="text-sm text-gray-600 dark:text-gray-400 prose prose-sm dark:prose-invert max-w-none"
                dangerouslySetInnerHTML={{ __html: meeting.description }}
              />
            </div>
          )}

          {/* Attendees */}
          {sortedAttendees.length > 0 && (
            <div>
              <p className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Attendees ({sortedAttendees.length})
              </p>
              <div className="space-y-1">
                {sortedAttendees.map((attendee, index) => (
                  <AttendeeRow key={attendee.email || index} attendee={attendee} />
                ))}
              </div>
            </div>
          )}

          {/* Notes section - collapsible */}
          <div>
            <button
              type="button"
              onClick={() => setShowNotes(!showNotes)}
              className="flex items-center gap-1 text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 hover:text-gray-900 dark:hover:text-gray-100"
            >
              <ChevronDown className={`w-4 h-4 transition-transform ${showNotes ? '' : '-rotate-90'}`} />
              Meeting notes
              {updateNotes.isPending && <span className="text-xs text-gray-400 ml-2">Saving...</span>}
            </button>
            {showNotes && (
              <RichTextEditor
                value={notes}
                onChange={handleNotesChange}
                onBlur={handleNotesSave}
                placeholder="Add meeting prep notes..."
                disabled={isLoadingNotes}
                minHeight="100px"
              />
            )}
          </div>
        </div>

        {/* Footer */}
        <div className="px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 flex justify-end">
          <button onClick={onClose} className="btn-secondary">
            Close
          </button>
        </div>
      </div>
    </div>
  );
}

function AttendeeRow({ attendee }) {
  const displayName = attendee.person_name || attendee.name || attendee.email || 'Unknown';

  const content = (
    <div className="flex items-center gap-3 py-2">
      {/* Avatar */}
      {attendee.matched && attendee.thumbnail ? (
        <img
          src={attendee.thumbnail}
          alt={displayName}
          className="w-8 h-8 rounded-full object-cover"
        />
      ) : (
        <div className="w-8 h-8 bg-gray-200 dark:bg-gray-600 rounded-full flex items-center justify-center">
          <User className="w-4 h-4 text-gray-500 dark:text-gray-400" />
        </div>
      )}

      {/* Name and email */}
      <div className="flex-1 min-w-0">
        <p className={`text-sm truncate ${
          attendee.matched
            ? 'font-medium text-accent-600 dark:text-accent-400'
            : 'text-gray-600 dark:text-gray-400'
        }`}>
          {displayName}
        </p>
        {attendee.matched && attendee.email && attendee.email !== displayName && (
          <p className="text-xs text-gray-500 dark:text-gray-500 truncate">{attendee.email}</p>
        )}
      </div>
    </div>
  );

  // Wrap in Link only if matched
  if (attendee.matched && attendee.person_id) {
    return (
      <Link
        to={`/people/${attendee.person_id}`}
        className="block rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors px-2 -mx-2"
      >
        {content}
      </Link>
    );
  }

  return <div className="px-2 -mx-2">{content}</div>;
}
```
  </action>
  <verify>
Build passes:
```bash
cd /Users/joostdevalk/Code/stadion && npm run build
```
Component compiles without errors.
  </verify>
  <done>MeetingDetailModal.jsx exists with header, time/location/description display, attendee list with matched distinction, and collapsible notes section</done>
</task>

<task type="auto">
  <name>Task 2: Integrate modal with Dashboard MeetingCard</name>
  <files>src/pages/Dashboard.jsx</files>
  <action>
Update Dashboard.jsx to:

1. Import MeetingDetailModal (lazy-loaded like TodoModal):
```jsx
const MeetingDetailModal = lazy(() => import('@/components/MeetingDetailModal'));
```

2. Add state for selected meeting:
```jsx
// State for meeting detail modal
const [selectedMeeting, setSelectedMeeting] = useState(null);
const [showMeetingModal, setShowMeetingModal] = useState(false);
```

3. Modify MeetingCard component to accept onClick prop and always be clickable:
```jsx
function MeetingCard({ meeting, onClick }) {
  // ... existing card content code ...

  // Always wrap in button for click handling
  return (
    <button
      type="button"
      onClick={() => onClick(meeting)}
      className="w-full flex items-center p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left"
    >
      {cardContent}
    </button>
  );
}
```

4. Update MeetingCard usage in cardRenderers['meetings'] to pass onClick:
```jsx
todayMeetings.map((meeting) => (
  <MeetingCard
    key={meeting.id}
    meeting={meeting}
    onClick={(m) => {
      setSelectedMeeting(m);
      setShowMeetingModal(true);
    }}
  />
))
```

5. Add modal to JSX (after TodoModal, inside Suspense):
```jsx
<Suspense fallback={null}>
  {/* Existing TodoModal */}
  <TodoModal ... />

  {/* Meeting Detail Modal */}
  <MeetingDetailModal
    isOpen={showMeetingModal}
    onClose={() => {
      setShowMeetingModal(false);
      setSelectedMeeting(null);
    }}
    meeting={selectedMeeting}
  />
</Suspense>
```

Remove the Link wrapper from MeetingCard - the modal replaces direct navigation. Users can click attendees inside the modal to navigate to profiles.
  </action>
  <verify>
1. Build passes: `npm run build`
2. Manual test on production:
   - Dashboard shows Today's meetings
   - Click any meeting card
   - Modal opens with meeting details
   - Attendees show with correct matched/unmatched styling
   - Known attendees are clickable (navigate to profile)
   - Notes can be added and saved
   - Close button works
  </verify>
  <done>MeetingCard is clickable, opens MeetingDetailModal with full meeting details and attendee list</done>
</task>

</tasks>

<verification>
1. Build: `npm run build` passes with no errors
2. Manual verification on production (after deploy):
   - Click meeting card in dashboard -> modal opens (MTG-01)
   - Modal shows title, time, duration (MTG-02)
   - Modal shows location if present (MTG-03)
   - Modal shows description if present (MTG-04)
   - Modal shows attendee list with avatars (MTG-05)
   - Known attendees have accent color, unknown are gray (MTG-06, ADD-01)
   - Click known attendee -> navigates to profile (MTG-07)
   - Notes section can be edited and saves (MTG-08)
</verification>

<success_criteria>
- MeetingDetailModal component created following existing modal patterns
- Dashboard MeetingCard is clickable to open modal
- Modal displays all meeting information (title, time, location, description)
- Attendees show with matched/unmatched visual distinction
- Known attendees are clickable links to their profiles
- Meeting notes can be added, edited, and persist
- All 9 requirements for Phase 73 covered (MTG-01 through MTG-08, ADD-01)
</success_criteria>

<output>
After completion, create `.planning/phases/73-meeting-detail-modal/73-02-SUMMARY.md`
</output>
