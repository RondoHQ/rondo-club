---
phase: 107-pwa-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vite.config.js
  - public/icons/icon-192x192.png
  - public/icons/icon-512x512.png
  - public/icons/icon-512x512-maskable.png
  - public/icons/apple-touch-icon-180x180.png
  - favicon.svg
autonomous: true

must_haves:
  truths:
    - "PWA manifest.webmanifest is generated during build"
    - "manifest includes all required icon sizes"
    - "manifest has correct app identity (name, start_url, display)"
  artifacts:
    - path: "vite.config.js"
      provides: "vite-plugin-pwa configuration"
      contains: "VitePWA"
    - path: "public/icons/icon-192x192.png"
      provides: "Android home screen icon"
    - path: "public/icons/icon-512x512.png"
      provides: "Android splash icon"
    - path: "public/icons/apple-touch-icon-180x180.png"
      provides: "iOS home screen icon"
    - path: "dist/manifest.webmanifest"
      provides: "Generated PWA manifest"
  key_links:
    - from: "vite.config.js"
      to: "dist/manifest.webmanifest"
      via: "VitePWA plugin generates manifest during build"
      pattern: "manifest:"
---

<objective>
Install vite-plugin-pwa, configure the PWA manifest, and generate all required PWA icons for Android and iOS home screen installation.

Purpose: Create the foundation for PWA installation by generating the manifest and icons that browsers use to determine if an app is installable.

Output: Configured vite-plugin-pwa with manifest generation, PWA icons in public/icons/, and production build that includes manifest.webmanifest.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/107-pwa-foundation/107-RESEARCH.md
@.planning/phases/107-pwa-foundation/107-CONTEXT.md
@vite.config.js
@package.json
@favicon.svg
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install vite-plugin-pwa and configure manifest</name>
  <files>
    - package.json
    - vite.config.js
  </files>
  <action>
1. Install vite-plugin-pwa as dev dependency:
   ```bash
   npm install -D vite-plugin-pwa
   ```

2. Update vite.config.js to add VitePWA plugin with manifest configuration:
   - Import VitePWA from 'vite-plugin-pwa'
   - Add VitePWA plugin to plugins array
   - Configure manifest with these EXACT values from CONTEXT.md:
     - name: "Stadion"
     - short_name: "Stadion"
     - description: "Club data management"
     - theme_color: "#f97316" (orange-500, default accent)
     - background_color: "#ffffff"
     - display: "standalone"
     - orientation: "any"
     - start_url: "/dashboard"
     - scope: "/"
     - categories: ["sports"]
   - Configure icons array pointing to public/icons/:
     - icon-192x192.png (sizes: 192x192)
     - icon-512x512.png (sizes: 512x512)
     - icon-512x512-maskable.png (sizes: 512x512, purpose: maskable)
   - Set registerType: 'prompt' (from research - users control updates)
   - Configure workbox for NetworkFirst API caching (from research):
     - globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}']
     - runtimeCaching for /wp-json/ with NetworkFirst handler
     - cleanupOutdatedCaches: true

Note: Do NOT use injectRegister for meta tags - we'll inject those via PHP in Plan 02.
  </action>
  <verify>
    - npm list vite-plugin-pwa shows package installed
    - grep -q "VitePWA" vite.config.js returns success
    - Node can parse vite.config.js without errors: node -e "import('./vite.config.js')"
  </verify>
  <done>
    vite-plugin-pwa installed and configured in vite.config.js with complete manifest settings
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate PWA icons from existing favicon</name>
  <files>
    - public/icons/icon-192x192.png
    - public/icons/icon-512x512.png
    - public/icons/icon-512x512-maskable.png
    - public/icons/apple-touch-icon-180x180.png
    - favicon.svg
  </files>
  <action>
1. Create public/icons/ directory if it doesn't exist

2. Generate PWA icons from the existing favicon.svg (stadium icon):
   - The current favicon.svg has a stadium icon in orange (#f97316)
   - Use a tool to convert SVG to PNG at required sizes

   Options for generation (pick one that works):
   a) Use sharp via npx: Create a quick script that uses sharp to convert
   b) Use ImageMagick if available: convert favicon.svg -resize 512x512 icon-512x512.png
   c) Create simple node script using sharp (install as dev dep if needed)

3. Generate these icon files:
   - icon-192x192.png (192x192, for Android manifest)
   - icon-512x512.png (512x512, for Android splash)
   - icon-512x512-maskable.png (512x512 with safe area padding for Android adaptive icons - add 10% padding)
   - apple-touch-icon-180x180.png (180x180, for iOS Add to Home Screen)

4. For maskable icon: The safe area is the center 80% circle. Either:
   - Scale the icon down to 80% and center it on a #f97316 background
   - Or use a simpler approach: just copy icon-512x512.png (browsers handle masking)

Note: If ImageMagick/sharp not available, can use online tools or pwa-asset-generator, but prefer automated approach.

The icon should be the stadium symbol from favicon.svg in orange (#f97316) on white or transparent background.
  </action>
  <verify>
    - ls public/icons/ shows all 4 PNG files
    - file public/icons/icon-512x512.png confirms PNG format
    - Each file size is > 1KB (not empty placeholder)
  </verify>
  <done>
    All 4 PWA icon files exist in public/icons/ at correct dimensions
  </done>
</task>

<task type="auto">
  <name>Task 3: Build and verify manifest generation</name>
  <files>
    - dist/manifest.webmanifest
    - dist/.vite/manifest.json
  </files>
  <action>
1. Run production build:
   ```bash
   npm run build
   ```

2. Verify manifest.webmanifest was generated in dist/:
   ```bash
   cat dist/manifest.webmanifest
   ```

3. Verify manifest content includes:
   - name: "Stadion"
   - short_name: "Stadion"
   - start_url: "/dashboard"
   - display: "standalone"
   - icons array with all icon paths

4. If manifest is NOT in dist/, check:
   - vite-plugin-pwa config syntax
   - Build output for errors
   - Adjust configuration if needed

5. Verify service worker was generated:
   ```bash
   ls dist/sw.js
   ```
  </action>
  <verify>
    - test -f dist/manifest.webmanifest (file exists)
    - grep -q '"name":"Stadion"' dist/manifest.webmanifest
    - grep -q '"display":"standalone"' dist/manifest.webmanifest
    - test -f dist/sw.js (service worker exists)
  </verify>
  <done>
    npm run build produces dist/manifest.webmanifest with correct content and dist/sw.js
  </done>
</task>

</tasks>

<verification>
Run these checks after all tasks complete:

1. **Package installed:**
   ```bash
   npm list vite-plugin-pwa
   ```

2. **Icons exist:**
   ```bash
   ls -la public/icons/
   ```

3. **Build succeeds:**
   ```bash
   npm run build 2>&1 | tail -20
   ```

4. **Manifest generated:**
   ```bash
   cat dist/manifest.webmanifest | head -30
   ```

5. **Service worker generated:**
   ```bash
   ls -la dist/sw.js dist/workbox-*.js
   ```
</verification>

<success_criteria>
- vite-plugin-pwa installed as devDependency
- vite.config.js imports and uses VitePWA with manifest config
- public/icons/ contains 4 PNG icon files at correct sizes
- npm run build produces dist/manifest.webmanifest
- Manifest contains correct app identity and icon references
- dist/sw.js service worker file generated
</success_criteria>

<output>
After completion, create `.planning/phases/107-pwa-foundation/107-01-SUMMARY.md`
</output>
