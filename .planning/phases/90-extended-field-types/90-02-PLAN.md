---
phase: 90-extended-field-types
plan: 02
type: execute
wave: 2
depends_on: [90-01]
files_modified:
  - src/components/FieldFormPanel.jsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "Image field shows return format selector in Settings UI"
    - "File field shows return format selector in Settings UI"
    - "Link field shows no type-specific options (ACF handles natively)"
    - "Color field shows default color picker preview in Settings UI"
    - "Relationship field shows post type checkboxes and cardinality selector"
  artifacts:
    - path: "src/components/FieldFormPanel.jsx"
      provides: "Type-specific options UI for all 5 extended field types"
      contains: "case 'image'"
    - path: "package.json"
      provides: "@uiw/react-color dependency"
      contains: "@uiw/react-color"
  key_links:
    - from: "src/components/FieldFormPanel.jsx"
      to: "/rondo/v1/custom-fields"
      via: "onSubmit callback with extended type options"
      pattern: "submitData.return_format|submitData.post_type"
---

<objective>
Add type-specific configuration UI to FieldFormPanel for the 5 extended field types: Image, File, Link, Color, and Relationship.

Purpose: Enable admins to configure extended field type options when creating/editing custom fields in Settings.
Output: Complete Settings UI for all 14 custom field types with type-appropriate configuration options.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/90-extended-field-types/90-CONTEXT.md
@.planning/phases/90-extended-field-types/90-01-SUMMARY.md
@src/components/FieldFormPanel.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @uiw/react-color and add extended type options to FieldFormPanel</name>
  <files>package.json, src/components/FieldFormPanel.jsx</files>
  <action>
**Step 1: Install color picker library**
```bash
npm install @uiw/react-color-sketch
```
Use the Sketch variant - it provides the simple square picker style (saturation/brightness square with hue slider) specified in CONTEXT.md.

**Step 2: Add extended type defaults to getDefaultFormData()**
```javascript
// Image options
return_format: 'array',
preview_size: 'medium',
library: 'all',
// File options (shares return_format, library)
// Link options - none needed (ACF handles natively)
// Color options
default_color: '',
// Relationship options
relationship_post_types: ['person', 'team'],
relationship_min: 0,
relationship_max: 1, // 1 = single, >1 = multiple
```

**Step 3: Add cases in renderTypeOptions() for extended types:**

**case 'image':**
- Return Format: Select with options 'Image Array', 'Image URL', 'Image ID'
- Preview Size: Select with options 'Thumbnail', 'Medium', 'Large', 'Full'
- Library: Select with options 'All', 'Uploaded to this post'
- Hint text explaining each option

**case 'file':**
- Return Format: Select with options 'File Array', 'File URL', 'File ID'
- Library: Select with options 'All', 'Uploaded to this post'
- Hint text for return format

**case 'link':**
- Show informational text: "Link fields capture URL and display text. No additional configuration needed."
- The field automatically stores {url, title, target} - ACF handles this natively

**case 'color_picker':**
- Default Color: Use Sketch color picker component with hex input
- Import: `import Sketch from '@uiw/react-color-sketch'`
- Show color swatch preview next to hex input
- Allow clearing to empty (no default color)
- No opacity slider (per CONTEXT.md: hex only)

**case 'relationship':**
- Post Types: Two checkboxes for 'People' and 'Teams' (both checked by default)
- Cardinality: Radio buttons for 'Single' (max=1) and 'Multiple' (max=0 means unlimited)
- If Multiple selected, show optional Max field (number input)
- Return Format: Select with 'Post Object' and 'Post ID' options

**Step 4: Update handleSubmit to include extended type options:**

```javascript
if (formData.type === 'image') {
  submitData.return_format = formData.return_format;
  submitData.preview_size = formData.preview_size;
  submitData.library = formData.library;
}

if (formData.type === 'file') {
  submitData.return_format = formData.return_format;
  submitData.library = formData.library;
}

// Link type needs no special handling - stored as native ACF link

if (formData.type === 'color_picker') {
  if (formData.default_color) {
    submitData.default_value = formData.default_color;
  }
}

if (formData.type === 'relationship') {
  submitData.post_type = formData.relationship_post_types;
  submitData.min = formData.relationship_min;
  submitData.max = formData.relationship_max;
  submitData.return_format = formData.return_format || 'object';
  submitData.filters = ['search', 'post_type'];
}
```

**Step 5: Update useEffect for editing to load extended type values:**
Map saved field values back to form state for image, file, color_picker, and relationship types.
  </action>
  <verify>Run `npm run build` to verify no TypeScript/build errors with new component code</verify>
  <done>FieldFormPanel renders type-specific options for all 5 extended field types</done>
</task>

<task type="auto">
  <name>Task 2: Deploy and verify extended type options UI</name>
  <files></files>
  <action>
1. Run `npm run build` to create production build
2. Deploy to production using `bin/deploy.sh`
3. Navigate to Settings > Custom Fields in the app
4. Test creating each extended field type:
   - Image: Verify return format, preview size, library dropdowns appear
   - File: Verify return format, library dropdowns appear
   - Link: Verify informational text appears (no config options)
   - Color: Verify color picker with hex input appears
   - Relationship: Verify post type checkboxes and cardinality options appear
5. Save a field of each type and verify options persist when editing
6. Delete test fields
  </action>
  <verify>All 5 extended field types show correct configuration UI and options persist on save</verify>
  <done>Extended field type configuration UI complete and deployed</done>
</task>

</tasks>

<verification>
- [ ] @uiw/react-color-sketch installed and imported
- [ ] Image field shows return format, preview size, library selectors
- [ ] File field shows return format, library selectors
- [ ] Link field shows informational text only
- [ ] Color field shows Sketch color picker with hex preview
- [ ] Relationship field shows post type checkboxes and cardinality options
- [ ] All options persist correctly when saving and re-editing fields
- [ ] No console errors when switching between field types
</verification>

<success_criteria>
Admin can create and configure all 5 extended field types (Image, File, Link, Color, Relationship) through the Settings UI with type-appropriate configuration options.
</success_criteria>

<output>
After completion, create `.planning/phases/90-extended-field-types/90-02-SUMMARY.md`
</output>
