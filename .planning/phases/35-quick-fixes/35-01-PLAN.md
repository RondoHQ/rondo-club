---
phase: 35-quick-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Companies/CompaniesList.jsx
  - src/pages/People/PersonDetail.jsx
  - src/hooks/useVersionCheck.js
  - functions.php
  - includes/class-rest-api.php
  - vite.config.js
autonomous: true
---

<objective>
Implement four quick UI fixes: clickable website links, remove labels column from companies, simplify Slack display, and switch to build numbers for refresh detection.

Purpose: Address pending UI polish items from backlog to improve UX.
Output: Cleaner Organizations list, improved contact display, and reliable refresh detection.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/pages/Companies/CompaniesList.jsx
@src/pages/People/PersonDetail.jsx
@src/hooks/useVersionCheck.js
@functions.php
@includes/class-rest-api.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make company website clickable and remove labels column</name>
  <files>src/pages/Companies/CompaniesList.jsx</files>
  <action>
In OrganizationListRow component (around line 388):
1. Change the website cell from plain text to a clickable link:
   - Wrap the website URL in an anchor tag with `target="_blank"` and `rel="noopener noreferrer"`
   - Only show as link if website exists, otherwise show '-'
   - Add `text-primary-600 hover:underline` styling to the link
   - Truncate display with `truncate` class to maintain table layout

In OrganizationListRow component:
2. Remove the labels column entirely:
   - Remove the labels `<td>` element (lines 394-412)
   - Remove the `labelIds` and `labelNames` variables

In OrganizationListView component:
3. Remove labels header:
   - Remove the SortableHeader for labels (around line 466)

In CompaniesList component:
4. Clean up labels sorting:
   - Remove 'labels' option from sort dropdown (around line 729)
   - Remove labels sorting logic from sortedCompanies useMemo (around lines 663-667)
   - Remove getCompanyLabelNames helper function (lines 610-618)

5. Remove BulkLabelsModal and related state/handlers since labels aren't used for companies:
   - Remove showBulkLabelsModal state
   - Remove BulkLabelsModal import usage from selection toolbar (around line 955-963)
   - Remove BulkLabelsModal component instance (around lines 1054-1076)
   - Keep the BulkLabelsModal component definition (may be used elsewhere in future)
  </action>
  <verify>
- `npm run build` succeeds
- Organizations list shows website as clickable blue link opening in new tab
- Labels column is removed from organizations list
- Labels option is removed from sort dropdown
- Labels bulk action is removed from selection toolbar
  </verify>
  <done>
- Website URLs are clickable links with proper styling and new tab behavior
- Labels column, sorting, and bulk action completely removed from Organizations list
  </done>
</task>

<task type="auto">
  <name>Task 2: Simplify Slack contact details display</name>
  <files>src/pages/People/PersonDetail.jsx</files>
  <action>
In the contact information section (around lines 1543-1584), modify the Slack contact display:

Current display shows: "label: value" where value is the full Slack URL

Change to show only the label as a clickable link:
1. For Slack type contacts, instead of showing:
   `<span className="text-sm text-gray-500">{contact.contact_label || contact.contact_type}: </span>`
   followed by the link with full URL,

   Show just the label as the clickable link:
   ```jsx
   {isSlack ? (
     <a
       href={contact.contact_value}
       target="_blank"
       rel="noopener noreferrer"
       className="text-primary-600 hover:text-primary-700 hover:underline"
     >
       {contact.contact_label || 'Slack'}
     </a>
   ) : (
     // existing display for other contact types
   )}
   ```

The Slack icon should still be shown before the label link, maintaining consistency with other contact types.
  </action>
  <verify>
- `npm run build` succeeds
- Slack contacts show only the label as a clickable link (not "Slack: https://...")
- Clicking the label opens Slack URL in new tab
- Other contact types (email, phone, calendar) still display normally
  </verify>
  <done>
- Slack contact details display only the label text as clickable link
- Slack icon remains visible before the label
- No URL text visible for Slack contacts
  </done>
</task>

<task type="auto">
  <name>Task 3: Switch from version numbers to build timestamps for refresh detection</name>
  <files>vite.config.js, functions.php, includes/class-rest-api.php, src/hooks/useVersionCheck.js</files>
  <action>
1. In vite.config.js, add build timestamp injection using Vite's define feature:
   ```js
   export default defineConfig({
     define: {
       __BUILD_TIME__: JSON.stringify(new Date().toISOString()),
     },
     // ... rest of config
   });
   ```

2. In functions.php, update prm_get_js_config() to include build_time:
   - Add 'buildTime' key that reads from a generated file or falls back to theme version
   - During development (WP_DEBUG), use current timestamp
   - During production, use manifest-based timestamp or file modification time

   Update the function around line 330:
   ```php
   function prm_get_js_config() {
       $user = wp_get_current_user();

       // Get build time from manifest or use file mtime
       $build_time = null;
       $manifest_path = PRM_THEME_DIR . '/dist/.vite/manifest.json';
       if (file_exists($manifest_path)) {
           $build_time = date('c', filemtime($manifest_path));
       } else {
           $build_time = date('c'); // Current time for dev mode
       }

       return [
           // ... existing keys ...
           'version'     => wp_get_theme()->get('Version'),
           'buildTime'   => $build_time,
       ];
   }
   ```

3. In includes/class-rest-api.php, update get_version() method to return buildTime:
   ```php
   public function get_version($request) {
       $build_time = null;
       $manifest_path = PRM_THEME_DIR . '/dist/.vite/manifest.json';
       if (file_exists($manifest_path)) {
           $build_time = date('c', filemtime($manifest_path));
       } else {
           $build_time = date('c');
       }

       return rest_ensure_response([
           'version' => PRM_THEME_VERSION,
           'buildTime' => $build_time,
       ]);
   }
   ```

4. In src/hooks/useVersionCheck.js, update to compare buildTime instead of version:
   - Change `currentVersion` state to `currentBuildTime`
   - Read from `window.prmConfig?.buildTime` instead of `version`
   - Compare `serverBuildTime` (from API response.data?.buildTime) with `currentBuildTime`
   - Keep displaying version in the banner (from response.data?.version) for user clarity
  </action>
  <verify>
- `npm run build` succeeds
- `npm run build` updates manifest.json mtime
- prmConfig.buildTime is populated in browser console
- /prm/v1/version endpoint returns buildTime field
- After a new build and deployment, the refresh banner appears even if version number unchanged
  </verify>
  <done>
- Build timestamps are generated from manifest.json file modification time
- Client compares buildTime instead of version for refresh detection
- Banner still shows version number to users for clarity
- Every `npm run build` produces a new buildTime that triggers refresh banner
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Organizations list: website clickable, no labels column
- [ ] Person profile: Slack shows label only as link
- [ ] prmConfig includes buildTime in browser
- [ ] /prm/v1/version API returns buildTime
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/lint errors introduced
- Four quick fixes implemented and working
</success_criteria>

<output>
After completion, create `.planning/phases/35-quick-fixes/35-01-SUMMARY.md`
</output>
