---
phase: 174-end-to-end-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - fixtures/demo-fixture.json
  - includes/class-demo-import.php
  - includes/class-demo-export.php
autonomous: false

must_haves:
  truths:
    - "Export command produces a valid fixture JSON file from production data"
    - "Import command loads fixture into WordPress without errors"
    - "Leden page displays all imported people with correct names, infix, and ages"
    - "Teams page displays all imported teams"
    - "Contributie page calculates fees for imported people"
    - "Tuchtzaken page displays imported discipline cases"
    - "Tasks page displays imported tasks"
    - "Dashboard widgets display imported data correctly"
    - "Global search finds imported people"
    - "Person detail pages display work history, activities, tasks, and relationships"
  artifacts:
    - path: "fixtures/demo-fixture.json"
      provides: "Anonymized production fixture"
  key_links:
    - from: "wp rondo demo export"
      to: "fixtures/demo-fixture.json"
      via: "WP-CLI on production"
    - from: "fixtures/demo-fixture.json"
      to: "wp rondo demo import --clean"
      via: "WP-CLI import command"
    - from: "imported data"
      to: "all Rondo Club pages"
      via: "existing REST API endpoints and React frontend"
---

<objective>
Generate the anonymized fixture from production data, import it, and verify all Rondo Club pages render correctly with demo data.

Purpose: This is the end-to-end validation that the entire export/anonymize/import pipeline produces data that works throughout the application. Any bugs in the export, anonymization, or import will surface here.

Output: A validated `fixtures/demo-fixture.json` file and confirmation that all UI pages work.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/173-import-command/173-01-SUMMARY.md
@.planning/phases/173-import-command/173-02-SUMMARY.md
@.planning/phases/173-import-command/173-03-SUMMARY.md
@includes/class-demo-export.php
@includes/class-demo-import.php
@includes/class-wp-cli.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate fixture from production and import</name>
  <files>fixtures/demo-fixture.json</files>
  <action>
Run the full export-import cycle on the production server:

1. **Deploy current code** to production (ensure export/import commands are available):
   ```bash
   bin/deploy.sh
   ```

2. **Run export on production** to generate the anonymized fixture:
   ```bash
   source .env && ssh -p "$DEPLOY_SSH_PORT" "$DEPLOY_SSH_USER@$DEPLOY_SSH_HOST" "cd $DEPLOY_REMOTE_THEME_PATH && wp rondo demo export"
   ```
   This creates `fixtures/demo-fixture.json` on the server.

3. **Pull the fixture file locally** via SCP:
   ```bash
   source .env && scp -P "$DEPLOY_SSH_PORT" "$DEPLOY_SSH_USER@$DEPLOY_SSH_HOST:$DEPLOY_REMOTE_THEME_PATH/fixtures/demo-fixture.json" fixtures/demo-fixture.json
   ```

4. **Push fixture back to production** (deploy again so import can read it):
   ```bash
   bin/deploy.sh
   ```

5. **Run import on production** with --clean flag to verify the full round-trip:
   ```bash
   source .env && ssh -p "$DEPLOY_SSH_PORT" "$DEPLOY_SSH_USER@$DEPLOY_SSH_HOST" "cd $DEPLOY_REMOTE_THEME_PATH && wp rondo demo import --clean"
   ```

6. **Clear caches** to ensure frontend loads fresh data:
   ```bash
   source .env && ssh -p "$DEPLOY_SSH_PORT" "$DEPLOY_SSH_USER@$DEPLOY_SSH_HOST" "cd $DEPLOY_REMOTE_THEME_PATH && wp cache flush"
   ```

7. **Validate the fixture file locally**:
   - Verify it's valid JSON: `python3 -c "import json; d=json.load(open('fixtures/demo-fixture.json')); print(f'Records: {d[\"meta\"][\"record_counts\"]}')" `
   - Verify it has reasonable record counts (people > 10, teams > 3, etc.)
   - Verify no real PII: check that no real email domains appear (only example.nl, rondo-demo.nl, etc.)
   - Verify no photos: check that photo/avatar fields are null/empty

If the export or import produces errors, diagnose and fix issues in `class-demo-export.php` or `class-demo-import.php` as needed. Common issues to watch for:
- ACF field format mismatches (post object vs ID)
- Missing reference resolution
- Date format parsing errors
- WordPress option format issues

After fixing any issues, re-run the export and import cycle.
  </action>
  <verify>
- `fixtures/demo-fixture.json` exists locally and is valid JSON
- The fixture has realistic record counts (people, teams, commissies, etc.)
- Import command completes without errors on production
- No real PII in the fixture (grep for real email domains, real names if known)
  </verify>
  <done>A validated demo-fixture.json exists locally and has been successfully imported on production.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify all Rondo Club pages render correctly</name>
  <files>none (visual verification only)</files>
  <action>
User verifies all Rondo Club pages on production after demo data import.

**What was built:** Full demo data pipeline: exported from production, anonymized, imported back. All Rondo Club data should now be demo data.

**How to verify — visit each page:**

1. **Dashboard** (https://stadion.svawc.nl/)
   - Stats row shows counts for leden, teams, etc.
   - Birthday widget shows upcoming birthdays
   - Activity widget shows recent activities
   - Awaiting todos widget shows todo counts

2. **Leden page** (https://stadion.svawc.nl/leden)
   - List displays imported people with Dutch fake names
   - Names include infix (tussenvoegsel) where applicable
   - Sorting works on name columns
   - Search finds people by name

3. **Person detail** (click any person)
   - Header shows name, age, birthdate
   - Work history tab shows team/commissie assignments
   - Timeline shows activities and notes
   - Tasks sidebar shows linked todos
   - Relationships show linked family members

4. **Teams page** (https://stadion.svawc.nl/teams)
   - List displays all imported teams
   - Team detail shows roster with player/staff split

5. **Contributie page** (https://stadion.svawc.nl/contributie)
   - Fee calculations display for imported people
   - Season selector works
   - Family discount calculations appear

6. **Tuchtzaken page** (https://stadion.svawc.nl/tuchtzaken)
   - Discipline cases display with season filter
   - Case detail shows linked person

7. **Taken page** (https://stadion.svawc.nl/taken)
   - Tasks display with correct statuses
   - Task detail shows linked persons

8. **Global search** (magnifying glass icon in top bar)
   - Search for a name from the imported data
   - Results should appear with correct names

Type "approved" if all pages render correctly, or describe any issues found.
  </action>
  <verify>User confirms all 8 page areas render correctly with demo data.</verify>
  <done>All Rondo Club pages display imported demo data correctly — no rendering errors, no missing data, no broken relationships.</done>
</task>

</tasks>

<verification>
1. `fixtures/demo-fixture.json` exists and is valid JSON with realistic record counts
2. Import completed without errors on production
3. All 8 success criteria from the phase are visually confirmed
</verification>

<success_criteria>
- Export produces valid fixture from production data
- Import loads all data without errors
- All Rondo Club pages render correctly with demo data
- Global search finds imported people
- Person detail pages show complete data (work history, activities, tasks, relationships)
</success_criteria>

<output>
After completion, create `.planning/phases/174-end-to-end-verification/174-01-SUMMARY.md`
</output>
