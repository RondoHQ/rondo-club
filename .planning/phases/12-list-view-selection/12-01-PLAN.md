---
phase: 12-list-view-selection
plan: 01
type: execute
depends_on: []
files_modified: [src/pages/People/PeopleList.jsx]
---

<objective>
Add list view with selection infrastructure to the People screen.

Purpose: Enable users to view contacts in a compact table format and select multiple contacts for bulk operations (Phase 13).
Output: PeopleList.jsx with card/list view toggle, tabular list view with columns, and checkbox selection with selection toolbar.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/pages/People/PeopleList.jsx
@src/hooks/usePeople.js
@.planning/codebase/CONVENTIONS.md

**Existing Patterns:**
- PersonCard component shows thumbnail, name, company, labels
- Filter dropdown uses custom checkboxes with Check icon
- Sort controls exist (first_name, last_name, modified)
- Company lookup uses batch query + companyMap pattern
- Workspace filter already implemented

**Codebase Conventions:**
- Functional components with hooks at top
- useState for UI state, TanStack Query for server state
- Tailwind CSS for styling
- lucide-react for icons
- Named exports for utilities, default export for page components
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add view mode toggle (card/list)</name>
  <files>src/pages/People/PeopleList.jsx</files>
  <action>
Add view mode state and toggle control:

1. Add state: `const [viewMode, setViewMode] = useState('card');` after sortOrder state
2. Add import for `LayoutGrid, List` icons from lucide-react
3. Add toggle control in the header area (after sort controls, before filter button):
   ```jsx
   <div className="flex items-center border border-gray-200 rounded-lg p-1">
     <button
       onClick={() => setViewMode('card')}
       className={`p-1.5 rounded transition-colors ${viewMode === 'card' ? 'bg-gray-100' : 'hover:bg-gray-50'}`}
       title="Card view"
     >
       <LayoutGrid className={`w-4 h-4 ${viewMode === 'card' ? 'text-primary-600' : 'text-gray-600'}`} />
     </button>
     <button
       onClick={() => setViewMode('list')}
       className={`p-1.5 rounded transition-colors ${viewMode === 'list' ? 'bg-gray-100' : 'hover:bg-gray-50'}`}
       title="List view"
     >
       <List className={`w-4 h-4 ${viewMode === 'list' ? 'text-primary-600' : 'text-gray-600'}`} />
     </button>
   </div>
   ```
4. Wrap the existing grid rendering in a conditional: `{viewMode === 'card' && (...existing grid...)}`
5. Add placeholder for list view: `{viewMode === 'list' && <div>List view coming next task</div>}`

Avoid: Changing the existing PersonCard component or filter logic.
  </action>
  <verify>Run `npm run lint` passes. Manually verify toggle buttons appear and switch viewMode state.</verify>
  <done>View toggle visible in header. Clicking card/list icons switches viewMode. Card grid shows when card selected.</done>
</task>

<task type="auto">
  <name>Task 2: Create list view with table columns</name>
  <files>src/pages/People/PeopleList.jsx</files>
  <action>
Create PersonListView component and table layout:

1. Add PersonListView function component above PeopleList:
   ```jsx
   function PersonListView({ people, companyMap, workspaces }) {
     return (
       <div className="card overflow-hidden">
         <table className="min-w-full divide-y divide-gray-200">
           <thead className="bg-gray-50">
             <tr>
               <th scope="col" className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                 Name
               </th>
               <th scope="col" className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                 Organization
               </th>
               <th scope="col" className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                 Workspace
               </th>
             </tr>
           </thead>
           <tbody className="bg-white divide-y divide-gray-200">
             {people.map((person) => (
               <PersonListRow
                 key={person.id}
                 person={person}
                 companyName={companyMap[person.id]}
                 workspaces={workspaces}
               />
             ))}
           </tbody>
         </table>
       </div>
     );
   }
   ```

2. Add PersonListRow component:
   ```jsx
   function PersonListRow({ person, companyName, workspaces }) {
     const assignedWorkspaces = person.acf?._assigned_workspaces || [];
     const workspaceNames = assignedWorkspaces
       .map(wsId => workspaces.find(ws => ws.id === wsId)?.title)
       .filter(Boolean)
       .join(', ');

     return (
       <tr className="hover:bg-gray-50">
         <td className="px-4 py-3 whitespace-nowrap">
           <Link to={`/people/${person.id}`} className="flex items-center">
             {person.thumbnail ? (
               <img
                 src={person.thumbnail}
                 alt=""
                 className="w-8 h-8 rounded-full object-cover"
               />
             ) : (
               <div className="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                 <span className="text-sm font-medium text-gray-500">
                   {person.first_name?.[0] || '?'}
                 </span>
               </div>
             )}
             <div className="ml-3">
               <div className="flex items-center">
                 <span className="text-sm font-medium text-gray-900">
                   {person.name}
                   {person.is_deceased && <span className="ml-1 text-gray-500">â€ </span>}
                 </span>
                 {person.is_favorite && (
                   <Star className="w-4 h-4 ml-1 text-yellow-400 fill-current" />
                 )}
               </div>
             </div>
           </Link>
         </td>
         <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
           {companyName || '-'}
         </td>
         <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500">
           {workspaceNames || '-'}
         </td>
       </tr>
     );
   }
   ```

3. Replace the list view placeholder with actual component:
   ```jsx
   {viewMode === 'list' && (
     <PersonListView
       people={filteredAndSortedPeople}
       companyMap={personCompanyMap}
       workspaces={workspaces}
     />
   )}
   ```

Avoid: Duplicating company lookup logic - reuse existing personCompanyMap. Do not modify filtering/sorting logic.
  </action>
  <verify>Run `npm run lint` passes. Switch to list view - see table with columns for name, org, workspace. Rows link to person detail.</verify>
  <done>List view renders as table. Name column shows avatar+name+favorite star. Org column shows company name. Workspace column shows assigned workspaces.</done>
</task>

<task type="auto">
  <name>Task 3: Add checkbox selection infrastructure</name>
  <files>src/pages/People/PeopleList.jsx</files>
  <action>
Add selection state, checkboxes, and selection toolbar:

1. Add selection state after viewMode:
   ```jsx
   const [selectedIds, setSelectedIds] = useState(new Set());
   ```

2. Add selection helper functions:
   ```jsx
   const toggleSelection = (personId) => {
     setSelectedIds(prev => {
       const next = new Set(prev);
       if (next.has(personId)) {
         next.delete(personId);
       } else {
         next.add(personId);
       }
       return next;
     });
   };

   const toggleSelectAll = () => {
     if (selectedIds.size === filteredAndSortedPeople.length) {
       setSelectedIds(new Set());
     } else {
       setSelectedIds(new Set(filteredAndSortedPeople.map(p => p.id)));
     }
   };

   const clearSelection = () => setSelectedIds(new Set());

   const isAllSelected = filteredAndSortedPeople.length > 0 &&
     selectedIds.size === filteredAndSortedPeople.length;
   const isSomeSelected = selectedIds.size > 0 &&
     selectedIds.size < filteredAndSortedPeople.length;
   ```

3. Add import for `Square, CheckSquare, MinusSquare` icons from lucide-react

4. Update PersonListView to accept and use selection props:
   - Add props: `selectedIds, onToggleSelection, onToggleSelectAll, isAllSelected, isSomeSelected`
   - Add checkbox column header:
     ```jsx
     <th scope="col" className="pl-4 pr-2 py-3 w-10">
       <button
         onClick={onToggleSelectAll}
         className="text-gray-400 hover:text-gray-600"
         title={isAllSelected ? 'Deselect all' : 'Select all'}
       >
         {isAllSelected ? (
           <CheckSquare className="w-5 h-5 text-primary-600" />
         ) : isSomeSelected ? (
           <MinusSquare className="w-5 h-5 text-primary-600" />
         ) : (
           <Square className="w-5 h-5" />
         )}
       </button>
     </th>
     ```
   - Pass selectedIds and onToggleSelection to PersonListRow

5. Update PersonListRow to show checkbox:
   - Add props: `isSelected, onToggleSelection`
   - Add checkbox cell as first column:
     ```jsx
     <td className="pl-4 pr-2 py-3 w-10">
       <button
         onClick={(e) => { e.preventDefault(); onToggleSelection(person.id); }}
         className="text-gray-400 hover:text-gray-600"
       >
         {isSelected ? (
           <CheckSquare className="w-5 h-5 text-primary-600" />
         ) : (
           <Square className="w-5 h-5" />
         )}
       </button>
     </td>
     ```

6. Add selection toolbar above the view content (only shown when in list view and items selected):
   ```jsx
   {viewMode === 'list' && selectedIds.size > 0 && (
     <div className="flex items-center justify-between bg-primary-50 border border-primary-200 rounded-lg px-4 py-2">
       <span className="text-sm text-primary-800 font-medium">
         {selectedIds.size} {selectedIds.size === 1 ? 'person' : 'people'} selected
       </span>
       <button
         onClick={clearSelection}
         className="text-sm text-primary-600 hover:text-primary-800 font-medium"
       >
         Clear selection
       </button>
     </div>
   )}
   ```

7. Clear selection when filters change: Add to the end of the useMemo for filteredAndSortedPeople - actually use useEffect instead:
   ```jsx
   // Clear selection when filters change or data changes
   useEffect(() => {
     setSelectedIds(new Set());
   }, [showFavoritesOnly, selectedLabels, selectedBirthYear, lastModifiedFilter, ownershipFilter, selectedWorkspaceFilter, people]);
   ```

8. Update the PersonListView call to pass all selection props:
   ```jsx
   <PersonListView
     people={filteredAndSortedPeople}
     companyMap={personCompanyMap}
     workspaces={workspaces}
     selectedIds={selectedIds}
     onToggleSelection={toggleSelection}
     onToggleSelectAll={toggleSelectAll}
     isAllSelected={isAllSelected}
     isSomeSelected={isSomeSelected}
   />
   ```

Avoid: Adding bulk action buttons - that's Phase 13. Selection toolbar only shows count and clear button.
  </action>
  <verify>Run `npm run lint` passes. Run `npm run build` succeeds. In list view: header checkbox toggles all, row checkboxes toggle individual, selection count shows in toolbar.</verify>
  <done>Checkboxes appear in list view. Header checkbox toggles select all/none. Individual row checkboxes work. Selection toolbar shows count. Clear button clears selection. Selection clears when filters change.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes with no warnings
- [ ] `npm run build` succeeds without errors
- [ ] Card view toggle works and shows existing grid
- [ ] List view toggle works and shows table
- [ ] List view shows Name, Organization, Workspace columns
- [ ] Checkboxes work (individual and select all)
- [ ] Selection toolbar shows count when items selected
- [ ] Selection clears when filters change
</verification>

<success_criteria>

- All 3 tasks completed
- All verification checks pass
- No TypeScript/ESLint errors
- View toggle works seamlessly between card and list views
- Selection infrastructure ready for Phase 13 bulk actions
</success_criteria>

<output>
After completion, create `.planning/phases/12-list-view-selection/12-01-SUMMARY.md`:

```markdown
---
phase: 12-list-view-selection
plan: 01
subsystem: frontend
requires: []
provides: [list-view, selection-infrastructure]
affects: [13-bulk-actions]
tags: [react, ui, people]
key-decisions: []
key-files: [src/pages/People/PeopleList.jsx]
tech-stack:
  added: []
  patterns: [view-toggle, table-list-view, checkbox-selection]
patterns-established: [view-toggle-pattern, selection-state-management]
---

# Phase 12 Plan 01: List View & Selection Summary

**[One-liner describing what shipped]**

## Accomplishments

- [What was built]

## Files Created/Modified

- `src/pages/People/PeopleList.jsx` - Added view toggle, list view table, selection infrastructure

## Decisions Made

[Any decisions made during implementation]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Ready for Phase 13: Bulk Actions - selection infrastructure provides selectedIds Set for bulk operations.
```
</output>
