# Phase 17-01: Organizations List View

<objective>
Transform Organizations from card-based grid view to a tabular list view with columns, sorting, and selection infrastructure, matching the People list view patterns.
</objective>

<execution_context>
@src/pages/Companies/CompaniesList.jsx - Current Organizations page (card view)
@src/pages/People/PeopleList.jsx - Reference implementation (target patterns)
</execution_context>

<context>
**Phase Goal:** Build list view for Organizations with columns, sorting, and selection infrastructure

**Current State:**
- CompaniesList.jsx uses card-based grid view (CompanyCard component)
- No selection checkboxes or bulk actions
- Basic filters only (ownership, workspace)
- No sortable column headers

**Target State (match PeopleList patterns):**
- Tabular list view with OrganizationListRow component
- Columns: checkbox, logo, name, industry, website, workspace, labels
- SortableHeader component for clickable column headers
- Selection infrastructure (checkboxes, select all, sticky toolbar)
- Remove card view entirely

**Established Patterns to Reuse:**
- SortableHeader component pattern from PeopleList.jsx
- Selection state management (selectedIds Set, toggleSelection, toggleSelectAll)
- Sticky thead with bg-gray-50 and z-10
- Image column pattern: w-10 px-2 narrow column
- Alternating row colors with isOdd prop
</context>

<tasks>
## Task 1: Create OrganizationListRow component [auto]

Add OrganizationListRow component to CompaniesList.jsx, following PersonListRow pattern.

**Changes to `src/pages/Companies/CompaniesList.jsx`:**

1. Create OrganizationListRow function component with props: `company, workspaces, isSelected, onToggleSelection, isOdd`

2. Columns (in order):
   - Checkbox column: `pl-4 pr-2 py-3 w-10` with CheckSquare/Square icons
   - Logo column: `w-10 px-2 py-3` with 32x32 image or Building2 fallback
   - Name column: `px-4 py-3 whitespace-nowrap` with Link to company detail
   - Industry column: `px-4 py-3 whitespace-nowrap text-sm text-gray-500`
   - Website column: `px-4 py-3 whitespace-nowrap text-sm text-gray-500 truncate max-w-48`
   - Workspace column: `px-4 py-3 whitespace-nowrap text-sm text-gray-500` (joined names)
   - Labels column: `px-4 py-3 text-sm text-gray-500` with pills (max 3, "+N more")

3. Row styling: `hover:bg-gray-100 ${isOdd ? 'bg-gray-50' : 'bg-white'}`

4. Add imports: `CheckSquare, Square` from lucide-react

**Commit:** `feat(17-01): add OrganizationListRow component`

---

## Task 2: Create OrganizationListView and SortableHeader [auto]

Add OrganizationListView wrapper component with SortableHeader for sortable columns.

**Changes to `src/pages/Companies/CompaniesList.jsx`:**

1. Copy SortableHeader component from PeopleList.jsx (lines 119-139)

2. Create OrganizationListView function component with props:
   - `companies, workspaces, selectedIds, onToggleSelection, onToggleSelectAll`
   - `isAllSelected, isSomeSelected, sortField, sortOrder, onSort`

3. Structure:
   ```jsx
   <div className="card overflow-x-auto max-h-[calc(100vh-12rem)] overflow-y-auto">
     <table className="min-w-full divide-y divide-gray-200">
       <thead className="bg-gray-50 sticky top-0 z-10">
         <tr className="shadow-sm">
           {/* Checkbox header */}
           {/* Empty logo header */}
           <SortableHeader field="name" label="Name" ... />
           <SortableHeader field="industry" label="Industry" ... />
           <SortableHeader field="website" label="Website" ... />
           <SortableHeader field="workspace" label="Workspace" ... />
           <SortableHeader field="labels" label="Labels" ... />
         </tr>
       </thead>
       <tbody>
         {companies.map((company, index) => (
           <OrganizationListRow key={company.id} ... isOdd={index % 2 === 1} />
         ))}
       </tbody>
     </table>
   </div>
   ```

4. Add imports: `ArrowUp, ArrowDown, MinusSquare` from lucide-react

**Commit:** `feat(17-01): add OrganizationListView with SortableHeader`

---

## Task 3: Add selection state and sorting logic [auto]

Add selection state management and sorting logic to CompaniesList component.

**Changes to `src/pages/Companies/CompaniesList.jsx`:**

1. Add state variables:
   ```jsx
   const [sortField, setSortField] = useState('name');
   const [sortOrder, setSortOrder] = useState('asc');
   const [selectedIds, setSelectedIds] = useState(new Set());
   ```

2. Add selection helper functions (copy from PeopleList):
   - `toggleSelection(companyId)` - toggle single selection
   - `toggleSelectAll()` - select/deselect all filtered companies
   - `clearSelection()` - reset selection

3. Add computed selection state:
   ```jsx
   const isAllSelected = filteredAndSortedCompanies.length > 0 &&
     selectedIds.size === filteredAndSortedCompanies.length;
   const isSomeSelected = selectedIds.size > 0 &&
     selectedIds.size < filteredAndSortedCompanies.length;
   ```

4. Add useEffect to clear selection when filters change

5. Update sorting logic in filteredAndSortedCompanies useMemo:
   - Support fields: name, industry, website, workspace, labels
   - Empty values sort last
   - Use localeCompare for string comparisons

6. Fetch company labels for Labels column:
   ```jsx
   const { data: companyLabelsData } = useQuery({
     queryKey: ['company-labels'],
     queryFn: async () => {
       const response = await wpApi.getCompanyLabels();
       return response.data;
     },
   });
   ```

**Commit:** `feat(17-01): add selection state and sorting to Organizations`

---

## Task 4: Replace grid view with list view [auto]

Remove CompanyCard component and grid rendering, replace with OrganizationListView.

**Changes to `src/pages/Companies/CompaniesList.jsx`:**

1. Delete CompanyCard function component (lines 11-43)

2. Add sticky selection toolbar before list (copy pattern from PeopleList):
   ```jsx
   {selectedIds.size > 0 && (
     <div className="sticky top-0 z-20 flex items-center justify-between bg-primary-50 ...">
       <span>{selectedIds.size} organization(s) selected</span>
       <button onClick={clearSelection}>Clear selection</button>
     </div>
   )}
   ```

3. Replace grid rendering:
   - Remove: `<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">` block
   - Replace with: `<OrganizationListView companies={...} workspaces={...} ... />`

4. Pass all required props to OrganizationListView:
   - companies, workspaces, selectedIds
   - onToggleSelection, onToggleSelectAll
   - isAllSelected, isSomeSelected
   - sortField, sortOrder, onSort handler

**Commit:** `feat(17-01): replace Organizations grid with list view`

---

## Task 5: Add header sort controls [auto]

Add sort field dropdown and direction toggle to header (matching PeopleList pattern).

**Changes to `src/pages/Companies/CompaniesList.jsx`:**

1. Add sort controls in header (before Filter button):
   ```jsx
   <div className="flex items-center gap-2 border border-gray-200 rounded-lg p-1">
     <select value={sortField} onChange={(e) => setSortField(e.target.value)} ...>
       <option value="name">Name</option>
       <option value="industry">Industry</option>
       <option value="website">Website</option>
       <option value="workspace">Workspace</option>
       <option value="labels">Labels</option>
     </select>
     <div className="h-4 w-px bg-gray-300"></div>
     <button onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')} ...>
       {sortOrder === 'asc' ? <ArrowUp /> : <ArrowDown />}
     </button>
   </div>
   ```

2. Remove the inline sort from filteredAndSortedCompanies (move to separate sortedCompanies useMemo)

3. Rename filteredAndSortedCompanies to filteredCompanies, create new sortedCompanies useMemo that applies sorting

**Commit:** `feat(17-01): add sort controls to Organizations header`

---

## Task 6: Version bump and verification [checkpoint:human-verify]

**Version bump:**
- Update package.json version to 1.69.0
- Update style.css version to 1.69.0
- Update CHANGELOG.md with changes

**Human verification required:**
1. Navigate to Organizations page
2. Verify list view displays with columns: checkbox, logo, name, industry, website, workspace, labels
3. Verify clickable column headers sort data
4. Verify header sort dropdown works
5. Verify checkbox selection works (single and select all)
6. Verify selection toolbar shows count and clear button
7. Verify sticky header stays visible when scrolling
8. Verify alternating row colors
9. Verify clicking organization name navigates to detail page
10. Verify filters still work with list view
</tasks>

<verification>
**Build verification:** `npm run build` must pass

**Manual verification (checkpoint):**
- Organizations shows list view instead of card grid
- All columns display correctly
- Sorting works via headers and dropdown
- Selection checkboxes work
- Sticky header works on scroll
</verification>

<success_criteria>
- [ ] OrganizationListRow displays checkbox, logo, name, industry, website, workspace, labels
- [ ] SortableHeader enables column sorting with visual indicators
- [ ] Selection state tracks selected organizations
- [ ] CompanyCard removed, grid view replaced with list view
- [ ] Sort controls in header match PeopleList pattern
- [ ] Sticky header and selection toolbar work
- [ ] Human verification approved
</success_criteria>

<output>
**Summary file:** 17-01-SUMMARY.md
**Closes:** ISS-008
</output>
