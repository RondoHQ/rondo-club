---
phase: 13-bulk-actions
plan: 02
type: execute
depends_on: ["13-01"]
files_modified: [src/pages/People/PeopleList.jsx]
---

<objective>
Add bulk action UI to the selection toolbar in PeopleList.

Purpose: Allow users to change visibility and workspace assignments for multiple selected contacts at once.
Output: Bulk action dropdown in selection toolbar with working modals for workspace and visibility changes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-bulk-actions/13-01-SUMMARY.md

**Selection infrastructure from Phase 12:**
- `selectedIds` is a Set of selected person IDs
- `clearSelection()` resets selection after action
- Selection toolbar shows at top when `selectedIds.size > 0`

**Existing patterns:**
- Visibility values: "private", "workspace", "shared" (from PRM_Visibility)
- WorkspaceSelector component exists (used in PersonDetail.jsx)
- VisibilitySelector component exists (used in ShareModal or similar)
- Modal pattern: isOpen, onClose, onSubmit props

**Key files:**
@src/pages/People/PeopleList.jsx
@src/components/VisibilitySelector.jsx (if exists)
@src/hooks/useWorkspaces.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bulk action dropdown to selection toolbar</name>
  <files>src/pages/People/PeopleList.jsx</files>
  <action>
1. Import the `useBulkUpdatePeople` hook from `@/hooks/usePeople`
2. Import `ChevronDown` icon from lucide-react for dropdown indicator
3. Add state for dropdown visibility and modal visibility:
   ```js
   const [showBulkDropdown, setShowBulkDropdown] = useState(false);
   const [showBulkVisibilityModal, setShowBulkVisibilityModal] = useState(false);
   const [showBulkWorkspaceModal, setShowBulkWorkspaceModal] = useState(false);
   const [bulkActionLoading, setBulkActionLoading] = useState(false);
   ```
4. Initialize the bulk update mutation:
   ```js
   const bulkUpdateMutation = useBulkUpdatePeople();
   ```
5. Modify the selection toolbar (currently at line ~857-869) to add a dropdown button:
   - Keep the count display: "{N} people selected"
   - Add a dropdown button "Actions" with ChevronDown icon
   - Dropdown menu items:
     - "Change visibility..." → opens BulkVisibilityModal
     - "Assign to workspace..." → opens BulkWorkspaceModal
   - Keep "Clear selection" button
6. Close dropdown when clicking outside (use existing pattern from filter dropdown - add ref and useEffect)
  </action>
  <verify>Visual inspection: Selection toolbar shows "Actions" dropdown when items selected. Clicking actions shows menu options.</verify>
  <done>Selection toolbar has working dropdown with "Change visibility" and "Assign to workspace" options</done>
</task>

<task type="auto">
  <name>Task 2: Create inline bulk action modals</name>
  <files>src/pages/People/PeopleList.jsx</files>
  <action>
Create two inline modal components within PeopleList.jsx (or extract to separate files if preferred).

**BulkVisibilityModal:**
- Simple modal with visibility radio buttons (Private, Workspace, Shared)
- Uses same styling as other modals in the project
- "Apply to {N} people" button
- On submit: call `bulkUpdateMutation.mutateAsync({ ids: Array.from(selectedIds), updates: { visibility } })`
- On success: show success message, clear selection, close modal
- On error: show error message

**BulkWorkspaceModal:**
- Modal with workspace checkboxes (using workspaces from useWorkspaces hook)
- Allow selecting multiple workspaces to assign
- "Assign to {N} people" button
- On submit: call `bulkUpdateMutation.mutateAsync({ ids: Array.from(selectedIds), updates: { assigned_workspaces: selectedWorkspaceIds } })`
- On success: clear selection, close modal
- On error: show error message

Both modals:
- Use same modal backdrop/container pattern as PersonEditModal
- Show loading state during mutation
- Include "Cancel" button
  </action>
  <verify>
1. Select multiple people in list view
2. Click Actions → Change visibility
3. Select "Private" and click Apply
4. Verify selection clears and changes are saved
5. Repeat for workspace assignment
  </verify>
  <done>Both bulk action modals work correctly - visibility changes and workspace assignments are applied to all selected people</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Bulk actions for visibility and workspace assignment on selected contacts</what-built>
  <how-to-verify>
    1. Run: npm run dev (or visit production after deploy)
    2. Navigate to /people
    3. Switch to list view (click list icon)
    4. Select 2-3 people using checkboxes
    5. Verify selection toolbar shows "X people selected" and "Actions" dropdown
    6. Click Actions → Change visibility
    7. Select "Private" and click Apply
    8. Verify: Selection clears, changes applied (check individual person)
    9. Select same people again
    10. Click Actions → Assign to workspace
    11. Select a workspace and click Assign
    12. Verify: Workspace column updates for selected people
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes without errors
- [ ] `npm run build` succeeds
- [ ] Bulk visibility change works for multiple selected people
- [ ] Bulk workspace assignment works for multiple selected people
- [ ] Selection clears after successful bulk action
- [ ] Error states are handled gracefully
</verification>

<success_criteria>

- Selection toolbar shows Actions dropdown when items selected
- Change visibility modal allows selecting visibility level
- Assign workspace modal allows selecting workspaces
- Bulk mutations update all selected people
- UI refreshes to show updated data
- Phase 13 complete
</success_criteria>

<output>
After completion, create `.planning/phases/13-bulk-actions/13-02-SUMMARY.md`
</output>
