---
phase: 65-split-reorganize
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [includes/class-notification-channels.php, includes/class-notification-channel.php, includes/class-email-channel.php, includes/class-slack-channel.php, functions.php, phpcs.xml.dist]
autonomous: true
---

<objective>
Split the multi-class file and update the autoloader to achieve one-class-per-file compliance.

Purpose: Prepare codebase for Phase 66 PSR-4 namespacing by ensuring each file contains exactly one class.
Output: Split notification classes, updated autoloader, PHPCS rule enabled.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/64-audit-planning/64-01-SUMMARY.md
@.planning/phases/64-audit-planning/AUDIT.md

Key findings from Phase 64 AUDIT:
- Only 1 file needs splitting: `class-notification-channels.php` (3 classes)
- RONDO_Notification_Channel (abstract, line 15)
- RONDO_Email_Channel (line 79)
- RONDO_Slack_Channel (line 426)
- PHPCS exclusion at phpcs.xml.dist line 37

Relevant source files:
@includes/class-notification-channels.php (the multi-class file)
@functions.php (contains autoloader at lines 52-104)
@phpcs.xml.dist (has the rule exclusion)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Split class-notification-channels.php into 3 files</name>
  <files>includes/class-notification-channel.php, includes/class-email-channel.php, includes/class-slack-channel.php</files>
  <action>
Split the multi-class file into 3 separate files:

1. **class-notification-channel.php** - Contains `RONDO_Notification_Channel` abstract class
   - Copy lines 1-74 (file header + abstract class)
   - Add file header comment "Abstract base class for notification channels"

2. **class-email-channel.php** - Contains `RONDO_Email_Channel` class
   - Add file header comment "Email notification channel"
   - Add ABSPATH check
   - Copy lines 79-420 (class RONDO_Email_Channel)

3. **class-slack-channel.php** - Contains `RONDO_Slack_Channel` class
   - Add file header comment "Slack notification channel"
   - Add ABSPATH check
   - Copy lines 426-end (class RONDO_Slack_Channel)

Each file must:
- Have proper file header comments
- Include ABSPATH security check
- Contain exactly one class
- Use the same indentation style (tabs)

Do NOT delete the original file yet - Task 2 will handle that after updating the autoloader.
  </action>
  <verify>All 3 new files exist and contain exactly one class each: `grep -c "^class " includes/class-notification-channel.php includes/class-email-channel.php includes/class-slack-channel.php` shows 1 for each</verify>
  <done>3 new files created, each with one class, proper headers and ABSPATH checks</done>
</task>

<task type="auto">
  <name>Task 2: Update autoloader and remove original file</name>
  <files>functions.php, includes/class-notification-channels.php</files>
  <action>
1. Update the `$class_map` array in functions.php (around lines 59-98):

Replace these 3 lines:
```php
'RONDO_Notification_Channel'     => 'class-notification-channels.php',
'RONDO_Email_Channel'            => 'class-notification-channels.php',
'RONDO_Slack_Channel'            => 'class-notification-channels.php',
```

With:
```php
'RONDO_Notification_Channel'     => 'class-notification-channel.php',
'RONDO_Email_Channel'            => 'class-email-channel.php',
'RONDO_Slack_Channel'            => 'class-slack-channel.php',
```

2. After verifying the autoloader update, delete the original multi-class file:
   `rm includes/class-notification-channels.php`

3. Run tests to verify functionality preserved:
   `./vendor/bin/phpunit`
  </action>
  <verify>Tests pass (./vendor/bin/phpunit), and `ls includes/class-notification-channel*.php includes/class-email-channel.php includes/class-slack-channel.php` shows the 3 new files (original gone)</verify>
  <done>Autoloader updated with new paths, original multi-class file deleted, tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Enable PHPCS one-class-per-file rule and verify</name>
  <files>phpcs.xml.dist</files>
  <action>
1. Remove the PHPCS exclusion rule from phpcs.xml.dist (around line 37):
   Delete this line: `<exclude name="Generic.Files.OneObjectStructurePerFile.MultipleFound"/>`

2. Run PHPCS to verify all files pass the one-class-per-file rule:
   `composer lint`

3. If any violations appear, investigate and fix (there should be none after splitting).
  </action>
  <verify>`composer lint` passes with no OneObjectStructurePerFile violations</verify>
  <done>PHPCS exclusion removed, lint passes, codebase fully compliant with one-class-per-file rule</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] 3 new files exist: class-notification-channel.php, class-email-channel.php, class-slack-channel.php
- [ ] Original class-notification-channels.php deleted
- [ ] Autoloader in functions.php points to new file paths
- [ ] `./vendor/bin/phpunit` passes all tests
- [ ] `composer lint` passes (one-class-per-file rule enabled)
- [ ] No breaking changes to notification functionality
</verification>

<success_criteria>
- All tasks completed
- Each PHP file in includes/ contains exactly one class
- PHPCS Generic.Files.OneObjectStructurePerFile rule enabled and passing
- All 120+ PHPUnit tests pass
- No changes to class interfaces or public APIs
</success_criteria>

<output>
After completion, create `.planning/phases/65-split-reorganize/65-01-SUMMARY.md`
</output>
