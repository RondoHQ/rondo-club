---
phase: 11-migration-testing
plan: 02
type: execute
depends_on: []
files_modified: [docs/multi-user.md, docs/access-control.md]
---

<objective>
Document the multi-user system including workspaces, visibility, sharing, and the updated access control logic.

Purpose: Provide clear documentation for users and future developers on how the multi-user collaboration system works.
Output: Comprehensive documentation in docs/multi-user.md and updated docs/access-control.md.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@docs/access-control.md
@includes/class-access-control.php
@includes/class-rest-workspaces.php

**Tech stack available:** Markdown documentation, existing docs/ structure

**Established patterns from prior phases:**
- Phase 7: Workspace CPT, workspace_access taxonomy, _visibility meta, _shared_with meta
- Phase 8: Workspace membership in user meta, invitation system, term sync
- Phase 9: ShareModal, VisibilitySelector components, workspace pages
- Phase 10: Note visibility, @mentions, workspace iCal, activity digest

**Key decisions to document:**
- Default visibility = private (preserves single-user behavior)
- Workspace membership stored in user meta `_workspace_memberships`
- workspace_access taxonomy links contacts to workspaces
- Permission chain: author > private > workspace > shared > deny
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create multi-user documentation</name>
  <files>docs/multi-user.md</files>
  <action>
Create comprehensive documentation for the multi-user system covering:

1. **Overview** - What multi-user adds to Stadion
2. **Workspaces** - Creating, managing, inviting members
3. **Visibility System** - Private, workspace, shared options
4. **Sharing** - How to share contacts directly with users
5. **Collaborative Features** - Note visibility, @mentions, workspace calendar
6. **Migration** - How to upgrade existing installations (`wp prm multiuser migrate`)

Use the existing documentation style from other files in docs/. Include:
- Clear section headers
- Code examples where helpful (e.g., WP-CLI commands)
- Links to related documentation

Keep it user-focused (how to use) rather than implementation-focused.
  </action>
  <verify>Read the file and verify it covers all major multi-user features</verify>
  <done>Documentation exists, covers workspaces, visibility, sharing, collaboration, and migration</done>
</task>

<task type="auto">
  <name>Task 2: Update access control documentation</name>
  <files>docs/access-control.md</files>
  <action>
Update the existing access-control.md to reflect the new permission system:

1. **Permission Chain** - Document the resolution order:
   - Is user the author? → Full access
   - Is visibility = private? → Deny (unless author)
   - Is visibility = workspace? → Check membership → Allow with role
   - Check _shared_with → Allow with specified permission
   - Deny

2. **Permission Levels** - Document the `get_user_permission()` return values:
   - 'owner' - Post author
   - 'admin', 'member', 'viewer' - Workspace roles
   - 'edit', 'view' - Direct share permissions
   - false - No access

3. **Query Filtering** - How `get_accessible_post_ids()` now works:
   - Author posts
   - Workspace-visible posts where user is member
   - Shared posts where user is in _shared_with

Keep existing content that's still relevant, update or remove outdated information.
  </action>
  <verify>Read the file and verify it accurately describes the current permission system</verify>
  <done>Documentation reflects the visibility, workspace, and sharing permission system</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] docs/multi-user.md exists and is comprehensive
- [ ] docs/access-control.md reflects current permission logic
- [ ] No broken internal links
- [ ] Documentation is clear and user-friendly
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Documentation accurately reflects implemented system
- New users can understand multi-user features from documentation
</success_criteria>

<output>
After completion, create `.planning/phases/11-migration-testing/11-02-SUMMARY.md`
</output>
