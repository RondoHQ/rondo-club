---
phase: 75-date-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - includes/class-rest-calendar.php
  - src/api/client.js
  - src/hooks/useMeetings.js
  - src/pages/Dashboard.jsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can click prev button to see yesterday's meetings"
    - "User can click next button to see tomorrow's meetings"
    - "User can click Today button to return to current day"
    - "Widget header shows selected date (or 'Today's meetings' if today)"
  artifacts:
    - path: "includes/class-rest-calendar.php"
      provides: "Date parameter support in today-meetings endpoint"
      contains: "get_param.*date"
    - path: "src/hooks/useMeetings.js"
      provides: "useDateMeetings hook with date parameter"
      exports: ["useDateMeetings", "meetingsKeys"]
    - path: "src/api/client.js"
      provides: "getMeetingsForDate API method"
      contains: "getMeetingsForDate"
    - path: "src/pages/Dashboard.jsx"
      provides: "Navigation buttons and date state"
      contains: "selectedDate"
  key_links:
    - from: "src/pages/Dashboard.jsx"
      to: "src/hooks/useMeetings.js"
      via: "useDateMeetings(selectedDate)"
      pattern: "useDateMeetings.*selectedDate"
    - from: "src/hooks/useMeetings.js"
      to: "src/api/client.js"
      via: "prmApi.getMeetingsForDate"
      pattern: "getMeetingsForDate"
    - from: "src/api/client.js"
      to: "/stadion/v1/calendar/today-meetings"
      via: "REST API with date param"
      pattern: "today-meetings.*date"
---

<objective>
Add date navigation to the meetings dashboard widget, allowing users to browse meetings across different days.

Purpose: Users currently can only see today's meetings. This adds prev/next/today navigation to view past and future meetings.
Output: Working date navigation in dashboard meetings widget with properly formatted date header.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/75-date-navigation/75-RESEARCH.md

# Key source files
@includes/class-rest-calendar.php (lines 1191-1255: get_today_meetings method)
@src/hooks/useMeetings.js (meetingsKeys and useTodayMeetings)
@src/api/client.js (getTodayMeetings method)
@src/pages/Dashboard.jsx (meetings card renderer, lines 627-655)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add date parameter to API layer</name>
  <files>
    - includes/class-rest-calendar.php
    - src/api/client.js
    - src/hooks/useMeetings.js
  </files>
  <action>
**Backend (class-rest-calendar.php):**

1. Modify `get_today_meetings()` method (around line 1191) to accept optional date parameter:
   - Get date from request: `$date_param = $request->get_param('date');`
   - Sanitize and validate: `$target_date = $date_param ? sanitize_text_field($date_param) : current_time('Y-m-d');`
   - Validate format (YYYY-MM-DD) to prevent SQL injection issues
   - Replace `current_time('Y-m-d')` with `$target_date` for both `$today_start` and `$today_end` variables
   - The rest of the query logic stays the same

**Frontend API client (src/api/client.js):**

2. Add new method alongside existing `getTodayMeetings`:
   ```javascript
   getMeetingsForDate: (date) => api.get('/stadion/v1/calendar/today-meetings', { params: { date } }),
   ```
   - Keep `getTodayMeetings` for backward compatibility (calls getMeetingsForDate with no param)

**Frontend hook (src/hooks/useMeetings.js):**

3. Update `meetingsKeys` to support date parameter:
   ```javascript
   export const meetingsKeys = {
     all: ['meetings'],
     today: ['meetings', 'today'],
     forDate: (dateStr) => ['meetings', 'forDate', dateStr],
     // ...existing keys
   };
   ```

4. Create `useDateMeetings` hook accepting a Date object:
   ```javascript
   export function useDateMeetings(date) {
     const dateStr = format(date, 'yyyy-MM-dd');
     return useQuery({
       queryKey: meetingsKeys.forDate(dateStr),
       queryFn: async () => {
         const response = await prmApi.getMeetingsForDate(dateStr);
         return response.data;
       },
       enabled: !!date,
       staleTime: 5 * 60 * 1000,
       refetchInterval: 15 * 60 * 1000,
     });
   }
   ```

5. Keep `useTodayMeetings` as alias: `export const useTodayMeetings = () => useDateMeetings(new Date());`

**Note:** Import `format` from date-fns in the hook file.
  </action>
  <verify>
Test via curl that date parameter works:
```bash
# Test today (should match existing behavior)
curl -s "https://cael.is/wp-json/stadion/v1/calendar/today-meetings" -H "Cookie: ..." | jq '.total'

# Test specific date
curl -s "https://cael.is/wp-json/stadion/v1/calendar/today-meetings?date=2026-01-16" -H "Cookie: ..." | jq '.total'
```

Run `npm run lint` to verify no ESLint errors.
  </verify>
  <done>
REST endpoint accepts optional `date` parameter (YYYY-MM-DD format), defaults to today. Frontend `useDateMeetings(date)` hook fetches meetings for any date. Backward compatible - `useTodayMeetings()` still works.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add navigation UI to Dashboard</name>
  <files>
    - src/pages/Dashboard.jsx
  </files>
  <action>
**Add imports at top of file:**
```javascript
import { format, addDays, subDays, isToday } from 'date-fns';
import { ChevronLeft, ChevronRight } from 'lucide-react';
```
Note: ChevronLeft and ChevronRight are from lucide-react, which is already imported.

**Add date state in Dashboard component:**
```javascript
const [selectedDate, setSelectedDate] = useState(new Date());
```

**Update meetings hook call:**
Replace:
```javascript
const { data: meetingsData } = useTodayMeetings();
```
With:
```javascript
import { useDateMeetings } from '@/hooks/useMeetings';
// ...
const { data: meetingsData } = useDateMeetings(selectedDate);
```

**Add navigation handlers:**
```javascript
const handlePrevDay = () => setSelectedDate(d => subDays(d, 1));
const handleNextDay = () => setSelectedDate(d => addDays(d, 1));
const handleToday = () => setSelectedDate(new Date());
```

**Update meetings card header (around line 629):**
Replace the current header div with:
```jsx
<div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
  <h2 className="font-semibold flex items-center dark:text-gray-50">
    <CalendarClock className="w-5 h-5 mr-2 text-gray-500 dark:text-gray-400" />
    {isToday(selectedDate) ? "Today's meetings" : format(selectedDate, 'EEEE, MMMM d')}
  </h2>
  <div className="flex items-center gap-1">
    <button
      onClick={handlePrevDay}
      className="p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors"
      aria-label="Previous day"
    >
      <ChevronLeft className="w-4 h-4" />
    </button>
    {!isToday(selectedDate) && (
      <button
        onClick={handleToday}
        className="px-2 py-1 text-xs font-medium text-accent-600 dark:text-accent-400 hover:bg-accent-50 dark:hover:bg-accent-900/30 rounded transition-colors"
      >
        Today
      </button>
    )}
    <button
      onClick={handleNextDay}
      className="p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors"
      aria-label="Next day"
    >
      <ChevronRight className="w-4 h-4" />
    </button>
  </div>
</div>
```

**Update empty state message (around line 651):**
Replace:
```jsx
<p className="p-4 text-sm text-gray-500 dark:text-gray-400 text-center">No meetings scheduled for today</p>
```
With:
```jsx
<p className="p-4 text-sm text-gray-500 dark:text-gray-400 text-center">
  {isToday(selectedDate)
    ? 'No meetings scheduled for today'
    : `No meetings on ${format(selectedDate, 'MMMM d')}`}
</p>
```

**Move Settings link:**
The current Settings link in the header will be removed since we need the space for navigation. Keep it accessible via the existing /settings route in the nav.
  </action>
  <verify>
1. Run `npm run build` to verify successful build
2. Run `npm run lint` to verify no ESLint errors
3. Manual verification after deploy:
   - Click left arrow: Shows previous day's meetings, header updates to date
   - Click right arrow: Shows next day's meetings, header updates to date
   - Click "Today" button: Returns to today, header shows "Today's meetings"
   - "Today" button hidden when viewing today
   - Empty state message includes the date being viewed
  </verify>
  <done>
Dashboard meetings widget has prev/next navigation buttons, Today button (visible when not on today), and header shows either "Today's meetings" or the selected date (e.g., "Friday, January 17"). Empty state message is context-aware.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Build verification:**
   - `npm run lint` passes with 0 errors
   - `npm run build` succeeds

2. **Functional verification on production:**
   - Navigate to dashboard at https://cael.is/
   - Meetings widget shows "Today's meetings" with nav buttons
   - Click prev arrow: Shows yesterday's meetings with date in header
   - Click next arrow: Shows tomorrow's meetings with date in header
   - Click "Today" button: Returns to today's view
   - "Today" button hidden when viewing today
   - Query caching works: Navigating back to same date loads instantly
</verification>

<success_criteria>
- [ ] NAV-01: Prev/next buttons navigate between days
- [ ] NAV-02: Today button returns to current day (hidden when on today)
- [ ] NAV-03: Widget header shows selected date (or "Today's meetings")
- [ ] REST endpoint accepts date parameter, defaults to today
- [ ] Query key includes date for proper cache management
- [ ] All existing meeting functionality preserved
- [ ] Production deployed and verified
</success_criteria>

<output>
After completion, create `.planning/phases/75-date-navigation/75-01-SUMMARY.md`
</output>
