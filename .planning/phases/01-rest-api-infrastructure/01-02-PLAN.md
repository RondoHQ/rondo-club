---
phase: 01-rest-api-infrastructure
plan: 02
type: execute
depends_on: ["01-01"]
files_modified: []
---

<objective>
Verify backward compatibility of the REST API after the base class extraction.

Purpose: Ensure all existing API endpoints work identically before proceeding to extract domain-specific classes in phases 2-3.
Output: Documented verification that API contracts are unchanged.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-rest-api-infrastructure/01-01-SUMMARY.md

**Verification targets:**
All routes in stadion/v1 namespace must respond correctly:
- Public endpoints: /version
- User endpoints: /dashboard, /search, /todos, /reminders
- People endpoints: /people/{id}/dates, /people/{id}/gravatar
- Team endpoints: /teams/{id}/people, /teams/{id}/logo
- Slack endpoints: /slack/oauth/authorize, /slack/status
- Export endpoints: /export/vcard, /export/google-csv
- User settings: /user/me, /user/notification-channels
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify PHP class loading</name>
  <files></files>
  <action>
Run PHP lint on all modified files and verify class inheritance works:

```bash
# Check all PHP files for syntax errors
php -l includes/class-rest-base.php
php -l includes/class-rest-api.php
php -l functions.php

# Verify class structure loads correctly (WordPress environment)
wp eval "
\$api = new STADION_REST_API();
echo 'STADION_REST_API instantiated successfully\n';
echo 'Parent class: ' . get_parent_class(\$api) . '\n';
echo 'Has check_user_approved: ' . (method_exists(\$api, 'check_user_approved') ? 'yes' : 'no') . '\n';
"
```

If `wp eval` fails due to environment issues, use `php -r` with manual includes:
```bash
php -r "
require_once '/path/to/wordpress/wp-load.php';
\$api = new STADION_REST_API();
var_dump(get_parent_class(\$api));
"
```
  </action>
  <verify>wp eval or php -r command shows STADION_REST_Base as parent class</verify>
  <done>Class inheritance verified working, parent class is STADION_REST_Base</done>
</task>

<task type="auto">
  <name>Task 2: Test API endpoint availability</name>
  <files></files>
  <action>
Verify key endpoints return expected HTTP status codes.

First, get the site URL and a valid nonce for authenticated requests:
```bash
# Get site URL
SITE_URL=$(wp option get siteurl)

# Test public endpoint (no auth needed)
curl -s -o /dev/null -w "%{http_code}" "$SITE_URL/wp-json/stadion/v1/version"
# Expected: 200

# Test authenticated endpoint (will return 401 without auth, which is correct behavior)
curl -s -o /dev/null -w "%{http_code}" "$SITE_URL/wp-json/stadion/v1/dashboard"
# Expected: 401 (requires authentication - this is correct)
```

The test passes if:
- Public endpoints return 200
- Protected endpoints return 401 without auth (not 500/404)

Do NOT test with actual authentication - just verify routing works.
  </action>
  <verify>/version returns 200, /dashboard returns 401 (not 500)</verify>
  <done>API routing works, public endpoints accessible, protected endpoints require auth</done>
</task>

<task type="auto">
  <name>Task 3: Document infrastructure state</name>
  <files></files>
  <action>
Create a brief infrastructure status check by listing:

1. Count of routes still in STADION_REST_API:
```bash
grep -c "register_rest_route" includes/class-rest-api.php
```

2. Count of methods in base class:
```bash
grep -c "function " includes/class-rest-base.php
```

3. File size comparison (should be smaller than original 107KB):
```bash
ls -la includes/class-rest-api.php | awk '{print $5}'
ls -la includes/class-rest-base.php | awk '{print $5}'
```

Document these metrics in the summary for tracking progress across phases.
  </action>
  <verify>All three measurements collected</verify>
  <done>Infrastructure metrics documented: route count, base class methods, file sizes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PHP class inheritance verified (STADION_REST_API extends STADION_REST_Base)
- [ ] Public API endpoint (/version) returns 200
- [ ] Protected API endpoint returns 401 (not 500/404)
- [ ] Infrastructure metrics collected
</verification>

<success_criteria>
- All PHP files load without errors
- API endpoints respond (correct status codes)
- No regression in API behavior
- Phase 1 infrastructure ready for domain extraction in phases 2-3
</success_criteria>

<output>
After completion, create `.planning/phases/01-rest-api-infrastructure/01-02-SUMMARY.md` with:
- Verification results
- Infrastructure metrics (route count, file sizes)
- Next phase readiness status
</output>
