---
phase: 98-admin-management
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Settings/Settings.jsx
  - src/pages/Settings/FeedbackManagement.jsx
  - src/App.jsx
autonomous: true

must_haves:
  truths:
    - "Admin can see Feedback management link in Admin tab"
    - "Admin can view all feedback from all users in management page"
    - "Admin can change feedback status via dropdown (new/in_progress/resolved/declined)"
    - "Admin can assign priority via dropdown (low/medium/high/critical)"
    - "Admin can sort feedback by date, priority, or status"
    - "Admin can filter feedback by type, status, and priority"
    - "Non-admins cannot access feedback management page"
  artifacts:
    - path: "src/pages/Settings/FeedbackManagement.jsx"
      provides: "Admin feedback management page"
      min_lines: 150
    - path: "src/App.jsx"
      provides: "Route for /settings/feedback"
      contains: "settings/feedback"
  key_links:
    - from: "FeedbackManagement.jsx"
      to: "prmApi.getFeedbackList"
      via: "useFeedbackList hook"
      pattern: "useFeedbackList"
    - from: "FeedbackManagement.jsx"
      to: "prmApi.updateFeedback"
      via: "useUpdateFeedback hook"
      pattern: "useUpdateFeedback"
    - from: "Settings.jsx AdminTab"
      to: "/settings/feedback"
      via: "Link component"
      pattern: "to=\"/settings/feedback\""
---

<objective>
Create admin-only feedback management UI to view, filter, sort, and manage all user feedback.

Purpose: Fulfill FEED-13, FEED-14, FEED-15, FEED-16 requirements â€” administrators need full visibility and control over all feedback from all users to triage bugs and feature requests.

Output: New FeedbackManagement page at /settings/feedback with sortable table, inline status/priority controls, and filtering.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v6.1-feedback-system/ROADMAP.md
@.planning/phases/98-admin-management/98-RESEARCH.md

# Reference for existing patterns
@src/pages/Settings/UserApproval.jsx (admin page pattern)
@src/pages/Settings/Settings.jsx (AdminTab link pattern)
@src/hooks/useFeedback.js (existing hooks)
@src/pages/People/PeopleList.jsx (SortableHeader pattern - lines 1-50)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add feedback management link to AdminTab</name>
  <files>src/pages/Settings/Settings.jsx</files>
  <action>
In the AdminTab function component, add a link to feedback management under the "Configuration" card:

```jsx
<Link
  to="/settings/feedback"
  className="block p-4 rounded-lg border border-gray-200 hover:bg-gray-50 hover:border-gray-300 transition-colors dark:border-gray-700 dark:hover:bg-gray-700 dark:hover:border-gray-600"
>
  <p className="font-medium dark:text-gray-100">Feedback management</p>
  <p className="text-sm text-gray-500 dark:text-gray-400">View and manage all user feedback</p>
</Link>
```

Place it in the Configuration section, after "Custom Fields" link.
  </action>
  <verify>
1. Run `npm run lint` - should pass
2. Settings > Admin tab shows "Feedback management" link
  </verify>
  <done>AdminTab shows link to Feedback management page</done>
</task>

<task type="auto">
  <name>Task 2: Create FeedbackManagement page</name>
  <files>src/pages/Settings/FeedbackManagement.jsx</files>
  <action>
Create new admin-only page following UserApproval.jsx pattern:

1. Imports:
   - React hooks (useState)
   - Link from react-router-dom
   - Icons: ArrowLeft, ShieldAlert, Loader2, ArrowUp, ArrowDown, Eye from lucide-react
   - useFeedbackList, useUpdateFeedback from @/hooks/useFeedback
   - useDocumentTitle from @/hooks/useDocumentTitle
   - format from date-fns

2. Constants:
   ```javascript
   const STATUS_OPTIONS = [
     { value: 'new', label: 'New', color: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' },
     { value: 'in_progress', label: 'In Progress', color: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' },
     { value: 'resolved', label: 'Resolved', color: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' },
     { value: 'declined', label: 'Declined', color: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300' },
   ];

   const PRIORITY_OPTIONS = [
     { value: 'low', label: 'Low', color: 'text-gray-600 dark:text-gray-400' },
     { value: 'medium', label: 'Medium', color: 'text-blue-600 dark:text-blue-400' },
     { value: 'high', label: 'High', color: 'text-orange-600 dark:text-orange-400' },
     { value: 'critical', label: 'Critical', color: 'text-red-600 dark:text-red-400' },
   ];

   const TYPE_OPTIONS = [
     { value: '', label: 'All Types' },
     { value: 'bug', label: 'Bugs' },
     { value: 'feature_request', label: 'Features' },
   ];
   ```

3. Component:
   ```javascript
   export default function FeedbackManagement() {
     useDocumentTitle('Feedback Management - Settings');
     const config = window.prmConfig || {};
     const isAdmin = config.isAdmin || false;

     // Filter and sort state
     const [typeFilter, setTypeFilter] = useState('');
     const [statusFilter, setStatusFilter] = useState('');
     const [priorityFilter, setPriorityFilter] = useState('');
     const [sortField, setSortField] = useState('date');
     const [sortOrder, setSortOrder] = useState('desc');

     // Fetch feedback with filters (API supports these params)
     const { data: feedback = [], isLoading, refetch } = useFeedbackList({
       type: typeFilter || undefined,
       status: statusFilter || undefined,
       priority: priorityFilter || undefined,
       orderby: sortField,
       order: sortOrder,
       per_page: 100,
     });

     const updateFeedback = useUpdateFeedback();

     // Admin check
     if (!isAdmin) {
       return <AccessDenied />;
     }

     // Handler for status change
     const handleStatusChange = (id, newStatus) => {
       updateFeedback.mutate({ id, data: { status: newStatus } });
     };

     // Handler for priority change
     const handlePriorityChange = (id, newPriority) => {
       updateFeedback.mutate({ id, data: { priority: newPriority } });
     };

     // Sort handler
     const handleSort = (field) => {
       if (sortField === field) {
         setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');
       } else {
         setSortField(field);
         setSortOrder('desc');
       }
     };

     // ... render
   }
   ```

4. AccessDenied component (inline, same pattern as UserApproval):
   ```jsx
   function AccessDenied() {
     return (
       <div className="max-w-2xl mx-auto">
         <div className="card p-8 text-center">
           <ShieldAlert className="w-16 h-16 mx-auto text-amber-500 dark:text-amber-400 mb-4" />
           <h1 className="text-2xl font-bold dark:text-gray-50 mb-2">Access Denied</h1>
           <p className="text-gray-600 dark:text-gray-300 mb-6">
             You don't have permission to manage feedback. This feature is only available to administrators.
           </p>
           <Link to="/settings" className="btn-primary">
             Back to Settings
           </Link>
         </div>
       </div>
     );
   }
   ```

5. SortableHeader component (copy from PeopleList pattern):
   ```jsx
   function SortableHeader({ field, label, currentField, currentOrder, onSort }) {
     const isActive = currentField === field;
     return (
       <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider bg-gray-50 dark:bg-gray-800">
         <button
           onClick={() => onSort(field)}
           className="flex items-center gap-1 hover:text-gray-700 dark:hover:text-gray-200 cursor-pointer"
         >
           {label}
           {isActive && (currentOrder === 'asc' ? <ArrowUp className="w-3 h-3" /> : <ArrowDown className="w-3 h-3" />)}
         </button>
       </th>
     );
   }
   ```

6. Main render:
   - Header with back button and title
   - Filter row: Type dropdown, Status dropdown, Priority dropdown
   - Table with columns: Type (badge), Title, Author, Status (dropdown), Priority (dropdown), Date, Actions (View link)
   - Sortable headers for: Title, Status, Priority, Date
   - Loading state
   - Empty state when no feedback
  </action>
  <verify>
1. Run `npm run lint` - should pass
2. File exists at src/pages/Settings/FeedbackManagement.jsx
  </verify>
  <done>
- FeedbackManagement page created with all required functionality
- Admin-only access check
- Sortable table with inline status/priority controls
- Filter dropdowns for type, status, priority
  </done>
</task>

<task type="auto">
  <name>Task 3: Add route for FeedbackManagement</name>
  <files>src/App.jsx</files>
  <action>
1. Import FeedbackManagement at the top with other Settings page imports:
   ```javascript
   import FeedbackManagement from '@/pages/Settings/FeedbackManagement';
   ```

2. Add route inside protected routes, after custom-fields route:
   ```jsx
   <Route path="/settings/feedback" element={<FeedbackManagement />} />
   ```
  </action>
  <verify>
1. Run `npm run lint` - should pass
2. Run `npm run build` - should complete
3. Navigating to /settings/feedback loads FeedbackManagement page
  </verify>
  <done>Route registered, navigation works</done>
</task>

</tasks>

<verification>
1. `npm run lint` passes
2. `npm run build` completes
3. Admin tab shows Feedback management link
4. /settings/feedback loads for admins, shows Access Denied for non-admins
5. Table displays all feedback with author column
6. Can change status via inline dropdown
7. Can assign priority via inline dropdown
8. Can sort by clicking column headers
9. Can filter by type, status, priority
10. Deploy to production: `bin/deploy.sh`
</verification>

<success_criteria>
- FEED-13: Admin feedback management UI in Settings
- FEED-14: Status workflow controls (dropdown)
- FEED-15: Priority assignment (dropdown)
- FEED-16: Feedback ordering (sortable columns)
- Admin-only access enforced
- Existing useFeedback hooks reused
</success_criteria>

<output>
After completion, create `.planning/phases/98-admin-management/98-02-SUMMARY.md`
</output>
