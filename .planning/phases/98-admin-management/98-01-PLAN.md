---
phase: 98-admin-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Settings/Settings.jsx
autonomous: true

must_haves:
  truths:
    - "User can see API Access tab in Settings"
    - "User can create application passwords with custom name"
    - "User can copy newly created password (shown only once)"
    - "User can see list of existing application passwords with last-used date"
    - "User can revoke application passwords with confirmation"
  artifacts:
    - path: "src/pages/Settings/Settings.jsx"
      provides: "API Access tab with password management"
      contains: "api-access"
  key_links:
    - from: "Settings.jsx"
      to: "prmApi.getAppPasswords"
      via: "useEffect fetch"
      pattern: "prmApi\\.getAppPasswords"
    - from: "Settings.jsx"
      to: "prmApi.createAppPassword"
      via: "handleCreateAppPassword"
      pattern: "prmApi\\.createAppPassword"
---

<objective>
Add dedicated "API Access" tab to Settings for all users to manage application passwords.

Purpose: Fulfill FEED-17 requirement — users need self-service management of application passwords for external API access. Currently, app password functionality is buried in the CardDAV subtab and tied to CardDAV context.

Output: New "API Access" tab in Settings visible to all users with create/list/revoke functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v6.1-feedback-system/ROADMAP.md
@.planning/phases/98-admin-management/98-RESEARCH.md

# Reference for existing patterns
@src/pages/Settings/Settings.jsx (lines 16-23 for TABS, 63-69 for password state, 583-675 for renderTabContent)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add API Access tab to Settings</name>
  <files>src/pages/Settings/Settings.jsx</files>
  <action>
1. Import Key icon from lucide-react (add to existing import)
2. Add API Access tab to TABS array BEFORE 'data' tab (position 4):
   ```javascript
   { id: 'api-access', label: 'API Access', icon: Key },
   ```
   Note: No adminOnly flag — all users can access

3. Add case in renderTabContent switch for 'api-access':
   ```javascript
   case 'api-access':
     return <APIAccessTab
       appPasswords={appPasswords}
       appPasswordsLoading={appPasswordsLoading}
       config={config}
       newPasswordName={newPasswordName}
       setNewPasswordName={setNewPasswordName}
       handleCreateAppPassword={handleCreateAppPassword}
       creatingPassword={creatingPassword}
       newPassword={newPassword}
       setNewPassword={setNewPassword}
       copyNewPassword={copyNewPassword}
       passwordCopied={passwordCopied}
       handleDeleteAppPassword={handleDeleteAppPassword}
       formatDate={formatDate}
     />;
   ```

4. Create APIAccessTab function component (place after DataTab):
   - Accept all password-related props
   - Render card with "Application Passwords" heading
   - Description: "Create application passwords for API access from external tools and scripts."
   - Create form: name input + Create button
   - Password list with: name, last used date, Revoke button
   - Empty state when no passwords
   - Loading skeleton when appPasswordsLoading

5. Password display modal (copy from existing CardDAV pattern):
   - Shown when newPassword is set
   - Title: "Application Password Created"
   - Warning: "Copy this password now. It won't be shown again."
   - Password display with copy button
   - Done button to dismiss

The existing state and handlers (appPasswords, handleCreateAppPassword, etc.) are already defined at the Settings component level — just wire them to the new tab.
  </action>
  <verify>
1. Run `npm run lint` - should pass with no errors
2. Run `npm run build` - should complete successfully
3. Verify manually: Settings page shows "API Access" tab
  </verify>
  <done>
- API Access tab visible in Settings for all users
- Can create application password with name
- Password shown once in modal with copy button
- Existing passwords listed with revoke option
- Build and lint pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CardDAV subtab to reference API Access</name>
  <files>src/pages/Settings/Settings.jsx</files>
  <action>
In the CardDAV subtab section (ConnectionsCardDAVSubtab function or inline), remove the application password management UI and replace with a reference to API Access tab:

1. Remove the password create form from CardDAV subtab
2. Remove the password list from CardDAV subtab
3. Keep only CardDAV URL display

4. Add a note in CardDAV subtab:
   ```jsx
   <p className="text-sm text-gray-500 dark:text-gray-400">
     Application passwords for CardDAV are managed in{' '}
     <button
       onClick={() => setActiveTab('api-access')}
       className="text-accent-600 dark:text-accent-400 hover:underline"
     >
       Settings &gt; API Access
     </button>
     .
   </p>
   ```

This avoids duplication and establishes API Access as the single source for password management.
  </action>
  <verify>
1. Run `npm run lint` - should pass
2. Verify manually: CardDAV subtab shows only URLs and reference to API Access
3. Clicking reference navigates to API Access tab
  </verify>
  <done>
- CardDAV subtab no longer shows duplicate password UI
- CardDAV subtab links to API Access for password management
- No code duplication for password functionality
  </done>
</task>

</tasks>

<verification>
1. `npm run lint` passes
2. `npm run build` completes
3. Settings page shows API Access tab (all users)
4. Can create, view, copy, and revoke application passwords
5. CardDAV subtab references API Access for passwords
6. Deploy to production: `bin/deploy.sh`
</verification>

<success_criteria>
- FEED-17 requirement satisfied: Application password management UI in Settings
- API Access tab visible to all users
- Full CRUD for application passwords
- One-time password display with copy functionality
- CardDAV subtab cleaned up (no duplication)
</success_criteria>

<output>
After completion, create `.planning/phases/98-admin-management/98-01-SUMMARY.md`
</output>
