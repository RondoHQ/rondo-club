---
phase: 165-pwa-backend-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.js
  - favicon.svg
  - functions.php
  - includes/class-rest-api.php
  - src/api/client.js
autonomous: true

must_haves:
  truths:
    - "PWA manifest theme_color is #0891b2 (electric-cyan)"
    - "Static favicon SVG uses #0891b2 fill color"
    - "WordPress login page renders with brand gradient, no PHP undefined variable warnings"
    - "REST API /rondo/v1/user/theme-preferences endpoint and color_scheme handling are removed"
    - "Dead theme API methods removed from frontend API client"
    - "Production build contains no old #006935 color references"
  artifacts:
    - path: "vite.config.js"
      provides: "PWA manifest with electric-cyan theme_color"
      contains: "theme_color: '#0891b2'"
    - path: "favicon.svg"
      provides: "Static brand favicon"
      contains: 'fill="#0891b2"'
    - path: "functions.php"
      provides: "Login page styling with correct variable names"
    - path: "includes/class-rest-api.php"
      provides: "REST API without color_scheme dead code"
    - path: "src/api/client.js"
      provides: "API client without dead theme preference methods"
  key_links:
    - from: "vite.config.js"
      to: "dist/manifest.webmanifest"
      via: "Vite build generates manifest"
      pattern: "theme_color.*0891b2"
    - from: "functions.php"
      to: "WordPress login page"
      via: "login_enqueue_scripts hook"
      pattern: "brand_color_darkest|brand_color_border|brand_color"
---

<objective>
Update PWA assets to use electric-cyan brand color (#0891b2), fix login page styling bugs with undefined PHP variables, and remove dead theming code from the REST API and frontend API client.

Purpose: Complete the v22.0 Design Refresh by ensuring all external-facing assets (PWA manifest, favicon, login page) match the new brand identity, and eliminate dead code from the removed dynamic theming system.
Output: Updated PWA manifest, favicon, login page styles, and cleaned REST API + frontend client.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/165-pwa-backend-cleanup/165-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update PWA manifest and favicon to electric-cyan</name>
  <files>vite.config.js, favicon.svg</files>
  <action>
1. In `vite.config.js` line 18, change `theme_color: '#006935'` to `theme_color: '#0891b2'`.

2. In `favicon.svg` line 1, change `fill="#006935"` to `fill="#0891b2"`.

3. Run `npm run build` to regenerate the manifest and all production assets.

4. Verify the generated `dist/manifest.webmanifest` contains `"theme_color":"#0891b2"`.
  </action>
  <verify>
- `grep 'theme_color' dist/manifest.webmanifest` shows `#0891b2`
- `grep '#006935' vite.config.js` returns no matches
- `grep '#006935' favicon.svg` returns no matches
  </verify>
  <done>PWA manifest theme_color is #0891b2 and favicon SVG uses #0891b2 fill. No #006935 references remain in either file.</done>
</task>

<task type="auto">
  <name>Task 2: Fix login page styling bugs and remove REST API dead code</name>
  <files>functions.php, includes/class-rest-api.php, src/api/client.js</files>
  <action>
**A. Fix undefined variables in login page styling (functions.php)**

The `rondo_login_styles()` function (starting at line 976) has several undefined variable references from the old dynamic color system. Fix each one:

1. Line 1033: `$color_darkest` -> `$brand_color_darkest`
2. Line 1041: `$color_border` -> `$brand_color_border`
3. Line 1043: Replace `rgba(<?php echo "$r, $g, $b"; ?>, 0.1)` with `rgba(8, 145, 178, 0.1)` (the RGB values of #0891b2)
4. Line 1050: `$color_border` -> `$brand_color_border`
5. Line 1059: `$club_color` -> `$brand_color`
6. Line 1060: Replace `rgba(<?php echo "$r, $g, $b"; ?>, 0.15)` with `rgba(8, 145, 178, 0.15)`
7. Line 1066: `$color_darkest` -> `$brand_color_darkest`

**B. Remove color_scheme from REST API (includes/class-rest-api.php)**

The frontend `useTheme.js` hook now uses localStorage only -- it does NOT call the REST API for color_scheme. The API client methods exist but are never imported or called. Safe to remove:

1. Delete the `color_scheme` args block from the PATCH `/user/theme-preferences` route registration (lines 163-170 approximately -- the `'color_scheme' => [...]` array inside the `'args'` parameter).

2. Delete the entire `get_theme_preferences()` method (lines 1144-1157).

3. Delete the entire `update_theme_preferences()` method (lines 1162-1193).

4. Delete BOTH route registrations for `/user/theme-preferences` -- the GET route (around lines 147-153) AND the PATCH route (around lines 155-172). Both routes are dead code since the frontend uses localStorage.

**C. Remove dead API methods from frontend client (src/api/client.js)**

1. Delete lines 216-218 (the comment and two method definitions):
   ```
   // Theme preferences
   getThemePreferences: () => api.get('/rondo/v1/user/theme-preferences'),
   updateThemePreferences: (prefs) => api.patch('/rondo/v1/user/theme-preferences', prefs),
   ```

**Important:** Do NOT remove `useTheme.js` or the color scheme selector from Settings.jsx. These manage dark mode (light/dark/system) via localStorage and are actively used. The user explicitly chose to keep dark mode.

After all edits, run `npm run build` and `npm run lint` to verify the build succeeds.
  </action>
  <verify>
- `grep -n 'color_darkest\|color_border\|club_color\|\$r,\|\$g,\|\$b' functions.php | grep -v brand_color | grep -v '^\s*//'` returns no matches (all undefined variables fixed)
- `grep -r 'color_scheme' includes/class-rest-api.php` returns no matches
- `grep -r 'theme-preferences' includes/class-rest-api.php` returns no matches
- `grep -r 'getThemePreferences\|updateThemePreferences' src/api/client.js` returns no matches
- `npm run build` succeeds
- `grep '#006935' vite.config.js favicon.svg functions.php includes/class-rest-api.php` returns no matches
  </verify>
  <done>Login page renders correctly without undefined PHP variables. REST API no longer has dead color_scheme/theme-preferences endpoints. Frontend API client no longer has dead theme preference methods. Build succeeds cleanly.</done>
</task>

</tasks>

<verification>
1. Run `npm run build` and verify `dist/manifest.webmanifest` contains `"theme_color":"#0891b2"`
2. Open `favicon.svg` and confirm `fill="#0891b2"`
3. Grep entire project for `#006935` in source files (excluding `.planning/`): should return no matches
4. Grep `includes/class-rest-api.php` for `color_scheme` or `theme-preferences`: should return no matches
5. Grep `src/api/client.js` for `ThemePreferences`: should return no matches
6. Verify `src/hooks/useTheme.js` still exists and is unchanged (dark mode preserved)
7. Verify Settings.jsx still has color scheme selector card (dark mode UI preserved)
8. Deploy to production and verify login page renders with brand gradient, no PHP errors
</verification>

<success_criteria>
- PWA manifest theme_color is #0891b2
- Favicon SVG uses #0891b2 fill
- Login page has zero undefined PHP variables (all use $brand_color_* variants or hardcoded RGB)
- REST API has no theme-preferences routes or color_scheme handling
- Frontend API client has no dead theme preference methods
- useTheme.js and dark mode selector remain functional (NOT removed)
- Production build succeeds with no old color references
- Version bumped and changelog updated per project rules
</success_criteria>

<output>
After completion, create `.planning/phases/165-pwa-backend-cleanup/165-01-SUMMARY.md`
</output>
