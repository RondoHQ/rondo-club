---
phase: 72-activity-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Timeline/QuickActivityModal.jsx
  - src/utils/timeline.js
  - src/components/Timeline/TimelineView.jsx
  - src/components/layout/Layout.jsx
  - src/pages/People/PersonDetail.jsx
autonomous: true

must_haves:
  truths:
    - "User can select Dinner as an activity type in QuickActivityModal"
    - "User can select Zoom as an activity type in QuickActivityModal"
    - "Phone call activity type displays as Phone (shortened)"
    - "Topbar stays above content and dropdowns on People screen"
    - "Person header shows at Company with proper spacing"
  artifacts:
    - path: "src/components/Timeline/QuickActivityModal.jsx"
      provides: "Activity type selection buttons"
      contains: "dinner"
    - path: "src/utils/timeline.js"
      provides: "Activity type icon and label mappings"
      contains: "zoom"
    - path: "src/components/Timeline/TimelineView.jsx"
      provides: "Timeline icon rendering"
      contains: "Video"
    - path: "src/components/layout/Layout.jsx"
      provides: "Topbar with proper z-index"
      contains: "z-30"
    - path: "src/pages/People/PersonDetail.jsx"
      provides: "Person header with company link"
      contains: " at "
  key_links:
    - from: "QuickActivityModal.jsx"
      to: "timeline.js"
      via: "activity type IDs"
      pattern: "dinner|zoom"
    - from: "TimelineView.jsx"
      to: "timeline.js"
      via: "getActivityTypeIcon"
      pattern: "ICON_MAP\\[iconName\\]"
---

<objective>
Add Dinner and Zoom activity types, rename Phone call to Phone, and fix z-index and spacing bugs.

Purpose: Complete v4.7 milestone with activity type improvements and UI bug fixes identified during UAT.
Output: Updated activity types visible in modal and timeline, fixed topbar layering, proper spacing in person header.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/72-activity-bug-fixes/72-RESEARCH.md
@src/components/Timeline/QuickActivityModal.jsx
@src/utils/timeline.js
@src/components/Timeline/TimelineView.jsx
@src/components/layout/Layout.jsx
@src/pages/People/PersonDetail.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Dinner and Zoom activity types and rename Phone call</name>
  <files>
    src/components/Timeline/QuickActivityModal.jsx
    src/utils/timeline.js
    src/components/Timeline/TimelineView.jsx
  </files>
  <action>
    Update activity type definitions in three files:

    1. **QuickActivityModal.jsx:**
       - Add `Video` to imports from lucide-react (line 2)
       - Update ACTIVITY_TYPES array (lines 8-16):
         - Change `{ id: 'call', label: 'Phone call', icon: Phone }` to `{ id: 'call', label: 'Phone', icon: Phone }`
         - Add `{ id: 'dinner', label: 'Dinner', icon: Utensils }` after lunch
         - Add `{ id: 'zoom', label: 'Zoom', icon: Video }` after dinner, before note

    2. **timeline.js:**
       - In `getActivityTypeIcon()` (line 121-133):
         - Add `dinner: 'Utensils',` after lunch
         - Add `zoom: 'Video',` after dinner
       - In `getActivityTypeLabel()` (line 140-152):
         - Change `call: 'Phone call',` to `call: 'Phone',`
         - Add `dinner: 'Dinner',` after lunch
         - Add `zoom: 'Zoom',` after dinner

    3. **TimelineView.jsx:**
       - Add `Video` to imports from lucide-react (line 4)
       - Add `Video,` to ICON_MAP object (after MessageCircle)

    IMPORTANT: Keep type ID 'call' unchanged - only change the display label. This preserves existing phone call activities.
  </action>
  <verify>
    - `npm run build` succeeds without errors
    - `npm run lint` passes
    - Grep confirms new activity types: `grep -n "dinner\|zoom" src/components/Timeline/QuickActivityModal.jsx src/utils/timeline.js`
    - Grep confirms Video import: `grep -n "Video" src/components/Timeline/QuickActivityModal.jsx src/components/Timeline/TimelineView.jsx`
    - Grep confirms Phone label (not Phone call): `grep -n "'Phone'" src/components/Timeline/QuickActivityModal.jsx src/utils/timeline.js`
  </verify>
  <done>
    - ACTIVITY_TYPES array has 9 items: call(Phone), email, chat, meeting, coffee, lunch, dinner, zoom, note
    - getActivityTypeIcon maps dinner->Utensils, zoom->Video
    - getActivityTypeLabel maps call->Phone, dinner->Dinner, zoom->Zoom
    - Video icon imported in both QuickActivityModal.jsx and TimelineView.jsx
    - ICON_MAP includes Video
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix topbar z-index and person header spacing</name>
  <files>
    src/components/layout/Layout.jsx
    src/pages/People/PersonDetail.jsx
  </files>
  <action>
    1. **Layout.jsx (line 531):**
       - Change `z-10` to `z-30` in the header className
       - Before: `className="sticky top-0 z-10 flex items-center...`
       - After: `className="sticky top-0 z-30 flex items-center...`
       - This keeps topbar above selection toolbar (z-20) and table headers (z-10) but below modals (z-50)

    2. **PersonDetail.jsx (line 1469):**
       - Add trailing space after "at" in the span
       - Before: `<span className="text-gray-400 dark:text-gray-500"> at</span>`
       - After: `<span className="text-gray-400 dark:text-gray-500"> at </span>`
       - This creates proper spacing between "at" and the company name link
  </action>
  <verify>
    - `npm run build` succeeds
    - `npm run lint` passes
    - Grep confirms z-30: `grep -n "z-30" src/components/layout/Layout.jsx`
    - Grep confirms " at ": `grep -n '" at "' src/pages/People/PersonDetail.jsx`
  </verify>
  <done>
    - Topbar has z-index 30 (above content, below modals)
    - Person header shows "Role at CompanyName" with proper spacing
  </done>
</task>

<task type="auto">
  <name>Task 3: Build, deploy, and update version</name>
  <files>
    style.css
    package.json
    CHANGELOG.md
  </files>
  <action>
    1. Run `npm run build` to generate production assets
    2. Update version from 4.5.0 to 4.7.0 in:
       - `style.css` (Version: line)
       - `package.json` (version field)
    3. Update CHANGELOG.md with v4.7.0 release entry:
       - Added: Dinner and Zoom activity types
       - Changed: Phone call activity type renamed to Phone
       - Fixed: Topbar z-index layering on People screen
       - Fixed: Person header spacing between "at" and company name
    4. Deploy to production using the rsync procedure from AGENTS.md
    5. Clear production caches
  </action>
  <verify>
    - `npm run build` succeeds
    - Version is 4.7.0 in both style.css and package.json
    - CHANGELOG.md has v4.7.0 entry
    - Production site loads at https://cael.is/
    - Activity types visible in QuickActivityModal on production
  </verify>
  <done>
    - Version 4.7.0 released
    - CHANGELOG.md updated
    - Production deployed and cache cleared
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run `npm run lint` - should pass with no warnings
2. Run `npm run build` - should succeed
3. Test on production (https://cael.is/):
   - Open a person profile
   - Click "Add activity" button
   - Verify 9 activity type buttons visible: Phone, Email, Chat, Meeting, Coffee, Lunch, Dinner, Zoom, Other
   - Select Dinner - should show Utensils icon
   - Select Zoom - should show Video icon
   - Verify person header shows "Title at CompanyName" with proper spacing
   - Navigate to People list
   - Scroll down with selection toolbar visible - topbar should stay above it
</verification>

<success_criteria>
- ACT-01: Dinner activity type available and functional
- ACT-02: Zoom activity type available and functional
- ACT-03: Phone call shows as "Phone" in all views
- BUG-01: Topbar stays above content on People screen (z-30)
- BUG-02: Person header shows proper spacing (" at ")
- Version 4.7.0 deployed to production
</success_criteria>

<output>
After completion, create `.planning/phases/72-activity-bug-fixes/72-01-SUMMARY.md`
</output>
