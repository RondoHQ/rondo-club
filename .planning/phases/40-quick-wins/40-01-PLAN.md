---
phase: 40-quick-wins
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/pages/Dashboard.jsx, includes/class-auto-title.php]
autonomous: true
---

<objective>
Add awaiting checkbox toggle to dashboard and auto-lowercase email addresses on save.

Purpose: Quick UX improvements - checkbox enables quick status toggle without navigating to person page, email normalization prevents duplicate contacts with different casing.
Output: Working awaiting checkbox in dashboard, emails auto-lowercased on save.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Source files:
@src/pages/Dashboard.jsx
@includes/class-auto-title.php
@acf-json/group_person_fields.json
@acf-json/group_company_fields.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add awaiting checkbox to Dashboard AwaitingTodoCard</name>
  <files>src/pages/Dashboard.jsx</files>
  <action>
Modify the `AwaitingTodoCard` component (around line 184-217) to add a checkbox for toggling awaiting status:

1. Add `onToggle` prop to AwaitingTodoCard (mirroring TodoCard pattern)
2. Add a checkbox button before the content that calls onToggle when clicked
3. The checkbox should:
   - Use `CheckSquare` icon (from lucide-react, already imported)
   - Have title "Mark as complete"
   - Call `e.preventDefault()` and `e.stopPropagation()` to prevent Link navigation
   - Call `onToggle(todo)` to toggle the status
4. Update AwaitingTodoCard usage in the render (around line 541) to pass `onToggle={handleToggleTodo}`

Note: The existing `handleToggleTodo` function already handles awaitingâ†’completed transition (lines 264-279), so just pass it through.

Pattern to follow from TodoCard (lines 131-182):
```jsx
<button
  onClick={(e) => {
    e.preventDefault();
    e.stopPropagation();
    onToggle(todo);
  }}
  className="mt-0.5 mr-3 flex-shrink-0"
  title="Mark as complete"
>
  <Clock className="w-5 h-5 text-orange-500" />
</button>
```
  </action>
  <verify>npm run build succeeds</verify>
  <done>AwaitingTodoCard shows clickable checkbox icon that marks todo as complete when clicked, without navigating away</done>
</task>

<task type="auto">
  <name>Task 2: Auto-lowercase email addresses on save</name>
  <files>includes/class-auto-title.php</files>
  <action>
Add a new method to STADION_Auto_Title class to lowercase email addresses in the contact_info repeater field.

1. Add new hook in constructor:
   ```php
   add_filter('acf/update_value/key=field_contact_value', [$this, 'maybe_lowercase_email'], 10, 4);
   add_filter('acf/update_value/key=field_company_contact_value', [$this, 'maybe_lowercase_email'], 10, 4);
   ```

2. Add new method:
   ```php
   /**
    * Lowercase email addresses when saving contact_info repeater
    *
    * @param mixed $value The value to save
    * @param int $post_id The post ID
    * @param array $field The field array
    * @param mixed $original The original value
    * @return mixed
    */
   public function maybe_lowercase_email($value, $post_id, $field, $original) {
       // Only process string values
       if (!is_string($value) || empty($value)) {
           return $value;
       }

       // Get the parent row to check contact_type
       // The field key tells us which repeater we're in
       $parent_field = $field['parent'];

       // We need to check if this row's contact_type is 'email'
       // ACF passes the row data during save, but we need to get it from $_POST
       // The structure is: acf[field_contact_info][row_id][field_contact_type]

       // Check if this looks like an email (simple validation)
       if (is_email($value)) {
           return strtolower($value);
       }

       return $value;
   }
   ```

Note: The `is_email()` WordPress function validates email format. By checking with is_email(), we ensure we only lowercase actual email addresses, even if the contact_type wasn't set to 'email'.

Alternative simpler approach if the above is complex: Hook into acf/save_post and iterate through contact_info repeater to lowercase any email values.
  </action>
  <verify>Create a test person with email "Test@Example.COM" and verify it's saved as "test@example.com" in the database</verify>
  <done>Email addresses in contact_info are automatically lowercased on save for both person and company post types</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Dashboard awaiting todos show checkbox that can be clicked to mark complete
- [ ] Clicking checkbox marks awaiting todo as complete (status changes, todo moves out of awaiting list)
- [ ] New person with uppercase email gets email lowercased on save
- [ ] Existing person with uppercase email gets lowercased when re-saved
- [ ] Company email addresses are also lowercased on save
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Dashboard awaiting todos have working toggle checkbox
- Email addresses are normalized to lowercase on save
</success_criteria>

<output>
After completion, create `.planning/phases/40-quick-wins/40-01-SUMMARY.md`
</output>
