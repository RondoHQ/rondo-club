---
phase: 99-date-formatting-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/dateFormat.js
  - src/utils/timeline.js
autonomous: true

must_haves:
  truths:
    - "dateFormat.js exports format, formatDistance, formatDistanceToNow, formatRelative with Dutch locale pre-configured"
    - "dateFormat.js re-exports non-locale functions (parseISO, isToday, isYesterday, isThisWeek, addDays, subDays, differenceInYears, parse, isValid)"
    - "timeline.js uses Dutch date labels (gisteren, vandaag) instead of English"
    - "formatTimelineDate returns Dutch formatted dates"
  artifacts:
    - path: "src/utils/dateFormat.js"
      provides: "Centralized Dutch locale date formatting utilities"
      min_lines: 40
      exports: ["format", "formatDistance", "formatDistanceToNow", "formatRelative", "parseISO", "isToday", "isYesterday", "isThisWeek", "addDays", "subDays", "differenceInYears", "parse", "isValid"]
    - path: "src/utils/timeline.js"
      provides: "Updated timeline utilities with Dutch formatting"
      contains: "gisteren"
  key_links:
    - from: "src/utils/dateFormat.js"
      to: "date-fns"
      via: "import with nl locale"
      pattern: "from 'date-fns/locale'"
    - from: "src/utils/timeline.js"
      to: "src/utils/dateFormat.js"
      via: "import statement"
      pattern: "from '@/utils/dateFormat'"
---

<objective>
Create centralized Dutch date formatting utility and update timeline.js

Purpose: Establish the foundation for Dutch date formatting by creating a centralized utility module that wraps date-fns functions with the Dutch locale pre-configured. This prevents scattered locale configuration and ensures consistent Dutch date formatting throughout the application.

Output:
- New `src/utils/dateFormat.js` with Dutch locale-aware wrapper functions
- Updated `src/utils/timeline.js` using the new utility with Dutch labels
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/99-date-formatting-foundation/99-RESEARCH.md

# Source files
@src/utils/timeline.js
@vite.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dateFormat.js utility module</name>
  <files>src/utils/dateFormat.js</files>
  <action>
Create a new utility module `src/utils/dateFormat.js` that:

1. Imports the Dutch locale from date-fns:
   ```javascript
   import { nl } from 'date-fns/locale';
   ```

2. Creates wrapper functions for locale-aware date-fns functions:
   - `format(date, formatStr, options = {})` - wraps dateFnsFormat with nl locale
   - `formatDistance(date, baseDate, options = {})` - wraps with nl locale
   - `formatDistanceToNow(date, options = {})` - wraps with nl locale
   - `formatRelative(date, baseDate, options = {})` - wraps with nl locale

3. Re-exports non-locale functions for convenience (so consumers only need one import):
   - parseISO, isToday, isYesterday, isThisWeek, addDays, subDays, differenceInYears, parse, isValid

4. Use a shared dateConfig object: `{ locale: nl }`

5. Add JSDoc comments explaining the purpose (Dutch locale enforcement)

The pattern:
```javascript
import { format as dateFnsFormat, ... } from 'date-fns';
import { nl } from 'date-fns/locale';

const dateConfig = { locale: nl };

export function format(date, formatStr, options = {}) {
  return dateFnsFormat(date, formatStr, { ...dateConfig, ...options });
}
```

Do NOT include any functions that don't exist in date-fns. The functions parse and isValid should be re-exported directly since they don't need locale.
  </action>
  <verify>
File exists and exports all required functions:
```bash
grep -E "export (function|const|{)" src/utils/dateFormat.js
```
Verify nl locale import:
```bash
grep "from 'date-fns/locale'" src/utils/dateFormat.js
```
  </verify>
  <done>
- dateFormat.js exists with ~50-70 lines
- Exports format, formatDistance, formatDistanceToNow, formatRelative (locale-wrapped)
- Re-exports parseISO, isToday, isYesterday, isThisWeek, addDays, subDays, differenceInYears, parse, isValid
- Dutch locale imported and used in config
  </done>
</task>

<task type="auto">
  <name>Task 2: Update timeline.js to use Dutch formatting</name>
  <files>src/utils/timeline.js</files>
  <action>
Update `src/utils/timeline.js` to:

1. Change the import statement from:
   ```javascript
   import { format, formatDistanceToNow, isToday, isYesterday, isThisWeek, parseISO } from 'date-fns';
   ```
   To:
   ```javascript
   import { format, formatDistanceToNow, isToday, isYesterday, isThisWeek, parseISO } from '@/utils/dateFormat';
   ```

2. Update the `formatTimelineDate` function to use Dutch labels:
   - Change `'Yesterday' 'at' HH:mm` to `'gisteren om' HH:mm`
   - Change `'Yesterday'` to `'gisteren'`
   - Change date format from `MMM d, yyyy 'at' HH:mm` to `d MMM yyyy 'om' HH:mm`
   - Change date format from `MMM d, yyyy` to `d MMM yyyy`

The updated formatTimelineDate function should look like:
```javascript
export function formatTimelineDate(dateString) {
  if (!dateString) return '';

  try {
    const date = parseISO(dateString);
    const hasTime = dateString.includes('T') && dateString.length > 10;

    // If it's today, show relative time (already Dutch via locale)
    if (isToday(date)) {
      return formatDistanceToNow(date, { addSuffix: true });
    }

    // If it's yesterday, show "gisteren" with optional time
    if (isYesterday(date)) {
      return hasTime ? format(date, "'gisteren om' HH:mm") : 'gisteren';
    }

    // Otherwise show formatted date with optional time (Dutch format: day month year)
    return format(date, hasTime ? "d MMM yyyy 'om' HH:mm" : 'd MMM yyyy');
  } catch (error) {
    return dateString;
  }
}
```

Note: The formatDistanceToNow with nl locale will automatically return Dutch strings like "3 uur geleden", "over 2 dagen", etc.
  </action>
  <verify>
Check import statement changed:
```bash
grep "from '@/utils/dateFormat'" src/utils/timeline.js
```
Check Dutch labels present:
```bash
grep -E "(gisteren|'om')" src/utils/timeline.js
```
Verify no direct date-fns import remains:
```bash
grep "from 'date-fns'" src/utils/timeline.js && echo "FAIL: Direct date-fns import still exists" || echo "OK: No direct date-fns import"
```
  </verify>
  <done>
- timeline.js imports from '@/utils/dateFormat' instead of 'date-fns'
- formatTimelineDate uses 'gisteren' instead of 'Yesterday'
- Date format uses Dutch order (d MMM yyyy) with 'om' for time
- formatDistanceToNow will output Dutch via locale (automatic)
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Build verification:
```bash
cd /Users/joostdevalk/Code/stadion && npm run build
```
Build should complete without errors.

2. Lint verification:
```bash
cd /Users/joostdevalk/Code/stadion && npm run lint
```
No lint errors should appear.

3. File structure verification:
```bash
ls -la src/utils/dateFormat.js src/utils/timeline.js
```
Both files should exist.
</verification>

<success_criteria>
- src/utils/dateFormat.js exists and exports Dutch locale-wrapped date functions
- src/utils/timeline.js imports from dateFormat.js, not date-fns directly
- timeline.js uses Dutch labels: 'gisteren', 'om'
- `npm run build` passes
- `npm run lint` passes
</success_criteria>

<output>
After completion, create `.planning/phases/99-date-formatting-foundation/99-01-SUMMARY.md`
</output>
