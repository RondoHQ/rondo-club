---
phase: 119-backend-foundation
plan: 02
type: execute
wave: 2
depends_on: ["119-01"]
files_modified:
  - src/pages/Settings/Settings.jsx
  - src/api/client.js
autonomous: true

must_haves:
  truths:
    - "User sees VOG tab in Settings page (admin only)"
    - "User can edit from email address in VOG settings"
    - "User can edit new volunteer email template"
    - "User can edit renewal email template"
    - "Changes save to backend via REST API"
  artifacts:
    - path: "src/pages/Settings/Settings.jsx"
      provides: "VOG settings tab in Settings page"
      contains: "vog"
    - path: "src/api/client.js"
      provides: "VOG settings API methods"
      contains: "getVOGSettings"
  key_links:
    - from: "src/pages/Settings/Settings.jsx"
      to: "src/api/client.js"
      via: "prmApi.getVOGSettings / updateVOGSettings"
      pattern: "prmApi\\..*VOG"
    - from: "src/api/client.js"
      to: "/rondo/v1/vog/settings"
      via: "axios request"
      pattern: "vog/settings"
---

<objective>
Add VOG settings tab to the Settings page for admin users.

Purpose: Allow administrators to configure VOG email templates and sender address through the UI, enabling customization of the compliance emails sent to volunteers.

Output:
- New "VOG" tab in Settings page (admin-only)
- Form with from email, new template, and renewal template fields
- API integration for loading and saving settings
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/119-backend-foundation/119-01-SUMMARY.md

# Reference files
@src/pages/Settings/Settings.jsx (existing settings UI structure)
@src/api/client.js (API client pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add VOG API Methods to Client</name>
  <files>src/api/client.js</files>
  <action>
Add two new methods to the `prmApi` object for VOG settings:

```javascript
// VOG Settings (admin only)
getVOGSettings: () => api.get('/rondo/v1/vog/settings'),
updateVOGSettings: (settings) => api.post('/rondo/v1/vog/settings', settings),
```

Add these after the existing notification/user settings methods in the prmApi object (look for patterns like `getNotificationChannels`, `updateNotificationChannels`).
  </action>
  <verify>
`grep "VOGSettings" src/api/client.js` shows both methods
`grep "vog/settings" src/api/client.js` shows the endpoint paths
  </verify>
  <done>
prmApi.getVOGSettings() and prmApi.updateVOGSettings() methods exist in client.js
  </done>
</task>

<task type="auto">
  <name>Task 2: Add VOG Tab to Settings Page</name>
  <files>src/pages/Settings/Settings.jsx</files>
  <action>
1. **Add VOG tab to TABS array:**
   Find the TABS array at the top of the file and add a new VOG tab (admin-only):
   ```javascript
   { id: 'vog', label: 'VOG', icon: Shield, adminOnly: true },
   ```
   Place it before the 'about' tab. Use the Shield icon (already imported).

2. **Add VOG state variables:**
   Add state hooks for VOG settings after the existing state declarations:
   ```javascript
   // VOG settings state
   const [vogSettings, setVogSettings] = useState({
     from_email: '',
     template_new: '',
     template_renewal: '',
   });
   const [vogLoading, setVogLoading] = useState(true);
   const [vogSaving, setVogSaving] = useState(false);
   const [vogMessage, setVogMessage] = useState('');
   ```

3. **Add useEffect to load VOG settings:**
   Add a useEffect that loads VOG settings when the Settings page mounts (only for admins):
   ```javascript
   // Fetch VOG settings on mount (admin only)
   useEffect(() => {
     const fetchVogSettings = async () => {
       if (!isAdmin) {
         setVogLoading(false);
         return;
       }
       try {
         const response = await prmApi.getVOGSettings();
         setVogSettings(response.data);
       } catch {
         // VOG settings fetch failed silently
       } finally {
         setVogLoading(false);
       }
     };
     fetchVogSettings();
   }, [isAdmin]);
   ```

4. **Add save handler function:**
   ```javascript
   // Handle VOG settings save
   const handleVogSave = async () => {
     setVogSaving(true);
     setVogMessage('');
     try {
       const response = await prmApi.updateVOGSettings(vogSettings);
       setVogSettings(response.data);
       setVogMessage('VOG-instellingen opgeslagen');
     } catch (error) {
       setVogMessage('Fout bij opslaan: ' + (error.response?.data?.message || 'Onbekende fout'));
     } finally {
       setVogSaving(false);
     }
   };
   ```

5. **Add VOG tab content:**
   In the tab content rendering section (after the existing tabs), add the VOG tab content:
   ```jsx
   {activeTab === 'vog' && (
     <div className="space-y-6">
       <div>
         <h3 className="text-lg font-medium text-gray-900 dark:text-gray-100">
           VOG E-mail Instellingen
         </h3>
         <p className="mt-1 text-sm text-gray-500 dark:text-gray-400">
           Configureer de e-mails die verstuurd worden voor VOG-aanvragen.
         </p>
       </div>

       {vogLoading ? (
         <div className="flex items-center justify-center py-8">
           <Loader2 className="w-6 h-6 animate-spin text-accent-500" />
         </div>
       ) : (
         <div className="space-y-6">
           {/* From Email */}
           <div>
             <label htmlFor="vog-from-email" className="block text-sm font-medium text-gray-700 dark:text-gray-300">
               Afzender e-mailadres
             </label>
             <input
               type="email"
               id="vog-from-email"
               value={vogSettings.from_email}
               onChange={(e) => setVogSettings(prev => ({ ...prev, from_email: e.target.value }))}
               placeholder="vog@vereniging.nl"
               className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-accent-500 focus:ring-accent-500 sm:text-sm"
             />
             <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
               Het e-mailadres dat als afzender wordt gebruikt voor VOG e-mails.
             </p>
           </div>

           {/* Template for new volunteers */}
           <div>
             <label htmlFor="vog-template-new" className="block text-sm font-medium text-gray-700 dark:text-gray-300">
               Template nieuwe vrijwilliger
             </label>
             <textarea
               id="vog-template-new"
               rows={8}
               value={vogSettings.template_new}
               onChange={(e) => setVogSettings(prev => ({ ...prev, template_new: e.target.value }))}
               className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-accent-500 focus:ring-accent-500 sm:text-sm font-mono"
             />
             <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
               Beschikbare variabelen: {'{first_name}'}
             </p>
           </div>

           {/* Template for renewals */}
           <div>
             <label htmlFor="vog-template-renewal" className="block text-sm font-medium text-gray-700 dark:text-gray-300">
               Template verlenging
             </label>
             <textarea
               id="vog-template-renewal"
               rows={8}
               value={vogSettings.template_renewal}
               onChange={(e) => setVogSettings(prev => ({ ...prev, template_renewal: e.target.value }))}
               className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-accent-500 focus:ring-accent-500 sm:text-sm font-mono"
             />
             <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
               Beschikbare variabelen: {'{first_name}'}, {'{previous_vog_date}'}
             </p>
           </div>

           {/* Save button and message */}
           <div className="flex items-center gap-4">
             <button
               onClick={handleVogSave}
               disabled={vogSaving}
               className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-accent-600 hover:bg-accent-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-500 disabled:opacity-50"
             >
               {vogSaving ? (
                 <>
                   <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                   Opslaan...
                 </>
               ) : (
                 'Opslaan'
               )}
             </button>
             {vogMessage && (
               <span className={`text-sm ${vogMessage.includes('Fout') ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400'}`}>
                 {vogMessage}
               </span>
             )}
           </div>
         </div>
       )}
     </div>
   )}
   ```

Note: The Shield icon is already imported at the top of the file. Make sure Loader2 is also imported.
  </action>
  <verify>
`grep "vog" src/pages/Settings/Settings.jsx | head -5` shows VOG tab definition
`grep "VOGSettings" src/pages/Settings/Settings.jsx` shows API usage
`npm run build` completes without errors
  </verify>
  <done>
VOG tab appears in Settings for admins. Form shows from email, new template, and renewal template. Save button updates settings via API.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build and Deploy</name>
  <files></files>
  <action>
1. Run `npm run build` to compile the frontend changes
2. Deploy to production using `bin/deploy.sh`
3. Clear caches on production

This ensures the VOG settings tab is available for testing on production.
  </action>
  <verify>
`npm run build` succeeds
`bin/deploy.sh` completes without errors
Production site loads with VOG tab visible in Settings (for admin users)
  </verify>
  <done>
Frontend built and deployed. VOG settings tab accessible at /settings/vog (admin only).
  </done>
</task>

</tasks>

<verification>
1. Build verification: `npm run build` completes without errors
2. API methods: `grep "VOGSettings" src/api/client.js` returns matches
3. Settings tab: Navigate to /settings as admin, VOG tab is visible
4. Form loads: VOG tab shows from email and two template textareas
5. Form saves: Edit a template, click save, refresh page - changes persist
</verification>

<success_criteria>
- VOG tab appears in Settings page navigation (admin only)
- Form displays from_email input field
- Form displays template_new textarea with {first_name} variable hint
- Form displays template_renewal textarea with {first_name}, {previous_vog_date} variable hints
- Save button updates settings via /rondo/v1/vog/settings
- Success/error messages display after save
- Dark mode styling works correctly
- Page loads without errors
</success_criteria>

<output>
After completion, create `.planning/phases/119-backend-foundation/119-02-SUMMARY.md`
</output>
