---
phase: 02-rest-api-people-teams
plan: 02
type: execute
depends_on: ["02-01"]
files_modified: [includes/class-rest-teams.php, includes/class-rest-api.php, functions.php]
---

<objective>
Extract team-related REST API endpoints and methods into a dedicated STADION_REST_Teams class.

Purpose: Complete Phase 2 by moving team domain logic out of the monolithic class.
Output: New `class-rest-teams.php` with team endpoints, `class-rest-api.php` further reduced.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-rest-api-infrastructure/01-01-SUMMARY.md
@.planning/phases/02-rest-api-people-teams/02-01-SUMMARY.md
@includes/class-rest-base.php
@includes/class-rest-api.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create STADION_REST_Teams class with routes and methods</name>
  <files>includes/class-rest-teams.php</files>
  <action>
Create new file `includes/class-rest-teams.php` with class STADION_REST_Teams extending STADION_REST_Base.

In constructor:
- Add `rest_api_init` action to register_routes method

Register these routes in register_routes():
- `/teams/{team_id}/people` - GET - callback: get_people_by_team, permission: __return_true (public endpoint per existing code)
- `/teams/{team_id}/logo` - POST - callback: set_team_logo, permission: check_team_edit_permission
- `/teams/{team_id}/logo/upload` - POST - callback: upload_team_logo, permission: check_team_edit_permission

Copy these methods from class-rest-api.php:
- get_people_by_team (lines ~481-568) - note: this checks access internally via STADION_Access_Control
- set_team_logo (lines ~1546-1575)
- upload_team_logo (lines ~1653-1720)

Use protected methods from base class: format_person_summary (used in get_people_by_team).
Permission methods are public in base class and can be used as permission_callback via $this.
  </action>
  <verify>php -l includes/class-rest-teams.php shows no syntax errors</verify>
  <done>class-rest-teams.php exists with STADION_REST_Teams class containing all team-specific endpoints</done>
</task>

<task type="auto">
  <name>Task 2: Remove team methods from STADION_REST_API and update autoloader</name>
  <files>includes/class-rest-api.php, functions.php</files>
  <action>
Remove from class-rest-api.php:

From register_routes():
- Remove route registration for `/teams/{team_id}/people`
- Remove route registration for `/teams/{team_id}/logo`
- Remove route registration for `/teams/{team_id}/logo/upload`

Remove these methods entirely:
- get_people_by_team
- set_team_logo
- upload_team_logo

In functions.php:

1. Add autoloader mapping for STADION_REST_Teams:
   'STADION_REST_Teams' => 'includes/class-rest-teams.php'
   (Add near the STADION_REST_People mapping)

2. Instantiate the new class in stadion_init() function:
   new STADION_REST_Teams();
   (Add after the STADION_REST_People instantiation)
  </action>
  <verify>php -l includes/class-rest-api.php passes AND php -l functions.php passes</verify>
  <done>class-rest-api.php no longer contains team-specific routes or methods, autoloader updated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `php -l includes/class-rest-teams.php` passes
- [ ] `php -l includes/class-rest-api.php` passes
- [ ] `php -l functions.php` passes
- [ ] class-rest-teams.php contains all 3 team-related methods
- [ ] class-rest-api.php no longer has team-specific routes or methods
- [ ] Both new REST classes are instantiated in functions.php
</verification>

<success_criteria>

- All tasks completed
- All PHP files pass syntax check
- STADION_REST_Teams class properly extends STADION_REST_Base
- Team endpoints extracted to dedicated class
- Phase 2 complete: People and Teams endpoints fully extracted
</success_criteria>

<output>
After completion, create `.planning/phases/02-rest-api-people-teams/02-02-SUMMARY.md`
</output>
