---
phase: 63-phpcs-config-refinement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [phpcs.xml.dist, includes/*.php, functions.php, tests/*.php]
autonomous: true
---

<objective>
Refine PHPCS configuration to match project preferences: disable Yoda conditions and require short array syntax.

Purpose: Align coding standards with modern PHP conventions preferred by the project.
Output: Updated phpcs.xml.dist and all PHP files using short array syntax with non-Yoda conditions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@phpcs.xml.dist

Current violations:
- 192 Yoda condition violations (WordPress.PHP.YodaConditions.NotYoda)
- Unknown number of long array syntax violations (need to check)

The user wants:
1. Disable Yoda conditions rule entirely (allow `$var === 'value'` instead of `'value' === $var`)
2. Require short array syntax (require `[]` instead of `array()`)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update phpcs.xml.dist configuration</name>
  <files>phpcs.xml.dist</files>
  <action>
    1. Disable the Yoda conditions rule by setting severity to 0:
       ```xml
       <!--
           Yoda conditions disabled - prefer readable $var === 'value' style
           over WordPress-mandated 'value' === $var style.
       -->
       <rule ref="WordPress.PHP.YodaConditions">
           <severity>0</severity>
       </rule>
       ```

    2. Add rule to require short array syntax ([] instead of array()):
       ```xml
       <!--
           Require modern short array syntax [] instead of array().
           This is more concise and has been standard since PHP 5.4.
       -->
       <rule ref="Generic.Arrays.DisallowLongArraySyntax"/>
       ```

    Add both rules after the existing exclusions section (before the closing </ruleset> tag).
  </action>
  <verify>
    - `vendor/bin/phpcs -i` shows configuration is valid
    - `vendor/bin/phpcs --report=source` no longer shows YodaConditions violations
    - `vendor/bin/phpcs --report=source` shows any DisallowLongArraySyntax violations
  </verify>
  <done>phpcs.xml.dist updated with both rule changes</done>
</task>

<task type="auto">
  <name>Task 2: Run phpcbf to convert to short array syntax</name>
  <files>includes/*.php, functions.php, tests/*.php</files>
  <action>
    1. Check current violation count:
       `vendor/bin/phpcs --report=summary 2>&1 | tail -5`

    2. Run phpcbf to auto-fix array syntax:
       `vendor/bin/phpcbf`
       This will convert all `array()` to `[]` throughout the codebase.

    3. Check new violation count:
       `vendor/bin/phpcs --report=summary 2>&1 | tail -5`

    4. Run phpcs with source report to verify no Yoda violations:
       `vendor/bin/phpcs --report=source 2>&1 | grep -i yoda` (should return nothing)
  </action>
  <verify>
    - phpcbf runs without errors
    - No Yoda condition violations appear in report
    - Short array syntax violations (if any existed) are fixed
    - Total violation count decreased
  </verify>
  <done>
    - All array() converted to []
    - Yoda condition rule disabled
    - Violation count reduced
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify and document final state</name>
  <files>None (verification only)</files>
  <action>
    1. Run final phpcs check:
       `vendor/bin/phpcs --report=summary`
       Record final error and warning counts.

    2. Run npm build to ensure no PHP syntax errors introduced:
       `npm run build`

    3. Document the changes:
       - Before: 192 Yoda violations + X array syntax violations
       - After: 0 Yoda violations + 0 array syntax violations
       - Net change: Reduction of ~192+ violations

    Note: Remaining violations after this change are intentional (error_log for debugging,
    loose comparisons in specific contexts, etc.) and documented in phpcs.xml.dist.
  </action>
  <verify>
    - `vendor/bin/phpcs --report=summary` shows reduced total
    - `npm run build` succeeds
  </verify>
  <done>
    - Final violation count documented
    - All changes verified working
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] phpcs.xml.dist has YodaConditions rule disabled (severity 0)
- [ ] phpcs.xml.dist has Generic.Arrays.DisallowLongArraySyntax rule added
- [ ] No Yoda condition violations in phpcs report
- [ ] No long array syntax violations in phpcs report
- [ ] npm run build succeeds
- [ ] All changes committed
</verification>

<success_criteria>

- Yoda conditions rule disabled in phpcs.xml.dist
- Short array syntax required and enforced
- All PHP files converted to short array syntax
- Total PHPCS violations reduced by ~192+
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/63-phpcs-config-refinement/63-01-SUMMARY.md`

Document:
- Configuration changes made to phpcs.xml.dist
- Before/after violation counts
- Files modified by phpcbf
- Any manual fixes required
</output>
