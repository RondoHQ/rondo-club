---
phase: 88-settings-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/client.js
  - src/pages/Settings/CustomFields.jsx
  - src/App.jsx
autonomous: true

must_haves:
  truths:
    - "Custom Fields subtab appears in Settings navigation"
    - "Admin can toggle between People and Organizations field lists"
    - "Field list shows Label and Type columns for each field"
    - "Edit/Delete actions appear on row hover"
  artifacts:
    - path: "src/pages/Settings/CustomFields.jsx"
      provides: "Custom fields management page with tab bar and field list"
      min_lines: 100
    - path: "src/api/client.js"
      provides: "API methods for custom fields CRUD"
      contains: "getCustomFields"
  key_links:
    - from: "src/pages/Settings/CustomFields.jsx"
      to: "/stadion/v1/custom-fields"
      via: "prmApi.getCustomFields"
      pattern: "getCustomFields.*person|company"
    - from: "src/App.jsx"
      to: "src/pages/Settings/CustomFields.jsx"
      via: "React Router lazy import"
      pattern: "Route.*custom-fields"
---

<objective>
Create the Custom Fields Settings page foundation with API integration, tab navigation, and field list table.

Purpose: Enable admins to view existing custom field definitions for People and Organizations.
Output: CustomFields.jsx page with working API integration, accessible at /settings/custom-fields
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/88-settings-ui/88-CONTEXT.md
@.planning/phases/87-acf-foundation/87-02-SUMMARY.md
@src/pages/Settings/Labels.jsx
@src/api/client.js
@src/App.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add custom fields API methods to client.js</name>
  <files>src/api/client.js</files>
  <action>
Add custom fields CRUD methods to prmApi object:

```javascript
// Custom Fields management
getCustomFields: (postType) => api.get(`/stadion/v1/custom-fields/${postType}`),
createCustomField: (postType, data) => api.post(`/stadion/v1/custom-fields/${postType}`, data),
updateCustomField: (postType, fieldKey, data) => api.put(`/stadion/v1/custom-fields/${postType}/${fieldKey}`, data),
deleteCustomField: (postType, fieldKey) => api.delete(`/stadion/v1/custom-fields/${postType}/${fieldKey}`),
```

Place these after the Google Contacts methods section (around line 264).
  </action>
  <verify>Check that client.js exports the new methods by reviewing the file</verify>
  <done>prmApi includes getCustomFields, createCustomField, updateCustomField, deleteCustomField methods</done>
</task>

<task type="auto">
  <name>Task 2: Create CustomFields settings page</name>
  <files>src/pages/Settings/CustomFields.jsx</files>
  <action>
Create CustomFields.jsx following Labels.jsx pattern closely:

1. **Admin check**: Same pattern as Labels.jsx - show Access Denied card if !isAdmin

2. **Tab navigation**: Two tabs "People Fields" and "Organization Fields"
   - Use same border-b tab styling as Labels.jsx
   - Store activeTab in state ('person' or 'company')
   - Remember last selected tab via localStorage key 'stadion-custom-fields-tab'

3. **Data fetching**: Use TanStack Query
   ```javascript
   const { data: personFields = [], isLoading: personFieldsLoading } = useQuery({
     queryKey: ['custom-fields', 'person'],
     queryFn: async () => {
       const response = await prmApi.getCustomFields('person');
       return response.data;
     },
   });
   // Same for company
   ```

4. **Field list table**: Simple table layout
   - Columns: Label, Type (text label, not icon)
   - Hover to reveal Edit/Delete buttons (use opacity-0 group-hover:opacity-100)
   - Use Edit2 and Trash2 icons from lucide-react
   - Empty state: "No custom fields defined. Click 'Add Field' to create one."

5. **Add Field button**: Position in header like Labels.jsx
   - Opens slide-out panel (Plan 02 will implement panel, just set state for now)
   - Generic button adds to currently selected entity type

6. **Page structure**:
   - Header with Database icon, title "Custom Fields", Add Field button
   - Tab bar below header
   - Field list table below tabs
   - Use same card/spacing patterns as Labels.jsx

Field type display mapping (for Type column):
```javascript
const FIELD_TYPE_LABELS = {
  text: 'Text',
  textarea: 'Textarea',
  number: 'Number',
  email: 'Email',
  url: 'URL',
  date: 'Date',
  select: 'Select',
  checkbox: 'Checkbox',
  true_false: 'True/False',
  image: 'Image',
  file: 'File',
  link: 'Link',
  color: 'Color',
  relationship: 'Relationship',
};
```

Edit/Delete click handlers: Just set state for now (editingField, showDeleteDialog).
These will be wired to the panel in Plan 02.
  </action>
  <verify>File exists and contains tab navigation, query hooks, and table rendering logic</verify>
  <done>CustomFields.jsx renders field list with tabs, loading states, empty states, and hover actions</done>
</task>

<task type="auto">
  <name>Task 3: Add route and navigation</name>
  <files>src/App.jsx</files>
  <action>
1. Add lazy import for CustomFields:
   ```javascript
   const CustomFields = lazy(() => import('@/pages/Settings/CustomFields'));
   ```

2. Add route in Settings section (after /settings/user-approval):
   ```javascript
   <Route path="/settings/custom-fields" element={<CustomFields />} />
   ```

The navigation link will be added by Claude in the Settings.jsx file as part of the admin section - but for now, direct URL access is sufficient for testing.
  </action>
  <verify>Visit /settings/custom-fields in browser - page loads without errors</verify>
  <done>Route /settings/custom-fields renders CustomFields component</done>
</task>

</tasks>

<verification>
1. Navigate to /settings/custom-fields (direct URL)
2. Non-admin users see "Access Denied" message
3. Admin users see Custom Fields page with People/Organizations tabs
4. Switching tabs updates the field list
5. Empty state shows when no fields exist
6. If fields exist (from Phase 87 testing), they appear in table with Label and Type
7. Edit/Delete icons appear on row hover
</verification>

<success_criteria>
- CustomFields page accessible at /settings/custom-fields
- Tab bar toggles between person and company field lists
- Fields fetched from REST API and displayed in table
- Edit/Delete hover actions visible (not yet functional)
- Admin-only access enforced
</success_criteria>

<output>
After completion, create `.planning/phases/88-settings-ui/88-01-SUMMARY.md`
</output>
