---
phase: 120-vog-list-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/VOG/VOGList.jsx
  - src/App.jsx
  - src/components/layout/Layout.jsx
  - src/hooks/useVOGCount.js
autonomous: true

must_haves:
  truths:
    - "User sees VOG item in sidebar navigation under People section"
    - "VOG nav item shows count badge with number of volunteers needing action"
    - "VOG list displays only volunteers with huidig-vrijwilliger=true AND (no datum-vog OR datum-vog 3+ years ago)"
    - "List shows columns: Name, KNVB ID, Email, Phone, Datum VOG"
    - "Each row shows badge: Nieuw (blue) for no VOG, Vernieuwing (purple) for expired"
    - "Empty state shows success message with checkmark icon"
  artifacts:
    - path: "src/pages/VOG/VOGList.jsx"
      provides: "VOG list page component with server-side filtering"
      min_lines: 150
    - path: "src/hooks/useVOGCount.js"
      provides: "Hook for VOG count in navigation badge"
      exports: ["useVOGCount"]
    - path: "src/App.jsx"
      provides: "Route configuration for /vog"
      contains: "VOGList"
    - path: "src/components/layout/Layout.jsx"
      provides: "Navigation with VOG sub-item"
      contains: "FileCheck"
  key_links:
    - from: "src/pages/VOG/VOGList.jsx"
      to: "useFilteredPeople hook"
      via: "import from @/hooks/usePeople"
      pattern: "useFilteredPeople\\("
    - from: "src/components/layout/Layout.jsx"
      to: "useVOGCount hook"
      via: "import for nav badge count"
      pattern: "useVOGCount\\("
---

<objective>
Create VOG list page showing volunteers who need VOG action.

Purpose: Enable users to quickly identify which volunteers need a new or renewed VOG (Verklaring Omtrent Gedrag), which is a required background check that expires after 3 years.

Output: Navigation item with count badge, list page with sortable columns and status badges, success empty state.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/120-vog-list-page/120-CONTEXT.md
@.planning/phases/120-vog-list-page/120-RESEARCH.md

# Existing patterns to follow
@src/pages/People/PeopleList.jsx (sortable table, custom field columns, helper functions)
@src/hooks/usePeople.js (useFilteredPeople hook with VOG filters)
@src/components/layout/Layout.jsx (navigation structure, count badges)
@src/components/CustomFieldColumn.jsx (custom field rendering)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useVOGCount hook and VOGList page component</name>
  <files>
    src/hooks/useVOGCount.js
    src/pages/VOG/VOGList.jsx
  </files>
  <action>
Create useVOGCount hook in `src/hooks/useVOGCount.js`:
- Use `useFilteredPeople` hook with VOG-specific filters:
  - `huidigeVrijwilliger: '1'`
  - `vogMissing: '1'`
  - `vogOlderThanYears: 3`
  - `perPage: 1` (only need count, not full data)
- Return `{ count, isLoading }` derived from `data.total`
- Cache key will be separate from main list due to perPage difference

Create VOGList.jsx page component in `src/pages/VOG/VOGList.jsx`:
- Use `useFilteredPeople` hook with preset filters:
  - `huidigeVrijwilliger: '1'` - only current volunteers
  - `vogMissing: '1'` - no VOG date
  - `vogOlderThanYears: 3` - OR expired VOG
  - `perPage: 100`
  - `orderby: 'custom_datum-vog'` - sort by VOG date (nulls first)
  - `order: 'asc'` - oldest first
- State: `page`, `orderby`, `order` for pagination and sorting
- Column definitions:
  - Name (with badge, sortable via first_name)
  - KNVB ID (custom field `knvb-id`)
  - Email (from contact_info)
  - Phone (from contact_info - mobile or phone)
  - Datum VOG (custom field `datum-vog`, sortable via custom_datum-vog)
- Copy helper functions from PeopleList.jsx: `getFirstContactByType`, `getFirstPhone`
- VOGBadge component: determines badge type based on `datum-vog` presence
  - No VOG date = "Nieuw" badge (blue: bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300)
  - Has VOG date (expired) = "Vernieuwing" badge (purple: bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300)
- VOG email sent indicator: If `vog-email-verzonden` field has value, show Mail icon with tooltip showing date
- Loading state: centered spinner (match PeopleList pattern)
- Error state: error message with retry option
- Empty state: celebratory success message
  - Green CheckCircle icon in rounded bg-green-100 container
  - "Alle vrijwilligers hebben een geldige VOG" as heading
  - Supportive subtext: "Er zijn momenteel geen vrijwilligers die een nieuwe of vernieuwde VOG nodig hebben."
- Sortable headers: follow PeopleList pattern
  - Name sorts by `first_name`
  - Datum VOG sorts by `custom_datum-vog` (must include custom_ prefix)
  - Other columns not sortable (KNVB ID, Email, Phone)
- Table structure: follow PeopleList pattern but simpler (no checkboxes yet - Phase 121)
- Name links to person profile: `/people/${person.id}`
- Use CustomFieldColumn for KNVB ID and Datum VOG display
- Wrap in PullToRefreshWrapper for mobile
- Dark mode support on all elements
  </action>
  <verify>
    - File exists: `src/hooks/useVOGCount.js`
    - File exists: `src/pages/VOG/VOGList.jsx`
    - `npm run lint` passes with no errors
  </verify>
  <done>
    VOGList component renders filtered volunteer list with correct columns, badges, and empty state. useVOGCount hook provides count for navigation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add VOG route and navigation item</name>
  <files>
    src/App.jsx
    src/components/layout/Layout.jsx
  </files>
  <action>
Update `src/App.jsx`:
- Add lazy import for VOGList: `const VOGList = lazy(() => import('@/pages/VOG/VOGList'));`
- Add route inside protected routes after People routes:
  ```jsx
  {/* VOG route */}
  <Route path="/vog" element={<VOGList />} />
  ```

Update `src/components/layout/Layout.jsx`:
- Add FileCheck to lucide-react imports
- Add useVOGCount import: `import { useVOGCount } from '@/hooks/useVOGCount';`
- In Sidebar component, call `const { count: vogCount } = useVOGCount();`
- Modify navigation array to add VOG as indented sub-item under Leden:
  - Keep current structure but add VOG after Leden item
  - VOG item: `{ name: 'VOG', href: '/vog', icon: FileCheck, indent: true }`
  - Add `indent` property to distinguish sub-items
- Update getCounts function to return vogCount for 'VOG'
- In navigation rendering:
  - Add conditional styling for indented items: `pl-8` padding when `item.indent`
  - Show count badge for VOG using same pattern as other items
  - Keep icon at `w-5 h-5 mr-3` but with indent padding applied to whole item
- Update Header getPageTitle to handle '/vog' path: return 'VOG'
  </action>
  <verify>
    - `npm run lint` passes with no errors
    - Navigation shows VOG item indented under Leden
    - Clicking VOG navigates to /vog
    - Header shows "VOG" as page title when on /vog route
  </verify>
  <done>
    VOG route is configured and accessible. Navigation shows VOG as indented sub-item with count badge.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build, deploy, and verify</name>
  <files>dist/</files>
  <action>
Run production build:
```bash
npm run build
```

Deploy to production:
```bash
bin/deploy.sh
```

Verify build output includes VOG assets in manifest.
  </action>
  <verify>
    - `npm run build` completes without errors
    - `dist/` folder contains updated assets
    - `bin/deploy.sh` executes successfully
  </verify>
  <done>
    VOG list page is built and deployed to production, ready for verification.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Navigation check:**
   - VOG item appears indented under Leden in sidebar
   - VOG item shows FileCheck icon
   - VOG item shows count badge (number or empty if 0)
   - Clicking VOG navigates to /vog

2. **List display:**
   - Page shows volunteers needing VOG action
   - Columns visible: Name, KNVB ID, Email, Phone, Datum VOG
   - Each row has badge next to name: "Nieuw" (blue) or "Vernieuwing" (purple)
   - Names are clickable links to person profile

3. **Sorting:**
   - Clicking Name header sorts by first_name
   - Clicking Datum VOG header sorts by date (nulls first when asc)
   - Sort indicators (arrows) show current sort state

4. **Empty state:**
   - If no volunteers need VOG, shows success message
   - Green checkmark icon with celebratory text

5. **Dark mode:**
   - All elements render correctly in dark mode
   - Badges use dark mode color variants
</verification>

<success_criteria>
- VOG navigation item visible with count badge
- VOG list shows only volunteers with huidig-vrijwilliger=true AND (no VOG OR expired VOG)
- All 5 columns display correctly: Name, KNVB ID, Email, Phone, Datum VOG
- Badges show correct status (Nieuw/Vernieuwing)
- Empty state shows success message
- No lint errors
- Production deployment successful
</success_criteria>

<output>
After completion, create `.planning/phases/120-vog-list-page/120-01-SUMMARY.md`
</output>
