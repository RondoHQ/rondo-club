---
phase: 146-integration-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/People/PersonDetail.jsx
  - src/hooks/useTheme.js
  - AGENTS.md
  - PERFORMANCE-FINDINGS.md
autonomous: true

must_haves:
  truths:
    - "FreeScout link in PersonDetail reads base URL from club config"
    - "FreeScout link is hidden when URL not configured"
    - "Theme contains zero awc/svawc/AWC references in source code"
    - "ACF JSON field definitions contain no awc/svawc references"
    - "Documentation uses generic placeholder domains"
  artifacts:
    - path: "src/pages/People/PersonDetail.jsx"
      provides: "Dynamic FreeScout URL construction"
      contains: "window.stadionConfig?.freescoutUrl"
    - path: "src/hooks/useTheme.js"
      provides: "Clean theme preferences (no legacy migration)"
      not_contains: "awc"
    - path: "AGENTS.md"
      provides: "Generic documentation"
      not_contains: "svawc.nl"
    - path: "PERFORMANCE-FINDINGS.md"
      provides: "Generic performance analysis"
      not_contains: "svawc.nl"
    - path: "acf-json/*.json"
      provides: "ACF field definitions without club-specific references"
      not_contains: "awc"
  key_links:
    - from: "PersonDetail.jsx"
      to: "window.stadionConfig.freescoutUrl"
      via: "FreeScout link construction"
      pattern: "window\\.stadionConfig\\?\\.freescoutUrl"
---

<objective>
Externalize FreeScout URL to read from club config API and remove all AWC/svawc.nl-specific references from source code and documentation.

Purpose: Make Stadion installable by any sports club without code changes
Output: Zero awc/svawc references in source, dynamic FreeScout integration
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/146-integration-cleanup/146-CONTEXT.md
@.planning/phases/146-integration-cleanup/146-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Externalize FreeScout URL in PersonDetail</name>
  <files>src/pages/People/PersonDetail.jsx</files>
  <action>
Update the FreeScout link construction (around line 1023-1029) to:
1. Read the base URL from `window.stadionConfig?.freescoutUrl`
2. Only add the FreeScout link if BOTH conditions are true:
   - Person has a `freescout-id` ACF field value
   - `freescoutUrl` is configured (not empty/undefined)
3. Construct URL dynamically: `${freescoutUrl}/customers/${acf['freescout-id']}`

Current code:
```javascript
// Add Freescout if there's a Freescout ID
if (acf['freescout-id']) {
  links.push({
    contact_type: 'freescout',
    contact_value: `https://box.svawc.nl/customers/${acf['freescout-id']}`,
  });
}
```

Target code:
```javascript
// Add FreeScout if there's a FreeScout ID AND a configured URL
const freescoutUrl = window.stadionConfig?.freescoutUrl;
if (acf['freescout-id'] && freescoutUrl) {
  links.push({
    contact_type: 'freescout',
    contact_value: `${freescoutUrl}/customers/${acf['freescout-id']}`,
  });
}
```

Note: The link rendering code further down does NOT need changes - it already uses `contact.contact_value` which will contain the full URL.
  </action>
  <verify>
1. `grep -n "svawc" src/pages/People/PersonDetail.jsx` returns no matches
2. `grep -n "stadionConfig.*freescoutUrl" src/pages/People/PersonDetail.jsx` returns match
3. `npm run lint` passes (no new errors)
  </verify>
  <done>FreeScout URL reads from club config; link hidden when URL not configured</done>
</task>

<task type="auto">
  <name>Task 2: Remove AWC references and update documentation</name>
  <files>src/hooks/useTheme.js, AGENTS.md, PERFORMANCE-FINDINGS.md</files>
  <action>
Three files need updates:

**1. src/hooks/useTheme.js** (lines 131-134):
Remove the legacy 'awc' to 'club' migration code. Users were migrated during Phase 145 - this code is no longer needed.

Remove these lines:
```javascript
// Auto-migrate 'awc' to 'club' for existing users
if (parsed.accentColor === 'awc') {
  parsed.accentColor = 'club';
}
```

**2. AGENTS.md** (line 273):
Replace the specific svawc.nl path with a generic placeholder.

Change:
```bash
source .env && ssh -p "$DEPLOY_SSH_PORT" "$DEPLOY_SSH_USER@$DEPLOY_SSH_HOST" "cd ~/www/stadion.svawc.nl/public_html/wp-content/themes/stadion && wp <command>"
```

To:
```bash
source .env && ssh -p "$DEPLOY_SSH_PORT" "$DEPLOY_SSH_USER@$DEPLOY_SSH_HOST" "cd $DEPLOY_REMOTE_THEME_PATH && wp <command>"
```

This uses the existing env variable `DEPLOY_REMOTE_THEME_PATH` from .env.example, making it truly generic.

**3. PERFORMANCE-FINDINGS.md** (line 1):
Change the title from specific domain to generic.

Change:
```markdown
# Performance Analysis: stadion.svawc.nl
```

To:
```markdown
# Performance Analysis: Stadion Dashboard
```
  </action>
  <verify>
1. `grep -n "awc" src/hooks/useTheme.js` returns no matches
2. `grep -n "svawc" AGENTS.md` returns no matches
3. `grep -n "svawc" PERFORMANCE-FINDINGS.md` returns no matches
4. `npm run lint` passes
  </verify>
  <done>Zero awc/svawc references in source code; documentation uses generic placeholders</done>
</task>

<task type="auto">
  <name>Task 3: Verify internal keys and final build</name>
  <files>None (verification only)</files>
  <action>
Run comprehensive verification scan to confirm zero AWC/svawc references remain in source code AND internal definitions (ACF JSON field keys).

**Step 1: Verify ACF JSON field definitions (per user decision to check internal keys)**

Research already confirmed no ACF field keys contain "awc" or "svawc", but verify explicitly:

```bash
grep -rn "awc\|AWC\|svawc" acf-json/
```

Expected result: Zero matches. If any matches found, rename the field keys and note that a database migration may be needed.

**Step 2: Run full source code scan with proper exclusions**

```bash
grep -rn "awc\|AWC\|svawc" \
  --include="*.php" \
  --include="*.js" \
  --include="*.jsx" \
  --include="*.md" \
  --include="*.json" \
  --exclude-dir=node_modules \
  --exclude-dir=.git \
  --exclude-dir=dist \
  --exclude-dir=vendor \
  --exclude-dir=.planning \
  --exclude="CHANGELOG.md" \
  --exclude="package-lock.json" \
  .
```

Expected result: Zero matches (empty output)

**Step 3: Build and lint**

1. Run `npm run build` to generate production assets
2. Run `npm run lint` to verify no code quality issues

**If grep returns any matches:**
- Evaluate each match
- If in source code (not .planning/): fix it
- If in CHANGELOG.md: leave as-is (historical record)
- If in .planning/: ignore (context documents)
- If in ACF JSON: rename field key and add database migration if needed
  </action>
  <verify>
1. `grep -rn "awc\|AWC\|svawc" acf-json/` returns zero matches
2. Full source grep scan returns zero matches in source files (CHANGELOG.md excluded as historical record)
3. `npm run build` completes successfully
4. `npm run lint` passes with no new errors
  </verify>
  <done>Grep scan returns zero matches in source files; ACF JSON verified clean; theme installable by any club</done>
</task>

</tasks>

<verification>
Phase completion verification:
1. Visit a person with a freescout-id in production
2. If FreeScout URL is configured in Settings: link should appear with configured base URL
3. If FreeScout URL is NOT configured: link should NOT appear
4. grep scan returns zero awc/svawc matches in source files (including ACF JSON)
5. All documentation uses generic placeholders (example.com, DEPLOY_REMOTE_THEME_PATH)
</verification>

<success_criteria>
1. FreeScout link in PersonDetail reads base URL from `window.stadionConfig.freescoutUrl`
2. FreeScout link is hidden entirely when URL not configured
3. Zero awc/svawc/AWC references in source code (verified by grep scan returning zero matches)
4. Zero awc/svawc/AWC references in ACF JSON field definitions (verified by grep scan)
5. AGENTS.md uses `$DEPLOY_REMOTE_THEME_PATH` instead of hardcoded path
6. PERFORMANCE-FINDINGS.md has generic title
7. Build and lint pass with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/146-integration-cleanup/146-01-SUMMARY.md`
</output>
