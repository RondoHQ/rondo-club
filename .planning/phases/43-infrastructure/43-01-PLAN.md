---
phase: 43-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tailwind.config.js
  - src/index.css
  - src/hooks/useTheme.js
  - includes/class-rest-api.php
  - src/api/client.js
autonomous: true
---

<objective>
Establish theme customization infrastructure with CSS custom properties, Tailwind accent colors, useTheme hook, and REST API endpoint for preferences.

Purpose: Create the foundational layer for user-configurable themes (dark mode + accent colors) without changing any existing component styling yet.
Output: Theme infrastructure ready for Phase 44 (dark mode) and Phase 45 (accent color replacement).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@/Multi-Color.md

# Key source files:
@tailwind.config.js
@src/index.css
@src/hooks/usePeople.js (reference for hook patterns)
@includes/class-rest-api.php (reference for REST endpoint patterns)
@src/api/client.js
@src/pages/Settings/Settings.jsx (will add Appearance tab in Phase 44)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CSS custom properties for accent colors</name>
  <files>src/index.css</files>
  <action>
Add CSS custom properties in `@layer base` that define accent color scales for all 8 palettes. Structure:

1. Define `:root` with default orange palette values (--color-accent-50 through --color-accent-900)
2. Add `[data-accent="teal"]`, `[data-accent="indigo"]`, etc. attribute selectors that override the accent values
3. Use Tailwind's `theme()` function to reference the actual Tailwind color values

Color palettes from PRD (use Tailwind defaults):
- orange (default): theme('colors.orange.*')
- teal: theme('colors.teal.*')
- indigo: theme('colors.indigo.*')
- emerald: theme('colors.emerald.*')
- violet: theme('colors.violet.*')
- pink: theme('colors.pink.*')
- fuchsia: theme('colors.fuchsia.*')
- rose: theme('colors.rose.*')

Define these shade levels: 50, 100, 200, 300, 400, 500, 600, 700, 800, 900.

Add after the existing `@layer base` block (don't modify existing body styles).
  </action>
  <verify>Run `npm run build` - should complete without errors. CSS output should contain the custom properties.</verify>
  <done>CSS custom properties defined for all 8 accent color palettes with data-accent attribute selectors.</done>
</task>

<task type="auto">
  <name>Task 2: Extend Tailwind config with accent color utilities</name>
  <files>tailwind.config.js</files>
  <action>
Extend the Tailwind config to:

1. Enable class-based dark mode: `darkMode: 'class'`
2. Add `accent` color palette using CSS custom properties:
   ```javascript
   colors: {
     accent: {
       50: 'var(--color-accent-50)',
       100: 'var(--color-accent-100)',
       // ... through 900
     }
   }
   ```

This allows using `bg-accent-500`, `text-accent-600`, `border-accent-200` etc. throughout the app.

Keep existing `primary` color palette - it will remain for backward compatibility during migration.
  </action>
  <verify>Run `npm run build` - should complete without errors. Check that accent classes are available.</verify>
  <done>Tailwind config has darkMode: 'class' and accent color utilities available.</done>
</task>

<task type="auto">
  <name>Task 3: Create useTheme hook with localStorage + system preference support</name>
  <files>src/hooks/useTheme.js</files>
  <action>
Create a new hook that:

1. Manages colorScheme ('light' | 'dark' | 'system') and accentColor ('orange' | 'teal' | 'indigo' | 'emerald' | 'violet' | 'pink' | 'fuchsia' | 'rose')
2. On mount:
   - Read from localStorage('theme-preferences') for instant application (prevents flash)
   - Apply theme immediately: set `data-accent` attribute and `dark` class on document.documentElement
3. Listen to prefers-color-scheme media query when colorScheme is 'system'
4. Export: { colorScheme, accentColor, setColorScheme, setAccentColor, effectiveColorScheme }
   - effectiveColorScheme: resolved 'light' or 'dark' (useful for conditional rendering)
5. When values change:
   - Update localStorage immediately
   - Update DOM (data-accent attribute, dark class)

Use useEffect for side effects. Follow existing hook patterns (see usePeople.js).

Do NOT fetch from API in this hook - that will be handled by a separate useThemePreferences hook that wraps this one (Phase 44).
  </action>
  <verify>Import hook in a test component, verify it doesn't crash and exports expected functions.</verify>
  <done>useTheme hook created with localStorage persistence and DOM manipulation.</done>
</task>

<task type="auto">
  <name>Task 4: Add REST API endpoint for theme preferences</name>
  <files>includes/class-rest-api.php, src/api/client.js</files>
  <action>
In class-rest-api.php:

1. Register GET endpoint: `/prm/v1/user/theme-preferences`
   - Returns: { color_scheme: 'light'|'dark'|'system', accent_color: 'orange'|... }
   - Default values: color_scheme = 'system', accent_color = 'orange'
   - Read from user meta: 'caelis_color_scheme', 'caelis_accent_color'

2. Register PATCH endpoint: `/prm/v1/user/theme-preferences`
   - Accepts: { color_scheme?: string, accent_color?: string }
   - Validate color_scheme is one of: 'light', 'dark', 'system'
   - Validate accent_color is one of: 'orange', 'teal', 'indigo', 'emerald', 'violet', 'pink', 'fuchsia', 'rose'
   - Save to user meta using update_user_meta()
   - Return updated preferences

Follow existing patterns from get_notification_channels/update_notification_channels.

In src/api/client.js:

Add to prmApi object:
- getThemePreferences: () => apiClient.get('/prm/v1/user/theme-preferences')
- updateThemePreferences: (prefs) => apiClient.patch('/prm/v1/user/theme-preferences', prefs)
  </action>
  <verify>Test endpoints with curl or in browser console:
- GET /wp-json/prm/v1/user/theme-preferences returns default values
- PATCH with valid values updates and returns new values
- PATCH with invalid values returns 400 error
  </verify>
  <done>REST API endpoints registered and functional, client methods added to prmApi.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] CSS custom properties visible in browser dev tools when inspecting :root
- [ ] Setting `data-accent="teal"` on html element changes accent variables
- [ ] Setting `class="dark"` on html element doesn't break existing styles (no dark variants yet, but no errors)
- [ ] GET /wp-json/prm/v1/user/theme-preferences returns valid JSON
- [ ] PATCH /wp-json/prm/v1/user/theme-preferences updates user meta
- [ ] useTheme hook can be imported without errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Theme infrastructure ready for Phase 44 (dark mode implementation)
- Existing UI unchanged (infrastructure only, no visual changes)
</success_criteria>

<output>
After completion, create `.planning/phases/43-infrastructure/43-01-SUMMARY.md`
</output>
