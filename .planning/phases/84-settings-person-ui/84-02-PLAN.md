---
phase: 84-settings-person-ui
plan: 02
type: execute
wave: 2
depends_on: [84-01]
files_modified:
  - src/pages/Settings/Settings.jsx
  - src/pages/People/PersonDetail.jsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees error count in status card when last sync had errors"
    - "User can view sync history showing recent sync operations"
    - "User sees 'View in Google' link on synced person's detail page"
  artifacts:
    - path: "src/pages/Settings/Settings.jsx"
      provides: "Error count display and sync history viewer"
      contains: "sync_history"
    - path: "src/pages/People/PersonDetail.jsx"
      provides: "View in Google Contacts link"
      contains: "contacts.google.com"
  key_links:
    - from: "src/pages/Settings/Settings.jsx"
      to: "googleContactsStatus.sync_history"
      via: "Conditional rendering in ConnectionsContactsSubtab"
      pattern: "sync_history"
    - from: "src/pages/People/PersonDetail.jsx"
      to: "person.google_contact_id"
      via: "External link construction"
      pattern: "google_contact_id"
---

<objective>
Add frontend UI for error count display, sync history viewer, and "View in Google" link on person pages.

Purpose: Complete Settings UI polish (SETTINGS-03 error count, SETTINGS-07 sync history) and Person page integration (PERSON-01).
Output: Enhanced Settings Contacts tab and PersonDetail page with Google link.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/84-settings-person-ui/84-RESEARCH.md
@.planning/phases/84-settings-person-ui/84-CONTEXT.md
@.planning/phases/84-settings-person-ui/84-01-SUMMARY.md

# Relevant source files
@src/pages/Settings/Settings.jsx
@src/pages/People/PersonDetail.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add error count and sync history to Settings</name>
  <files>src/pages/Settings/Settings.jsx</files>
  <action>
In `ConnectionsContactsSubtab` component, enhance the status display:

**1. Add error count display** in the connected status card (after contact_count display, around line 2242):

Replace the simple error banner at line 2459-2465 with a collapsible error indicator in the status section:

```jsx
{/* Error indicator - show if last sync had errors */}
{googleContactsStatus.sync_history?.[0]?.errors > 0 ? (
  <details className="text-xs text-amber-600 dark:text-amber-400 mt-1">
    <summary className="cursor-pointer hover:underline">
      {googleContactsStatus.sync_history[0].errors} error{googleContactsStatus.sync_history[0].errors !== 1 ? 's' : ''} in last sync
    </summary>
    {googleContactsStatus.last_error && (
      <p className="mt-1 pl-2 text-amber-700 dark:text-amber-300 text-xs">
        {googleContactsStatus.last_error}
      </p>
    )}
  </details>
) : googleContactsStatus.last_error && !googleContactsImportResult ? (
  <p className="text-xs text-amber-600 dark:text-amber-400 mt-1">
    Warning: {googleContactsStatus.last_error}
  </p>
) : null}
```

**2. Add sync history section** after the Background Sync section (after line 2456):

```jsx
{/* Sync History */}
{googleContactsStatus.sync_history?.length > 0 && (
  <div className="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
    <details className="group">
      <summary className="text-sm font-medium text-gray-900 dark:text-white cursor-pointer hover:text-accent-600 dark:hover:text-accent-400 flex items-center gap-1">
        <span>Sync History</span>
        <span className="text-xs text-gray-500 dark:text-gray-400">
          ({googleContactsStatus.sync_history.length} recent)
        </span>
      </summary>
      <div className="mt-3 space-y-2">
        {googleContactsStatus.sync_history.map((entry, index) => (
          <div
            key={index}
            className="text-xs text-gray-600 dark:text-gray-400 flex items-center justify-between py-1 border-b border-gray-100 dark:border-gray-800 last:border-0"
          >
            <span>
              {formatDistanceToNow(new Date(entry.timestamp), { addSuffix: true })}
            </span>
            <span className="flex items-center gap-3">
              {entry.pulled > 0 && <span>{entry.pulled} pulled</span>}
              {entry.pushed > 0 && <span>{entry.pushed} pushed</span>}
              {entry.errors > 0 && (
                <span className="text-amber-600 dark:text-amber-400">
                  {entry.errors} error{entry.errors !== 1 ? 's' : ''}
                </span>
              )}
              {entry.pulled === 0 && entry.pushed === 0 && entry.errors === 0 && (
                <span className="text-gray-400 dark:text-gray-500">No changes</span>
              )}
            </span>
          </div>
        ))}
      </div>
    </details>
  </div>
)}
```

Remove or simplify the existing error banner at lines 2459-2465 since errors are now shown in the status card.

Note: `formatDistanceToNow` is already imported from date-fns at line 5.
  </action>
  <verify>
1. Connect Google Contacts (if not connected)
2. Trigger a sync via "Sync Now" button
3. Verify error count shows in status card if there were errors
4. Verify "Sync History" section appears and is expandable
5. Verify sync entries show pulled/pushed/errors counts
  </verify>
  <done>Settings shows error count in status card and sync history is viewable via expandable section</done>
</task>

<task type="auto">
  <name>Task 2: Add "View in Google Contacts" link to PersonDetail</name>
  <files>src/pages/People/PersonDetail.jsx</files>
  <action>
Add a "View in Google" link on the PersonDetail page for synced contacts.

**Placement decision:** Per CONTEXT.md, "Display as small link icon near contact info (not prominent - utility feature)". Add it in the header section near the person's name, as a subtle utility link.

**1. Find the person name/header section** (around line 1540-1580 in the header area).

**2. Add the Google link** after the name display, as a small external link:

```jsx
{/* View in Google Contacts link - only for synced contacts */}
{person.google_contact_id && (
  <a
    href={`https://contacts.google.com/person/${person.google_contact_id}`}
    target="_blank"
    rel="noopener noreferrer"
    className="inline-flex items-center gap-1 text-xs text-gray-400 dark:text-gray-500 hover:text-accent-600 dark:hover:text-accent-400 ml-2"
    title="View in Google Contacts"
  >
    <ExternalLink className="w-3 h-3" />
    <span>Google</span>
  </a>
)}
```

The ExternalLink icon is already imported at line 6.

**Alternative placement:** If the header area is too crowded, add it to the Contact Information card header (around line 1744-1752) next to the "Edit" button:

```jsx
<div className="flex items-center justify-between mb-4">
  <div className="flex items-center gap-2">
    <h2 className="font-semibold">Contact information</h2>
    {person.google_contact_id && (
      <a
        href={`https://contacts.google.com/person/${person.google_contact_id}`}
        target="_blank"
        rel="noopener noreferrer"
        className="text-xs text-gray-400 dark:text-gray-500 hover:text-accent-600 dark:hover:text-accent-400 flex items-center gap-1"
        title="View in Google Contacts"
      >
        <ExternalLink className="w-3 h-3" />
      </a>
    )}
  </div>
  <button ...>Edit</button>
</div>
```

Use your judgment on best placement. Keep it subtle but accessible.

After changes, run `npm run build` and deploy to production.
  </action>
  <verify>
1. Navigate to a person that is synced with Google (has google_contact_id)
2. Verify "View in Google" link appears (small, subtle placement)
3. Click link - should open Google Contacts in new tab
4. Navigate to a person NOT synced with Google
5. Verify link does NOT appear
  </verify>
  <done>PersonDetail shows "View in Google Contacts" link for synced contacts only</done>
</task>

</tasks>

<verification>
1. Settings shows error count when last sync had errors
2. Settings shows collapsible sync history section
3. PersonDetail shows "View in Google" link for synced contacts
4. Link opens correct Google Contacts URL
5. Link hidden for unsynced contacts
6. Production deployed and working
</verification>

<success_criteria>
- Error count visible in status card (derived from sync_history[0].errors)
- Sync history expandable, shows pulled/pushed/errors for each entry
- "View in Google" link appears only when person.google_contact_id exists
- Link URL is `https://contacts.google.com/person/{resourceName}`
- All features work in both light and dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/84-settings-person-ui/84-02-SUMMARY.md`
</output>
