---
phase: 36-dashboard-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Dashboard.jsx
  - src/pages/People/PersonDetail.jsx
  - includes/class-rest-api.php
autonomous: true
---

<objective>
Add awaiting todos count to dashboard stats and expand Timeline panel to 2 columns on desktop.

Purpose: Improve dashboard visibility into pending responses and give timeline content more room.
Output: Dashboard stats include awaiting count; Timeline tab uses full 2-column width on desktop.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/pages/Dashboard.jsx
@src/pages/People/PersonDetail.jsx
@includes/class-rest-api.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add awaiting todos count to dashboard stats</name>
  <files>includes/class-rest-api.php, src/pages/Dashboard.jsx</files>
  <action>
1. In includes/class-rest-api.php, add a count_awaiting_todos() method:
   - Similar to count_open_todos() but queries 'prm_awaiting' post_status
   - Returns count of awaiting todos for current user

2. In get_dashboard_summary(), add the awaiting count to the stats array:
   - Call count_awaiting_todos() around line 696 (after open_todos_count)
   - Add 'awaiting_todos_count' to the stats response object (line 706)

3. In src/pages/Dashboard.jsx, update the stats row (lines 428-453):
   - Change from 4-column grid to 5-column: `lg:grid-cols-5`
   - Add a new StatCard for "Awaiting" after "Open todos":
     ```jsx
     <StatCard
       title="Awaiting"
       value={stats?.awaiting_todos_count || 0}
       icon={Clock}
       href="/todos?status=awaiting"
     />
     ```
   - Import Clock icon (already imported at line 2)

4. Also update the empty state stats grid (lines 388-418):
   - Change to `lg:grid-cols-5`
   - Add the same Awaiting StatCard with value 0
  </action>
  <verify>
- `npm run build` succeeds
- Dashboard shows 5 stat cards: People, Organizations, Events, Open todos, Awaiting
- Awaiting stat links to /todos?status=awaiting
- API response at /prm/v1/dashboard includes awaiting_todos_count
  </verify>
  <done>
- Dashboard stats row displays awaiting todos count
- Backend returns awaiting_todos_count in dashboard API
- Clicking Awaiting stat navigates to filtered todos view
  </done>
</task>

<task type="auto">
  <name>Task 2: Expand Timeline panel to full width on desktop</name>
  <files>src/pages/People/PersonDetail.jsx</files>
  <action>
In src/pages/People/PersonDetail.jsx, modify the Timeline tab content (around line 1875-1911):

Currently the Timeline tab has:
```jsx
{activeTab === 'timeline' && (
  <div className="columns-1 md:columns-2 gap-6">
    <div className="card p-6 break-inside-avoid mb-6">
```

The issue is that the main content area is `lg:col-span-2` (2 of 3 columns), leaving 1 column for the todos sidebar on the right. The Timeline card sits inside this area but uses a masonry layout (`columns-1 md:columns-2`).

Change to make the Timeline tab content span the full 2-column area as a single card:

1. Remove the masonry columns wrapper for Timeline tab:
   ```jsx
   {activeTab === 'timeline' && (
     <div className="card p-6">
   ```
   (Remove the `columns-1 md:columns-2 gap-6` wrapper div and `break-inside-avoid mb-6` from the card)

2. The Timeline content will now use the full lg:col-span-2 width, giving it more horizontal space on desktop.

Note: Keep the Todos sidebar in the 3rd column (already working via the grid layout). The Timeline card just gets more room.
  </action>
  <verify>
- `npm run build` succeeds
- Timeline tab content uses full 2-column width on desktop
- Todos sidebar still visible on right side
- Mobile layout unchanged (single column)
  </verify>
  <done>
- Timeline panel uses full 2-column width on desktop
- Timeline entries have more horizontal space
- Todos sidebar remains in place
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Dashboard stats show 5 items including Awaiting count
- [ ] Timeline tab uses full 2-column width on person profile desktop view
- [ ] Mobile layouts unchanged
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/lint errors introduced
- Dashboard shows awaiting count stat
- Timeline panel wider on desktop
</success_criteria>

<output>
After completion, create `.planning/phases/36-dashboard-enhancement/36-01-SUMMARY.md`
</output>
