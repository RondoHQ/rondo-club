---
phase: 27-pending-response-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Timeline/TodoModal.jsx
  - src/pages/Todos/TodosList.jsx
  - src/pages/Dashboard.jsx
  - src/components/Timeline/TimelineView.jsx
  - src/components/Timeline/GlobalTodoModal.jsx
  - src/utils/timeline.js
autonomous: true
---

<objective>
Add "awaiting response" UI to the todo system with visual indicators and dashboard integration.

Purpose: Allow users to mark todos as awaiting a response, see aging indicators, and track pending responses across the dashboard.
Output: Updated todo components with awaiting response toggle, visual badges, and dashboard statistics.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-pending-response-model/26-01-SUMMARY.md

# Prior phase established:
# - ACF fields: awaiting_response (true_false), awaiting_response_since (date_time_picker)
# - REST API auto-timestamps: sets awaiting_response_since when awaiting_response changes to true
# - REST API clears timestamp when awaiting_response set to false

@src/components/Timeline/TodoModal.jsx
@src/pages/Todos/TodosList.jsx
@src/pages/Dashboard.jsx
@src/components/Timeline/TimelineView.jsx
@src/utils/timeline.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add awaiting response toggle to TodoModal</name>
  <files>src/components/Timeline/TodoModal.jsx</files>
  <action>
Add an "Awaiting response" checkbox to TodoModal that appears for both new and existing todos.

1. Add state: `const [awaitingResponse, setAwaitingResponse] = useState(false);`

2. In useEffect, populate from todo prop:
   ```javascript
   setAwaitingResponse(todo?.awaiting_response || false);
   ```

3. Add checkbox after the due date input (before the completed checkbox):
   ```jsx
   <div className="mb-4">
     <label className="flex items-center">
       <input
         type="checkbox"
         checked={awaitingResponse}
         onChange={(e) => setAwaitingResponse(e.target.checked)}
         className="mr-2"
         disabled={isLoading}
       />
       <span className="text-sm text-gray-700">Awaiting response</span>
     </label>
   </div>
   ```

4. Include in handleSubmit data:
   ```javascript
   onSubmit({
     content: content.trim(),
     due_date: dueDate || null,
     is_completed: isCompleted,
     awaiting_response: awaitingResponse,
   });
   ```

5. Reset in handleClose:
   ```javascript
   setAwaitingResponse(false);
   ```

Note: The backend auto-handles awaiting_response_since timestamp.
  </action>
  <verify>Open TodoModal for edit, toggle awaiting response checkbox, save. Check browser dev tools Network tab for PUT request containing awaiting_response field.</verify>
  <done>TodoModal includes awaiting_response checkbox for both create and edit modes, data sent to API.</done>
</task>

<task type="auto">
  <name>Task 2: Add awaiting response indicator to TodosList and TodoItem</name>
  <files>src/pages/Todos/TodosList.jsx, src/utils/timeline.js</files>
  <action>
Add visual indicators for awaiting response status in the todos list.

1. In src/utils/timeline.js, add helper function after `isTodoOverdue`:
   ```javascript
   /**
    * Calculate days since awaiting response was set
    * @param {Object} todo
    * @returns {number|null} Days since awaiting, or null if not awaiting
    */
   export function getAwaitingDays(todo) {
     if (!todo.awaiting_response || !todo.awaiting_response_since) {
       return null;
     }
     const since = new Date(todo.awaiting_response_since);
     const now = new Date();
     const diffTime = now - since;
     const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
     return diffDays;
   }

   /**
    * Get urgency class for awaiting response based on days
    * @param {number} days
    * @returns {string} Tailwind class for badge
    */
   export function getAwaitingUrgencyClass(days) {
     if (days === null) return '';
     if (days >= 7) return 'bg-red-100 text-red-700';
     if (days >= 3) return 'bg-orange-100 text-orange-700';
     return 'bg-yellow-100 text-yellow-700';
   }
   ```

2. In src/pages/Todos/TodosList.jsx:
   - Import: `import { isTodoOverdue, getAwaitingDays, getAwaitingUrgencyClass } from '@/utils/timeline';`
   - Import icon: Add `Clock` to lucide-react imports (already imported)

3. In TodoItem component, add awaiting response badge after the due date span:
   ```jsx
   {/* Awaiting response indicator */}
   {todo.awaiting_response && (
     <span className={`text-xs px-2 py-0.5 rounded-full flex items-center gap-1 ${getAwaitingUrgencyClass(getAwaitingDays(todo))}`}>
       <Clock className="w-3 h-3" />
       {getAwaitingDays(todo) === 0 ? 'Awaiting today' : `Awaiting ${getAwaitingDays(todo)}d`}
     </span>
   )}
   ```

Place this inside the flex wrapper div that contains the person link and due date (around line 362), after the due_date span.
  </action>
  <verify>Create or edit a todo with "awaiting response" checked. Verify badge appears in TodosList with color coding (yellow for recent, orange for 3+ days, red for 7+ days).</verify>
  <done>TodosList shows awaiting response badge with day count and urgency coloring.</done>
</task>

<task type="auto">
  <name>Task 3: Add awaiting response section to Dashboard</name>
  <files>src/pages/Dashboard.jsx</files>
  <action>
Add an "Awaiting response" section to the dashboard showing todos that are awaiting response.

1. Import helpers at top:
   ```javascript
   import { isTodoOverdue, getAwaitingDays, getAwaitingUrgencyClass } from '@/utils/timeline';
   ```
   Add `Clock` to the lucide-react import.

2. Filter awaiting response todos from the todos data. After line 218 (`const { data: todos } = useTodos(false);`), add:
   ```javascript
   // Filter todos awaiting response
   const awaitingTodos = useMemo(() => {
     if (!todos) return [];
     return todos.filter(todo => todo.awaiting_response && !todo.is_completed);
   }, [todos]);
   ```
   Import `useMemo` from react if not already imported.

3. In the dashboard grid (after the "Open todos" card, around line 340), add an "Awaiting response" card:
   ```jsx
   {/* Awaiting Response Card */}
   {awaitingTodos.length > 0 && (
     <div className="card">
       <div className="p-4 border-b border-gray-200">
         <div className="flex items-center justify-between">
           <h3 className="font-semibold flex items-center">
             <Clock className="w-5 h-5 mr-2 text-orange-500" />
             Awaiting response ({awaitingTodos.length})
           </h3>
           <Link to="/todos" className="text-primary-600 hover:text-primary-700 text-sm">
             View all
             <ArrowRight className="w-4 h-4 inline ml-1" />
           </Link>
         </div>
       </div>
       <div className="divide-y divide-gray-100">
         {awaitingTodos.slice(0, 5).map((todo) => (
           <AwaitingTodoCard key={todo.id} todo={todo} />
         ))}
       </div>
     </div>
   )}
   ```

4. Create AwaitingTodoCard component (add before Dashboard export):
   ```jsx
   function AwaitingTodoCard({ todo }) {
     const days = getAwaitingDays(todo);
     const urgencyClass = getAwaitingUrgencyClass(days);

     return (
       <Link
         to={`/people/${todo.person_id}`}
         className="flex items-start p-3 hover:bg-gray-50 transition-colors"
       >
         <div className="flex-1 min-w-0">
           <p className="text-sm font-medium text-gray-900 truncate">{todo.content}</p>
           <div className="flex items-center gap-2 mt-1">
             {todo.person_thumbnail ? (
               <img
                 src={todo.person_thumbnail}
                 alt={todo.person_name}
                 loading="lazy"
                 className="w-5 h-5 rounded-full object-cover"
               />
             ) : (
               <div className="w-5 h-5 bg-gray-200 rounded-full flex items-center justify-center">
                 <span className="text-xs text-gray-500">{todo.person_name?.[0]}</span>
               </div>
             )}
             <span className="text-xs text-gray-500 truncate">{todo.person_name}</span>
           </div>
         </div>
         <div className={`ml-3 text-xs px-2 py-1 rounded-full flex items-center gap-1 ${urgencyClass}`}>
           <Clock className="w-3 h-3" />
           {days === 0 ? 'Today' : `${days}d`}
         </div>
       </Link>
     );
   }
   ```

Note: The Awaiting Response card only shows when there are awaiting todos.
  </action>
  <verify>Mark a todo as awaiting response. Go to Dashboard. Verify "Awaiting response" card appears with the todo, showing day count badge.</verify>
  <done>Dashboard shows "Awaiting response" section with todos awaiting response and aging indicators.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] TodoModal has awaiting response checkbox
- [ ] TodosList shows awaiting response badges with urgency coloring
- [ ] Dashboard shows awaiting response section when todos exist
- [ ] Awaiting days counter works correctly (0d for today, 1d for yesterday, etc.)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/ESLint errors introduced
- Awaiting response UI visible across TodoModal, TodosList, and Dashboard
- Day counters and urgency colors working correctly
</success_criteria>

<output>
After completion, create `.planning/phases/27-pending-response-ui/27-01-SUMMARY.md`
</output>
