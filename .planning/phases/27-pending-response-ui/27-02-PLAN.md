---
phase: 27-pending-response-ui
plan: 02
type: execute
wave: 2
depends_on: ["27-01"]
files_modified:
  - src/components/Timeline/TimelineView.jsx
  - src/components/Timeline/GlobalTodoModal.jsx
  - src/pages/People/PersonDetail.jsx
autonomous: true
---

<objective>
Complete awaiting response UI with TimelineView indicators and GlobalTodoModal support.

Purpose: Ensure awaiting response status is visible in all todo contexts and can be set from any todo creation point.
Output: Full awaiting response UI coverage across all todo-related components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-pending-response-ui/27-01-PLAN.md

# Prior plan adds to timeline.js:
# - getAwaitingDays(todo) - returns number of days since awaiting
# - getAwaitingUrgencyClass(days) - returns Tailwind class for badge

@src/components/Timeline/TimelineView.jsx
@src/components/Timeline/GlobalTodoModal.jsx
@src/pages/People/PersonDetail.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add awaiting response indicator to TimelineView</name>
  <files>src/components/Timeline/TimelineView.jsx</files>
  <action>
Add awaiting response visual indicator in the TimelineView component for todos.

1. Import helpers at top (add to existing import):
   ```javascript
   import {
     groupTimelineByDate,
     formatTimelineDate,
     getActivityTypeIcon,
     getActivityTypeLabel,
     isTodoOverdue,
     getTodoStatusClass,
     getAwaitingDays,
     getAwaitingUrgencyClass,
   } from '@/utils/timeline';
   ```

2. Add Clock to lucide-react imports.

3. In renderTimelineItem, after the todo due date section (around line 180), add awaiting indicator:
   ```jsx
   {/* Awaiting response indicator */}
   {isTodo && item.awaiting_response && !item.is_completed && (
     <div className="mt-2">
       <span className={`text-xs px-2 py-0.5 rounded-full inline-flex items-center gap-1 ${getAwaitingUrgencyClass(getAwaitingDays(item))}`}>
         <Clock className="w-3 h-3" />
         {getAwaitingDays(item) === 0 ? 'Awaiting response' : `Awaiting ${getAwaitingDays(item)}d`}
       </span>
     </div>
   )}
   ```

Place this inside the flex-1 content div, after the due_date display section.
  </action>
  <verify>Open a person detail page with an awaiting response todo. Verify the badge appears in the timeline view with day counter and urgency coloring.</verify>
  <done>TimelineView shows awaiting response badges for todos in the timeline.</done>
</task>

<task type="auto">
  <name>Task 2: Add awaiting response checkbox to GlobalTodoModal</name>
  <files>src/components/Timeline/GlobalTodoModal.jsx</files>
  <action>
Add awaiting response checkbox to GlobalTodoModal for creating todos that immediately start awaiting a response.

1. Add state after existing state declarations (around line 11):
   ```javascript
   const [awaitingResponse, setAwaitingResponse] = useState(false);
   ```

2. Reset in useEffect when modal opens (around line 54):
   ```javascript
   setAwaitingResponse(false);
   ```

3. Add checkbox after the due date input (before the button row, around line 238):
   ```jsx
   {/* Awaiting response */}
   <div className="mb-4">
     <label className="flex items-center">
       <input
         type="checkbox"
         checked={awaitingResponse}
         onChange={(e) => setAwaitingResponse(e.target.checked)}
         className="mr-2"
         disabled={createTodo.isPending}
       />
       <span className="text-sm text-gray-700">Awaiting response</span>
     </label>
   </div>
   ```

4. Include in handleSubmit data object (around line 68):
   ```javascript
   data: {
     content: content.trim(),
     due_date: dueDate || null,
     is_completed: false,
     awaiting_response: awaitingResponse,
   },
   ```
  </action>
  <verify>Open GlobalTodoModal from TodosList "Add todo" button. Create a todo with "Awaiting response" checked. Verify the new todo shows awaiting badge in TodosList.</verify>
  <done>GlobalTodoModal supports awaiting response checkbox for new todo creation.</done>
</task>

<task type="auto">
  <name>Task 3: Add awaiting response indicator to PersonDetail todo sidebar</name>
  <files>src/pages/People/PersonDetail.jsx</files>
  <action>
Add awaiting response visual indicator to the todo items shown in the PersonDetail sidebar.

1. First, search for where todos are rendered in PersonDetail. Look for the todo rendering section - it should show incomplete todos in a sidebar or section.

2. Import the helper functions at the top:
   ```javascript
   import { getAwaitingDays, getAwaitingUrgencyClass } from '@/utils/timeline';
   ```
   And add Clock to the lucide-react imports.

3. Find the todo item rendering (look for `todo.content` or the todo checkbox). Add awaiting indicator after the content/due date:
   ```jsx
   {todo.awaiting_response && (
     <span className={`text-xs px-1.5 py-0.5 rounded-full inline-flex items-center gap-0.5 ml-2 ${getAwaitingUrgencyClass(getAwaitingDays(todo))}`}>
       <Clock className="w-3 h-3" />
       {getAwaitingDays(todo)}d
     </span>
   )}
   ```

Note: PersonDetail likely has a simplified todo display. Match the existing styling pattern.
  </action>
  <verify>Open a person detail page with an awaiting response todo. Verify the badge appears inline with the todo content in the sidebar.</verify>
  <done>PersonDetail sidebar shows awaiting response indicator on todos.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] TimelineView shows awaiting response badges
- [ ] GlobalTodoModal has awaiting response checkbox
- [ ] PersonDetail shows awaiting response indicators
- [ ] All awaiting indicators use consistent styling (urgency colors, clock icon, day count)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/ESLint errors introduced
- Awaiting response UI consistent across all todo display contexts
- Users can mark todos as awaiting response from any creation point
</success_criteria>

<output>
After completion, create `.planning/phases/27-pending-response-ui/27-02-SUMMARY.md`
</output>
