---
phase: 108-offline-support
plan: 03
type: execute
wave: 2
depends_on: ["108-01"]
files_modified:
  - src/components/PersonEditModal.jsx
  - src/components/TeamEditModal.jsx
  - src/components/CommissieEditModal.jsx
  - src/components/ContactEditModal.jsx
  - src/components/WorkHistoryEditModal.jsx
  - src/components/AddressEditModal.jsx
  - src/components/RelationshipEditModal.jsx
  - src/components/ImportantDateModal.jsx
  - src/components/FeedbackModal.jsx
  - src/components/CustomFieldsEditModal.jsx
autonomous: true

must_haves:
  truths:
    - "Save buttons are disabled when offline"
    - "Delete buttons are disabled when offline"
    - "Form inputs show visual feedback when disabled offline"
    - "User cannot submit forms when offline"
  artifacts:
    - path: "src/components/PersonEditModal.jsx"
      provides: "Person edit with offline protection"
      contains: "useOnlineStatus"
    - path: "src/components/TeamEditModal.jsx"
      provides: "Team edit with offline protection"
      contains: "useOnlineStatus"
  key_links:
    - from: "src/components/PersonEditModal.jsx"
      to: "src/hooks/useOnlineStatus.js"
      via: "hook import"
      pattern: "useOnlineStatus"
---

<objective>
Add offline protection to all edit modals by disabling forms and mutation buttons when offline.

Purpose: Prevent users from attempting writes that will fail while offline (OFF-03 read-only requirement)
Output: All major edit modals respect online state and disable inputs/buttons when offline
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/108-offline-support/108-CONTEXT.md
@.planning/phases/108-offline-support/108-RESEARCH.md
@.planning/phases/108-offline-support/108-01-SUMMARY.md

# Key files
@src/hooks/useOnlineStatus.js
@src/components/PersonEditModal.jsx
@src/components/TeamEditModal.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add offline protection to major entity edit modals</name>
  <files>src/components/PersonEditModal.jsx, src/components/TeamEditModal.jsx, src/components/CommissieEditModal.jsx</files>
  <action>
Add useOnlineStatus hook to PersonEditModal, TeamEditModal, and CommissieEditModal to disable forms when offline.

For each modal:

1. Import the hook:
```javascript
import { useOnlineStatus } from '@/hooks/useOnlineStatus';
```

2. Call hook at top of component:
```javascript
const isOnline = useOnlineStatus();
```

3. Add to the submit button(s):
```jsx
<button
  type="submit"
  disabled={!isOnline || isSubmitting || ...existing conditions...}
  className={`...existing classes... ${!isOnline ? 'opacity-50 cursor-not-allowed' : ''}`}
>
```

4. Add to delete button(s) if present:
```jsx
<button
  onClick={handleDelete}
  disabled={!isOnline || ...existing conditions...}
  className={`...existing classes... ${!isOnline ? 'opacity-50 cursor-not-allowed' : ''}`}
>
```

5. For form inputs, add disabled prop that includes isOnline check IF the modal uses controlled inputs with explicit disabled props. If inputs use react-hook-form register(), they don't need individual disabled props - the submit button disable is sufficient.

Note: Per CONTEXT.md, "banner is enough context" - no need for inline messages explaining why buttons are disabled. The OfflineBanner from Plan 02 provides context.

For TeamEditModal and CommissieEditModal: These share similar structure. Apply same pattern.

IMPORTANT: Don't add disabled to ALL form fields if it would cause significant visual noise. The primary protection is disabling the submit/delete buttons. Only add opacity styling to buttons, not all inputs.
  </action>
  <verify>
- PersonEditModal imports hook: `grep -q "useOnlineStatus" src/components/PersonEditModal.jsx`
- TeamEditModal imports hook: `grep -q "useOnlineStatus" src/components/TeamEditModal.jsx`
- CommissieEditModal imports hook: `grep -q "useOnlineStatus" src/components/CommissieEditModal.jsx`
- Submit buttons disabled: `grep -q "!isOnline" src/components/PersonEditModal.jsx`
- `npm run lint` passes
  </verify>
  <done>PersonEditModal, TeamEditModal, and CommissieEditModal disable mutations when offline</done>
</task>

<task type="auto">
  <name>Task 2: Add offline protection to secondary edit modals</name>
  <files>src/components/ContactEditModal.jsx, src/components/WorkHistoryEditModal.jsx, src/components/AddressEditModal.jsx, src/components/RelationshipEditModal.jsx, src/components/ImportantDateModal.jsx, src/components/FeedbackModal.jsx, src/components/CustomFieldsEditModal.jsx</files>
  <action>
Add useOnlineStatus hook to remaining edit modals that perform mutations.

Apply same pattern as Task 1 to each modal:
1. Import useOnlineStatus hook
2. Call hook at component top
3. Disable submit button(s) with !isOnline condition
4. Disable delete button(s) with !isOnline condition
5. Add opacity-50 cursor-not-allowed styling to disabled buttons

Modals to update:
- ContactEditModal.jsx - edit contact info (email, phone, social)
- WorkHistoryEditModal.jsx - edit work history entries
- AddressEditModal.jsx - edit addresses
- RelationshipEditModal.jsx - edit person relationships
- ImportantDateModal.jsx - create/edit important dates
- FeedbackModal.jsx - submit feedback
- CustomFieldsEditModal.jsx - edit custom field values

Each modal follows same pattern. Scan for:
- `type="submit"` buttons
- delete/remove handler buttons
- Add !isOnline to disabled prop and opacity styling

Note: Some modals may have delete functionality via a separate handler (like handleDelete or onDelete). Ensure these trigger buttons also respect isOnline.
  </action>
  <verify>
- All 7 modals import hook:
  - `grep -q "useOnlineStatus" src/components/ContactEditModal.jsx`
  - `grep -q "useOnlineStatus" src/components/WorkHistoryEditModal.jsx`
  - `grep -q "useOnlineStatus" src/components/AddressEditModal.jsx`
  - `grep -q "useOnlineStatus" src/components/RelationshipEditModal.jsx`
  - `grep -q "useOnlineStatus" src/components/ImportantDateModal.jsx`
  - `grep -q "useOnlineStatus" src/components/FeedbackModal.jsx`
  - `grep -q "useOnlineStatus" src/components/CustomFieldsEditModal.jsx`
- `npm run lint` passes
- `npm run build` succeeds
  </verify>
  <done>All secondary edit modals disable mutations when offline</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run lint` passes
2. `npm run build` succeeds
3. All 10 edit modals import and use useOnlineStatus hook
4. Submit buttons include !isOnline in disabled condition
5. Delete buttons (where present) include !isOnline in disabled condition
</verification>

<success_criteria>
- 10 edit modals updated with offline protection:
  - PersonEditModal, TeamEditModal, CommissieEditModal
  - ContactEditModal, WorkHistoryEditModal, AddressEditModal
  - RelationshipEditModal, ImportantDateModal, FeedbackModal
  - CustomFieldsEditModal
- Each modal: imports useOnlineStatus, disables submit/delete when offline
- Visual feedback via opacity-50 cursor-not-allowed on disabled buttons
- No inline messages (banner provides context per CONTEXT.md)
- All lint checks pass
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/108-offline-support/108-03-SUMMARY.md`
</output>
