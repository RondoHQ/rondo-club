---
phase: 108-offline-support
plan: 04
type: execute
wave: 3
depends_on: ["108-02", "108-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can view cached contacts/teams/dates when offline"
    - "App displays 'Je bent offline' banner when network disconnected"
    - "Static assets load from service worker cache when offline"
    - "Offline fallback page shows for uncached routes"
    - "Save/delete buttons are disabled when offline"
    - "'Je bent weer online' confirmation appears briefly when reconnecting"
  artifacts: []
  key_links: []
---

<objective>
Deploy Phase 108 changes and verify offline functionality on production devices.

Purpose: Confirm all offline support features work correctly on real devices before marking phase complete
Output: Verified offline functionality meeting all OFF-01 through OFF-04 requirements
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/108-offline-support/108-CONTEXT.md
@.planning/phases/108-offline-support/108-01-SUMMARY.md
@.planning/phases/108-offline-support/108-02-SUMMARY.md
@.planning/phases/108-offline-support/108-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and deploy to production</name>
  <files></files>
  <action>
Build production assets and deploy to production server.

1. Run production build:
```bash
npm run build
```

2. Verify offline.html in build output:
```bash
ls -la dist/offline.html
```

3. Deploy to production:
```bash
bin/deploy.sh
```

4. Wait for deployment to complete and caches to clear.
  </action>
  <verify>
- `npm run build` succeeds
- `dist/offline.html` exists
- `bin/deploy.sh` completes without errors
  </verify>
  <done>Production build deployed with offline support features</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete offline support implementation:
- useOnlineStatus hook for network detection
- TanStack Query integration for automatic query pausing
- OfflineBanner component showing network state
- Offline fallback page (offline.html) for uncached routes
- Form/mutation disabling when offline
  </what-built>
  <how-to-verify>
**Test on mobile device (iOS or Android) with PWA installed:**

1. **Install/update PWA**: Visit production URL, ensure latest version is installed (check for update prompt)

2. **Load data while online**:
   - Navigate to Dashboard
   - Open People list, view a few person details
   - Open Teams list, view a team detail
   - Open Dates list

3. **Go offline** (airplane mode or disable WiFi/cellular):
   - Verify "Je bent offline" banner appears at bottom of screen
   - Banner should be gray/muted, persistent (doesn't auto-dismiss)

4. **Browse cached content**:
   - Navigate to previously viewed person - should display normally
   - Navigate to previously viewed team - should display normally
   - Dashboard should show cached data
   - Data should look normal (no "stale" indicators per CONTEXT.md)

5. **Test offline fallback**:
   - Navigate to a route NOT previously visited (e.g., a different person)
   - Should see offline.html page with:
     - "Je bent offline" heading
     - Wifi-off icon
     - "Opnieuw proberen" and "Ga terug" buttons

6. **Test form disabling**:
   - Open a person edit modal
   - Save button should be disabled (grayed out)
   - Delete button should be disabled (grayed out)
   - Try to submit form - should not work

7. **Go back online**:
   - Enable network connection
   - Verify "Je bent weer online" banner appears briefly (2-3 seconds)
   - Banner should turn green
   - Banner should disappear after ~2.5 seconds

8. **Verify forms work again**:
   - Open person edit modal
   - Save/delete buttons should be enabled
   - Submit should work normally

**Expected results:**
- [x] Offline banner appears immediately when going offline
- [x] Cached pages load and display normally when offline
- [x] Uncached routes show Dutch offline.html fallback
- [x] Mutation buttons disabled when offline
- [x] "Back online" confirmation shows briefly when reconnecting
- [x] Forms work normally when back online
  </how-to-verify>
  <resume-signal>Type "verified" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 108 success criteria from ROADMAP.md:
1. ✓ User can view previously loaded contacts/teams/dates when offline
2. ✓ App displays clear offline indicator when network disconnected
3. ✓ Static assets (JS, CSS, fonts) load from cache when offline
4. ✓ User sees helpful offline fallback page when navigating to uncached route
</verification>

<success_criteria>
- All OFF-01 through OFF-04 requirements verified on production
- Offline banner shows Dutch text ("Je bent offline")
- Cached content accessible when offline
- Offline.html fallback works for uncached routes
- Forms properly disabled when offline
- "Back online" confirmation displays briefly
- No regressions to online functionality
</success_criteria>

<output>
After completion, create `.planning/phases/108-offline-support/108-04-SUMMARY.md`

Then update `.planning/phases/108-offline-support/108-VERIFICATION.md` with full verification results.
</output>
