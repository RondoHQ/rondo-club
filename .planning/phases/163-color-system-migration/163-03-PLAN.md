---
phase: 163-color-system-migration
plan: 03
type: execute
wave: 2
depends_on: ["163-01"]
files_modified:
  - includes/class-club-config.php
  - includes/class-rest-api.php
  - functions.php
autonomous: true

must_haves:
  truths:
    - "ClubConfig class has no accent_color option, getter, or updater methods"
    - "REST API /rondo/v1/config endpoint returns only club_name and freescout_url (no accent_color)"
    - "rondoConfig JavaScript global object does not include accentColor property"
    - "User preferences REST endpoints do not accept or return accent_color"
    - "Login page and admin styles no longer reference accent-color CSS property from ClubConfig"
  artifacts:
    - path: "includes/class-club-config.php"
      provides: "ClubConfig without accent_color"
    - path: "includes/class-rest-api.php"
      provides: "REST API without accent_color field"
    - path: "functions.php"
      provides: "Theme functions without accentColor in rondoConfig"
  key_links:
    - from: "includes/class-rest-api.php"
      to: "includes/class-club-config.php"
      via: "ClubConfig::get_all_settings()"
      pattern: "get_all_settings"
    - from: "functions.php"
      to: "includes/class-club-config.php"
      via: "ClubConfig settings for rondoConfig global"
      pattern: "get_all_settings\\|accent_color"
---

<objective>
Remove the accent_color option from the WordPress backend: ClubConfig class, REST API endpoints, user preferences, rondoConfig JavaScript global, and login/admin page styling that references the club accent color.

Purpose: Completes the backend half of the color system removal. After Plans 01 and 02 remove frontend accent references, this plan ensures the server no longer stores, serves, or uses accent color data.

Output: ClubConfig manages only club_name and freescout_url. REST API returns no accent_color. Login page uses fixed brand colors.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/163-color-system-migration/163-RESEARCH.md
@includes/class-club-config.php
@includes/class-rest-api.php
@functions.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove accent_color from ClubConfig class</name>
  <files>includes/class-club-config.php</files>
  <action>
Make the following changes to `includes/class-club-config.php`:

1. **Delete** the `OPTION_ACCENT_COLOR` constant (line 29: `const OPTION_ACCENT_COLOR = 'rondo_accent_color';`)

2. **Remove** `'accent_color' => '#006935'` from the `DEFAULTS` array (line 43). The DEFAULTS array should only contain `club_name` and `freescout_url`.

3. **Delete** the entire `get_accent_color()` method (lines 61-71). This method reads the accent color option with fallback to default and validates hex format.

4. **Delete** the entire `update_accent_color()` method (lines 112-118). This method updates the WordPress option for accent color.

5. **Update** `get_all_settings()` method (around line 88) — remove the `'accent_color' => $this->get_accent_color()` line. The method should return only:
```php
return [
    'club_name'    => $this->get_club_name(),
    'freescout_url' => $this->get_freescout_url(),
];
```

After these changes, ClubConfig should manage exactly two settings: club_name and freescout_url.
  </action>
  <verify>
Run: `cd /Users/joostdevalk/Code/rondo/rondo-club && grep -c "accent" includes/class-club-config.php` — must return 0.
Run: `cd /Users/joostdevalk/Code/rondo/rondo-club && php -l includes/class-club-config.php` — must return "No syntax errors detected".
  </verify>
  <done>ClubConfig class manages only club_name and freescout_url. No accent_color constant, getter, updater, or default remains.</done>
</task>

<task type="auto">
  <name>Task 2: Remove accent_color from REST API and rondoConfig global</name>
  <files>includes/class-rest-api.php, functions.php</files>
  <action>
**1. Clean up includes/class-rest-api.php:**

a) **Remove accent_color from club config REST schema** (around line 170): Delete the `'accent_color'` entry from the schema definition array for the config endpoint.

b) **Remove accent_color from club config update schema** (around line 724): Delete the `'accent_color'` entry from the update endpoint's schema.

c) **Remove accent_color from user preferences GET** (around lines 1164-1172): Remove the logic that reads `rondo_accent_color` user meta and returns it in the response. The user preferences response should not include `accent_color`.

d) **Remove accent_color from user preferences POST** (around lines 1185-1228): Remove the `$valid_accent_colors` array, the `$accent_color = $request->get_param('accent_color')` logic, the validation, and the `update_user_meta()` call. Also remove `accent_color` from the response.

e) **Remove accent_color from club config update handler** (around lines 2993-2996): Delete the block that calls `$club_config->update_accent_color()`.

**2. Clean up functions.php:**

a) **Remove `accentColor` from the rondoConfig JavaScript global** (around line 633). Find the line:
```php
'accentColor' => $club_settings['accent_color'],
```
Delete it. The rondoConfig object should not include accentColor.

b) **Remove accent color references from login page styling** (around lines 657, 1011, 1172, 1227). These are places where `$settings['accent_color']` or `$club_color` derived from accent_color is used for:
- Login page background/button styling
- Admin bar or other PHP-rendered styling
- Any CSS `accent-color` property

For the login page, replace the dynamic club color with a fixed brand color. Use `#0891b2` (the sRGB fallback for electric-cyan) as the fixed color for any PHP-rendered CSS that needs a brand color. This matches the electric-cyan OKLCH token from Phase 162.

c) **Remove the comment about dynamic favicon** (around lines 692-696) — the React-side favicon logic was removed in Plan 02, and this comment is now stale.

d) **Clean up the theme-color meta tag comment** (around line 681) — update to reflect fixed brand colors.

**IMPORTANT:** Be careful with `$club_settings = $club_config->get_all_settings()` calls — after Task 1 removes accent_color from ClubConfig, `$club_settings['accent_color']` would cause undefined index warnings. All references must be removed or replaced with the fixed brand color hex.
  </action>
  <verify>
Run: `cd /Users/joostdevalk/Code/rondo/rondo-club && grep -c "accent_color\|accentColor" includes/class-rest-api.php` — must return 0.
Run: `cd /Users/joostdevalk/Code/rondo/rondo-club && grep -c "accent_color\|accentColor" functions.php` — must return 0.
Run: `cd /Users/joostdevalk/Code/rondo/rondo-club && php -l includes/class-rest-api.php` — must return "No syntax errors detected".
Run: `cd /Users/joostdevalk/Code/rondo/rondo-club && php -l functions.php` — must return "No syntax errors detected".
  </verify>
  <done>REST API endpoints return no accent_color field. rondoConfig global has no accentColor. Login page uses fixed brand color (#0891b2). All PHP files pass syntax check.</done>
</task>

</tasks>

<verification>
1. `grep -c "accent" includes/class-club-config.php` returns 0
2. `grep -c "accent_color\|accentColor" includes/class-rest-api.php` returns 0
3. `grep -c "accent_color\|accentColor" functions.php` returns 0
4. All three PHP files pass `php -l` syntax check
5. `npm run build` still succeeds (no frontend breakage from backend changes)
</verification>

<success_criteria>
- ClubConfig class has no accent_color-related code
- REST API config endpoint returns {club_name, freescout_url} only
- User preferences endpoint does not accept or return accent_color
- rondoConfig JavaScript global has no accentColor property
- Login page uses fixed brand color
- All PHP files syntax-valid
</success_criteria>

<output>
After completion, create `.planning/phases/163-color-system-migration/163-03-SUMMARY.md`
</output>
