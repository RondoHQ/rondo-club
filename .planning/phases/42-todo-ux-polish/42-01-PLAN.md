---
phase: 42-todo-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/Dashboard.jsx
  - src/components/Timeline/TodoModal.jsx
  - src/components/Timeline/GlobalTodoModal.jsx
autonomous: true
---

<objective>
Improve todo interaction patterns for faster, more intuitive task management.

Purpose: Make todos easier to view and interact with from the Dashboard by opening a modal instead of navigating away, add view-first mode for notes, and set smarter due date defaults.

Output: Enhanced Dashboard todo clicking, TodoModal with view/edit modes, tomorrow as default due date.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/pages/Dashboard.jsx
@src/components/Timeline/TodoModal.jsx
@src/components/Timeline/GlobalTodoModal.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TodoModal to Dashboard for viewing/editing todos</name>
  <files>src/pages/Dashboard.jsx</files>
  <action>
  1. Add lazy import for TodoModal at the top (existing lazy pattern):
     `const TodoModal = lazy(() => import('@/components/Timeline/TodoModal'));`

  2. Add state for viewing/editing todos:
     - `const [todoToView, setTodoToView] = useState(null);`
     - `const [showTodoModal, setShowTodoModal] = useState(false);`

  3. Import useUpdateTodo hook (already imported) for updating todos from the modal.

  4. Modify TodoCard and AwaitingTodoCard components:
     - Change the outer `Link` to a `button` element with `onClick={() => onView(todo)}`
     - Keep the checkbox button with `e.stopPropagation()` for status toggling
     - Preserve all existing styling (cursor-pointer, hover states)
     - Remove the href/Link navigation behavior

  5. Update the usage of TodoCard/AwaitingTodoCard to pass `onView={handleViewTodo}`:
     ```jsx
     const handleViewTodo = (todo) => {
       setTodoToView(todo);
       setShowTodoModal(true);
     };
     ```

  6. Add handler for updating todo from modal:
     ```jsx
     const handleUpdateTodo = (data) => {
       if (!todoToView) return;
       updateTodo.mutate({
         todoId: todoToView.id,
         data,
       }, {
         onSuccess: () => {
           setShowTodoModal(false);
           setTodoToView(null);
         }
       });
     };
     ```

  7. Add TodoModal to JSX (wrapped in Suspense):
     ```jsx
     <Suspense fallback={null}>
       <TodoModal
         isOpen={showTodoModal}
         onClose={() => {
           setShowTodoModal(false);
           setTodoToView(null);
         }}
         onSubmit={handleUpdateTodo}
         isLoading={updateTodo.isPending}
         todo={todoToView}
       />
     </Suspense>
     ```

  8. Import Suspense and lazy from React at the top.
  </action>
  <verify>npm run build succeeds, clicking a todo on Dashboard opens TodoModal instead of navigating away</verify>
  <done>Dashboard todo click opens TodoModal; checkbox still toggles status with existing flow</done>
</task>

<task type="auto">
  <name>Task 2: Add view-first mode to TodoModal</name>
  <files>src/components/Timeline/TodoModal.jsx</files>
  <action>
  1. Add isViewMode state: `const [isViewMode, setIsViewMode] = useState(false);`

  2. In useEffect when `todo` exists (editing), set `setIsViewMode(true)` to start in view mode.
     When `todo` is null (creating new), set `setIsViewMode(false)`.

  3. Create a view mode layout that shows:
     - Todo content as plain text (not editable textarea)
     - Due date displayed as formatted text (e.g., "Due: Jan 16, 2026" or "No due date")
     - Notes displayed as rendered HTML (use dangerouslySetInnerHTML with the existing notes content)
     - Related people shown as avatars with names (read-only, no edit capability)
     - An "Edit" button in the footer to switch to edit mode

  4. Update the modal header to show "View todo" in view mode, "Edit todo" in edit mode, "Add todo" when creating.

  5. In view mode:
     - Hide the form submit button (Save)
     - Show only Close and Edit buttons
     - Notes section always visible if notes exist (no collapse toggle needed in view mode)

  6. In edit mode:
     - Show the existing form with all edit functionality
     - Cancel button returns to view mode if editing existing todo (not closes modal)
     - Cancel button closes modal if creating new todo
     - Save button saves and returns to view mode

  7. Update save handler: after successful save, stay in the modal but switch back to view mode.
     Pass a callback prop `onSaveSuccess` or handle in the parent to update the local todo state.
     Alternatively, just close the modal on save (simpler approach, keeps current behavior).

  8. Strip HTML tags from notes for the preview display to avoid XSS (notes are stored as HTML from RichTextEditor).
     Use a simple regex or create a stripHtmlTags utility if not already available.
     Actually, use dangerouslySetInnerHTML with sanitized content for proper rendering of formatted notes.
  </action>
  <verify>npm run lint passes, opening TodoModal with existing todo shows view mode first with rendered notes</verify>
  <done>TodoModal opens in view mode for existing todos; Edit button switches to edit mode; new todos go directly to edit mode</done>
</task>

<task type="auto">
  <name>Task 3: Change default due date to tomorrow</name>
  <files>src/components/Timeline/TodoModal.jsx, src/components/Timeline/GlobalTodoModal.jsx</files>
  <action>
  1. In TodoModal.jsx, update getTodayDate() to getTomorrowDate():
     ```jsx
     const getTomorrowDate = () => {
       const tomorrow = new Date();
       tomorrow.setDate(tomorrow.getDate() + 1);
       return tomorrow.toISOString().split('T')[0];
     };
     ```

  2. Update all references from getTodayDate() to getTomorrowDate():
     - In useEffect when creating new todo: `setDueDate(getTomorrowDate())`
     - In handleSubmit after resetting for new todo: `setDueDate(getTomorrowDate())`
     - In handleClose for new todo: `setDueDate(getTomorrowDate())`

  3. Apply the same change to GlobalTodoModal.jsx:
     - Update getTodayDate() to getTomorrowDate()
     - Update all references accordingly
  </action>
  <verify>npm run build succeeds, creating a new todo shows tomorrow's date as default</verify>
  <done>New todos default to tomorrow's date in both TodoModal and GlobalTodoModal</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes (max-warnings 0)
- [ ] Dashboard: clicking todo text/card opens TodoModal (not navigates to person)
- [ ] Dashboard: clicking checkbox still shows CompleteTodoModal for open todos
- [ ] TodoModal: existing todos open in view mode with rendered notes
- [ ] TodoModal: Edit button switches to edit mode
- [ ] TodoModal: new todos go directly to edit mode
- [ ] GlobalTodoModal: new todos default to tomorrow's date
- [ ] TodoModal: new todos default to tomorrow's date
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Todo UX improved: click to view, view-first mode, smart due date defaults
</success_criteria>

<output>
After completion, create `.planning/phases/42-todo-ux-polish/42-01-SUMMARY.md`
</output>
