# Phase 62.1: WordPress Coding Standards - Research

**Researched:** 2026-01-16
**Domain:** PHP_CodeSniffer with WordPress Coding Standards (WPCS)
**Confidence:** HIGH

<research_summary>
## Summary

Researched the WordPress Coding Standards ecosystem for enforcing PHP coding conventions in a WordPress theme. The standard approach uses PHP_CodeSniffer (phpcs) with the wp-coding-standards/wpcs package installed via Composer.

Key finding: WPCS 3.3.0 is the current stable version (Nov 2025), requires PHP 7.2+, and provides four ruleset levels: WordPress (complete), WordPress-Core, WordPress-Extra (best practices), and WordPress-Docs (documentation). The theme-specific configuration needs `is_theme=true` for proper file naming rules.

**Primary recommendation:** Install WPCS via Composer, create a `phpcs.xml.dist` configuration with `WordPress` standard (or `WordPress-Extra`), set theme-specific properties (text-domain: `stadion`, prefix: `stadion_`), then run `phpcbf` for auto-fixing followed by manual fixes for remaining issues.
</research_summary>

<standard_stack>
## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| wp-coding-standards/wpcs | ^3.3 | WordPress coding rules | Official WordPress project, 39M+ installs |
| squizlabs/php_codesniffer | ^3.13 | PHP linting framework | Industry standard, auto-installed with WPCS |
| phpcsstandards/phpcsutils | ^1.1 | Utility functions for sniffs | WPCS dependency |
| phpcsstandards/phpcsextra | ^1.5 | Additional sniffs | WPCS dependency |
| dealerdirect/phpcodesniffer-composer-installer | * | Auto-registers standards | Required for Composer integration |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| phpcompatibility/phpcompatibility-wp | ^2.1 | PHP version compatibility | If checking PHP 8.x compatibility |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| WordPress standard | WordPress-Extra | Extra includes Core + best practices, stricter |
| WordPress-Docs | None | Only needed if enforcing inline doc standards strictly |

**Installation:**
```bash
composer config allow-plugins.dealerdirect/phpcodesniffer-composer-installer true
composer require --dev wp-coding-standards/wpcs:"^3.3"
```
</standard_stack>

<architecture_patterns>
## Architecture Patterns

### Recommended Project Structure
```
stadion/
├── phpcs.xml.dist          # WPCS configuration (committed)
├── composer.json           # Dev dependency on wpcs
├── functions.php           # Theme entry point
├── includes/               # PHP classes (41 files)
│   ├── class-*.php         # WordPress-style class files
│   └── carddav/            # Subdirectory for CardDAV classes
├── tests/                  # Test files (8 files)
└── vendor/                 # Excluded from phpcs
```

### Pattern 1: phpcs.xml.dist Configuration
**What:** Project-specific coding standards configuration
**When to use:** Every WordPress theme/plugin project
**Example:**
```xml
<?xml version="1.0"?>
<ruleset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         name="Stadion Theme"
         xsi:noNamespaceSchemaLocation="https://schema.phpcodesniffer.com/phpcs.xsd">

    <description>WordPress Coding Standards for Stadion Theme</description>

    <!-- What to scan -->
    <file>.</file>

    <!-- Exclude paths -->
    <exclude-pattern>vendor/*</exclude-pattern>
    <exclude-pattern>node_modules/*</exclude-pattern>
    <exclude-pattern>dist/*</exclude-pattern>
    <exclude-pattern>tests/Support/_generated/*</exclude-pattern>

    <!-- Show progress and sniff codes -->
    <arg value="ps"/>
    <arg name="basepath" value="."/>
    <arg name="parallel" value="8"/>
    <arg name="extensions" value="php"/>

    <!-- Use WordPress-Extra (includes Core + best practices) -->
    <rule ref="WordPress-Extra">
        <!-- Exclude rules that conflict with existing patterns if needed -->
    </rule>

    <!-- Theme-specific file naming -->
    <rule ref="WordPress.Files.FileName">
        <properties>
            <property name="is_theme" value="true"/>
        </properties>
    </rule>

    <!-- Text domain for i18n -->
    <rule ref="WordPress.WP.I18n">
        <properties>
            <property name="text_domain" type="array">
                <element value="stadion"/>
            </property>
        </properties>
    </rule>

    <!-- Prefix for global functions/variables -->
    <rule ref="WordPress.NamingConventions.PrefixAllGlobals">
        <properties>
            <property name="prefixes" type="array">
                <element value="stadion_"/>
                <element value="stadion"/>
                <element value="STADION_"/>
            </property>
        </properties>
    </rule>

    <!-- Minimum WordPress version -->
    <config name="minimum_supported_wp_version" value="6.0"/>

    <!-- Test files have relaxed rules -->
    <rule ref="WordPress.NamingConventions.PrefixAllGlobals.NonPrefixedVariableFound">
        <exclude-pattern>tests/*</exclude-pattern>
    </rule>
    <rule ref="WordPress.Files.FileName">
        <exclude-pattern>tests/*</exclude-pattern>
    </rule>
</ruleset>
```

### Pattern 2: Composer Scripts
**What:** NPM-style scripts for running phpcs/phpcbf
**When to use:** Consistent developer experience
**Example:**
```json
{
    "scripts": {
        "lint": "vendor/bin/phpcs",
        "lint:fix": "vendor/bin/phpcbf"
    }
}
```

### Anti-Patterns to Avoid
- **Global PHPCS installation:** Project-local Composer is more portable
- **Ignoring all errors:** Fix issues properly, don't suppress entire categories
- **Running phpcbf without commit:** Always commit first so you can revert
</architecture_patterns>

<dont_hand_roll>
## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Coding standards checking | Custom regex/scripts | phpcs + WPCS | Battle-tested rules, community maintained |
| Auto-fixing violations | Manual find/replace | phpcbf | Consistent, reversible, handles edge cases |
| Configuration format | Custom config system | phpcs.xml.dist | Standard format, IDE integration |
| Text domain validation | Manual grep | WordPress.WP.I18n sniff | Catches edge cases, consistent |
| Prefix checking | Manual review | WordPress.NamingConventions.PrefixAllGlobals | Comprehensive, catches all globals |

**Key insight:** WPCS has 40+ sniffs covering indentation, spacing, naming, security (escaping/sanitization), documentation, and WordPress-specific patterns. Custom solutions miss edge cases and don't integrate with IDEs.
</dont_hand_roll>

<common_pitfalls>
## Common Pitfalls

### Pitfall 1: PHPCBF Cannot Fix Everything
**What goes wrong:** Running phpcbf expecting it to fix all errors, then finding 50+ manual fixes needed
**Why it happens:** Some violations require human judgment (Yoda conditions, complex array alignment, doc blocks)
**How to avoid:**
- Run phpcs first to see total count
- Run phpcbf to auto-fix what's possible
- Review git diff before committing
- Plan for manual fixes (expect 30-50% manual work)
**Warning signs:** High error count remaining after phpcbf

### Pitfall 2: Array Alignment Side Effects
**What goes wrong:** phpcbf breaks array formatting or introduces odd spacing
**Why it happens:** WordPress.Arrays.MultipleStatementAlignment has known edge cases
**How to avoid:**
- Review all array changes in diff
- Consider excluding this sniff if problematic
- Use `git checkout -- file.php` to revert specific files
**Warning signs:** Weird spacing in associative arrays after phpcbf

### Pitfall 3: Tabs vs Spaces Confusion
**What goes wrong:** Mixed indentation, partial fixes that look worse
**Why it happens:** Existing code may have precision alignment with spaces
**How to avoid:**
- Ensure IDE is set to tabs (not spaces) for PHP
- Run phpcbf in stages (one directory at a time)
- Review diffs carefully
**Warning signs:** "Spaces must be used for mid-line alignment" warnings

### Pitfall 4: Yoda Conditions Everywhere
**What goes wrong:** Code becomes hard to read with strict Yoda enforcement
**Why it happens:** WordPress requires Yoda conditions (`'value' === $var`)
**How to avoid:** Accept this is WordPress style, or selectively exclude the rule
**Warning signs:** Many "Yoda condition required" errors

### Pitfall 5: Missing Text Domain
**What goes wrong:** All __() and _e() calls flagged as errors
**Why it happens:** Text domain not configured in phpcs.xml
**How to avoid:** Always set text_domain property in configuration
**Warning signs:** "Mismatched text domain" errors on every i18n call

### Pitfall 6: Test Files Flagged
**What goes wrong:** Test classes flagged for naming, globals, etc.
**Why it happens:** Tests follow different conventions (CamelCase, no prefix)
**How to avoid:** Exclude test directories from strict rules (see pattern above)
**Warning signs:** Many errors in tests/ directory
</common_pitfalls>

<code_examples>
## Code Examples

Verified patterns from official sources:

### Running PHPCS Check
```bash
# Check all files
vendor/bin/phpcs

# Check specific file with sniff codes
vendor/bin/phpcs -ps includes/class-rest-api.php

# Show only errors (no warnings)
vendor/bin/phpcs -n
```

### Running PHPCBF Auto-Fix
```bash
# ALWAYS commit first!
git add -A && git commit -m "chore: before phpcs auto-fix"

# Auto-fix all files
vendor/bin/phpcbf

# Auto-fix specific directory
vendor/bin/phpcbf includes/

# Review changes
git diff

# If something went wrong
git checkout -- problematic-file.php
```

### Common Violation Fixes

**Yoda Conditions:**
```php
// Wrong
if ( $type === 'person' ) {

// Correct
if ( 'person' === $type ) {
```

**Array Spacing:**
```php
// Wrong
$args = array('post_type'=>'person');

// Correct
$args = array(
    'post_type' => 'person',
);
```

**Function Spacing:**
```php
// Wrong
function my_function($arg1,$arg2){

// Correct
function my_function( $arg1, $arg2 ) {
```

**Escaping Output:**
```php
// Wrong
echo $user_input;

// Correct
echo esc_html( $user_input );
```
</code_examples>

<sota_updates>
## State of the Art (2025-2026)

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| WPCS 2.x | WPCS 3.x | Aug 2023 | Major rewrite, stricter rules, better performance |
| Manual phpcs path config | Composer installer plugin | 2020+ | Auto-registration, no manual setup |
| Global phpcs install | Project-local via Composer | Best practice | Reproducible builds, version control |

**New tools/patterns to consider:**
- **WPCS 3.3.0:** Latest stable (Nov 2025), PHP 8.5 support
- **PHPCompatibilityWP:** Check code works on target PHP versions
- **Pre-commit hooks:** Enforce standards before commits

**Deprecated/outdated:**
- **WPCS 2.x:** Upgrade to 3.x, significant improvements
- **Standalone phpcs install:** Use Composer for project-local
</sota_updates>

<open_questions>
## Open Questions

Things that couldn't be fully resolved:

1. **Existing code style?**
   - What we know: Stadion has 41 PHP files + 8 test files
   - What's unclear: Current adherence level (unknown until first phpcs run)
   - Recommendation: Run initial phpcs check to baseline, expect 100-500+ errors initially

2. **Strict vs lenient approach?**
   - What we know: WordPress standard is strict, WordPress-Extra even more
   - What's unclear: User preference for strict enforcement vs pragmatic
   - Recommendation: Start with WordPress-Extra, selectively exclude problematic rules
</open_questions>

<sources>
## Sources

### Primary (HIGH confidence)
- [WordPress/WordPress-Coding-Standards](https://github.com/WordPress/WordPress-Coding-Standards) - Installation, rulesets, configuration
- [Packagist: wp-coding-standards/wpcs](https://packagist.org/packages/wp-coding-standards/wpcs) - Version 3.3.0, dependencies, requirements
- [WordPressCS 3.0.0 Release](https://make.wordpress.org/core/2023/08/21/wordpresscs-3-0-0-is-now-available/) - Upgrade guide, breaking changes

### Secondary (MEDIUM confidence)
- [Automattic/_s phpcs.xml.dist](https://github.com/Automattic/_s/blob/master/phpcs.xml.dist) - Reference theme configuration
- [WordPress Developer Blog: Namespaces and Coding Standards](https://developer.wordpress.org/news/2025/09/implementing-namespaces-and-coding-standards-in-wordpress-plugin-development/) - Best practices 2025

### Tertiary (LOW confidence - needs validation)
- Community blog posts on phpcbf limitations - Verified against GitHub issues
</sources>

<metadata>
## Metadata

**Research scope:**
- Core technology: PHP_CodeSniffer + WordPress Coding Standards
- Ecosystem: Composer, phpcs, phpcbf, IDE integration
- Patterns: Configuration, auto-fixing, CI integration
- Pitfalls: Auto-fix limitations, array alignment, test file handling

**Confidence breakdown:**
- Standard stack: HIGH - verified with Packagist, official GitHub
- Architecture: HIGH - from official sample, reference implementations
- Pitfalls: HIGH - documented in GitHub issues, verified in docs
- Code examples: HIGH - from official documentation

**Research date:** 2026-01-16
**Valid until:** 2026-02-16 (30 days - WPCS ecosystem stable)
</metadata>

---

*Phase: 62.1-wordpress-coding-standards*
*Research completed: 2026-01-16*
*Ready for planning: yes*
