---
phase: 62.1-wordpress-coding-standards
plan: 02
type: execute
wave: 2
depends_on: ["62.1-01"]
files_modified: [includes/*.php, functions.php]
autonomous: true
---

<objective>
Fix remaining WPCS violations that phpcbf could not auto-fix.

Purpose: Achieve full WPCS compliance by manually fixing remaining violations.
Output: All PHP files pass phpcs with zero errors (warnings acceptable for legacy patterns).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/62.1-wordpress-coding-standards/62.1-RESEARCH.md
@.planning/phases/62.1-wordpress-coding-standards/62.1-01-SUMMARY.md

Common manual fixes needed (from research):
- Yoda conditions: `'value' === $var` instead of `$var === 'value'`
- Array spacing: Trailing commas, proper alignment
- Function spacing: Spaces inside parentheses `function( $arg )`
- Escaping output: `esc_html()`, `esc_attr()`, etc.
- Doc blocks: Missing or incomplete PHPDoc
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix remaining WPCS violations</name>
  <files>includes/*.php, functions.php</files>
  <action>
    1. Run phpcs to get detailed error list:
       `vendor/bin/phpcs --report=full`

    2. Work through files systematically, starting with the most errors.
       Common fixes:
       - **Yoda conditions**: Change `$type === 'person'` to `'person' === $type`
       - **Spacing**: Add spaces inside function calls `function( $arg )`
       - **Array formatting**: Ensure trailing commas, proper indentation
       - **Escaping**: Add `esc_html()`, `esc_attr()`, `wp_kses_post()` where needed
       - **Doc blocks**: Add missing `@param`, `@return` annotations

    3. After each file or group of files, verify with:
       `vendor/bin/phpcs path/to/file.php`

    4. Commit in logical groups (e.g., per directory or per violation type):
       `git add includes/class-access-control.php && git commit -m "style(62.1): fix WPCS violations in class-access-control"`

    Note: Focus on ERRORS first. Warnings can be addressed later or excluded via phpcs.xml.dist if they conflict with project patterns.
  </action>
  <verify>
    - `vendor/bin/phpcs -n` returns 0 errors
    - All changes committed to git
  </verify>
  <done>
    - All PHPCS errors fixed
    - Zero errors reported by `vendor/bin/phpcs -n`
  </done>
</task>

<task type="auto">
  <name>Task 2: Update phpcs.xml.dist to exclude acceptable warnings</name>
  <files>phpcs.xml.dist</files>
  <action>
    If there are warnings that cannot be reasonably fixed (e.g., inline doc standards for one-liner functions, or legacy patterns that would require significant refactoring):

    1. Review remaining warnings: `vendor/bin/phpcs --report=summary`

    2. For warnings that should be excluded project-wide, add rule exclusions to phpcs.xml.dist:
       ```xml
       <rule ref="WordPress-Extra">
           <exclude name="Specific.Sniff.Name"/>
       </rule>
       ```

    3. Document why each exclusion exists as an XML comment.

    4. If no exclusions needed, skip this step.

    5. Commit any phpcs.xml.dist changes:
       `git add phpcs.xml.dist && git commit -m "style(62.1): configure phpcs exclusions"`
  </action>
  <verify>
    - phpcs.xml.dist is valid
    - Any exclusions are documented with comments
  </verify>
  <done>
    - phpcs.xml.dist finalized
    - Any necessary exclusions documented
  </done>
</task>

<task type="auto">
  <name>Task 3: Final verification and documentation</name>
  <files>README.md</files>
  <action>
    1. Run final phpcs check:
       `vendor/bin/phpcs --report=summary`
       Should show 0 errors (warnings acceptable if documented).

    2. Run npm lint to ensure React code still passes:
       `npm run lint`

    3. Add coding standards section to README.md (in Development section):
       ```markdown
       ## Coding Standards

       PHP code follows WordPress Coding Standards (WPCS).

       ```bash
       # Check for violations
       npm run lint        # JavaScript (ESLint)
       composer lint       # PHP (PHPCS)

       # Auto-fix violations
       composer lint:fix   # PHP (PHPCBF)
       ```
       ```

    4. Commit documentation update:
       `git add README.md && git commit -m "docs(62.1): add coding standards to README"`
  </action>
  <verify>
    - `vendor/bin/phpcs -n` returns 0 errors
    - `npm run lint` passes
    - README.md includes coding standards section
  </verify>
  <done>
    - Full WPCS compliance achieved
    - Both JS and PHP linting documented
    - All changes committed
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `vendor/bin/phpcs -n` returns 0 errors
- [ ] `npm run lint` passes
- [ ] All manual fixes committed
- [ ] phpcs.xml.dist exclusions documented (if any)
- [ ] README.md updated with coding standards info
</verification>

<success_criteria>

- Zero PHPCS errors (`vendor/bin/phpcs -n` clean)
- All PHP files WPCS compliant
- Coding standards documented in README.md
- Composer scripts work (`composer lint`, `composer lint:fix`)
</success_criteria>

<output>
After completion, create `.planning/phases/62.1-wordpress-coding-standards/62.1-02-SUMMARY.md`

Document:
- Total files fixed manually
- Most common violation types encountered
- Any exclusions added to phpcs.xml.dist (with rationale)
- Final error/warning counts
</output>
