---
phase: 62.1-wordpress-coding-standards
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [composer.json, phpcs.xml.dist, includes/*.php, functions.php]
autonomous: true
---

<objective>
Install WordPress Coding Standards (WPCS) tooling and run automated fixes on the codebase.

Purpose: Establish phpcs/phpcbf infrastructure and auto-fix as many coding standard violations as possible.
Output: WPCS installed, phpcs.xml.dist configured, phpcbf auto-fixes applied to all PHP files.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/62.1-wordpress-coding-standards/62.1-RESEARCH.md

Codebase has 54 PHP files:
- includes/ directory with class-*.php files
- includes/carddav/ subdirectory
- tests/ directory with PHPUnit tests
- functions.php entry point

Key project prefixes:
- Class prefix: RONDO_
- Function prefix: stadion_
- Text domain: stadion
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install WPCS via Composer</name>
  <files>composer.json</files>
  <action>
    1. Configure Composer to allow the phpcodesniffer-composer-installer plugin:
       `composer config allow-plugins.dealerdirect/phpcodesniffer-composer-installer true`
    2. Install WPCS as dev dependency:
       `composer require --dev wp-coding-standards/wpcs:"^3.3"`
    3. Verify installation:
       `vendor/bin/phpcs -i` should show WordPress standards registered
    4. Add Composer scripts for convenience:
       - "lint": "vendor/bin/phpcs"
       - "lint:fix": "vendor/bin/phpcbf"
  </action>
  <verify>
    - vendor/bin/phpcs -i shows "WordPress", "WordPress-Core", "WordPress-Extra"
    - composer.json has wp-coding-standards/wpcs in require-dev
    - composer.json has lint and lint:fix scripts
  </verify>
  <done>WPCS installed, Composer scripts configured, phpcs recognizes WordPress standards</done>
</task>

<task type="auto">
  <name>Task 2: Create phpcs.xml.dist configuration</name>
  <files>phpcs.xml.dist</files>
  <action>
    Create phpcs.xml.dist with WordPress-Extra standard and project-specific settings:
    - Standard: WordPress-Extra (includes Core + best practices)
    - Scan: . (current directory)
    - Exclude: vendor/*, node_modules/*, dist/*, tests/Support/_generated/*
    - Theme mode: is_theme=true for proper file naming
    - Text domain: stadion
    - Prefixes: stadion_, stadion, RONDO_
    - Minimum WP version: 6.0
    - Relaxed rules for tests/ directory (naming, globals)
    - Parallel: 8 threads for speed
    - Extensions: php only

    Use the exact configuration from 62.1-RESEARCH.md Pattern 1.
  </action>
  <verify>
    - phpcs.xml.dist exists in project root
    - vendor/bin/phpcs runs without "no standard" error
    - vendor/bin/phpcs --standard=phpcs.xml.dist -e lists expected sniffs
  </verify>
  <done>phpcs.xml.dist configured with WordPress-Extra standard and project-specific rules</done>
</task>

<task type="auto">
  <name>Task 3: Run baseline check and phpcbf auto-fix</name>
  <files>includes/*.php, functions.php, tests/*.php</files>
  <action>
    1. First, commit current state so we can revert if needed:
       `git add -A && git commit -m "chore(62.1): before phpcs auto-fix"`

    2. Run baseline phpcs check to capture initial error count:
       `vendor/bin/phpcs --report=summary 2>&1 | tee /tmp/phpcs-before.txt`
       Record the error and warning counts.

    3. Run phpcbf to auto-fix violations:
       `vendor/bin/phpcbf`
       This will modify files in place.

    4. Run phpcs again to see remaining issues:
       `vendor/bin/phpcs --report=summary 2>&1 | tee /tmp/phpcs-after.txt`
       Record the remaining error and warning counts.

    5. Review git diff for any problematic changes (especially array alignment).
       If any files have broken formatting, revert them: `git checkout -- file.php`

    6. Commit the auto-fixes:
       `git add -A && git commit -m "style(62.1): apply phpcbf auto-fixes"`
  </action>
  <verify>
    - phpcs-after.txt shows fewer errors than phpcs-before.txt
    - Git history shows two commits (before + auto-fix)
    - Code still functions (basic sanity: vendor/bin/phpcs -i still works)
  </verify>
  <done>
    - Initial error count recorded
    - phpcbf auto-fixes applied and committed
    - Remaining error count recorded for Plan 02
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] vendor/bin/phpcs -i shows WordPress standards
- [ ] phpcs.xml.dist exists and is valid
- [ ] Composer scripts (lint, lint:fix) work
- [ ] phpcbf auto-fixes committed
- [ ] Remaining error count documented for next plan
</verification>

<success_criteria>

- WPCS ^3.3 installed as dev dependency
- phpcs.xml.dist configured with project-specific settings
- phpcbf auto-fixes applied (expect 50-70% reduction in errors)
- All changes committed to git
- Remaining error count known for Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/62.1-wordpress-coding-standards/62.1-01-SUMMARY.md`

Document:
- Initial error/warning count from baseline
- Error/warning count after phpcbf
- Percentage reduction
- Number of files modified by phpcbf
- Any files that needed manual revert
</output>
