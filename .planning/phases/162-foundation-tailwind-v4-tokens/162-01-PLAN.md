---
phase: 162-foundation-tailwind-v4-tokens
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - vite.config.js
  - src/index.css
  - src/main.jsx
  - tailwind.config.js
  - postcss.config.js
autonomous: true

must_haves:
  truths:
    - "Tailwind CSS v4 build succeeds and produces valid CSS output"
    - "Brand color tokens (electric-cyan, electric-cyan-light, bright-cobalt, deep-midnight, obsidian) generate working utility classes"
    - "Montserrat font loads for heading elements at weights 600 and 700"
    - "bg-brand-gradient class applies a cyan-to-cobalt linear gradient"
    - "Dark mode (class-based) continues to work with existing dark: utility classes"
    - "Existing accent color system continues to function (not removed until Phase 163)"
  artifacts:
    - path: "src/index.css"
      provides: "CSS-first Tailwind v4 configuration with @theme, @custom-variant, @plugin, @utility"
      contains: "@import \"tailwindcss\""
    - path: "vite.config.js"
      provides: "Vite config with @tailwindcss/vite plugin"
      contains: "@tailwindcss/vite"
    - path: "src/main.jsx"
      provides: "Montserrat font imports"
      contains: "@fontsource/montserrat"
    - path: "package.json"
      provides: "Updated dependencies with tailwindcss v4 and @tailwindcss/vite"
  key_links:
    - from: "vite.config.js"
      to: "@tailwindcss/vite"
      via: "Vite plugin registration"
      pattern: "tailwindcss\\(\\)"
    - from: "src/index.css"
      to: "tailwindcss"
      via: "@import directive"
      pattern: "@import.*tailwindcss"
    - from: "src/index.css"
      to: "brand tokens"
      via: "@theme block with --color-* variables"
      pattern: "--color-electric-cyan"
    - from: "src/main.jsx"
      to: "Montserrat font files"
      via: "Fontsource CSS imports"
      pattern: "@fontsource/montserrat"
---

<objective>
Migrate from Tailwind CSS v3.4 to v4 with CSS-first configuration, define brand color tokens, load Montserrat font, and create gradient utility.

Purpose: Establish the design foundation for v22.0 Design Refresh. All subsequent phases (163-165) depend on Tailwind v4 being operational with brand tokens available.

Output: Working Tailwind v4 build with brand color tokens, Montserrat font, and gradient utility ready for use in components.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/162-foundation-tailwind-v4-tokens/162-RESEARCH.md

@vite.config.js
@tailwind.config.js
@postcss.config.js
@src/index.css
@src/main.jsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Tailwind CSS v3.4 to v4 with Vite plugin</name>
  <files>package.json, vite.config.js, src/index.css, tailwind.config.js, postcss.config.js</files>
  <action>
    **Step 1: Install Tailwind v4 packages and remove obsolete ones**

    ```bash
    cd /Users/joostdevalk/Code/rondo/rondo-club
    npm install tailwindcss@latest @tailwindcss/vite@latest @tailwindcss/typography@latest
    npm uninstall autoprefixer postcss
    ```

    Note: PostCSS is no longer needed as a direct dependency — Tailwind v4 handles CSS processing internally via the Vite plugin. The `postcss` and `autoprefixer` packages in devDependencies should be removed.

    **Step 2: Run the official Tailwind upgrade tool**

    ```bash
    npx @tailwindcss/upgrade
    ```

    This tool will attempt to:
    - Convert `@tailwind base/components/utilities` to `@import "tailwindcss"`
    - Migrate shadow/radius scale names (shadow-sm → shadow-xs, etc.)
    - Convert `!important` modifier positions (!flex → flex!)
    - Add explicit border colors where v4 defaults changed
    - Convert `outline-none` to `outline-hidden`

    Review what it changed. If it modifies JSX files, review those changes carefully. The tool may also attempt to create a CSS-based config — review and adjust as needed.

    **Step 3: Update vite.config.js**

    Add the `@tailwindcss/vite` plugin. Import it and add to the plugins array BEFORE the react() plugin:

    ```javascript
    import tailwindcss from '@tailwindcss/vite';

    // In plugins array:
    plugins: [
      tailwindcss(),
      react(),
      // ... VitePWA config stays the same
    ],
    ```

    **Step 4: Update src/index.css for v4 CSS-first configuration**

    Replace the top of index.css. The file should start with:

    ```css
    @import "tailwindcss";

    /* Enable class-based dark mode (v4 defaults to prefers-color-scheme) */
    @custom-variant dark (&:where(.dark, .dark *));

    /* Typography plugin */
    @plugin "@tailwindcss/typography";
    ```

    Remove the old `@tailwind base; @tailwind components; @tailwind utilities;` directives (the upgrade tool may have already done this).

    The existing accent color system (the CSS custom properties in `@layer base` with `:root`, `[data-accent="..."]`, and `.dark` variants) MUST be preserved as-is. It will be removed in Phase 163. If the upgrade tool modified these `theme()` function calls, verify they still work. In v4, `theme()` references like `theme('colors.orange.50')` should be converted to `var(--color-orange-50)` or the v4 equivalent — the upgrade tool handles this.

    The existing `@layer components` block (btn, btn-primary, etc.) and timeline-content styles should also be preserved. If the upgrade tool modified class names in these blocks (e.g., shadow-sm → shadow-xs), that is correct — accept those changes.

    **Step 5: Delete obsolete configuration files**

    Delete `tailwind.config.js` — all configuration is now in CSS via `@theme` blocks in index.css.

    Delete `postcss.config.js` — PostCSS is no longer needed; Tailwind v4 Vite plugin handles everything.

    **Step 6: Verify the build**

    ```bash
    npm run build
    ```

    The build must succeed with no errors. Warnings about deprecated syntax are acceptable if the upgrade tool missed some conversions — fix any remaining issues.

    Also run:
    ```bash
    npm run lint
    ```

    Fix any lint errors introduced by the upgrade tool's JSX changes.
  </action>
  <verify>
    1. `npm run build` completes successfully (exit code 0)
    2. `npm run lint` passes with 0 warnings
    3. `tailwind.config.js` no longer exists
    4. `postcss.config.js` no longer exists
    5. `src/index.css` starts with `@import "tailwindcss"` (not `@tailwind` directives)
    6. `src/index.css` contains `@custom-variant dark`
    7. `src/index.css` contains `@plugin "@tailwindcss/typography"`
    8. `vite.config.js` imports and uses `@tailwindcss/vite`
    9. `dist/` folder contains generated CSS with Tailwind utilities
  </verify>
  <done>Tailwind v4 build pipeline is operational. CSS-first configuration replaces JS config. Dark mode, typography plugin, and existing accent color system all continue to function. Old config files are deleted.</done>
</task>

<task type="auto">
  <name>Task 2: Define brand tokens, load Montserrat font, create gradient utility</name>
  <files>src/index.css, src/main.jsx, package.json</files>
  <action>
    **Step 1: Install Montserrat font**

    ```bash
    cd /Users/joostdevalk/Code/rondo/rondo-club
    npm install @fontsource/montserrat
    ```

    **Step 2: Import Montserrat in main.jsx**

    Add these imports near the top of `src/main.jsx`, before the `./index.css` import:

    ```javascript
    import '@fontsource/montserrat/600.css';  // Semi-bold for headings
    import '@fontsource/montserrat/700.css';  // Bold for headings
    ```

    **Step 3: Add brand tokens to @theme block in src/index.css**

    Add a `@theme` block after the `@plugin` directive and before any `@layer` or `@utility` blocks:

    ```css
    @theme {
      /* Brand colors (OKLCH for wider P3 gamut) */
      --color-electric-cyan: oklch(0.69 0.14 196);
      --color-electric-cyan-light: oklch(0.79 0.14 196);
      --color-bright-cobalt: oklch(0.55 0.19 264);
      --color-deep-midnight: oklch(0.35 0.12 264);
      --color-obsidian: oklch(0.16 0.02 264);

      /* Typography */
      --font-display: "Montserrat", sans-serif;
    }
    ```

    These hex equivalents are documented for reference:
    - electric-cyan: #0891B2
    - electric-cyan-light: #22D3EE
    - bright-cobalt: #2563EB
    - deep-midnight: #1E3A8A
    - obsidian: #0F172A

    Note: Do NOT add `--font-body` or override the default sans font. The existing Inter font configuration should be preserved from the v3 migration (the upgrade tool may have converted the `fontFamily.sans` from tailwind.config.js into a `--font-sans` in the @theme block).

    **Step 4: Add gradient utility**

    Add after the `@theme` block:

    ```css
    @utility bg-brand-gradient {
      background: linear-gradient(135deg, var(--color-electric-cyan), var(--color-bright-cobalt));
    }
    ```

    **Step 5: Add heading font-family rule**

    Inside the existing `@layer base` block, add a rule to apply Montserrat to headings:

    ```css
    h1, h2, h3, h4, h5, h6 {
      font-family: var(--font-display);
    }
    ```

    **Step 6: Verify tokens generate utility classes**

    Run the build:
    ```bash
    npm run build
    ```

    After build, verify the generated CSS contains the brand color utilities by checking the dist output:
    ```bash
    grep -l "electric-cyan" dist/assets/*.css
    ```

    This confirms the @theme tokens are being picked up and generating utility classes like `bg-electric-cyan`, `text-electric-cyan`, `border-electric-cyan`, etc.

    **Step 7: Verify Montserrat font files are bundled**

    ```bash
    ls dist/assets/ | grep -i montserrat
    ```

    Font files (.woff2) should be present in the build output.
  </action>
  <verify>
    1. `npm run build` completes successfully
    2. Generated CSS in `dist/assets/*.css` contains `electric-cyan` color definitions
    3. Generated CSS contains `bg-brand-gradient` utility
    4. Montserrat .woff2 font files exist in `dist/assets/`
    5. `src/index.css` contains `@theme` block with all 5 brand color tokens
    6. `src/index.css` contains `@utility bg-brand-gradient`
    7. `src/index.css` contains heading font-family rule using `--font-display`
    8. `src/main.jsx` imports `@fontsource/montserrat/600.css` and `@fontsource/montserrat/700.css`
  </verify>
  <done>Brand color tokens are defined and generate Tailwind utility classes (bg-electric-cyan, text-bright-cobalt, etc.). Montserrat font loads for headings at weights 600/700. bg-brand-gradient utility applies a 135-degree cyan-to-cobalt linear gradient. All tokens are ready for use in subsequent phases.</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Build check:** `npm run build` succeeds (exit 0)
2. **Lint check:** `npm run lint` passes (0 warnings)
3. **Config cleanup:** `tailwind.config.js` and `postcss.config.js` do not exist
4. **CSS-first:** `src/index.css` uses `@import "tailwindcss"`, `@theme`, `@custom-variant`, `@plugin`, `@utility`
5. **Brand tokens:** CSS output contains electric-cyan, electric-cyan-light, bright-cobalt, deep-midnight, obsidian color utilities
6. **Gradient:** CSS output contains bg-brand-gradient utility
7. **Font:** Montserrat .woff2 files in `dist/assets/`, heading elements have font-family rule
8. **Dark mode:** `@custom-variant dark` is configured for class-based strategy
9. **Backward compat:** Existing accent-* color system and component classes (btn, card, input) still present in CSS output
10. **Dev server:** `npm run dev` starts without errors (quick check, Ctrl+C after startup)
</verification>

<success_criteria>
- Tailwind CSS v4 build succeeds with @theme configuration in index.css
- Brand color tokens (electric-cyan, bright-cobalt, deep-midnight, obsidian) are defined and accessible via Tailwind classes
- Montserrat font loads for heading elements with weights 600 and 700
- Cyan-to-cobalt gradient utility works as bg-brand-gradient class
- All existing functionality preserved (dark mode, accent colors, component classes)
</success_criteria>

<output>
After completion, create `.planning/phases/162-foundation-tailwind-v4-tokens/162-01-SUMMARY.md`
</output>
