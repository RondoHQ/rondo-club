---
phase: 97-frontend-submission
plan: 02
type: execute
wave: 2
depends_on: [97-01]
files_modified:
  - src/pages/Feedback/FeedbackList.jsx
  - src/pages/Feedback/FeedbackDetail.jsx
  - src/components/FeedbackModal.jsx
autonomous: true

must_haves:
  truths:
    - "User can view list of their submitted feedback"
    - "User can filter feedback by type (Bug/Feature) and status"
    - "User can submit new feedback with type-specific fields"
    - "User can view feedback detail with all fields displayed"
    - "User can attach screenshots via drag-and-drop upload"
    - "User can opt-in to include system info (browser, version, URL)"
  artifacts:
    - path: "src/pages/Feedback/FeedbackList.jsx"
      provides: "List view with filtering and submission modal"
      min_lines: 100
    - path: "src/pages/Feedback/FeedbackDetail.jsx"
      provides: "Detail view showing all feedback fields"
      min_lines: 50
    - path: "src/components/FeedbackModal.jsx"
      provides: "Submission form with conditional fields and file upload"
      min_lines: 150
  key_links:
    - from: "src/pages/Feedback/FeedbackList.jsx"
      to: "src/hooks/useFeedback.js"
      via: "useFeedbackList import"
      pattern: "useFeedbackList"
    - from: "src/pages/Feedback/FeedbackList.jsx"
      to: "src/components/FeedbackModal.jsx"
      via: "FeedbackModal import"
      pattern: "FeedbackModal"
    - from: "src/components/FeedbackModal.jsx"
      to: "src/api/client.js"
      via: "wpApi.uploadMedia for attachments"
      pattern: "wpApi\\.uploadMedia"
---

<objective>
Create the feedback UI components: list page with filtering, detail page, and submission modal with conditional fields.

Purpose: Deliver the user-facing feedback submission experience. Users can report bugs and request features from within Stadion.
Output: FeedbackList.jsx with type/status filters, FeedbackDetail.jsx for viewing, FeedbackModal.jsx with conditional bug/feature fields, system info capture, and file attachments.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v6.1-feedback-system/ROADMAP.md
@.planning/STATE.md
@.planning/phases/97-frontend-submission/97-RESEARCH.md

# Prior plan - API and hooks are ready
# Note: Reference 97-01-SUMMARY.md after Plan 01 completes

# Existing patterns to follow
@src/pages/Todos/TodosList.jsx
@src/pages/Dates/DatesList.jsx
@src/components/PersonEditModal.jsx
@src/components/ImportantDateModal.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FeedbackList.jsx with filtering</name>
  <files>src/pages/Feedback/FeedbackList.jsx</files>
  <action>
Create src/pages/Feedback/FeedbackList.jsx following TodosList.jsx pattern.

**Structure:**
1. Import statements:
   - useState from react
   - Link from react-router-dom
   - Icons from lucide-react: MessageSquare, Bug, Lightbulb, Plus, Clock
   - useFeedbackList, useCreateFeedback from @/hooks/useFeedback
   - useDocumentTitle from @/hooks/useDocumentTitle
   - format from date-fns
   - FeedbackModal from @/components/FeedbackModal

2. Component state:
   - `typeFilter` - '' | 'bug' | 'feature_request'
   - `statusFilter` - '' | 'new' | 'in_progress' | 'resolved' | 'declined'
   - `showModal` - boolean for submission modal

3. Data fetching:
   ```javascript
   const { data: feedback, isLoading, error } = useFeedbackList({
     type: typeFilter || undefined,
     status: statusFilter || undefined,
   });
   const createFeedback = useCreateFeedback();
   ```

4. Badge components (inline or extracted):
   ```javascript
   const statusColors = {
     new: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400',
     in_progress: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400',
     resolved: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400',
     declined: 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-400',
   };
   const typeColors = {
     bug: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400',
     feature_request: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400',
   };
   ```

5. UI sections:
   - Header with title and "Submit Feedback" button
   - Filter controls (type filter + status filter button groups, like TodosList)
   - Loading state (spinner)
   - Error state
   - Empty state with icon and "Submit feedback" button
   - Feedback list (card with items)

6. List item structure (for each feedback):
   - Link to /feedback/{id}
   - Type badge (Bug/Feature Request with color)
   - Title
   - Status badge
   - Created date (format: 'MMM d, yyyy')

7. Submit handler:
   ```javascript
   const handleSubmit = async (data) => {
     await createFeedback.mutateAsync(data);
     setShowModal(false);
   };
   ```

Follow the established card styling pattern and dark mode support.
  </action>
  <verify>Run `npm run lint` - no errors in FeedbackList.jsx</verify>
  <done>FeedbackList.jsx displays feedback with type/status filtering and submission modal trigger</done>
</task>

<task type="auto">
  <name>Task 2: Create FeedbackDetail.jsx</name>
  <files>src/pages/Feedback/FeedbackDetail.jsx</files>
  <action>
Create src/pages/Feedback/FeedbackDetail.jsx following PersonDetail.jsx pattern for detail views.

**Structure:**
1. Import statements:
   - useParams, Link from react-router-dom
   - Icons from lucide-react: ArrowLeft, Bug, Lightbulb, Clock, User, Monitor, Link as LinkIcon, Paperclip
   - useFeedback from @/hooks/useFeedback
   - useDocumentTitle from @/hooks/useDocumentTitle
   - format from date-fns

2. Component:
   ```javascript
   export default function FeedbackDetail() {
     const { id } = useParams();
     const { data: feedback, isLoading, error } = useFeedback(id);
     useDocumentTitle(feedback?.title || 'Feedback');
   ```

3. Loading/error states (same pattern as other detail pages)

4. Content sections:
   - Back link to /feedback
   - Header with title, type badge, status badge
   - Description section (content field)
   - Conditional bug fields section (if type === 'bug'):
     - Steps to reproduce
     - Expected behavior
     - Actual behavior
   - Conditional feature field section (if type === 'feature_request'):
     - Use case
   - System info section (if browser_info or app_version or url_context present):
     - Browser info
     - App version
     - URL context
   - Attachments section (if attachments array has items):
     - Display as clickable images/thumbnails
   - Metadata footer:
     - Submitted by (author name)
     - Submitted on (created date)
     - Last updated (modified date)

5. Use same badge colors as FeedbackList for consistency.

6. Handle read-only display - no edit functionality needed in this plan (admin edit is Phase 98).
  </action>
  <verify>Run `npm run lint` - no errors in FeedbackDetail.jsx</verify>
  <done>FeedbackDetail.jsx displays all feedback fields including conditional and system info sections</done>
</task>

<task type="auto">
  <name>Task 3: Create FeedbackModal.jsx with conditional fields and attachments</name>
  <files>src/components/FeedbackModal.jsx</files>
  <action>
Create src/components/FeedbackModal.jsx following PersonEditModal.jsx pattern.

**Structure:**
1. Import statements:
   - useState, useEffect, useCallback from react
   - useForm from react-hook-form
   - X, Upload, Trash2 from lucide-react
   - wpApi from @/api/client

2. Props:
   ```javascript
   export default function FeedbackModal({
     isOpen,
     onClose,
     onSubmit,
     isLoading,
   }) {
   ```

3. Form setup with react-hook-form:
   ```javascript
   const { register, handleSubmit, watch, reset, formState: { errors } } = useForm({
     defaultValues: {
       title: '',
       content: '',
       feedback_type: 'bug',
       steps_to_reproduce: '',
       expected_behavior: '',
       actual_behavior: '',
       use_case: '',
       include_system_info: false,
     },
   });
   const feedbackType = watch('feedback_type');
   ```

4. Attachment state:
   ```javascript
   const [attachments, setAttachments] = useState([]);
   const [isUploading, setIsUploading] = useState(false);
   const [dragActive, setDragActive] = useState(false);
   ```

5. Reset form on open:
   ```javascript
   useEffect(() => {
     if (isOpen) {
       reset();
       setAttachments([]);
     }
   }, [isOpen, reset]);
   ```

6. File upload handlers (following PersonEditModal pattern):
   ```javascript
   const handleFileUpload = async (files) => {
     setIsUploading(true);
     try {
       const newAttachments = [];
       for (const file of files) {
         const response = await wpApi.uploadMedia(file);
         newAttachments.push({
           id: response.data.id,
           url: response.data.source_url,
           thumbnail: response.data.media_details?.sizes?.thumbnail?.source_url || response.data.source_url,
           title: file.name,
         });
       }
       setAttachments(prev => [...prev, ...newAttachments]);
     } catch (error) {
       console.error('Upload failed:', error);
     } finally {
       setIsUploading(false);
     }
   };
   ```

7. Drag and drop handlers (handleDrag, handleDrop following PersonEditModal)

8. Submit handler that captures system info if opted in:
   ```javascript
   const handleFormSubmit = (data) => {
     const submitData = {
       title: data.title,
       content: data.content,
       feedback_type: data.feedback_type,
       attachments: attachments.map(a => a.id),
     };

     // Add type-specific fields
     if (data.feedback_type === 'bug') {
       submitData.steps_to_reproduce = data.steps_to_reproduce;
       submitData.expected_behavior = data.expected_behavior;
       submitData.actual_behavior = data.actual_behavior;
     } else if (data.feedback_type === 'feature_request') {
       submitData.use_case = data.use_case;
     }

     // Capture system info if opted in
     if (data.include_system_info) {
       submitData.browser_info = navigator.userAgent;
       submitData.app_version = window.stadionConfig?.version || 'unknown';
       submitData.url_context = window.location.href;
     }

     onSubmit(submitData);
   };
   ```

9. Modal UI structure:
   - Fixed backdrop with blur
   - Modal container (max-w-lg)
   - Header with title and close button
   - Form with fields:
     - Title (required, text input)
     - Type (radio buttons: Bug Report / Feature Request)
     - Description (required, textarea)
     - Conditional bug fields (when type === 'bug'):
       - Steps to reproduce (textarea)
       - Expected behavior (textarea)
       - Actual behavior (textarea)
     - Conditional feature field (when type === 'feature_request'):
       - Use case (textarea)
     - Attachments section:
       - Drag-and-drop zone with file input
       - Display uploaded attachments with remove button
       - Show spinner during upload
     - System info checkbox:
       - "Include system information (browser, app version, current URL)"
   - Footer with Cancel and Submit buttons

10. Styling: Use existing Tailwind classes matching other modals (input, label, btn-primary patterns)
  </action>
  <verify>Run `npm run lint` - no errors in FeedbackModal.jsx</verify>
  <done>FeedbackModal.jsx has conditional fields for bug/feature, system info capture checkbox, and drag-and-drop file attachments</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm run lint` passes with no errors
2. `npm run build` succeeds
3. Navigate to /feedback - see list page with filter controls
4. Click "Submit Feedback" - modal opens with type selection
5. Select "Bug Report" - bug-specific fields appear
6. Select "Feature Request" - use case field appears
7. Check "Include system information" - should be stored on submit
8. Drag image onto upload zone - shows thumbnail preview
9. Submit feedback - appears in list
10. Click feedback item - navigates to detail page showing all fields
</verification>

<success_criteria>
- FeedbackList shows feedback with type/status badges
- Type and status filters work correctly
- FeedbackModal shows conditional fields based on type selection
- File upload works with drag-and-drop
- System info checkbox captures browser/version/URL when checked
- FeedbackDetail displays all fields including attachments
- All components follow existing styling patterns
</success_criteria>

<output>
After completion, create `.planning/phases/97-frontend-submission/97-02-SUMMARY.md`
</output>
