---
phase: 115-column-preferences-ui
plan: 02
type: execute
wave: 2
depends_on: ["115-01"]
files_modified:
  - src/pages/People/ColumnSettingsModal.jsx
autonomous: true

must_haves:
  truths:
    - "User can toggle column visibility via checkboxes"
    - "User can reorder columns via drag-and-drop"
    - "Name column is always visible and always first (not in sortable list)"
    - "Changes apply instantly (no save button)"
    - "Reset to defaults link restores default columns"
  artifacts:
    - path: "src/pages/People/ColumnSettingsModal.jsx"
      provides: "Modal component for column show/hide and reorder"
      min_lines: 150
  key_links:
    - from: "src/pages/People/ColumnSettingsModal.jsx"
      to: "useListPreferences hook"
      via: "import useListPreferences"
      pattern: "useListPreferences"
    - from: "src/pages/People/ColumnSettingsModal.jsx"
      to: "dnd-kit"
      via: "DndContext, SortableContext"
      pattern: "DndContext"
---

<objective>
Create the Column Settings Modal component for column visibility and reorder.

Purpose: Users need a UI to customize which columns appear in the People list and in what order. This modal provides checkboxes for visibility and drag-and-drop for reordering, following the patterns established in CustomFields.jsx.

Output: ColumnSettingsModal.jsx component
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/115-column-preferences-ui/115-CONTEXT.md
@.planning/phases/115-column-preferences-ui/115-RESEARCH.md
@.planning/phases/115-column-preferences-ui/115-01-SUMMARY.md
@src/pages/Settings/CustomFields.jsx
@src/pages/People/PeopleList.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ColumnSettingsModal component</name>
  <files>src/pages/People/ColumnSettingsModal.jsx</files>
  <action>
Create the Column Settings Modal at src/pages/People/ColumnSettingsModal.jsx following the patterns from CustomFields.jsx (dnd-kit) and BulkOrganizationModal (modal structure).

Component requirements:

1. **Props:**
   - isOpen: boolean
   - onClose: () => void

2. **Modal structure (follow BulkOrganizationModal pattern):**
   - Fixed backdrop with centered modal
   - Header: "Kolommen aanpassen" with Settings icon and close button
   - Body: Scrollable list of columns with drag handles and checkboxes
   - Footer: "Standaardinstellingen herstellen" link (left) and "Sluiten" button (right)

3. **Column list:**
   - Use dnd-kit (DndContext, SortableContext, useSortable) following CustomFields.jsx pattern
   - verticalListSortingStrategy
   - Each column item shows: drag handle (GripVertical), checkbox, column label
   - Name column NOT in sortable list (it's always first, not draggable)
   - Custom fields show "(aangepast veld)" badge after label
   - Sensors: PointerSensor with distance: 8, TouchSensor with delay: 200

4. **SortableColumnItem subcomponent:**
   - Uses useSortable hook for drag-and-drop
   - CSS.Transform for drag animation
   - Disabled checkbox for name column (if somehow included)
   - Shows isDragging state with higher z-index and shadow

5. **State management:**
   - Use useListPreferences hook from Plan 01
   - Local state for column order (initialized from preferences.column_order or preferences.available_columns)
   - On checkbox toggle: update preferences.visible_columns immediately
   - On drag end: update local order, then update preferences.visible_columns with new order

6. **Instant apply (no save button):**
   - Every checkbox change calls updatePreferences immediately
   - Every reorder calls updatePreferences immediately
   - Hook handles optimistic updates for instant feedback

7. **Reset functionality:**
   - "Standaardinstellingen herstellen" link calls updatePreferences({ reset: true })

8. **Close behaviors:**
   - Close button in header
   - ESC key (useEffect with event listener)
   - Click outside modal (backdrop click handler)

9. **Styling:**
   - Match existing modal patterns (dark mode support)
   - Column items: p-3 rounded-lg border-2 bg-white dark:bg-gray-800
   - Drag handle: text-gray-400, cursor-grab
   - Checkbox: standard form checkbox styling
   - Loading state: spinner while preferences loading

Dutch labels:
- Title: "Kolommen aanpassen"
- Instructions: "Sleep om te herordenen, vink aan om te tonen."
- Reset link: "Standaardinstellingen herstellen"
- Close button: "Sluiten"
- Custom field badge: "(aangepast veld)"
  </action>
  <verify>
After npm run build:
1. Import component in a test: component file exists and is valid JSX
2. No ESLint errors: npm run lint -- src/pages/People/ColumnSettingsModal.jsx
3. Component uses dnd-kit imports correctly
4. Component uses useListPreferences hook
  </verify>
  <done>
- ColumnSettingsModal.jsx created at src/pages/People/
- Component receives isOpen and onClose props
- Uses dnd-kit for drag-and-drop reordering
- Uses useListPreferences hook for state management
- Checkboxes toggle column visibility with instant apply
- Drag-and-drop reorders columns with instant apply
- Reset link restores defaults
- ESC key and backdrop click close modal
- Dark mode styling applied
- No ESLint errors
  </done>
</task>

</tasks>

<verification>
1. ColumnSettingsModal.jsx exists at src/pages/People/
2. Component imports dnd-kit correctly (DndContext, SortableContext, useSortable)
3. Component imports useListPreferences hook
4. No ESLint errors
5. npm run build succeeds
</verification>

<success_criteria>
- Modal component created with drag-and-drop and checkbox functionality
- Follows existing UI patterns (modal structure, dark mode)
- Uses dnd-kit for professional drag-drop UX
- Changes apply instantly via useListPreferences hook
- Name column excluded from reordering (always first)
</success_criteria>

<output>
After completion, create `.planning/phases/115-column-preferences-ui/115-02-SUMMARY.md`
</output>
