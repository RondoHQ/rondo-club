---
phase: 115-column-preferences-ui
plan: 04
type: execute
wave: 3
depends_on: ["115-01", "115-02", "115-03"]
files_modified:
  - src/pages/People/PeopleList.jsx
autonomous: false

must_haves:
  truths:
    - "Table renders only visible columns in user's preferred order"
    - "Columns have user-defined widths from preferences"
    - "Column dividers can be dragged to resize"
    - "Gear icon in header opens column settings modal"
    - "Name column is sticky during horizontal scroll"
    - "Column preferences sync between tabs"
  artifacts:
    - path: "src/pages/People/PeopleList.jsx"
      provides: "Integrated People list with column preferences"
  key_links:
    - from: "src/pages/People/PeopleList.jsx"
      to: "useListPreferences"
      via: "import and use"
      pattern: "useListPreferences"
    - from: "src/pages/People/PeopleList.jsx"
      to: "ColumnSettingsModal"
      via: "import and render"
      pattern: "ColumnSettingsModal"
    - from: "src/pages/People/PeopleList.jsx"
      to: "useColumnResize"
      via: "import and use in headers"
      pattern: "useColumnResize"
---

<objective>
Integrate column preferences, settings modal, and resize functionality into PeopleList.

Purpose: The People list needs to render columns based on user preferences, allow column width resizing, and provide access to the settings modal via a gear icon. This plan wires everything together.

Output: Fully functional People list with column customization
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/115-column-preferences-ui/115-CONTEXT.md
@.planning/phases/115-column-preferences-ui/115-RESEARCH.md
@.planning/phases/115-column-preferences-ui/115-01-SUMMARY.md
@.planning/phases/115-column-preferences-ui/115-02-SUMMARY.md
@.planning/phases/115-column-preferences-ui/115-03-SUMMARY.md
@src/pages/People/PeopleList.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate column preferences into PeopleList</name>
  <files>src/pages/People/PeopleList.jsx</files>
  <action>
Update PeopleList.jsx to use column preferences for rendering the table.

1. **Add imports:**
   ```javascript
   import { Settings } from 'lucide-react';
   import { useListPreferences } from '@/hooks/useListPreferences';
   import { useColumnResize } from '@/hooks/useColumnResize';
   import ColumnSettingsModal from './ColumnSettingsModal';
   ```

2. **Add state for settings modal:**
   ```javascript
   const [showColumnSettings, setShowColumnSettings] = useState(false);
   ```

3. **Use preferences hook:**
   ```javascript
   const { preferences, updatePreferences, isLoading: prefsLoading } = useListPreferences();
   ```

4. **Replace listViewFields logic:**
   Replace the current customFields filtering (show_in_list_view) with preferences-based column rendering:

   - Get visibleColumns from preferences.visible_columns
   - Get columnOrder from preferences.column_order or preferences.available_columns
   - Get columnWidths from preferences.column_widths
   - Filter customFields to those in visibleColumns
   - Order columns according to columnOrder

5. **Add gear icon to table header:**
   Add a gear icon button next to the existing filter button that opens the column settings modal:
   ```jsx
   <button
     onClick={() => setShowColumnSettings(true)}
     className="btn-secondary"
     title="Kolommen aanpassen"
   >
     <Settings className="w-4 h-4" />
   </button>
   ```

6. **Update PersonListView component:**
   - Pass columnWidths to header cells
   - Add width style to th and td elements
   - Make header cells resizable (add resize handles)

7. **Create ResizableHeader inline or as subcomponent:**
   - Use useColumnResize hook for each column
   - Add resize handle div on right edge of header
   - Debounce and batch width changes to updatePreferences

8. **Add sticky name column CSS:**
   Add Tailwind classes or inline styles for name column:
   - position: sticky, left: 0, z-index: 2
   - Background color to prevent transparency
   - Apply to both th and td for name column

9. **Handle width persistence:**
   - Create a debounced function to save widths
   - On resize end, batch all column widths into single PATCH call
   - Use useRef to track pending width updates

10. **Render ColumnSettingsModal:**
    ```jsx
    <ColumnSettingsModal
      isOpen={showColumnSettings}
      onClose={() => setShowColumnSettings(false)}
    />
    ```

11. **Tab sync (optional, via query invalidation):**
    TanStack Query will refetch on window focus, providing basic tab sync.

Key changes to PersonListRow and PersonListView:
- Dynamic columns based on preferences
- Name column is always first (hardcoded, not from preferences)
- Custom field columns filtered by visible_columns
- Column widths applied via style prop
  </action>
  <verify>
After npm run build and bin/deploy.sh:
1. Open People list in browser
2. Verify gear icon appears in header
3. Click gear icon - settings modal opens
4. Toggle column visibility - columns appear/disappear
5. Drag columns to reorder - order changes
6. Resize columns by dragging dividers - widths change
7. Refresh page - preferences persist
8. Open in second tab - preferences sync on focus
  </verify>
  <done>
- PeopleList uses useListPreferences for column configuration
- Gear icon opens ColumnSettingsModal
- Table renders visible columns in user's preferred order
- Column widths from preferences applied to cells
- Column resize via drag on dividers
- Width changes persisted to server (debounced)
- Name column sticky during horizontal scroll
- Build and deploy successful
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete column preferences UI integration in People list:
- Gear icon opens settings modal
- Column show/hide via checkboxes
- Column reorder via drag-and-drop
- Column resize via dragging dividers
- Preferences persist across sessions
  </what-built>
  <how-to-verify>
1. Go to production URL and navigate to Leden (People) page
2. Verify gear icon (cog) appears in table header area
3. Click gear icon - "Kolommen aanpassen" modal should open
4. In modal:
   a. Toggle checkbox for "Team" - column should appear/disappear in table
   b. Drag "Labels" above "Team" - order should change in table
   c. Click "Standaardinstellingen herstellen" - defaults should restore
   d. Press ESC or click outside - modal should close
5. On table:
   a. Hover between column headers - resize cursor should appear
   b. Drag column divider - column width should change
   c. Scroll table horizontally - name column should stay fixed (sticky)
6. Refresh page - all preferences should persist
7. Open second browser tab - preferences should be same
  </how-to-verify>
  <resume-signal>Type "approved" if all column customization features work correctly, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. Gear icon visible in People list header
2. Click opens ColumnSettingsModal
3. Checkbox toggles column visibility
4. Drag-drop reorders columns
5. Column resize works via divider drag
6. Widths persist after page refresh
7. Name column stays sticky on horizontal scroll
8. No console errors
9. Build succeeds
</verification>

<success_criteria>
- Complete integration of column preferences in People list
- All CONTEXT.md requirements implemented:
  - Gear icon access to settings modal
  - Checkbox visibility controls
  - Drag-and-drop reordering in modal
  - Column resize by dragging dividers
  - Name column always first and sticky
  - Preferences persist per user
- Verified working in production
</success_criteria>

<output>
After completion, create `.planning/phases/115-column-preferences-ui/115-04-SUMMARY.md`
</output>
