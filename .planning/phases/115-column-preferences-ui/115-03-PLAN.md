---
phase: 115-column-preferences-ui
plan: 03
type: execute
wave: 2
depends_on: ["115-01"]
files_modified:
  - src/hooks/useColumnResize.js
autonomous: true

must_haves:
  truths:
    - "Column resize via pointer events on dividers"
    - "Minimum width constraint (~50px) prevents columns from disappearing"
    - "Width updates are batched and persisted"
  artifacts:
    - path: "src/hooks/useColumnResize.js"
      provides: "Hook for column resize event handling"
      exports: ["useColumnResize"]
  key_links:
    - from: "src/hooks/useColumnResize.js"
      to: "useListPreferences"
      via: "width persistence callback"
      pattern: "onWidthChange"
---

<objective>
Create the column resize hook for handling drag-to-resize interactions on table columns.

Purpose: Users need to resize columns by dragging dividers between column headers. This hook encapsulates the pointer event handling, minimum width constraints, and width state management.

Output: useColumnResize.js hook
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/115-column-preferences-ui/115-CONTEXT.md
@.planning/phases/115-column-preferences-ui/115-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useColumnResize hook</name>
  <files>src/hooks/useColumnResize.js</files>
  <action>
Create the column resize hook at src/hooks/useColumnResize.js following the pattern from RESEARCH.md.

Hook signature:
```javascript
useColumnResize(columnId, initialWidth = 150, minWidth = 50)
```

Returns:
```javascript
{
  width: number,           // Current width in pixels
  isResizing: boolean,     // True while dragging
  resizeHandlers: {        // Attach to resize handle element
    onPointerDown,
    onPointerMove,
    onPointerUp,
    onPointerCancel,
  }
}
```

Implementation details:

1. **State management:**
   - useState for width (initialized from initialWidth)
   - useState for isResizing (false initially)
   - useRef for startX (pointer position at drag start)
   - useRef for startWidth (width at drag start)

2. **Event handlers (memoized with useCallback):**

   onPointerDown:
   - e.preventDefault() and e.stopPropagation()
   - Set isResizing to true
   - Store startX (e.clientX) and startWidth (current width) in refs
   - Call e.currentTarget.setPointerCapture(e.pointerId) for smooth dragging

   onPointerMove:
   - Early return if not isResizing
   - Calculate delta = e.clientX - startX
   - Calculate newWidth = Math.max(minWidth, startWidth + delta)
   - Set width to newWidth

   onPointerUp:
   - Early return if not isResizing
   - Set isResizing to false
   - Call e.currentTarget.releasePointerCapture(e.pointerId)

   onPointerCancel:
   - Same as onPointerUp (handle edge cases)

3. **CSS requirements for resize handle:**
   - style={{ touchAction: 'none' }} to prevent browser touch gestures
   - cursor: col-resize on hover
   - Position absolute on right edge of header cell

4. **Dependency arrays:**
   - onPointerDown depends on [width]
   - onPointerMove depends on [isResizing, minWidth]
   - onPointerUp depends on [isResizing]

Note: This hook only handles the resize interaction. The parent component (ResizableHeader or PeopleList) is responsible for persisting widths via useListPreferences.
  </action>
  <verify>
1. File exists at src/hooks/useColumnResize.js
2. No ESLint errors: npm run lint -- src/hooks/useColumnResize.js
3. Hook exports correctly (named export useColumnResize)
4. Build succeeds: npm run build
  </verify>
  <done>
- useColumnResize hook created at src/hooks/useColumnResize.js
- Hook returns width, isResizing, and resizeHandlers
- Pointer events captured for smooth dragging
- Minimum width constraint enforced
- No ESLint errors
  </done>
</task>

</tasks>

<verification>
1. useColumnResize.js exists at src/hooks/
2. Hook exports useColumnResize function
3. Returns width, isResizing, resizeHandlers
4. minWidth constraint enforced (Math.max)
5. Uses pointer capture for smooth dragging
6. No ESLint errors
7. npm run build succeeds
</verification>

<success_criteria>
- Hook handles pointer events for column resize
- Width constrained to minimum 50px
- Pointer capture ensures smooth dragging
- Ready for integration into ResizableHeader or PeopleList
</success_criteria>

<output>
After completion, create `.planning/phases/115-column-preferences-ui/115-03-SUMMARY.md`
</output>
