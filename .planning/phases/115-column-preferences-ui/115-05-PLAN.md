---
phase: 115-column-preferences-ui
plan: 05
type: execute
wave: 3
depends_on: ["115-01"]
files_modified:
  - src/components/FieldFormPanel.jsx
  - includes/REST/class-custom-fields.php
autonomous: true

must_haves:
  truths:
    - "show_in_list_view checkbox removed from custom field form"
    - "list_view_order input removed from custom field form"
    - "Backend validation no longer requires show_in_list_view"
  artifacts:
    - path: "src/components/FieldFormPanel.jsx"
      provides: "Custom field form without list view settings"
    - path: "includes/REST/class-custom-fields.php"
      provides: "Backend without show_in_list_view validation"
  key_links: []
---

<objective>
Remove the "Tonen als kolom in lijstweergave" (show in list view) setting from custom field configuration.

Purpose: Per COL-07, column visibility is now controlled per-user via the column preferences system, not globally per-field. The old show_in_list_view checkbox and list_view_order input in Settings > Custom Fields are obsolete and should be removed.

Output: Clean custom field form without list view settings
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/115-column-preferences-ui/115-CONTEXT.md
@src/components/FieldFormPanel.jsx
@includes/REST/class-custom-fields.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove show_in_list_view from FieldFormPanel</name>
  <files>src/components/FieldFormPanel.jsx</files>
  <action>
Remove the list view settings from the custom field form:

1. **Remove from getDefaultFormData():**
   Delete these lines from the default form data object:
   ```javascript
   // List view options
   show_in_list_view: false,
   list_view_order: 999,
   ```

2. **Remove from form field loading (useEffect):**
   Delete these lines from the field data mapping:
   ```javascript
   // List view options
   show_in_list_view: field.show_in_list_view ?? false,
   list_view_order: field.list_view_order ?? 999,
   ```

3. **Remove from handleSubmit:**
   Delete these lines from submitData construction:
   ```javascript
   // List view settings
   submitData.show_in_list_view = formData.show_in_list_view;
   if (formData.show_in_list_view) {
     submitData.list_view_order = Number(formData.list_view_order) || 999;
   }
   ```

4. **Remove the Display Options section from render:**
   Delete the entire "Weergave opties" (Display Options) section:
   ```jsx
   {/* Display Options */}
   <div className="pt-4 border-t border-gray-200 dark:border-gray-700">
     <h4 className="text-sm font-medium text-gray-600 dark:text-gray-400 mb-3">Weergave opties</h4>
     <div className="space-y-3">
       <div className="flex items-center gap-2">
         <input
           id="show_in_list_view"
           ...
         />
         <label htmlFor="show_in_list_view" ...>
           Tonen als kolom in lijstweergave
         </label>
       </div>
       {formData.show_in_list_view && (
         <div>
           <label htmlFor="list_view_order" ...>
             Kolomvolgorde
           </label>
           ...
         </div>
       )}
     </div>
   </div>
   ```

The Validation Options section should remain (required, unique fields).
  </action>
  <verify>
1. No ESLint errors: npm run lint -- src/components/FieldFormPanel.jsx
2. Search for "show_in_list_view" in file - should return 0 results
3. Search for "list_view_order" in file - should return 0 results
4. Search for "Weergave opties" in file - should return 0 results
5. npm run build succeeds
  </verify>
  <done>
- show_in_list_view removed from default form data
- show_in_list_view removed from field loading
- show_in_list_view removed from form submission
- "Weergave opties" section removed from form UI
- list_view_order completely removed
- No ESLint errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Clean up backend validation (if needed)</name>
  <files>includes/REST/class-custom-fields.php</files>
  <action>
Check if show_in_list_view is validated in the backend and remove if found.

1. Search class-custom-fields.php for 'show_in_list_view'
2. If found in validation schema or field processing, remove it
3. If not found, no changes needed (ACF stores it but we don't validate it)

Note: Existing custom fields will retain their show_in_list_view values in ACF storage. This is harmless - the frontend now ignores this property and uses user preferences instead. No data migration needed.

If the field is in validation:
- Remove from create_field() validation
- Remove from update_field() validation
- Remove from any response formatting

Keep backwards compatibility: if show_in_list_view is sent in requests, silently ignore it (don't reject with error).
  </action>
  <verify>
After npm run build and bin/deploy.sh:
1. Go to Settings > Custom Fields (Aangepaste velden)
2. Click "Add field" (Veld toevoegen)
3. Verify NO "Tonen als kolom in lijstweergave" checkbox appears
4. Create a test field - should save successfully
5. Edit existing field - should load without "Weergave opties" section
  </verify>
  <done>
- Backend validation cleaned up (if show_in_list_view was validated)
- Old requests with show_in_list_view don't fail (backwards compat)
- Frontend form no longer shows list view options
- Custom field creation/editing still works
  </done>
</task>

</tasks>

<verification>
1. FieldFormPanel.jsx has no references to show_in_list_view
2. FieldFormPanel.jsx has no references to list_view_order
3. Custom field form UI has no "Weergave opties" section
4. Creating custom fields still works
5. Editing custom fields still works
6. No ESLint errors
7. npm run build succeeds
</verification>

<success_criteria>
- COL-07 implemented: "Tonen als kolom in lijstweergave" removed from custom field settings
- Custom field CRUD operations still function correctly
- No breaking changes to existing custom fields
- Clean UI without obsolete options
</success_criteria>

<output>
After completion, create `.planning/phases/115-column-preferences-ui/115-05-SUMMARY.md`
</output>
