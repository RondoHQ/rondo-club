---
phase: 109-mobile-ux
plan: 02
type: execute
wave: 2
depends_on: ["109-01"]
files_modified:
  - src/pages/People/PeopleList.jsx
  - src/pages/Teams/TeamsList.jsx
  - src/pages/Commissies/CommissiesList.jsx
  - src/pages/Dates/DatesList.jsx
  - src/pages/Todos/TodosList.jsx
  - src/pages/Feedback/FeedbackList.jsx
  - src/pages/People/PersonDetail.jsx
  - src/pages/Teams/TeamDetail.jsx
  - src/pages/Commissies/CommissieDetail.jsx
  - src/pages/Dashboard.jsx
autonomous: true

must_haves:
  truths:
    - "User can pull-to-refresh on People list to reload contacts"
    - "User can pull-to-refresh on Teams list to reload teams"
    - "User can pull-to-refresh on all other list views"
    - "User can pull-to-refresh on detail views to reload entity data"
    - "User can pull-to-refresh on Dashboard to reload all widgets"
    - "Pull gesture feels responsive with proper visual feedback"
  artifacts:
    - path: "src/pages/People/PeopleList.jsx"
      provides: "Pull-to-refresh on people list"
      contains: "PullToRefreshWrapper"
    - path: "src/pages/Teams/TeamsList.jsx"
      provides: "Pull-to-refresh on teams list"
      contains: "PullToRefreshWrapper"
    - path: "src/pages/Dashboard.jsx"
      provides: "Pull-to-refresh on dashboard"
      contains: "PullToRefreshWrapper"
  key_links:
    - from: "src/pages/People/PeopleList.jsx"
      to: "src/components/PullToRefreshWrapper.jsx"
      via: "import and wrap content"
      pattern: "import PullToRefreshWrapper"
    - from: "src/pages/People/PeopleList.jsx"
      to: "@tanstack/react-query"
      via: "invalidateQueries on refresh"
      pattern: "invalidateQueries.*queryKey"
---

<objective>
Integrate pull-to-refresh into all list views, detail views, and Dashboard

Purpose: Enable users to refresh data by pulling down on mobile devices, creating a native-like experience. Each view invalidates its relevant TanStack Query cache to trigger background refetch.

Output: All list views, detail views, and Dashboard wrapped with PullToRefreshWrapper and wired to invalidate appropriate queries.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/109-mobile-ux/109-RESEARCH.md

@src/components/PullToRefreshWrapper.jsx
@src/hooks/usePeople.js
@src/hooks/useDashboard.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pull-to-refresh to list views</name>
  <files>
    src/pages/People/PeopleList.jsx
    src/pages/Teams/TeamsList.jsx
    src/pages/Commissies/CommissiesList.jsx
    src/pages/Dates/DatesList.jsx
    src/pages/Todos/TodosList.jsx
    src/pages/Feedback/FeedbackList.jsx
  </files>
  <action>
For each list view file, follow this pattern:

1. Add imports at top:
   ```jsx
   import { useQueryClient } from '@tanstack/react-query';
   import PullToRefreshWrapper from '@/components/PullToRefreshWrapper';
   ```

2. Inside the component, get queryClient:
   ```jsx
   const queryClient = useQueryClient();
   ```

3. Create refresh handler that returns a Promise:
   ```jsx
   const handleRefresh = async () => {
     await queryClient.invalidateQueries({ queryKey: ['QUERY_KEY'] });
   };
   ```

4. Wrap the main content (everything returned by the component) with PullToRefreshWrapper:
   ```jsx
   return (
     <PullToRefreshWrapper onRefresh={handleRefresh}>
       {/* existing content */}
     </PullToRefreshWrapper>
   );
   ```

**Query keys for each view:**
- PeopleList.jsx: `['people', 'list']` (matches peopleKeys.lists())
- TeamsList.jsx: `['teams']`
- CommissiesList.jsx: `['commissies']`
- DatesList.jsx: `['reminders']` (dates use reminders endpoint)
- TodosList.jsx: `['todos']`
- FeedbackList.jsx: `['feedback']`

**Important:**
- The `onRefresh` must return the Promise from `invalidateQueries()` - this ensures the spinner stops when data loads
- Do NOT add useQueryClient if already imported (check each file first)
- Wrap the outermost container/fragment that is returned
  </action>
  <verify>
    - `npm run build` completes without errors
    - Each list file imports PullToRefreshWrapper
    - Each list file has a handleRefresh function calling invalidateQueries
    - Each list file wraps content with PullToRefreshWrapper
  </verify>
  <done>
    - All 6 list views have pull-to-refresh functionality
    - Each view invalidates appropriate query key on refresh
  </done>
</task>

<task type="auto">
  <name>Task 2: Add pull-to-refresh to detail views and Dashboard</name>
  <files>
    src/pages/People/PersonDetail.jsx
    src/pages/Teams/TeamDetail.jsx
    src/pages/Commissies/CommissieDetail.jsx
    src/pages/Dashboard.jsx
  </files>
  <action>
For each detail view and Dashboard, follow this pattern:

1. Add imports at top:
   ```jsx
   import { useQueryClient } from '@tanstack/react-query';
   import PullToRefreshWrapper from '@/components/PullToRefreshWrapper';
   ```

2. Inside the component, get queryClient:
   ```jsx
   const queryClient = useQueryClient();
   ```

3. Create refresh handler:

**For PersonDetail.jsx** (uses id from route params):
```jsx
const handleRefresh = async () => {
  await Promise.all([
    queryClient.invalidateQueries({ queryKey: ['people', 'detail', id] }),
    queryClient.invalidateQueries({ queryKey: ['people', id, 'timeline'] }),
  ]);
};
```

**For TeamDetail.jsx** (uses id from route params):
```jsx
const handleRefresh = async () => {
  await queryClient.invalidateQueries({ queryKey: ['teams', parseInt(id, 10)] });
};
```

**For CommissieDetail.jsx** (uses id from route params):
```jsx
const handleRefresh = async () => {
  await queryClient.invalidateQueries({ queryKey: ['commissies', parseInt(id, 10)] });
};
```

**For Dashboard.jsx:**
```jsx
const handleRefresh = async () => {
  await Promise.all([
    queryClient.invalidateQueries({ queryKey: ['dashboard'] }),
    queryClient.invalidateQueries({ queryKey: ['reminders'] }),
    queryClient.invalidateQueries({ queryKey: ['todos'] }),
  ]);
};
```

4. Wrap the main content with PullToRefreshWrapper:
   ```jsx
   return (
     <PullToRefreshWrapper onRefresh={handleRefresh}>
       {/* existing content */}
     </PullToRefreshWrapper>
   );
   ```

**Important:**
- Detail views get `id` from `useParams()` - check if already imported from react-router-dom
- Dashboard may need to invalidate multiple queries to refresh all widgets
- Ensure the wrapper is around the outermost container
  </action>
  <verify>
    - `npm run build` completes without errors
    - PersonDetail, TeamDetail, CommissieDetail import and use PullToRefreshWrapper
    - Dashboard imports and uses PullToRefreshWrapper
    - Each file has appropriate handleRefresh function
  </verify>
  <done>
    - All 3 detail views have pull-to-refresh functionality
    - Dashboard has pull-to-refresh that refreshes all widgets
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `npm run build` - should complete without errors
2. Verify all 10 files import PullToRefreshWrapper
3. Verify all files have handleRefresh functions with correct query keys
4. Verify all files wrap content with PullToRefreshWrapper
</verification>

<success_criteria>
- All list views (6 files) have pull-to-refresh
- All detail views (3 files) have pull-to-refresh
- Dashboard has pull-to-refresh
- Each view invalidates appropriate TanStack Query cache
- Build completes successfully
</success_criteria>

<output>
After completion, create `.planning/phases/109-mobile-ux/109-02-SUMMARY.md`
</output>
