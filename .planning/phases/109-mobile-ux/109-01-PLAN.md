---
phase: 109-mobile-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/components/PullToRefreshWrapper.jsx
  - src/components/layout/Layout.jsx
  - src/index.css
autonomous: true

must_haves:
  truths:
    - "PullToRefreshWrapper component exists and can wrap content"
    - "iOS standalone mode does not bounce/reload on overscroll at boundaries"
    - "Build completes without errors after library installation"
  artifacts:
    - path: "src/components/PullToRefreshWrapper.jsx"
      provides: "Reusable pull-to-refresh wrapper with Stadion styling"
      exports: ["default"]
      min_lines: 30
    - path: "src/index.css"
      provides: "Overscroll prevention CSS rules"
      contains: "overscroll-behavior"
  key_links:
    - from: "src/components/PullToRefreshWrapper.jsx"
      to: "react-simple-pull-to-refresh"
      via: "import PullToRefresh"
      pattern: "from 'react-simple-pull-to-refresh'"
---

<objective>
Set up pull-to-refresh infrastructure and iOS overscroll prevention

Purpose: Create the foundation for native-like mobile gestures - the PullToRefreshWrapper component that views will use, plus CSS to prevent iOS bounce/reload behavior in standalone PWA mode.

Output: Installed library, reusable wrapper component, overscroll prevention CSS applied globally.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/109-mobile-ux/109-RESEARCH.md

@src/components/layout/Layout.jsx
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-simple-pull-to-refresh and create wrapper component</name>
  <files>
    package.json
    package-lock.json
    src/components/PullToRefreshWrapper.jsx
  </files>
  <action>
1. Install the library:
   ```bash
   npm install react-simple-pull-to-refresh
   ```

2. Create `src/components/PullToRefreshWrapper.jsx` with:
   - Import PullToRefresh from 'react-simple-pull-to-refresh'
   - Props: `onRefresh` (async function returning Promise), `isPullable` (boolean, default true), `children`
   - `refreshingContent`: Stadion-style spinner matching existing patterns:
     ```jsx
     <div className="flex justify-center py-4">
       <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-accent-600 dark:border-accent-400" />
     </div>
     ```
   - `pullingContent`: Subtle down arrow indicator:
     ```jsx
     <div className="flex justify-center py-4 text-gray-400 dark:text-gray-500">
       <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
         <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 14l-7 7m0 0l-7-7m7 7V3" />
       </svg>
     </div>
     ```
   - Configuration props:
     - `pullDownThreshold={67}` (trigger threshold in px)
     - `maxPullDownDistance={95}` (max pull distance)
     - `resistance={1}` (no resistance for native feel)
   - Add `className="min-h-full"` for proper sizing

3. Export as default export.

Reference the RESEARCH.md Pattern 1 and Complete PullToRefreshWrapper example for exact implementation.
  </action>
  <verify>
    - `npm run build` completes without errors
    - `src/components/PullToRefreshWrapper.jsx` exists
    - File imports from 'react-simple-pull-to-refresh'
  </verify>
  <done>
    - react-simple-pull-to-refresh installed in package.json
    - PullToRefreshWrapper component created with Stadion styling
    - Build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Add overscroll prevention CSS</name>
  <files>
    src/index.css
    src/components/layout/Layout.jsx
  </files>
  <action>
1. Add to `src/index.css` (in base styles section, after existing @tailwind directives):
   ```css
   /* Prevent iOS standalone mode bounce/reload on overscroll */
   @supports (overscroll-behavior-y: none) {
     /* Apply to html/body for full coverage */
     html, body {
       overscroll-behavior-y: none;
     }
   }
   ```

2. In `src/components/layout/Layout.jsx`, update the `<main>` element (around line 748) to add Tailwind arbitrary property for overscroll:
   - Current: `<main className="flex-1 overflow-y-auto p-4 lg:p-6">`
   - Change to: `<main className="flex-1 overflow-y-auto p-4 lg:p-6 [overscroll-behavior-y:none]">`

   This double-application (CSS + inline) ensures coverage on the scroll container itself.

Do NOT use `-webkit-overflow-scrolling: touch` as it doesn't prevent bounce.
Do NOT use `overscroll-behavior: contain` as it still allows visual rubberbanding.
  </action>
  <verify>
    - `npm run build` completes without errors
    - `src/index.css` contains `overscroll-behavior-y: none`
    - `src/components/layout/Layout.jsx` main element has `[overscroll-behavior-y:none]`
  </verify>
  <done>
    - CSS prevents iOS overscroll bounce at page boundaries
    - Main content area has inline overscroll prevention
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Run `npm run build` - should complete without errors
2. Verify PullToRefreshWrapper.jsx exists and exports default
3. Verify index.css has overscroll-behavior rules
4. Verify Layout.jsx main element has overscroll class
</verification>

<success_criteria>
- react-simple-pull-to-refresh is installed (in package.json dependencies)
- PullToRefreshWrapper component exists with proper props and styling
- Overscroll prevention CSS applied to html/body and main element
- Build completes successfully
</success_criteria>

<output>
After completion, create `.planning/phases/109-mobile-ux/109-01-SUMMARY.md`
</output>
